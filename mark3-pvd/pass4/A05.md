# Pass 4 Agent A05 — Code Quality

**Audit run:** 2026-02-28-01
**Branch:** master
**Assigned files:**
- `app/globalconfigs.h`
- `app/globalconfigs.cpp`
- `app/globalconfigsfilemanager.h` / `.cpp` — **FILE NOT FOUND** (confirmed absent, see Finding A05-1)

---

## 1. Reading Evidence

### 1.1 `app/globalconfigs.h`

**Class:** `GlobalConfigs` (inherits `QObject`, decorated with `Q_OBJECT`)

**Macro defined in this file:**
| Macro | Line | Value |
|---|---|---|
| `gCfg` | 13 | `GlobalConfigs::instance()` |

**Public methods / inline accessors (all defined in the header):**

| Method | Line |
|---|---|
| `explicit GlobalConfigs(QObject *parent = nullptr)` | 20 |
| `static GlobalConfigs *instance()` | 21 |
| `static quint32 crc32(const void *buf, int len)` | 22 |
| `void readConfigs()` | 24 |
| `void saveConfigs()` | 25 |
| `void saveOpdDriverList()` | 26 |
| `void resetConfigs(bool resetAll = false)` | 27 |
| `quint32 keepAliveTime() const` | 30 |
| `bool setKeepAliveTime(quint32 time)` | 31 |
| `quint32 shutdownTime() const` | 40 |
| `bool setShutdownTime(quint32 time)` | 41 |
| `QByteArray gmtpId() const` | 50 |
| `bool setGmtpId(const QByteArray &id)` | 51 |
| `CIGCONF::MaintLockedCode maintCode() const` | 60 |
| `quint64 maintDriverId() const` | 61 |
| `quint32 maintTimestamp() const` | 62 |
| `bool setMaintCode(CIGCONF::MaintLockedCode code)` | 64 |
| `quint64 unlockId() const` | 81 |
| `bool setUnlockId(quint64 id)` | 82 |
| `QByteArray dialNumber() const` | 87 |
| `bool setDialNumber(const QByteArray &number)` | 88 |
| `QByteArray apn() const` | 97 |
| `bool setApn(const QByteArray &apn)` | 98 |
| `QByteArray apnUser() const` | 107 |
| `bool setApnUser(const QByteArray &user)` | 108 |
| `QByteArray apnPassword() const` | 117 |
| `bool setApnPassword(const QByteArray &password)` | 118 |
| `QByteArray gmtpServerAddress(int index) const` | 127 |
| `bool setGmtpServerAddress(int index, const QByteArray &addr)` | 128 |
| `quint16 gmtpServerPort(int index) const` | 137 |
| `bool setGmtpServerPort(int index, quint16 port)` | 138 |
| `quint64 expansionModMac() const` | 147 |
| `bool setExpansionModMac(quint64 mac)` | 148 |
| `void resetSimCardID()` | 157 |
| `QByteArray getSimCardID() const` | 158 |
| `bool setSimCardID(const QByteArray &iccid)` | 159 |
| `QList<CIGCONF::DriverId> driverIds() const` | 168 |
| `QList<CIGCONF::MasterId> masterIds() const` | 169 |
| `QList<quint64> superIds() const` | 170 |
| `QList<CIGCONF::DriverId> techIds() const` | 171 |
| `QList<CIGCONF::PreopDriverId> preopDriverIds() const` | 172 |
| `CIGCONF::DriverId driverId(int index) const` | 174 |
| `CIGCONF::MasterId masterId(int index) const` | 175 |
| `CIGCONF::MasterId masterIdById(quint64 id) const` | 176 |
| `quint64 superId(int index) const` | 177 |
| `CIGCONF::DriverId techId(int index) const` | 178 |
| `bool setDriverId(int index, quint64 id, QString name)` | 180 |
| `bool setMasterId(int index, quint64 id, quint8 option, QString name)` | 181 |
| `bool setSuperId(int index, quint64 id)` | 182 |
| `bool setTechId(int index, quint64 id, QString name)` | 183 |
| `bool containsDriverId(quint64 id) const` | 185 |
| `bool containsMasterId(quint64 id, quint8 permissions=0) const` | 186 |
| `bool containsSuperId(quint64 id) const` | 187 |
| `bool containsTechId(quint64 id) const` | 188 |
| `bool addDriverId(quint64 id, QString name)` | 190 |
| `bool addSuperId(quint64 id)` | 191 |
| `bool addTechId(quint64 id, QString name)` | 192 |
| `bool addPreopDriverId(quint64 id, quint32 timestamp)` | 193 |
| `bool removeDriverId(quint64 id)` | 195 |
| `bool removeMasterId(quint64 id)` | 196 |
| `bool removeSuperId(quint64 id)` | 197 |
| `bool removeTechId(quint64 id)` | 198 |
| `void clearDriverIds()` | 200 |
| `void clearMasterIds()` | 201 |
| `void clearSuperIds()` | 202 |
| `void clearTechIds()` | 203 |
| `void clearPreopDriverIds()` | 204 |
| `int getMasterIdIndex(quint64 id)` | 206 |
| `int getDriverIdIndex(quint64 id)` | 207 |
| `int getTechIdIndex(quint64 id)` | 208 |
| `int getPreopDriverIdIndex(quint64 id)` | 209 |
| `CIGCONF::PreopDriverId getPreopDriverId(quint64 id)` | 210 |
| `bool preopOncePerDayEn() const` | 212 |
| `bool setPreopOncePerDayEn(bool en)` | 213 |
| `QString getDriverName(quint64 id)` | 220 |
| `bool superIsEmpty()` | 233 |
| `quint8 digitalInputMode1() const` | 235 |
| `quint8 digitalInputMode2() const` | 236 |
| `quint8 digitalInputMode3() const` | 237 |
| `quint8 digitalInputMode4() const` | 238 |
| `void setDigInputMode(quint8, quint8, quint8, quint8)` | 240 |
| `quint32 seenDebounceTime() const` | 248 |
| `quint32 seenHoldTime() const` | 249 |
| `bool setSeenParam(quint32 debounce, quint32 hTime)` | 250 |
| `quint8 convorStatus() const` | 257 |
| `quint64 convorId() const` | 258 |
| `bool setConvor(quint8 convor, quint64 id)` | 259 |
| `quint8 fullLockoutEnable() const` | 270 |
| `bool setFullLockoutEnable(quint8 lockOutEnable)` | 271 |
| `quint32 fullLockoutTimeout() const` | 277 |
| `bool setFullLockoutTimeout(quint32 lockOutTimeout)` | 278 |
| `quint8 unlkScr() const` | 284 |
| `bool setUnlkScr(quint8 scr)` | 285 |
| `quint8 scrSavMode() const` | 294 |
| `bool setScrSavMode(quint8 mode)` | 295 |
| `quint16 checkTimeSlot(int index) const` | 304 |
| `bool setCheckTimeSlot(int index, quint16 hm)` | 305 |
| `quint16 checklistTimeout() const` | 314 |
| `bool setChecklistTimeout(quint16 time)` | 315 |
| `quint64 lastTimeServerUpdate() const` | 324 |
| `bool setLastTimeServerUpdate(quint64 ts)` | 325 |
| `qint64 timeError() const` | 330 |
| `bool setTimeError(qint64 ts)` | 331 |
| `quint32 lastPreopOncePerDayTimestamp() const` | 336 |
| `bool setlastPreopOncePerDayTimestamp(quint32 ts)` | 337 |
| `quint32 lastCheckTimestamp() const` | 344 |
| `bool setLastCheckTimestamp(quint32 ts)` | 345 |
| `quint64 lastCheckDriverId() const` | 352 |
| `bool setLastCheck(quint64 id, quint32 ts)` | 353 |
| `void clearChecklist()` | 361 |
| `Checklist::CheckItem checkItem(int index, bool query = false)` | 362 |
| `bool setCheckItem(int index, const Checklist::CheckItem item)` | 363 |
| `int nextValidCheckItemIndex(int start = 0, bool queryOrigList = false)` | 367 |
| `void shuffleChecklist()` | 374 |
| `quint8 preopRandom() const` | 375 |
| `bool setPreopRandom(quint8 isRandom)` | 376 |
| `quint32 shockThreshold() const` | 382 |
| `bool setShockThreshold(quint32 data)` | 383 |
| `quint32 shockRedImpact() const` | 389 |
| `bool setShockRedImpact(quint32 data)` | 390 |
| `quint32 shockPeriod() const` | 396 |
| `bool setShockPeriod(quint32 data)` | 397 |
| `quint32 shockTimer() const` | 403 |
| `bool setShockTimer(quint32 data)` | 404 |
| `qint16 timeZoneInMinutes() const` | 410 |
| `bool setTimeZoneInMinutes(qint16 zone)` | 411 |
| `QByteArray timeServerAddress() const` | 419 |
| `bool setTimeServerAddress(const QByteArray &addr)` | 420 |
| `quint32 gpsUpdateTime() const` | 429 |
| `bool setGpsUpdateTime(quint32 time)` | 430 |
| `qint16 gpsDistanceMark() const` | 439 |
| `bool setGpsDistanceMark(qint16 mark)` | 440 |
| `quint16 satNum() const` | 449 |
| `bool setSatNum(quint16 n)` | 450 |
| `quint16 idleTimeout() const` | 459 |
| `bool setIdleTimeout(quint16 time)` | 460 |
| `quint16 getGmtpWaitTimeout() const` | 466 |
| `bool setGmtpWaitTimeout(quint16 time)` | 467 |
| `bool idleInputPolarity() const` | 473 |
| `bool setIdleInputPolarity(bool high)` | 474 |
| `quint8 idleInputSource() const` | 480 |
| `bool setIdleInputSource(quint8 src)` | 481 |
| `CIGCONF::polygonStruct polygon(int n) const` | 490 |
| `quint8 polygonNPoints(int n) const` | 492 |
| `bool setPolygonNPoints(int n, quint8 vect)` | 493 |
| `quint32 polygonLatitude(int n, int vect) const` | 502 |
| `bool setPolygonLatitude(int n, int vect, quint32 lat)` | 503 |
| `quint32 polygonLongitude(int n, int vect) const` | 512 |
| `bool setPolygonLongitude(int n, int vect, quint32 lon)` | 513 |
| `quint32 configVersion() const` | 524 |
| `quint8 backlight() const` | 526 |
| `quint32 checksum() const` | 527 |
| `CIGCONF::ConfigErrorCode configErrorCode() const` | 529 |
| `void readPreopDriverIds()` | 531 |
| `void readDriverIds()` | 532 |
| `void readMasterIds()` | 533 |
| `void readSuperIds()` | 534 |
| `void readTechIds()` | 535 |
| `void readChecklist()` | 536 |
| `quint32 driverChecksum() const` | 537 |
| `quint32 masterChecksum() const` | 538 |
| `quint32 superChecksum() const` | 539 |
| `quint32 questionChecksum() const` | 540 |
| `quint32 timestamp() const` | 542 |
| `quint32 localTimestamp() const` | 543 |
| `QDateTime localTime() const` | 545 |
| `quint64 clockTime() const` | 547 |
| `QString preopCommentString() const` | 557 |
| `void setPreopCommentString(QString msg)` | 558 |
| `QString UnlkReasonString() const` | 560 |
| `void setUnlkReasonString(QString msg)` | 561 |
| `CIGCONF::RealImpact UnlkOption() const` | 563 |
| `void setUnlkOption(CIGCONF::RealImpact option)` | 564 |
| `quint64 currentDriverId() const` | 566 |
| `void setCurrentDriverId(quint64 id)` | 567 |
| `quint64 fwVersion()` | 569 |
| `QString fwVersionString()` | 570 |
| `quint32 onDemandStartTime() const` | 573 |
| `quint32 onDemandEndTime() const` | 574 |
| `quint64 onDemandSmId() const` | 575 |
| `void setOnDemand(quint32 start, quint32 end, quint64 id)` | 577 |
| `void clearOnDemand()` | 583 |
| `bool onDemandActive()` | 585 |
| `bool onDemandVehicleEnabled()` | 586 |
| `bool setWifiNetwork(quint32 index, const QByteArray &ssid, const QByteArray &pw)` | 588 |
| `CIGCONF::WifiNetwork wifiNetwork(quint32 index) const` | 589 |
| `bool setWifiCountry(const QByteArray &country)` | 591 |
| `QByteArray wifiCountry() const` | 592 |
| `void clearWifiConfig()` | 594 |
| `quint8 wifiPos()` | 596 |
| `quint16 wifiPosInterval()` | 597 |
| `CIGCONF::WifiPosSource wifiPosSource()` | 598 |
| `bool setWifiPos(const quint8 n, const quint16 interval, const CIGCONF::WifiPosSource src)` | 599 |
| `bool isRs232AccessoryActive()` | 606 |
| `qint16 debugMsg() const` | 608 |
| `void setDebugMsg(qint16 n)` | 609 |
| `qint16 debugSpn() const` | 611 |
| `void setDebugSpn(qint16 n)` | 612 |
| `quint32 geofenceState() const` | 614 |
| `void setGeofenceState(quint32 state)` | 615 |
| `quint8 showDriverName() const` | 617 |
| `bool setShowDriverName(quint8 show)` | 618 |
| `bool GPSMsgLogEn() const` | 624 |
| `void setGPSMsgLogEn(bool en)` | 625 |
| `quint8 showPreopComment() const` | 630 |
| `void setShowPreopComment(quint8 show)` | 631 |
| `quint8 amberImpactAlertActive() const` | 636 |
| `void setAmberImpactAlertActive(quint8 state)` | 637 |
| `quint8 idleLockout() const` | 642 |
| `bool setIdleLockout(quint8 en)` | 643 |
| `quint8 showPreopSummary() const` | 649 |
| `void setShowPreopSummary(quint8 show)` | 650 |
| `quint8 unlockMode() const` | 655 |
| `void setUnlockMode(quint8 mode)` | 656 |
| `quint8 forceChecklist() const` | 661 |
| `bool setForceChecklist(quint8 force)` | 662 |
| `quint8 showTime() const` | 669 |
| `void setShowTime(quint8 format)` | 670 |
| `quint8 vdiMode() const` | 675 |
| `void setVdiMode(quint8 mode)` | 676 |
| `CIGCONF::CameraMode cameraMode() const` | 681 |
| `void setCameraMode(CIGCONF::CameraMode mode)` | 682 |
| `quint8 cameraFlip() const` | 687 |
| `void setCameraFlip(quint8 flip)` | 688 |
| `QByteArray lastSessionDriver() const` | 693 |
| `QByteArray lastSessionStart() const` | 694 |
| `QByteArray lastSessionEnd() const` | 695 |
| `void setLastSessionDriver(const QByteArray& driver)` | 696 |
| `void setLastSessionStart(const QByteArray& start)` | 700 |
| `void setLastSessionEnd(const QByteArray& end)` | 704 |

**Signals:**
| Signal | Line |
|---|---|
| `superListChanged(bool empty)` | 710 |
| `convorStatusChanged()` | 711 |
| `preopOncePerDayStatusChanged()` | 712 |

**Private methods:**
| Method | Line |
|---|---|
| `bool readStaticConfig()` | 771 |
| `void saveStaticConfig()` | 772 |
| `void readDynamicConfig()` | 774 |
| `void saveDynamicConfig()` | 775 |
| `void readOdConfig()` | 777 |
| `void saveOdConfig()` | 778 |
| `void readVORConfig()` | 785 |
| `void saveVORConfig()` | 786 |
| `void readGeofenceConfig()` | 816 |
| `void saveGeofenceConfig()` | 817 |

**Private structs (nested / file-local):**
| Name | Lines |
|---|---|
| `ConfigsData` | 715–758 |
| `ConfigsDataExt` | 760–762 |
| `OnDemandData` | 764–769 |
| `ConvorData` | 780–783 |
| `DigitalInputCfg` | 788–793 |
| `FullLockoutData` | 835–838 |

**Private member variables:**
`m_configs`, `m_configsExt`, `m_odConfig`, `m_driverList`, `m_checklist`, `m_configErrorCode`, `m_VORConfig`, `m_dINConfig`, `m_currentDriverId`, `m_unlockId`, `m_lastTimeServerUpdate`, `m_timeError`, `m_unlkMessage`, `m_unlkOption`, `m_gpsDistanceMark`, `m_satNum`, `m_polygon[]`, `m_screenSaverMode`, `gmtpWaitTimeout`, `m_networks`, `m_country`, `m_wifiPos`, `m_wifiPosInterval`, `m_wifiPosSource`, `m_fmsDirty`, `m_dynDirty`, `m_gfnceDirty`, `m_debugMsg`, `m_debugSpn`, `m_geofenceState`, `m_convorId`, `m_seenDebounceTime`, `m_seenHoldTime`, `m_fullLockout`, `m_preopComment`, `m_preopRandom`, `m_showDriverName`, `m_isGPSMsgLogEn`, `m_showPreopComment`, `m_amberImpactAlertState`, `simICCID[]`, `m_preopOncePerDayEn`, `m_idleLockoutEnabled`, `m_showPreopSummary`, `m_unlockMode`, `m_forceChecklist`, `m_showTime`, `m_vdiMode`, `m_cameraMode`, `m_cameraFlip`, `m_lastSessionDriver`, `m_lastSessionStart`, `m_lastSessionEnd`

---

### 1.2 `app/globalconfigs.cpp`

**Functions defined (with line numbers):**

| Function | Line |
|---|---|
| `GlobalConfigs::GlobalConfigs(QObject *parent)` | 26 |
| `GlobalConfigs *GlobalConfigs::instance()` | 33 |
| `quint32 GlobalConfigs::crc32(const void *data, int len)` | 38 |
| `void GlobalConfigs::readConfigs()` | 51 |
| `void GlobalConfigs::saveConfigs()` | 110 |
| `void GlobalConfigs::saveOpdDriverList()` | 126 |
| `void GlobalConfigs::resetConfigs(bool resetAll)` | 131 |
| `bool GlobalConfigs::readStaticConfig()` | 265 |
| `void GlobalConfigs::saveStaticConfig()` | 420 |
| `void GlobalConfigs::readDynamicConfig()` | 510 |
| `void GlobalConfigs::saveDynamicConfig()` | 556 |
| `void GlobalConfigs::readOdConfig()` | 587 |
| `void GlobalConfigs::saveOdConfig()` | 618 |
| `bool GlobalConfigs::setSuperId(int index, quint64 id)` | 639 |
| `bool GlobalConfigs::addSuperId(quint64 id)` | 649 |
| `bool GlobalConfigs::removeSuperId(quint64 id)` | 659 |
| `void GlobalConfigs::readVORConfig()` | 669 |
| `void GlobalConfigs::saveVORConfig()` | 690 |
| `bool GlobalConfigs::setWifiNetwork(quint32 index, const QByteArray &ssid, const QByteArray &pw)` | 709 |
| `bool GlobalConfigs::setWifiCountry(const QByteArray &country)` | 723 |
| `void GlobalConfigs::clearWifiConfig()` | 733 |
| `void GlobalConfigs::saveGeofenceConfig()` | 749 |
| `void GlobalConfigs::readGeofenceConfig()` | 778 |

**File-level macros defined in `.cpp`:**

| Macro | Line | Value |
|---|---|---|
| `TEST_LOC_SZ` | 11 | (empty body — no value) |
| `FMS_INI_FILE` | 13 | `"fms.ini"` |
| `DYN_INI_FILE` | 14 | `"dyn.ini"` |
| `FMS_CONFIG_FILE` | 15 | `"fmscfg.dat"` |
| `OD_CONFIG_FILE` | 16 | `"odcfg.dat"` |
| `VOR_CONFIG_FILE` | 17 | `"vor.cfg"` |
| `GFNCE_CONFIG_FILE` | 18 | `"gfnce.cfg"` |
| `MAGIC_CODE` | 19 | `0xA53F3456` |
| `OD_VERSION` | 20 | `1` |

**`using` directive:** `using namespace CIGCONF;` at line 24.

---

### 1.3 `app/globalconfigsfilemanager.h` / `.cpp`

These files **do not exist** in the repository. A `Glob` search for `**/globalconfigsfilemanager*` returned no results. This is noted as Finding A05-1.

---

## 2. Findings

---

**A05-1** · INFO · `globalconfigsfilemanager.h` / `.cpp` do not exist

**Description:** The audit assignment references `app/globalconfigsfilemanager.h` and `app/globalconfigsfilemanager.cpp` as files to review. Neither file exists anywhere in the repository. This was also confirmed by the Pass 3 agent. File I/O is implemented directly inside `GlobalConfigs`, with no separate file-manager abstraction layer. The absence of the files may indicate: (a) the files were planned but never created; (b) they were deleted and the work was inlined; or (c) they are referenced by a stale task description.

**Fix:** Confirm with the team whether a file-manager abstraction was intentionally removed or was never implemented. If the split is still planned, create the files. If not, remove the reference from documentation and the build system.

---

**A05-2** · LOW · Dead macro `TEST_LOC_SZ` (cpp line 11)

**Description:** `#define TEST_LOC_SZ` is defined at `globalconfigs.cpp` line 11 with an empty body. It is never referenced anywhere else in the repository. It appears to be a leftover from a development or test build that was never cleaned up.

**Fix:** Remove the unused `#define TEST_LOC_SZ` line entirely.

---

**A05-3** · LOW · Commented-out code block — reverted MK3-296 logic (cpp lines 164–181)

**Description:** A large commented-out block (18 lines) at `globalconfigs.cpp` lines 164–181 contains the full implementation of an intentionally reverted feature (MK3-296: leading-zero GMTP ID generation). The comment header says `/** Reverted 06Mar24`. While the reverted date is noted, the dead code adds noise, obscures intent, and is now tracked in version control history.

**Fix:** Remove the commented-out block entirely. The VCS history preserves the reverted code if it is ever needed again.

---

**A05-4** · LOW · Commented-out code — minor residual comments (cpp lines 186–187, 194–196, 203–205, 212, 227–228, 243)

**Description:** Multiple single-line and small multi-line commented-out statements are scattered throughout `resetConfigs()` (cpp lines 186, 187, 194–196, 203–205, 212, 227–228) and `saveConfigs()` (line 120) and `resetConfigs()` (line 243). Examples:
- Line 120: `//saveOdConfig();`
- Lines 186–187: `// m_configs.maint.driverId = 0;` / `// m_configs.maint.timestamp = 0;`
- Lines 194–196: `// m_configs.checklistTimeout = 0;` etc.
- Line 243: `//setMasterId(0, 0x2002f5b, CIGCONF::UnassignedMasterMenu, "");`

These commented-out statements are redundant (the `memset` above already zeros the struct) or represent disabled functionality with no explanation. They create maintenance confusion.

**Fix:** Remove all residual commented-out statements. Add an explanatory comment if a deliberate default is being preserved.

---

**A05-5** · LOW · Commented-out `qDebug` in `saveDynamicConfig()` (cpp line 583)

**Description:** `// qDebug() << Q_FUNC_INFO << "Saved dynamic config.";` at line 583 is commented out, unlike the equivalent log statements in every other save function. This is inconsistent with the surrounding code style, where every other `save*Config()` function emits a `qDebug` success message.

**Fix:** Either restore the `qDebug` call (consistent with `saveStaticConfig()`, `saveOdConfig()`, etc.) or document why it is intentionally suppressed.

---

**A05-6** · MEDIUM · Member prefix inconsistency — `gmtpWaitTimeout` and `simICCID` lack `m_` prefix

**Description:** Every private member variable in `GlobalConfigs` uses the `m_` prefix (e.g., `m_fmsDirty`, `m_configs`, `m_screenSaverMode`). Two members violate this convention:
- `gmtpWaitTimeout` (header line 814 / used in cpp lines 236, 365, 470)
- `simICCID[MODEM_ICCID_LEN]` (header line 849 / used in cpp lines 157–165 via the public `getSimCardID()` / `setSimCardID()` / `resetSimCardID()`)

Both are accessed directly in public inline methods, making the inconsistency visible through the public interface.

**Fix:** Rename to `m_gmtpWaitTimeout` and `m_simICCID` (or `m_simIccid` following Qt camelCase conventions) throughout the header and implementation.

---

**A05-7** · MEDIUM · `getDriverName()` uses `gCfg` macro to call back on itself (header lines 220–231)

**Description:** The inline public method `getDriverName(quint64 id)` (header lines 220–231) calls `gCfg->containsTechId(id)`, `gCfg->techIds()`, etc., where `gCfg` expands to `GlobalConfigs::instance()`. The method is called on the singleton, and then internally re-acquires the singleton to call its own public methods. This is a circular self-reference through the global accessor: `this->getDriverName()` → `GlobalConfigs::instance()->containsTechId()`. The correct form would simply use `this->` or call the member objects directly.

**Fix:** Replace all `gCfg->` calls inside `getDriverName()` with direct calls on `this` (e.g., `containsTechId(id)`, `techIds().at(getTechIdIndex(id)).name`).

---

**A05-8** · MEDIUM · `setConvor()` uses `gCfg` self-reference inside member function (header line 265)

**Description:** `setConvor(quint8 convor, quint64 id)` (header lines 259–267) calls `gCfg->setLastCheckTimestamp(0)` inside its body. As with A05-7, `gCfg` is `GlobalConfigs::instance()`, so the method is calling back on itself through the global accessor rather than via `this`.

**Fix:** Replace `gCfg->setLastCheckTimestamp(0)` with `setLastCheckTimestamp(0)` or `this->setLastCheckTimestamp(0)`.

---

**A05-9** · MEDIUM · `onDemandActive()` and `onDemandVehicleEnabled()` use `gCfg` self-reference (header lines 585–586)

**Description:** Both methods expand `gCfg` to `GlobalConfigs::instance()` and then call other methods on the singleton, while they are themselves member functions of that same singleton. Same pattern as A05-7 and A05-8.

**Fix:** Replace `gCfg->` with direct method calls, e.g., `superIsEmpty()` and `onDemandStartTime()` etc.

---

**A05-10** · LOW · `resetConfigs()` calls `memset` on wrong type for `m_configsExt` (cpp line 140)

**Description:** `resetConfigs()` at cpp line 140 performs:
```cpp
memset(&m_configs, 0, sizeof(ConfigsDataExt));
```
This is a copy-paste error. The first argument is `&m_configs` (of type `ConfigsData`) but the size used is `sizeof(ConfigsDataExt)`. Since `ConfigsDataExt` is a 1-byte struct (`quint8 unlkScr`) this is harmless in practice (it only zeroes the first byte of `m_configs`, which was already zeroed by the preceding `memset`), but it never resets `m_configsExt` at all. The intended call should be `memset(&m_configsExt, 0, sizeof(ConfigsDataExt))`.

**Fix:** Change line 140 to:
```cpp
memset(&m_configsExt, 0, sizeof(ConfigsDataExt));
```

---

**A05-11** · HIGH · `readConfigs()` partial-read fallback branch uses an already-attempted `QFile` (cpp lines 63–90)

**Description:** In `readConfigs()`, if `readStaticConfig()` returns `false`, a second attempt is made to read `FMS_CONFIG_FILE` (`fmscfg.dat`) using binary layout. The two files are distinct (`fms.ini` vs `fmscfg.dat`), so this is intentional fallback logic. However, there is an architectural defect: the fallback branch sets `m_configErrorCode = ConfigSizeError` (line 65) before opening the file, then overwrites it with `ConfigCrcError` (line 79) before validating the magic/CRC. If the magic code or CRC check fails, `resetConfigs()` is called (which resets `m_configErrorCode` indirectly via `memset`) but the error code set at line 79 (`ConfigCrcError`) was already overwritten by `resetConfigs()` resetting `m_configs`. After `resetConfigs()`, the code falls through to line 92 (`m_configErrorCode = NoConfigError`), incorrectly reporting a clean state after a CRC failure.

**Fix:** Preserve the error code after calling `resetConfigs()` by setting it again after the `return` statements, or restructure the error-code assignments so `m_configErrorCode` is set after `resetConfigs()` returns in all error paths. Additionally, make `resetConfigs()` not clear `m_configErrorCode`.

---

**A05-12** · MEDIUM · `readGeofenceConfig()` — unused variable `it` declared outside the loop (cpp line 780)

**Description:** `readGeofenceConfig()` at cpp line 780 declares `int it;` and then uses it as the loop counter in a C-style `for (it = 0; it < bas.size(); it++)` loop (line 794). The `it` variable has function scope but is only used inside the loop. Modern C++ style (and Qt convention) declares the loop variable in the `for` initialiser.

**Fix:** Change the loop to `for (int it = 0; it < bas.size(); it++)` and remove the outer declaration.

---

**A05-13** · LOW · Naming convention inconsistency — `UnlkReasonString()` and `UnlkOption()` use PascalCase for non-constructor public methods (header lines 560, 563)

**Description:** Qt coding convention and the prevailing style throughout this class uses lowerCamelCase for public method names (e.g., `maintCode()`, `dialNumber()`, `checklistTimeout()`). The two methods `UnlkReasonString()` and `UnlkOption()` (header lines 560 and 563) use PascalCase, as does `GPSMsgLogEn()` (line 624). This is inconsistent with every other accessor in the class.

**Fix:** Rename to `unlkReasonString()`, `unlkOption()`, and `gpsMsgLogEn()` (or `isGpsMsgLogEn()` following Qt bool-property convention). Update all call sites.

---

**A05-14** · LOW · `bool` members stored as `quint8` — type mismatch and potential signed/unsigned warnings (header lines 851, 853–855, 858)

**Description:** Several fields that semantically hold boolean on/off state are stored as `quint8` rather than `bool`:
- `m_preopOncePerDayEn` (line 850) declared `bool`, but written in `resetConfigs()` as `m_preopOncePerDayEn = 0` and read from file as `(quint8)args[1].toUInt()`.
- `m_idleLockoutEnabled` (line 851): declared `quint8`, but the reset code assigns `false` (cpp line 252): `m_idleLockoutEnabled = false;`
- `m_showPreopSummary`, `m_unlockMode`, `m_forceChecklist`, `m_showTime`, `m_vdiMode` (lines 852–856) are all `quint8` but semantically flags or small enumerations.

The assignment `m_idleLockoutEnabled = false` (cpp line 252) is an implicit conversion from `bool` to `quint8`, which is defined behaviour but triggers `-Wconversion` on stricter build configurations. The inconsistency between `bool` declaration (`m_preopOncePerDayEn`) and `quint8` usage (file I/O casting) is a latent type-mismatch smell.

**Fix:** Decide on a consistent representation. Pure boolean flags should be `bool`. Multi-value flags that map to file-stored integers should be the appropriate integer type. Remove the `= false` initialisation of a `quint8` member.

---

**A05-15** · LOW · `QString` pass-by-value in several public setter methods (header lines 180–183, 220, 558, 561)

**Description:** Several public setters accept `QString` by value instead of by `const QString &`:
- `setDriverId(int index, quint64 id, QString name)` (line 180)
- `setMasterId(int index, quint64 id, quint8 option, QString name)` (line 181)
- `setTechId(int index, quint64 id, QString name)` (line 183)
- `addDriverId(quint64 id, QString name)` (line 190)
- `addTechId(quint64 id, QString name)` (line 192)
- `setPreopCommentString(QString msg)` (line 558)
- `setUnlkReasonString(QString msg)` (line 561)

Each call site causes an unnecessary copy of the `QString` object on the call stack.

**Fix:** Change the parameter type to `const QString &` in all of the above signatures.

---

**A05-16** · MEDIUM · `readStaticConfig()` uses `while(1)` with a single-empty-line break condition (cpp line 274)

**Description:** The loop `while (1) { ... if (ba.isEmpty()) break; ... }` in `readStaticConfig()` (and identically in `readDynamicConfig()`, cpp line 519) uses an infinite loop with an implicit EOF/empty-line break. `QFile::readLine()` returns an empty `QByteArray` both on EOF and on an actual blank line within the file. This means a blank line in `fms.ini` silently terminates parsing of the rest of the file, discarding any settings below the blank line without warning. The correct approach is to check `QFile::atEnd()`.

**Fix:** Replace `while (1)` with `while (!file.atEnd())` and remove the `if (ba.isEmpty()) break;` guard (keeping the `if (args.size() != 2) continue;` guard to skip truly blank lines).

---

**A05-17** · LOW · `dec` and `endl` stream manipulators are deprecated in Qt 5.15+ (cpp lines 434 onwards)

**Description:** `saveStaticConfig()` and `saveDynamicConfig()` make extensive use of `dec` and `endl` as `QTextStream` manipulators (e.g., cpp lines 434–502, 570–579). In Qt 5.15, `dec`, `endl`, and related manipulators were deprecated in favour of `Qt::dec`, `Qt::endl`, etc. Building with `-Wdeprecated-declarations` (default for Qt 5.15+) will produce warnings for every occurrence.

**Fix:** Replace `dec` with `Qt::dec` and `endl` with `Qt::endl` (or `'\n'`) throughout `saveStaticConfig()` and `saveDynamicConfig()`.

---

**A05-18** · LOW · C-style casts in `readStaticConfig()` (cpp lines 284, 300, 335–337, 339, 343–347, 359–410)

**Description:** `readStaticConfig()` uses C-style casts (`(quint8)`, `(quint16)`, `(quint32)`, `(qint16)`, `(CIGCONF::WifiPosSource)`, `(CIGCONF::CameraMode)`, `(CIGCONF::MaintLockedCode)`) extensively when assigning values parsed from the INI file (e.g., `(quint8)args[1].toUInt()` on lines 284, 335, 336, 339, etc.). C-style casts suppress compiler narrowing warnings and bypass type-safety checks.

**Fix:** Replace C-style casts with `static_cast<quint8>(...)` and the equivalent Qt integer types. For enum casts (`CIGCONF::WifiPosSource`, etc.), validate the integer value is within the enum range before casting.

---

**A05-19** · LOW · `readGeofenceConfig()` mixes `qint32` parse result into `quint32` polygon field without validation (cpp lines 803–807)

**Description:** In `readGeofenceConfig()` (cpp lines 801–807):
```cpp
qint32 lon = pol[2].trimmed().toLong();
qint32 lat = pol[3].trimmed().toLong();
m_polygon[n].polyVertices[vect].latitude = lat;
m_polygon[n].polyVertices[vect].longitude = lon;
```
`latitude` and `longitude` in `gpsPosStruct` are `qint32`, but in the header, `polygonLatitude()` / `polygonLongitude()` return `quint32` and the setters accept `quint32`. There is an implicit signed/unsigned mismatch at every point where the polygon data moves through the public API. This is likely to produce `-Wsign-compare` or `-Wconversion` warnings on stricter builds.

**Fix:** Decide on a single type for coordinates throughout (`qint32` is the correct type for signed latitude/longitude values). Update `gpsPosStruct` fields, the getter return types, setter parameter types, and the save/read functions to use `qint32` consistently.

---

**A05-20** · MEDIUM · No bounds checking on `gmtpServerAddress(int index)` and `gmtpServerPort(int index)` getters (header lines 127, 137)

**Description:** The getter methods `gmtpServerAddress(int index)` and `gmtpServerPort(int index)` (header lines 127 and 137) perform no bounds check on `index`. An out-of-range `index` causes an array out-of-bounds access on `m_configs.gmtpServer[index]`. The corresponding setters validate `index >= 0 && index < GMTP_SERVER_CNT`, but the getters do not. Callers who pass an unchecked `index` (e.g., in `saveStaticConfig()` loop) are relying on the caller to be correct. The same pattern exists for `checkTimeSlot(int index)` (line 304) and `polygon(int n)` / `polygonNPoints(int n)` / `polygonLatitude()` / `polygonLongitude()` (lines 490–519).

**Fix:** Add bounds assertions (`Q_ASSERT(index >= 0 && index < GMTP_SERVER_CNT)`) or range-checked access to all array-indexed getters.

---

## 3. Summary Table

| ID | Severity | Title |
|---|---|---|
| A05-1 | INFO | `globalconfigsfilemanager.h/.cpp` do not exist |
| A05-2 | LOW | Dead macro `TEST_LOC_SZ` |
| A05-3 | LOW | Large commented-out reverted-feature block (MK3-296, cpp lines 164–181) |
| A05-4 | LOW | Residual commented-out code in `resetConfigs()` / `saveConfigs()` |
| A05-5 | LOW | `qDebug` success log commented out in `saveDynamicConfig()` |
| A05-6 | MEDIUM | Missing `m_` prefix on `gmtpWaitTimeout` and `simICCID` |
| A05-7 | MEDIUM | `getDriverName()` uses `gCfg` self-reference instead of `this` |
| A05-8 | MEDIUM | `setConvor()` uses `gCfg` self-reference instead of `this` |
| A05-9 | MEDIUM | `onDemandActive()` / `onDemandVehicleEnabled()` use `gCfg` self-reference |
| A05-10 | LOW | `resetConfigs()` memset targets wrong object for `ConfigsDataExt` |
| A05-11 | HIGH | Error code incorrectly reset to `NoConfigError` after CRC failure in `readConfigs()` |
| A05-12 | MEDIUM | `readGeofenceConfig()` — loop variable `it` declared outside the loop |
| A05-13 | LOW | Inconsistent PascalCase on `UnlkReasonString()`, `UnlkOption()`, `GPSMsgLogEn()` |
| A05-14 | LOW | Boolean fields stored as `quint8`; `bool` field initialised with `false` assigned to `quint8` |
| A05-15 | LOW | `QString` parameters passed by value instead of `const QString &` |
| A05-16 | MEDIUM | `while(1)` parse loop breaks on first blank line, silently dropping rest of config file |
| A05-17 | LOW | Deprecated Qt `dec` / `endl` manipulators in `QTextStream` output |
| A05-18 | LOW | Pervasive C-style casts in `readStaticConfig()` |
| A05-19 | LOW | Signed/unsigned mismatch for polygon coordinate types across public API |
| A05-20 | MEDIUM | No bounds checking on array-indexed getter methods |
