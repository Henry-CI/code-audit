# Pass 3 Agent A19 — Documentation

**Audit run:** 2026-02-28-01
**Branch:** master
**Files reviewed:**
- `ui/checkcompleteddialog.h` + `ui/checkcompleteddialog.cpp`
- `ui/checkconfirmationdialog.h` + `ui/checkconfirmationdialog.cpp`
- `ui/checkquestiondialog.h` + `ui/checkquestiondialog.cpp`

---

## Reading Evidence

### 1. `CheckCompletedDialog` (checkcompleteddialog.h / checkcompleteddialog.cpp)

**Class name:** `CheckCompletedDialog` — inherits `QDialog`

**Public methods (header):**

| Line | Signature |
|------|-----------|
| 17 | `explicit CheckCompletedDialog(QWidget *parent = 0)` |
| 18 | `~CheckCompletedDialog()` |
| 20 | `void languageChanged(void)` |
| 21 | `bool isTimerActive()` |
| 22 | `void stopTimer()` |
| 23 | `void setCheckResponses(QList<CIGCONF::CheckResponse> &responses)` (inline) |

**Signals:**

| Name | Declared at line |
|------|-----------------|
| `openPreopNotes()` | 30 |

**Protected methods:**

| Line | Signature |
|------|-----------|
| 33 | `void showEvent(QShowEvent *event = 0)` |

**Types / constants used (from implementation):**

- `NO_ACTIVITY_TIME` — preprocessor constant defined at cpp line 5, value `10000` (milliseconds). Controls the auto-accept inactivity timeout.
- `CIGCONF::CheckResponse` — struct from `app/cigconfigs.h` with fields `id`, `type` (maps to `CIGCONF::ChecklistType`), `response` (maps to `CIGCONF::CheckResponses`), and `text`.
- `CIGCONF::ChecklistType` — enum: `NotCritical`, `CriticalByYes = 1`, `CriticalByNo = 2`
- `CIGCONF::CheckResponses` — enum: `UndefinedCheckResponse`, `CheckResponsedYes = 1`, `CheckResponsedNo = 2`

**Doc comments present:** None on any declaration.

---

### 2. `CheckConfirmationDialog` (checkconfirmationdialog.h / checkconfirmationdialog.cpp)

**Class name:** `CheckConfirmationDialog` — inherits `QDialog`

**Public methods (header):**

| Line | Signature |
|------|-----------|
| 16 | `explicit CheckConfirmationDialog(QWidget *parent = 0)` |
| 17 | `~CheckConfirmationDialog()` |
| 19 | `void confirm(bool yes)` |
| 20 | `void setQuestion(const QString &question)` |
| 21 | `void languageChanged(void)` |

**Signals:** None declared.

**Types / enums / constants:** None defined locally.

**Doc comments present:** None on any declaration.

---

### 3. `CheckQuestionDialog` (checkquestiondialog.h / checkquestiondialog.cpp)

**Class name:** `CheckQuestionDialog` — inherits `QDialog`

**Public methods (header):**

| Line | Signature |
|------|-----------|
| 17 | `explicit CheckQuestionDialog(QWidget *parent = 0)` |
| 18 | `~CheckQuestionDialog()` |
| 20 | `const QString &question() const` (inline) |
| 21 | `void setQuestion(const QString &question, bool critical = false)` |

**Signals:**

| Name | Declared at line |
|------|-----------------|
| `shown(void)` | 28 |

**Protected methods:**

| Line | Signature |
|------|-----------|
| 31 | `void showEvent(QShowEvent *event)` |

**Types / enums / constants:** None defined locally.

**Doc comments present:** None on any declaration.

---

## Documentation Findings

**A19-1** · LOW · No doc comment on `CheckCompletedDialog::languageChanged()`
**Description:** `languageChanged()` is a non-trivial method that retranslates all UI strings. The method is called externally (it is public) when the application language changes at runtime. There is no comment explaining when callers are expected to invoke it, nor that it updates UI labels. The method also duplicates the same label-setting logic that appears in `showEvent()`, which is a subtle maintenance hazard, but there is no comment alerting maintainers to this duplication.
**Fix:** Add a doc comment above the declaration, e.g.:
```
// Called by the parent widget when the application language changes at runtime.
// Re-applies translated strings to all UI labels. Note: duplicates the label
// updates in showEvent(); both must be kept in sync.
void languageChanged(void);
```

---

**A19-2** · HIGH · No doc comment on `CheckCompletedDialog::setCheckResponses()`
**Description:** `setCheckResponses()` accepts a `QList<CIGCONF::CheckResponse>` by non-const reference and stores it in `m_checkResponses`. This list is consumed during `showEvent()` to compute how many critical safety-check questions the driver failed, and the result is displayed visibly on the completion dialog. The method has no documentation explaining: (a) what constitutes a valid response list, (b) that it must be called before `show()` / `exec()` for the summary to be accurate, (c) that the parameter is taken by non-const lvalue reference (a subtle interface oddity — callers cannot pass a temporary or const list), or (d) the safety significance of the data (this is a pre-operation safety check summary visible to the operator). Missing documentation on a method that feeds safety-critical display logic is a HIGH concern.
**Fix:** Add a doc comment, e.g.:
```
// Sets the list of checklist responses used to compute the critical-question
// failure summary displayed in showEvent(). Must be called before show()/exec().
// The list is stored by value; the caller's list must remain valid until the
// dialog is shown. 'responses' is taken by non-const reference; passing a
// temporary or const list will not compile.
void setCheckResponses(QList<CIGCONF::CheckResponse> &responses) { ... }
```

---

**A19-3** · HIGH · No doc comment on `CheckCompletedDialog::stopTimer()` and `isTimerActive()`
**Description:** `CheckCompletedDialog` contains an auto-accept inactivity timer (`NO_ACTIVITY_TIME = 10000 ms`). When the timer fires it calls `accept()`, automatically advancing the workflow without any user interaction. `stopTimer()` and `isTimerActive()` are the external control points for this timer, yet neither has any documentation. Callers cannot determine: (a) what the timer does when it expires (auto-accept), (b) what side effects `stopTimer()` has versus simply hiding the dialog, or (c) why querying `isTimerActive()` is useful. Auto-accepting a safety-check completion dialog without user interaction is safety-relevant; the absence of documentation on the methods that govern this timer is a HIGH concern.
**Fix:** Add doc comments above both declarations, e.g.:
```
// Returns true if the inactivity auto-accept timer is currently running.
// The timer automatically accepts the dialog after NO_ACTIVITY_TIME ms of
// inactivity, advancing the workflow without explicit user confirmation.
bool isTimerActive();

// Stops the inactivity auto-accept timer if it is running. Call this before
// programmatically closing or hiding the dialog to prevent a spurious accept().
void stopTimer();
```

---

**A19-4** · LOW · No doc comment on `CheckCompletedDialog::openPreopNotes` signal
**Description:** The `openPreopNotes()` signal is emitted when either of the "Add notes" buttons is pressed (and the inactivity timer is stopped). There is no comment describing this signal's purpose, when it fires, or what behavior the connected slot is expected to implement. Consumers connecting to this signal must infer its semantics from the button label text, which may not be available at connection time.
**Fix:** Add a brief comment above the signal declaration:
```
// Emitted when the user taps the "Add notes" button. The inactivity timer is
// stopped before emission. Connected slot should open the pre-op notes editor.
void openPreopNotes();
```

---

**A19-5** · LOW · No doc comment on `CheckConfirmationDialog::confirm(bool yes)`
**Description:** `confirm()` is a non-trivial method that mutates the visible state of the dialog by showing either a "YES" label or a "NO" label depending on the argument. It is not merely a setter — it directly manipulates which UI element is visible. There is no comment explaining its purpose (to reflect back to the user the answer they just gave to the preceding question), when it must be called relative to `show()`, or what the `yes` parameter controls.
**Fix:** Add a doc comment, e.g.:
```
// Displays either the "YES" or "NO" confirmation label to reflect the user's
// prior answer. Pass true if the user answered yes, false for no.
// Should be called before show()/exec().
void confirm(bool yes);
```

---

**A19-6** · LOW · No doc comment on `CheckConfirmationDialog::setQuestion(const QString &question)`
**Description:** `setQuestion()` sets the question text in the confirmation dialog. There is no documentation explaining that this is the same question already answered by the user (displayed here as a reminder before they confirm), or that it must be called before `show()`.
**Fix:** Add a doc comment, e.g.:
```
// Sets the question text displayed in the confirmation dialog. Typically this
// is the same question the user just answered, shown for confirmation purposes.
// Must be called before show()/exec().
void setQuestion(const QString &question);
```

---

**A19-7** · HIGH · `CheckQuestionDialog::setQuestion()` — undocumented button-randomisation side effect
**Description:** `setQuestion()` does significantly more than set the question text. Its implementation at cpp line 24-28 uses `qrand() % 2` to randomly swap the physical screen positions of the YES and NO buttons on each call. This is a deliberate UX safety mechanism (to prevent muscle-memory tapping without reading), but it is entirely undocumented. Callers, testers, and reviewers reading only the header cannot know: (a) that button positions are randomised, (b) that `qrand()` is used (an older, non-thread-safe PRNG), or (c) that the `critical` parameter controls visibility of a "critical question" indicator label. The button-randomisation behaviour is safety-relevant: if it were inadvertently removed during a refactor the change would appear innocuous from the header alone.
**Fix:** Add a doc comment that explicitly documents the randomisation side effect and the `critical` parameter:
```
// Sets the displayed question text and configures the dialog state.
// The YES and NO button positions are randomly swapped on each call to
// prevent habitual tapping without reading. If 'critical' is true, a
// "critical question" indicator label is shown; it is hidden otherwise.
// Must be called before show()/exec().
void setQuestion(const QString &question, bool critical = false);
```

---

**A19-8** · LOW · No doc comment on `CheckQuestionDialog::shown` signal
**Description:** The `shown()` signal is emitted from `showEvent()` each time the dialog becomes visible. There is no comment describing its purpose or expected use. Consumers must inspect the implementation to understand it is a post-show notification (e.g., to trigger external timing or logging).
**Fix:** Add a brief comment:
```
// Emitted each time the dialog is shown (from showEvent). Can be used by
// callers to start timing or trigger other actions after display.
void shown(void);
```

---

**A19-9** · INFO · No doc comment on `CheckQuestionDialog::question()` getter
**Description:** The inline `question()` getter returns the last question string set via `setQuestion()`. It is a simple getter and the absence of documentation is low impact, but it is undocumented.
**Fix:** Add a brief comment:
```
// Returns the question text currently displayed in the dialog.
const QString &question() const { return m_question; }
```

---

**A19-10** · INFO · `languageChanged()` undocumented on both `CheckConfirmationDialog` and `CheckQuestionDialog` (no `languageChanged` in `CheckQuestionDialog`, but present in both others)
**Description:** `CheckConfirmationDialog::languageChanged()` has the same pattern as the other dialogs — it is a public, externally-called method that re-applies translated UI strings — yet carries no documentation. (Note: `CheckQuestionDialog` does not expose a `languageChanged()` method, but its counterpart in `setQuestion()` re-applies `tr("YES")` / `tr("NO")` on each call, so language changes are handled implicitly there.)
**Fix:** Add a doc comment above `CheckConfirmationDialog::languageChanged()`:
```
// Called by the parent widget when the application language changes at runtime.
// Re-applies translated strings to all UI labels and buttons.
void languageChanged(void);
```

---

## Summary Table

| ID | Severity | File | Method / Symbol | Issue |
|----|----------|------|-----------------|-------|
| A19-1 | LOW | checkcompleteddialog.h | `languageChanged()` | No doc comment; duplicated logic not flagged |
| A19-2 | HIGH | checkcompleteddialog.h | `setCheckResponses()` | No doc on safety-critical data-setter; non-const ref interface undocumented |
| A19-3 | HIGH | checkcompleteddialog.h | `stopTimer()` / `isTimerActive()` | No doc on auto-accept timer control — safety-relevant behaviour |
| A19-4 | LOW | checkcompleteddialog.h | `openPreopNotes` signal | No doc comment on signal semantics |
| A19-5 | LOW | checkconfirmationdialog.h | `confirm(bool yes)` | No doc on UI-mutating method |
| A19-6 | LOW | checkconfirmationdialog.h | `setQuestion()` | No doc comment |
| A19-7 | HIGH | checkquestiondialog.h | `setQuestion()` | Undocumented safety-critical button-randomisation side effect |
| A19-8 | LOW | checkquestiondialog.h | `shown` signal | No doc comment |
| A19-9 | INFO | checkquestiondialog.h | `question()` getter | No doc comment |
| A19-10 | INFO | checkconfirmationdialog.h | `languageChanged()` | No doc comment |

**Totals:** 3 HIGH, 4 LOW, 3 INFO
