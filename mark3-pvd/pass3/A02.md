# Pass 3 Agent A02 — Documentation

**Audit run:** 2026-02-28-01
**Branch:** master
**Auditor:** A02
**Files reviewed:** `mk3.pro`, `mk3-test.pro`

---

## Reading Evidence

### mk3.pro

**File purpose:** The main Qt project file for the FleetFocus application (the production build). It defines all Qt modules, compiler output directories, the application target, preprocessor defines, and enumerates every source file, header, UI form, resource file, translation file, and distribution file that make up the production build.

**Variables/settings and their line numbers:**

| Line(s) | Variable / Setting | Value |
|---|---|---|
| 6 | `DEFINES += "TEST_MODE=0"` | Disables test mode at compile time |
| 8 | `QT` | `core gui serialport serialbus bluetooth network` |
| 10 | `QT += widgets` (conditional) | Added when Qt major version > 4 |
| 13 | `INCLUDEPATH` | `../sdk/kernel_include` (linux only) |
| 14 | `INCLUDEPATH` | `../sdk/3rd/include` (linux only) |
| 15 | `LIBS` | `-L../sdk/3rd/lib` (linux only) |
| 18 | `RCC_DIR` | `tmp/rcc` |
| 19 | `MOC_DIR` | `tmp/moc` |
| 20 | `UI_DIR` | `tmp/ui` |
| 21 | `OBJECTS_DIR` | `tmp/obj` |
| 23 | `TARGET` | `FleetFocus` |
| 24 | `TEMPLATE` | `app` |
| 30 | `DEFINES += QT_DEPRECATED_WARNINGS` | Enables Qt deprecation warnings |
| 35 (commented out) | `DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000` | Would disable all APIs deprecated before Qt 6.0.0 |
| 38–96 | `SOURCES` | 58 `.cpp` source files across `platform/`, `app/`, `ui/`, `comm/`, `utils/` subdirectories |
| 98–157 | `HEADERS` | 57 `.h` header files |
| 160–184 | `FORMS` | 24 Qt Designer `.ui` form files |
| 186–187 | `RESOURCES` | `mk3.qrc` |
| 189 | `TRANSLATIONS` | `lang_es_ES.ts` |
| 191–192 | `DISTFILES` | `netcfg.json` |

**Constants / defines:**

- `TEST_MODE=0` (line 6) — explicit zero value, suppresses test-only code paths
- `QT_DEPRECATED_WARNINGS` (line 30) — Qt-provided macro to enable deprecation warnings
- `QT_DISABLE_DEPRECATED_BEFORE=0x060000` (line 35, commented out) — Qt-provided macro

---

### mk3-test.pro

**File purpose:** The Qt project file for the unit test build of FleetFocus. It is structurally nearly identical to `mk3.pro` but adds `testlib` to the Qt modules, defines `UNIT_TEST`, and prepends four test-specific source and header files (`test/test_ota`, `test/test_dialog`, `test/test_backgroundworker`, `test/test_canbus`). It does not include `main.cpp` (relies on `testlib`'s own entry point or one of the test files providing it). The `TARGET` is identically named `FleetFocus`, which is a potential build-system hazard.

**Variables/settings and their line numbers:**

| Line(s) | Variable / Setting | Value |
|---|---|---|
| 6 | `DEFINES += "TEST_MODE=0"` | Same as production — test mode flag set to 0 despite this being the test project |
| 7 | `DEFINES += UNIT_TEST` | Enables conditional compilation of unit-test-only code |
| 9 | `QT` | `core gui serialport serialbus bluetooth network testlib` |
| 11 | `QT += widgets` (conditional) | Added when Qt major version > 4 |
| 13 | `INCLUDEPATH` | `../sdk/kernel_include` (linux only) |
| 14 | `INCLUDEPATH` | `../sdk/3rd/include` (linux only) |
| 15 | `LIBS` | `-L../sdk/3rd/lib` (linux only) |
| 19 | `RCC_DIR` | `tmp/rcc` |
| 20 | `MOC_DIR` | `tmp/moc` |
| 21 | `UI_DIR` | `tmp/ui` |
| 22 | `OBJECTS_DIR` | `tmp/obj` |
| 24 | `TARGET` | `FleetFocus` (same name as production binary) |
| 25 | `TEMPLATE` | `app` |
| 31 | `DEFINES += QT_DEPRECATED_WARNINGS` | Enables Qt deprecation warnings |
| 36 (commented out) | `DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000` | Would disable all APIs deprecated before Qt 6.0.0 |
| 39–100 | `SOURCES` | 4 test `.cpp` files + 57 production `.cpp` files (no `main.cpp`) |
| 102–165 | `HEADERS` | 4 test `.h` files + 57 production `.h` files |
| 168–192 | `FORMS` | 24 `.ui` form files (identical to production) |
| 194–195 | `RESOURCES` | `mk3.qrc` |
| 197 | `TRANSLATIONS` | `lang_es_ES.ts` |
| 199–200 | `DISTFILES` | `netcfg.json` |

**Constants / defines:**

- `TEST_MODE=0` (line 6) — value is 0; inconsistent with being the test project
- `UNIT_TEST` (line 7) — enables test-specific compilation branches
- `QT_DEPRECATED_WARNINGS` (line 31) — Qt-provided macro
- `QT_DISABLE_DEPRECATED_BEFORE=0x060000` (line 36, commented out) — Qt-provided macro

---

## Findings

**A02-1** · LOW · No project header comment in either .pro file
**Description:** Both `mk3.pro` and `mk3-test.pro` carry only the boilerplate QtCreator creation timestamp header (lines 1–5). There is no comment describing what the project builds, its purpose, the target hardware/OS, or any build prerequisites. A developer unfamiliar with the project cannot determine from the file alone what `FleetFocus` is, what platform it runs on, or how it relates to `mk3-test.pro`.
**Fix:** Replace the boilerplate header in each file with a descriptive block, for example:
```
# mk3.pro — FleetFocus production build
# Target: embedded Linux (CIG Mark3 hardware) and Windows (development)
# Prerequisites: Qt 5.x with serialport, serialbus, bluetooth, network modules;
#                ../sdk containing kernel headers and third-party libraries.
# Do NOT build this project for unit testing; use mk3-test.pro instead.
```

---

**A02-2** · LOW · `TEST_MODE=0` is unexplained in both files
**Description:** Line 6 of both `mk3.pro` and `mk3-test.pro` sets `TEST_MODE=0` with no comment. In the test project file this is particularly confusing because a reader would expect the test project to activate test-mode paths, not suppress them. The relationship between `TEST_MODE` and the separate `UNIT_TEST` define (test project, line 7) is not explained anywhere in either file.
**Fix:** Add a comment above line 6 in both files explaining the define, and in `mk3-test.pro` clarify why it remains 0. For example:
```
# TEST_MODE: reserved for future hardware-simulation paths; not currently active.
# Note: unit test compilation is controlled by UNIT_TEST, not TEST_MODE.
DEFINES += "TEST_MODE=0"
```

---

**A02-3** · LOW · Linux-specific SDK block is uncommented
**Description:** Lines 12–16 of both files add `INCLUDEPATH` and `LIBS` entries unconditionally on Linux. There is no comment explaining where this SDK comes from, what it provides (kernel headers, third-party libraries), why it is Linux-only, or what the expected directory layout is relative to the repository root. New contributors on Linux will receive cryptic linker errors if the SDK is absent.
**Fix:** Add a comment above the `linux:` block, for example:
```
# Linux cross-compilation: include CIG SDK headers and third-party libs.
# The SDK must be checked out at ../sdk (sibling to this repository).
linux: {
```

---

**A02-4** · LOW · Intermediate-output directory variables are uncommented
**Description:** Lines 18–21 (both files) redirect Qt's intermediate build artefacts (`RCC_DIR`, `MOC_DIR`, `UI_DIR`, `OBJECTS_DIR`) to a `tmp/` subdirectory. There is no comment explaining why these are redirected (e.g., to keep the source tree clean, to support parallel production/test builds from the same tree). The fact that both project files share the same `tmp/` path means they will overwrite each other's intermediate files when building both configurations from the same directory — this is a latent build correctness issue, but it is also a documentation gap because the intent is not stated.
**Fix:** Add a comment explaining the redirect and, ideally, use distinct subdirectories such as `tmp/release/` and `tmp/test/` in the respective files.

---

**A02-5** · MEDIUM · `TEST_MODE=0` in the test project is functionally misleading
**Description:** `mk3-test.pro` defines both `UNIT_TEST` (line 7) and `TEST_MODE=0` (line 6). The name `TEST_MODE` strongly implies a boolean that should be `1` in a test build. If any source file guards behaviour with `#if TEST_MODE`, test-specific paths will be silently disabled even in the unit test binary. This is a correctness concern that is also a documentation failure: the choice is not justified by any comment.
**Fix:** Audit all `#if TEST_MODE` / `#ifdef TEST_MODE` usages in the source tree. If `TEST_MODE` is truly independent of `UNIT_TEST`, rename it to a name that does not suggest a test toggle (e.g., `HARDWARE_SIM_MODE`), and add a comment in both project files clarifying the distinction.

---

**A02-6** · LOW · `SOURCES`, `HEADERS`, and `FORMS` sections have no organisational comments
**Description:** Each of the three file-list sections in both project files contains 50+ entries spanning five architectural layers (`platform/`, `app/`, `ui/`, `comm/`, `utils/`). None of the entries have inline comments, and there are no section-header comments to group files by subsystem. This makes it difficult to verify completeness at a glance (e.g., when adding a new module) or to understand the role of a file from the project file alone.
**Fix:** Insert inline grouping comments within `SOURCES`, `HEADERS`, and `FORMS`, for example:
```
SOURCES += \
    main.cpp \
    mytranslator.cpp \
    # --- Platform abstraction layer ---
    platform/internalrfid.cpp \
    ...
    # --- Application logic ---
    app/globalconfigs.cpp \
    ...
```

---

**A02-7** · LOW · `TRANSLATIONS` and `DISTFILES` entries are unexplained
**Description:** `TRANSLATIONS = lang_es_ES.ts` (line 189/197) is the sole translation file, implying the application ships only in Spanish alongside the default language. `DISTFILES += netcfg.json` (lines 191–192/199–200) adds a network configuration file to the project but does not explain its purpose or deployment destination. Neither entry has a comment.
**Fix:** Add brief comments:
```
# Spanish (Spain) translation file; update with Qt Linguist before each release.
TRANSLATIONS = lang_es_ES.ts

# Deployment-time network configuration; copied to device by the installer.
DISTFILES += \
    netcfg.json
```

---

**A02-8** · MEDIUM · `mk3-test.pro` has no comment distinguishing it from `mk3.pro`
**Description:** `mk3-test.pro` replicates virtually the entire content of `mk3.pro` with three additions: `testlib` in the `QT` line, `DEFINES += UNIT_TEST`, and four test-specific source/header pairs. There is no header comment, no inline comment, and no section comment that explains this relationship. A developer opening the file in isolation cannot determine how it differs from the production project, whether the two files are meant to be kept in sync manually, or why a single combined project with a configuration variable was not used instead.
**Fix:** Add a header comment to `mk3-test.pro` explaining the relationship:
```
# mk3-test.pro — FleetFocus unit test build
# Mirrors mk3.pro but adds Qt testlib, the UNIT_TEST define, and test
# source files under test/. Keep SOURCES/HEADERS/FORMS in sync with mk3.pro
# when adding production modules.
# Build with: qmake mk3-test.pro && make
```

---

**A02-9** · LOW · Duplicate `utils/logger.h` entry in HEADERS (both files)
**Description:** `utils/logger.h` appears twice in the `HEADERS` list: at line 112 and line 122 in `mk3.pro`, and at lines 120 and 130 in `mk3-test.pro`. While qmake silently deduplicates this, the redundancy indicates that the file lists have been maintained by manual copy-paste without review. This is a documentation/maintenance quality issue.
**Fix:** Remove the duplicate entry and add a comment in the `HEADERS` block reminding maintainers to check for duplicates when editing: `# Note: keep entries unique; qmake deduplicates but duplicates indicate copy-paste errors.`

---

**A02-10** · INFO · QtCreator boilerplate timestamp is the only version/ownership information
**Description:** Both files retain only the auto-generated creation timestamp (`Project created by QtCreator 2018-10-17T08:42:55`). There is no author, project name, copyright, licence reference, or product version recorded in either project file. This is common practice for Qt projects but means there is no single canonical place to find this metadata.
**Fix:** Consider adding a copyright or ownership line to the header comment of each file for traceability, particularly given the product is deployed on safety-relevant industrial hardware.

---

## Summary Table

| ID | Severity | Title | File(s) |
|---|---|---|---|
| A02-1 | LOW | No descriptive project header comment | `mk3.pro`, `mk3-test.pro` |
| A02-2 | LOW | `TEST_MODE=0` define is unexplained | `mk3.pro`, `mk3-test.pro` |
| A02-3 | LOW | Linux SDK block has no explanatory comment | `mk3.pro`, `mk3-test.pro` |
| A02-4 | LOW | Intermediate output directory redirects are uncommented | `mk3.pro`, `mk3-test.pro` |
| A02-5 | MEDIUM | `TEST_MODE=0` in test project is functionally misleading | `mk3-test.pro` |
| A02-6 | LOW | File-list sections lack organisational/grouping comments | `mk3.pro`, `mk3-test.pro` |
| A02-7 | LOW | `TRANSLATIONS` and `DISTFILES` entries are unexplained | `mk3.pro`, `mk3-test.pro` |
| A02-8 | MEDIUM | `mk3-test.pro` has no comment distinguishing it from `mk3.pro` | `mk3-test.pro` |
| A02-9 | LOW | Duplicate `utils/logger.h` entry in `HEADERS` | `mk3.pro`, `mk3-test.pro` |
| A02-10 | INFO | No author/ownership/version information in project files | `mk3.pro`, `mk3-test.pro` |

**Totals:** 0 CRITICAL, 0 HIGH, 2 MEDIUM, 7 LOW, 1 INFO
