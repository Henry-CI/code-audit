# Pass 3 Agent A25 — Documentation

**Audit run:** 2026-02-28-01
**Branch:** master
**Auditor:** A25
**Files reviewed:**
- `ui/unlockreasondialog.h` + `ui/unlockreasondialog.cpp`
- `ui/vorconfirmationdialog.h` + `ui/vorconfirmationdialog.cpp`
- `ui/vorwarningdialog.h` + `ui/vorwarningdialog.cpp`

---

## Reading Evidence

### UnlockReasonDialog (`ui/unlockreasondialog.h`)

**Class:** `UnlockReasonDialog` (inherits `QDialog`)

**Public methods (header):**

| Line | Method |
|------|--------|
| 16 | `explicit UnlockReasonDialog(QWidget *parent = 0)` — constructor |
| 17 | `~UnlockReasonDialog()` — destructor |
| 18 | `QString getReason()` |
| 19 | `void languageChanged(void)` |

**Private methods:**

| Line | Method |
|------|--------|
| 23 | `void setReason()` — connected to every reason-button clicked signal; captures sender button text into `m_reason` and emits `accept()` |

**Signals:** None declared.

**Slots:** None declared with `slots:` keyword; `setReason()` is used as a slot via `connect()` but is declared only as a private method.

**Types / enums / constants:** None.

**Private members:** `Ui::UnlockReasonDialog *ui`, `QString m_reason`.

---

### VORConfirmationDialog (`ui/vorconfirmationdialog.h`)

**Class:** `VORConfirmationDialog` (inherits `QDialog`)

**Public methods (header):**

| Line | Method |
|------|--------|
| 15 | `explicit VORConfirmationDialog(QWidget *parent = 0)` — constructor |
| 16 | `~VORConfirmationDialog()` — destructor |
| 18 | `void isBeingTurnOn(bool on)` |

**Protected methods:**

| Line | Method |
|------|--------|
| 25 | `void hideEvent(QHideEvent *)` — stops the auto-close timer |
| 26 | `void showEvent(QShowEvent *event = 0)` — starts a 10-second single-shot auto-reject timer |

**Signals:** None declared.

**Slots:** None declared with `slots:` keyword; `reject()` and `accept()` are used as slots via `connect()` (inherited from `QDialog`).

**Types / enums / constants:** None.

**Private members:** `Ui::VORConfirmationDialog *ui`, `QTimer *m_timer`.

---

### VORWarningDialog (`ui/vorwarningdialog.h`)

**Class:** `VORWarningDialog` (inherits `QDialog`)

**Public methods (header):**

| Line | Method |
|------|--------|
| 15 | `explicit VORWarningDialog(QWidget *parent = 0)` — constructor |
| 16 | `~VORWarningDialog()` — destructor |

**Protected methods:**

| Line | Method |
|------|--------|
| 23 | `void hideEvent(QHideEvent *)` — stops the auto-close timer |
| 24 | `void showEvent(QShowEvent *event = 0)` — populates the safety warning text in HTML, starts a 30-second single-shot auto-reject timer |

**Signals:** None declared.

**Slots:** None declared with `slots:` keyword.

**Types / enums / constants:** None.

**Private members:** `Ui::VORWarningDialog *ui`, `QTimer *m_timer`.

---

## Documentation Check Results

### UnlockReasonDialog

| Method | Doc comment present? | Accurate? | Parameters/return described? |
|--------|----------------------|-----------|------------------------------|
| Constructor | No | N/A | N/A |
| Destructor | No | N/A | N/A |
| `getReason()` | No | N/A | N/A |
| `languageChanged()` | No | N/A | N/A |
| `setReason()` (private) | No | N/A | N/A |

No doc comments of any form exist in either the header or the implementation file for this class.

`getReason()` returns the text of the most recently clicked reason button (set by `setReason()`). The name suggests a simple getter, but the side effect context (the dialog accepts on button click and the caller retrieves the reason afterwards) is non-obvious.

`languageChanged()` performs a complete UI retranslation of all labels and buttons — a non-trivial responsibility that is not documented.

`setReason()` (private) is connected as a slot to 14 different buttons, captures the sender's text, and emits `accept()` to close the dialog. Its role as a multi-purpose slot and its side effect of emitting `accept()` is undocumented.

---

### VORConfirmationDialog

| Method | Doc comment present? | Accurate? | Parameters/return described? |
|--------|----------------------|-----------|------------------------------|
| Constructor | No | N/A | N/A |
| Destructor | No | N/A | N/A |
| `isBeingTurnOn(bool on)` | No | N/A | N/A |
| `hideEvent()` | No | N/A | N/A |
| `showEvent()` | No | N/A | N/A |

No doc comments of any form exist in either file for this class.

`isBeingTurnOn(bool on)` has a previously identified inverted boolean logic defect: when `on == false`, the method sets the UI to the "turn ON" state, and when `on == true`, the method sets the UI to the "turn OFF" state. The absence of any documentation means:

1. A reader of the header cannot determine the correct interpretation of the `on` parameter without reading the implementation.
2. The inverted logic cannot be flagged as an intentional design choice versus a defect by documentation alone.
3. Callers in other translation units have no indication that passing `true` will render a "turn OFF" confirmation and passing `false` will render a "turn ON" confirmation.

The auto-close timer behaviour (10-second timeout triggers `reject()`) is also completely undocumented in both the header and implementation, which is safety-relevant: if the operator does not respond within 10 seconds the dialog silently closes with a rejection result.

---

### VORWarningDialog

| Method | Doc comment present? | Accurate? | Parameters/return described? |
|--------|----------------------|-----------|------------------------------|
| Constructor | No | N/A | N/A |
| Destructor | No | N/A | N/A |
| `hideEvent()` | No | N/A | N/A |
| `showEvent()` | No | N/A | N/A |

No doc comments of any form exist in either file for this class.

`showEvent()` contains the entirety of the safety-warning text population logic including translatable legal disclaimer text and a 30-second auto-reject timer. None of this is described. A single inline comment `// wait 30 second before closing the dialog` exists at line 57 of the `.cpp` only, which partially documents the timer start but does not explain the consequence (dialog auto-closes via `reject()`, which means the VOR warning is dismissed without operator acknowledgement if no interaction occurs within 30 seconds).

---

## Findings

**A25-1** · LOW · No documentation on `UnlockReasonDialog` public interface

**Description:** Neither the header nor the implementation file for `UnlockReasonDialog` contains any doc comments for its four public methods. The constructor's connection of 14 buttons to a single slot, `getReason()`'s dependency on a prior slot invocation for meaningful return value, and `languageChanged()`'s role as a full UI retranslation method are all undescribed.

**Fix:** Add a class-level comment explaining the dialog's purpose (capturing an operator-selected unlock reason after an impact or checklist lockout). Add a comment above `getReason()` noting that the return value is only meaningful after the dialog has been accepted (i.e., after a reason button was clicked). Add a comment above `languageChanged()` describing its role and when it must be called.

---

**A25-2** · LOW · No documentation on `UnlockReasonDialog::setReason()` slot behaviour

**Description:** `setReason()` is a private method used as a slot that performs two non-obvious actions: it captures the text of the clicked button via `sender()` cast to `QPushButton*`, and it emits `accept()` directly (rather than calling `QDialog::accept()`). This dual responsibility — recording state and closing the dialog — is completely undocumented. Any future maintainer editing this slot is at risk of breaking the accept flow or the reason capture.

**Fix:** Add a comment above the `setReason()` declaration in the header (or at minimum above the definition in the `.cpp`) explaining that it reads `sender()` to extract the button label into `m_reason` and then accepts the dialog.

---

**A25-3** · HIGH · `VORConfirmationDialog::isBeingTurnOn(bool on)` has inverted boolean logic with no documentation

**Description:** The method `isBeingTurnOn(bool on)` is the sole public configuration method of the VOR Confirmation Dialog, a safety-critical dialog that either tags out a vehicle (denying driver access) or removes a tag-out (restoring driver access). The boolean parameter `on` is inverted in the implementation:

- `on == false` → UI displays "turn ON VOR mode", "TURN ON" button, note about tagging out equipment and denying access.
- `on == true` → UI displays "turn OFF VOR mode", "TURN OFF" button, note about restoring driver access.

This is the opposite of what the method name `isBeingTurnOn` and the parameter name `on` suggest. There is no doc comment, no parameter description, no note about this inversion, and no `// intentional` or similar annotation anywhere in the file. Any caller reading only the header will assume `on = true` configures the dialog for a VOR activation (turn-on) and `on = false` for a VOR deactivation (turn-off), which is precisely backwards. If a call site passes the parameter based on its intuitive meaning, the operator will be presented with the wrong confirmation dialog — potentially resulting in unintended VOR mode changes on safety-critical equipment.

**Fix:** At minimum, add a doc comment above the declaration in the header that explicitly states the inverted semantics: e.g., `// NOTE: pass on=false to configure for VOR activation; pass on=true to configure for VOR deactivation`. However, the correct remediation is to fix the boolean inversion in the implementation (addressed in the logic/correctness pass) and then document the corrected semantics with a standard doc comment describing the parameter.

---

**A25-4** · HIGH · Auto-close timer behaviour undocumented in VOR dialogs

**Description:** Both `VORConfirmationDialog` and `VORWarningDialog` implement auto-close timers via `QTimer` that trigger `reject()` if the operator does not interact within a fixed timeout period (10 seconds and 30 seconds respectively). In `VORConfirmationDialog`, a 10-second timeout silently rejects the confirmation dialog, meaning no VOR mode change occurs — but this is not documented anywhere in the header or implementation (no comment at all). In `VORWarningDialog`, the 30-second timeout dismisses the safety warning without acknowledgement; there is only a partial comment (`// wait 30 second before closing the dialog`) at the timer start line in the `.cpp`, which does not explain the safety implication of rejection (the caller must handle `Rejected` to determine whether the operator actually read and acknowledged the warning).

For safety-critical dialogs, the auto-close timeout and its consequence (rejection rather than acceptance) must be documented so that callers know they cannot treat a closed dialog as an implicit acceptance.

**Fix:** Add a class-level comment to both `VORConfirmationDialog` and `VORWarningDialog` headers explaining: (a) that a timer auto-closes the dialog via `reject()`, (b) the timeout duration, and (c) that callers must check the dialog result code to distinguish operator acceptance from a timeout rejection.

---

**A25-5** · MEDIUM · `showEvent()` in VORWarningDialog used as primary initialisation method — undocumented

**Description:** `VORWarningDialog::showEvent()` is the only place where the dialog's safety-warning text, legal disclaimer, and timer are initialised. This is a non-standard pattern: Qt's `showEvent` is a lifecycle hook expected to handle show-time side effects, not primary content population. The implementation builds three large translatable strings and a substantial HTML payload on every show event. There is no comment explaining why initialisation was placed in `showEvent()` rather than the constructor (likely to allow `tr()` to use the current locale at show time rather than construction time). Without documentation, a maintainer might move content initialisation to the constructor, breaking runtime language switching, or might add duplicate content population in both locations.

**Fix:** Add a comment above `showEvent()` in the header (and/or `.cpp`) stating that content is initialised here rather than in the constructor to ensure translatable strings reflect the locale active at display time.

---

**A25-6** · INFO · No class-level documentation on any of the three dialog classes

**Description:** None of the three classes (`UnlockReasonDialog`, `VORConfirmationDialog`, `VORWarningDialog`) has a class-level comment describing its purpose, usage contract, or caller responsibilities. For the two VOR dialogs especially, a brief description of the VOR feature context, the dialog's role in the operator confirmation flow, and how result codes should be interpreted would materially reduce the risk of misuse by future maintainers.

**Fix:** Add a brief class-level comment above each class definition in its header file describing: (a) the dialog's purpose in the application workflow, (b) how it is intended to be invoked, and (c) what the result codes mean in the application context.

---

## Summary Table

| ID | Severity | Title |
|----|----------|-------|
| A25-1 | LOW | No documentation on `UnlockReasonDialog` public interface |
| A25-2 | LOW | No documentation on `UnlockReasonDialog::setReason()` slot behaviour |
| A25-3 | HIGH | `VORConfirmationDialog::isBeingTurnOn(bool on)` has inverted boolean logic with no documentation |
| A25-4 | HIGH | Auto-close timer behaviour undocumented in VOR dialogs |
| A25-5 | MEDIUM | `showEvent()` in `VORWarningDialog` used as primary initialisation method — undocumented |
| A25-6 | INFO | No class-level documentation on any of the three dialog classes |

**Finding counts:** HIGH: 2, MEDIUM: 1, LOW: 2, INFO: 1
