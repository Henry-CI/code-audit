# Pass 3 Agent A01 — Documentation

**Audit run:** 2026-02-28-01
**Branch:** master
**Auditor:** Agent A01
**Files reviewed:** `run_tests`, `netcfg.json`, `.gitignore`, `mk3.pro`, `mk3-test.pro`

---

## Reading Evidence

### `run_tests` (shell script)

- **Purpose:** Executes the compiled `FleetFocus` binary and pipes its output through `awk` to apply ANSI colour codes to PASS/FAIL/DEBUG/WARN lines.
- **Functions/procedures defined:** None (single inline `awk` program).
- **Named constants/variables:** None declared explicitly; ANSI escape sequences `\033[32m` (green), `\033[31m` (red), and `\033[0m` (reset) are embedded as literals.
- **Commands used:**
  - Line 2: `./FleetFocus | awk '...'` — runs the application binary directly and pipes stdout to awk.
  - Lines 3–7: `awk` pattern-action rules for colouring output lines.
- **Existing comments:** Inline `awk` comments on lines 3–7 describe what each colour rule does; no file-level header comment exists.

---

### `netcfg.json`

- **Purpose:** Wi-Fi network configuration file supplying the SSID and password used by the device to join its wireless network. Listed as a `DISTFILES` entry in both `.pro` files (deployed alongside the application binary).
- **Fields defined:**
  - `"password"` (line 2): Wi-Fi pre-shared key — value `"P@ssMK3!"`.
  - `"ssid"` (line 3): Wi-Fi network name — value `"cigSecureConnect"`.
- **Functions/types/constants:** None (JSON data file; no comments are valid JSON syntax).
- **Existing documentation:** None. JSON does not support comments, but no companion documentation file or README references this file.

---

### `.gitignore`

- **Purpose:** Tells Git which files and directories to exclude from version control.
- **Entries defined:**
  - Line 1: `Makefile` — excludes the generated Qt Makefile.
  - Line 2: `FleetFocus` — excludes the compiled application binary.
  - Line 3: `.*` — excludes all dot-files and dot-directories.
  - Line 5: `/tmp` — excludes the top-level `tmp/` directory (used by Qt for intermediate build artefacts).
  - Line 7: `!.gitignore` — re-includes `.gitignore` itself (negation of the `.*` rule above).
  - Line 8: `*.bak` — excludes backup files.
- **Functions/types/constants:** None (configuration file).
- **Existing comments:** None.

---

### `mk3.pro` (Qt project file — production build)

- **Purpose:** qmake project descriptor for the production `FleetFocus` application. Specifies Qt modules, include paths, library paths, intermediate-output directories, source/header/form/resource/translation file lists, and a `DISTFILES` entry for `netcfg.json`.
- **Key settings (line numbers):**
  - Line 6: `DEFINES += "TEST_MODE=0"` — disables test mode for production build.
  - Line 8: `QT += core gui serialport serialbus bluetooth network` — Qt modules required.
  - Line 10: `greaterThan(QT_MAJOR_VERSION, 4): QT += widgets` — adds widgets module for Qt 5+.
  - Lines 12–16: `linux:` block — Linux-only SDK include/lib paths.
  - Lines 18–21: Intermediate build output directory assignments (`RCC_DIR`, `MOC_DIR`, `UI_DIR`, `OBJECTS_DIR`).
  - Line 23: `TARGET = FleetFocus` — output binary name.
  - Line 24: `TEMPLATE = app` — builds as a standalone application.
  - Line 30: `DEFINES += QT_DEPRECATED_WARNINGS` — enables deprecation warnings.
  - Lines 38–96: `SOURCES` list (58 `.cpp` files).
  - Lines 98–157: `HEADERS` list (note: `utils/logger.h` appears at both line 112 and line 122 — duplicate entry).
  - Lines 160–184: `FORMS` list (23 `.ui` files).
  - Line 186–187: `RESOURCES` — `mk3.qrc`.
  - Line 189: `TRANSLATIONS = lang_es_ES.ts` — Spanish (Spain) translation file.
  - Lines 191–192: `DISTFILES` — `netcfg.json`.
- **Functions/types/constants:** None (qmake variable-assignment file).
- **Existing comments:** Auto-generated QtCreator header (lines 1–5); boilerplate Qt deprecation-warning block comment (lines 26–35). No project-specific explanatory comments.

---

### `mk3-test.pro` (Qt project file — unit-test build)

- **Purpose:** qmake project descriptor for the unit-test build of `FleetFocus`. Mirrors `mk3.pro` almost exactly but adds `Qt testlib` module, defines `UNIT_TEST`, and prepends four test source/header files (`test/test_ota`, `test/test_dialog`, `test/test_backgroundworker`, `test/test_canbus`). Does **not** include `main.cpp` (test harness entry point is presumably inside one of the test files).
- **Key settings (line numbers):**
  - Line 6: `DEFINES += "TEST_MODE=0"` — test-mode flag; value is `0` despite this being the test project file (see finding A01-5).
  - Line 7: `DEFINES += UNIT_TEST` — preprocessor flag enabling unit-test code paths.
  - Line 9: `QT += core gui serialport serialbus bluetooth network testlib` — adds `testlib` vs production.
  - Lines 40–43: Four test `.cpp` files prefixed to `SOURCES`.
  - Lines 103–106: Four test `.h` files prefixed to `HEADERS`.
  - Lines 168–200: `FORMS`, `RESOURCES`, `TRANSLATIONS`, `DISTFILES` — identical to `mk3.pro`.
- **Duplicate header entry:** `utils/logger.h` appears at both line 120 and line 130 (same as `mk3.pro`).
- **Functions/types/constants:** None (qmake variable-assignment file).
- **Existing comments:** Same auto-generated header and Qt boilerplate as `mk3.pro`; no test-specific explanatory comments.

---

## Findings

**A01-1** · HIGH · `netcfg.json` stores a plaintext credential with no documentation

**Description:** `netcfg.json` contains a Wi-Fi pre-shared key (`"P@ssMK3!"`) and SSID in plaintext. There is no header comment, companion README, or inline annotation explaining what network this credential is for, whether it is a default/placeholder that must be changed before deployment, or what tool reads or writes this file. Developers and deployers have no documented guidance about the credential's lifecycle or sensitivity. (Note: the credential exposure itself is a security concern reported separately in the security passes; this finding addresses the absence of documentation about it.)

**Fix:** Add a companion `netcfg.json.example` (with redacted credential) and a comment block in the nearest README or deployment guide explaining: the file's purpose, which component reads it, whether the password is a factory default that must be rotated per deployment, and how to provision the file securely on the target device.

---

**A01-2** · MEDIUM · `run_tests` has no file-level header comment

**Description:** The script has no header comment explaining what it does, what prerequisites it requires (the `FleetFocus` binary must already be built and present in the current directory), how to run it, or what its exit behaviour is. A developer encountering it for the first time has to infer all of this from the code.

**Fix:** Add a header comment block immediately after the shebang line that states the script's purpose, prerequisite (a built `FleetFocus` binary in `./`), expected working directory, and a brief note on the awk colour-coding convention used.

---

**A01-3** · MEDIUM · `.gitignore` has no comments explaining non-obvious rules

**Description:** The `.gitignore` file contains several rules that are not self-explanatory to a new contributor:
- Line 3 (`.*`) — silently excludes all dot-files and dot-directories; the line 7 negation (`!.gitignore`) is the only safeguard keeping the file itself tracked. The relationship between these two rules is opaque without a comment.
- Line 5 (`/tmp`) — it is not obvious that this corresponds to the `tmp/` intermediate-build-output directories declared in the `.pro` files (`RCC_DIR`, `MOC_DIR`, `UI_DIR`, `OBJECTS_DIR`).
- Line 2 (`FleetFocus`) — it is not obvious that this is the built binary name rather than a directory or source file.

**Fix:** Add brief inline or section comments explaining each rule group, e.g.: `# Qt build intermediate artefacts`, `# Compiled application binary`, `# Exclude all dot-files except this file`, `# Qt intermediate output dirs (see RCC_DIR/MOC_DIR/UI_DIR/OBJECTS_DIR in .pro)`.

---

**A01-4** · MEDIUM · `mk3.pro` and `mk3-test.pro` share no comment explaining the relationship between the two project files

**Description:** Neither `.pro` file contains any comment explaining that one is for production builds and the other for unit testing, how to choose between them, or what the `UNIT_TEST` / `TEST_MODE` defines control at runtime. A developer checking out the repository for the first time cannot determine from the files themselves which project file to open in Qt Creator for normal development vs running tests.

**Fix:** Add a single-line comment near the top of each file (below the auto-generated header) stating its role: e.g., `# Production build — use this project for device deployment` in `mk3.pro` and `# Unit-test build — includes Qt testlib and test/ sources; use with run_tests script` in `mk3-test.pro`.

---

**A01-5** · LOW · `TEST_MODE=0` in `mk3-test.pro` is misleading and undocumented

**Description:** `mk3-test.pro` sets `DEFINES += "TEST_MODE=0"` (line 6), the same value as the production `mk3.pro`. Because `UNIT_TEST` is also defined (line 7), the intent of having two separate defines is unclear. There is no comment explaining what `TEST_MODE` controls vs what `UNIT_TEST` controls, or why `TEST_MODE` remains `0` in the test project. A developer may assume setting `TEST_MODE=1` is required for testing and be confused to find it is not.

**Fix:** Add a comment on or above the `TEST_MODE` line in both `.pro` files clarifying the distinction: e.g., `# TEST_MODE controls hardware-stub behaviour at runtime; UNIT_TEST enables compile-time test-only code paths`.

---

**A01-6** · LOW · Duplicate `utils/logger.h` entry in both `.pro` files is undocumented

**Description:** `utils/logger.h` appears twice in the `HEADERS` list of `mk3.pro` (lines 112 and 122) and twice in `mk3-test.pro` (lines 120 and 130). While qmake silently deduplicates this, the duplication suggests a copy-paste error and may confuse maintainers who try to understand the full header set or search for where a header was intentionally included. There is no comment marking it as intentional.

**Fix:** Remove the duplicate entry from both files. If the duplication is somehow intentional, add a comment explaining why.

---

**A01-7** · LOW · `mk3.pro` and `mk3-test.pro` have no comment on the Linux-only SDK block

**Description:** Lines 12–16 in both `.pro` files introduce a `linux:` conditional block that adds external SDK include and library paths (`../sdk/kernel_include`, `../sdk/3rd/include`, `../sdk//3rd/lib`). There is no comment explaining what SDK this is, why it is Linux-only, or where the SDK is obtained. This makes cross-platform development and build environment setup unnecessarily opaque.

**Fix:** Add a comment above the `linux:` block identifying the SDK (e.g., board vendor SDK name/version), why it is conditionally included for Linux only, and pointing to any setup instructions.

---

**A01-8** · INFO · `TRANSLATIONS` entry is present but undocumented in both `.pro` files

**Description:** `TRANSLATIONS = lang_es_ES.ts` (line 189 of `mk3.pro`, line 197 of `mk3-test.pro`) registers a Spanish (Spain) translation file. There is no comment explaining how to update translations (i.e., when to run `lupdate`/`lrelease`), why only Spanish is listed, or whether additional locales are planned. New contributors may not know translations exist or how to maintain them.

**Fix:** Add a brief comment above the `TRANSLATIONS` line, e.g.: `# Supported translations; run 'lupdate mk3.pro' to update and 'lrelease' to compile`.

---

## Summary Table

| ID     | Severity | Title                                                                 |
|--------|----------|-----------------------------------------------------------------------|
| A01-1  | HIGH     | `netcfg.json` stores a plaintext credential with no documentation    |
| A01-2  | MEDIUM   | `run_tests` has no file-level header comment                         |
| A01-3  | MEDIUM   | `.gitignore` has no comments explaining non-obvious rules            |
| A01-4  | MEDIUM   | No comment explains the relationship between the two `.pro` files    |
| A01-5  | LOW      | `TEST_MODE=0` in `mk3-test.pro` is misleading and undocumented       |
| A01-6  | LOW      | Duplicate `utils/logger.h` entry in both `.pro` files is undocumented|
| A01-7  | LOW      | Linux-only SDK block has no comment identifying the SDK              |
| A01-8  | INFO     | `TRANSLATIONS` entry is present but undocumented                     |

**Total findings:** 8 (1 HIGH, 3 MEDIUM, 3 LOW, 1 INFO)
