# Pass 1 Audit — A20
**Auditor:** A20
**Date:** 2026-02-28
**Branch:** master (confirmed)

---

## Reading Evidence

### informationdialog.h / informationdialog.cpp / informationdialog.ui

**File paths:**
- `/c/Projects/cig-audit/repos/mark3-pvd/ui/informationdialog.h`
- `/c/Projects/cig-audit/repos/mark3-pvd/ui/informationdialog.cpp`
- `/c/Projects/cig-audit/repos/mark3-pvd/ui/informationdialog.ui`

**Class:** `InformationDialog` extends `QDialog`

**Q_OBJECT macro:** `informationdialog.h` line 18

**Public methods:**
- `explicit InformationDialog(QWidget *parent = 0)` — h:21 / cpp:11
- `~InformationDialog()` — h:22 / cpp:101
- `void updateInformationScreen()` — h:23 / cpp:233
- `void setLux(int lux)` — h:24 / cpp:106
- `void setStatus(QByteArray IO, bool Rly1, bool Rly2, QByteArray can, const QByteArray &rssi, const QByteArray &moni, bool netStat, bool mdemStat, bool wifiStat, qint8 sat, qint32 lat, qint32 lon)` — h:25 / cpp:111
- `void setConfigParam()` — h:26 / cpp:137
- `void setBatteryStatus(bool avail, int state, int fault, quint16 voltage, qint16 current, quint16 temp, quint16 remainingCapacity)` — h:27 / cpp:126
- `void setExpModInfo(QByteArray mainVersion)` — h:28 / cpp:195
- `void setSuperMasterStatus()` — h:29 / cpp:200
- `void setVOR()` — h:30 / cpp:220
- `void setLastWiegand(quint64 id)` — h:31 / cpp:228
- `void languageChanged()` — h:32 / cpp:240

**Signals:** none declared

**Slots (protected):**
- `void showEvent(QShowEvent *)` — h:35 / cpp:94
- `void hideEvent(QHideEvent *)` — h:36 / cpp:89

**#include directives (cpp):**
- `#include "informationdialog.h"` (line 1)
- `#include "ui_informationdialog.h"` (line 2)
- `#include "app/globalconfigs.h"` (line 3)
- `#include "utils/barcode128.h"` (line 4)
- `#include <QBluetoothAddress>` (line 5)
- `#include <QProcess>` (line 6)
- `#include <QFile>` (line 7)

**Member variables (h):**
- `Ui::InformationDialog *ui` — h:39
- `QMap<int, QString> m_chargeStatusMap` — h:40
- `QMap<int, QString> m_chargeFaultMap` — h:41
- `QTimer *m_updateConfigTmr` — h:42

**UI widgets (informationdialog.ui):** QPushButton `btnHide`; QTabWidget `tabWidget` with tabs: System, Status, Configuration, Diagnostics; numerous QLabel widgets including: `labelHwVer`, `labelKernelVer`, `labelRootfsVer`, `labelAppVer`, `labelExpVer`, `lblgmtpid`, `labelBarcode`, `lblRelay1`, `lblCSQ`, `lblNetworkStatus`, `lblModemStatus`, `lblWifiStatus`, `lblDigitalIO`, `lblCAN`, `lblMoni`, `lblSMStatus`, `lblVOR`, `labelGPSSat`, `labelGPSLat`, `labelGPSLong`, `lblKeepAliveTime`, `lblshutDTime`, `lblMaint`, `lblServerProfile1`, `lblServerProfile2`, `lblServerProfile3`, `lblMacAddress`, `lblMacAddress_2`, `lblChkTimeout`, `lblChkSchedule1`–`lblChkSchedule4`, `lblTimezone`, `lblTHost`, `lblIdle`, `lblLastCheck`, `lblShockParam`, `lblICCID`, `labelBattPres`, `labelBattStat`, `labelBattFault`, `labelBattVolt`, `labelBattCurr`, `labelBattTemp`, `labelBattCap`, `labelWiegand`, `labelLux`, `labelGPSSat`, `labelGPSLat`, `labelGPSLong`; many static QLabel description labels (label_3 through label_42 with gaps).

---

### keyfilter.h / keyfilter.cpp

**File paths:**
- `/c/Projects/cig-audit/repos/mark3-pvd/ui/keyfilter.h`
- `/c/Projects/cig-audit/repos/mark3-pvd/ui/keyfilter.cpp`

**Class:** `KeyFilter` extends `QObject`

**Q_OBJECT macro:** `keyfilter.h` line 10

**Public methods:**
- `explicit KeyFilter(QObject *parent = nullptr)` — h:12 / cpp:8
- `static bool isPowerKeyPressed()` — h:13 (inline, returns `m_powerKeyPressed`)

**Signals:**
- `void showInfoDialog()` — h:16

**Protected methods:**
- `bool eventFilter(QObject *obj, QEvent *event)` — h:18 / cpp:20

**Private methods:**
- `void resetKeyCount()` — h:34 / cpp:66
- `void incrementKeyCount(int key)` — h:35 / cpp:76
- `int getKeyCount(int key)` — h:36 / cpp:101
- `void resetKeyCounter(int key)` — h:37 / cpp:114
- `bool getPressState(int key)` — h:38 / cpp:145
- `void setPressState(int key, bool state)` — h:39 / cpp:126

**#include directives (cpp):**
- `#include "keyfilter.h"` (line 1)
- `#include <QEvent>` (line 2)
- `#include <QKeyEvent>` (line 3)
- `#include <QTimer>` (line 4)

**Member variables (h):**
- `static bool m_powerKeyPressed` — h:21
- `QSet<int> m_pressedKeys` — h:22
- `QTimer *m_timer` — h:24
- `int m_leftKeyCount` — h:25
- `int m_rightKeyCount` — h:26
- `int m_upKeyCount` — h:27
- `int m_downKeyCount` — h:28
- `bool m_leftKeyPressed` — h:29
- `bool m_rightKeyPressed` — h:30
- `bool m_upKeyPressed` — h:31
- `bool m_downKeyPressed` — h:32

---

### languagedialog.h / languagedialog.cpp / languagedialog.ui

**File paths:**
- `/c/Projects/cig-audit/repos/mark3-pvd/ui/languagedialog.h`
- `/c/Projects/cig-audit/repos/mark3-pvd/ui/languagedialog.cpp`
- `/c/Projects/cig-audit/repos/mark3-pvd/ui/languagedialog.ui`

**Class:** `LanguageDialog` extends `QDialog`

**Q_OBJECT macro:** `languagedialog.h` line 12

**Public methods:**
- `explicit LanguageDialog(QWidget *parent = nullptr)` — h:15 / cpp:12
- `~LanguageDialog()` — h:16 / cpp:25
- `void languageChanged()` — h:17 / cpp:76
- `void startScreenTimeout()` — h:18 / cpp:84

**Signals:**
- `void sigLanguageChanged()` — h:21

**Private slots:**
- `void on_btnEnglish_clicked()` — h:24 / cpp:30
- `void on_btnSpanish_clicked()` — h:25 / cpp:42
- `void on_btnQuit_clicked()` — h:26 / cpp:54

**Protected methods:**
- `void showEvent(QShowEvent *event = 0)` — h:29 / cpp:59

**#include directives (cpp):**
- `#include "languagedialog.h"` (line 1)
- `#include "ui_languagedialog.h"` (line 2)
- `#include "app/globalconfigs.h"` (line 3)
- `#include "mytranslator.h"` (line 4)
- `#include "ui/dialog.h"` (line 5)
- `#include <QTimer>` (line 6)
- `#include <QLocale>` (line 7)
- `#include <QDebug>` (line 8)

**Member variables (h):**
- `Ui::LanguageDialog *ui` — h:32
- `QTimer *m_timer` — h:33
- `quint32 m_lastPress` — h:35

**UI widgets (languagedialog.ui):** QLabel `labelMsg`; QPushButton `btnEnglish`; QPushButton `btnSpanish`; QPushButton `btnQuit`.

---

### mytranslator.h / mytranslator.cpp (referenced by languagedialog)

**File paths:**
- `/c/Projects/cig-audit/repos/mark3-pvd/mytranslator.h`
- `/c/Projects/cig-audit/repos/mark3-pvd/mytranslator.cpp`

**Global constants:** `langEnglish = "EN"`, `langSpanish = "ES"` (h:11–12)
**Global variable:** `extern QTranslator mTranslator` (h:14)

**Free functions:**
- `void loadLocalLanguage(void)` — cpp:15
- `void updateLocalLanguage(const QString &arg1)` — cpp:74
- `QString getCurrentLanguage(void)` — cpp:132
- `int queryLanguage(void)` — cpp:167
- `int setLanguage(int local)` — cpp:177
- `void removeTranslator()` — cpp:190

**#include directives (cpp):**
- `#include <QApplication>`, `#include <QFile>`, `#include <QDebug>`, `#include <QTranslator>`, `#include "mytranslator.h"`

**Key file reads:**
- `localFile = "local.dat"` (relative path, cpp:7) — read/written to store active language code
- `langFile = ":/lang.dat"` (Qt resource, cpp:8) — read-only resource embedded in binary mapping language codes to translation filenames

---

## Security Review

### 1. Memory Safety

No `strcpy`, `strcat`, `sprintf`, `gets`, `memcpy`, or `memmove` usage found in the audited files. `QString::asprintf` is used throughout `informationdialog.cpp` with fixed format literals and typed arguments only — no user-controlled format strings. Raw `new` is used to allocate `ui` (both dialogs) and `m_updateConfigTmr` / `m_timer`, but all are deleted in destructors or parented to the dialog (Qt parent-child memory management). No unguarded array index access observed.

One marginal note: `informationdialog.cpp` line 53 computes `ba.mid(14, id1 - 15)` from `/proc/version` content. If `id1` is 14, the length argument is `-1` which in Qt's `QByteArray::mid` is treated as "to end of array" — this is benign but worth noting as it reads a kernel-provided file, not attacker-controlled data. No exploitable path identified.

Memory Safety: no issues found.

---

### 2. Communication Security

**A20-1** · MEDIUM · Communication Security
**File:** `/c/Projects/cig-audit/repos/mark3-pvd/ui/informationdialog.cpp:150-158`
**Description:** `setConfigParam()` renders the APN username (`gCfg->apnUser()`) and APN password (`gCfg->apnPassword()`) in plaintext inside a QLabel on the Configuration tab of the information screen. This screen is accessible at runtime by pressing any directional key four times (or a three-key combo via KeyFilter). If an operator or bystander accesses this screen, the modem APN credentials are visible in clear text on the display. On a vehicle-mounted device in a shared or high-traffic environment, this represents unintended credential exposure.

---

### 3. Input Handling

**A20-2** · HIGH · Input Handling — Hidden Debug/Info Menu via Key Sequence
**File:** `/c/Projects/cig-audit/repos/mark3-pvd/ui/keyfilter.cpp:26-43`
**Description:** `KeyFilter::eventFilter` implements two undocumented key sequences that silently emit `showInfoDialog()` and open the information/diagnostic screen: (1) simultaneous press of Left + Up + Down (three keys held at once, line 26–30); (2) pressing any single directional key exactly four times within 1.5 seconds (lines 31–43). The information screen that is revealed displays system configuration, APN credentials, server addresses, modem status, GPS coordinates, battery diagnostics, and Wiegand card IDs. There is no authentication, PIN, or operator-role check before the screen is shown. On a vehicle-mounted embedded device accessible to operators and drivers, this constitutes an unauthenticated hidden diagnostic menu reachable via the physical keypad.

**A20-3** · MEDIUM · Input Handling — `eventFilter` consumes all key events unconditionally
**File:** `/c/Projects/cig-audit/repos/mark3-pvd/ui/keyfilter.cpp:49, 60`
**Description:** Both the `KeyPress` and `KeyRelease` branches of `eventFilter` return `true` unconditionally (lines 49 and 60), preventing any key event from being propagated further up the event chain regardless of whether `KeyFilter` handled it. This means legitimate UI elements that rely on keyboard navigation or input will silently receive no key events when this filter is installed. While primarily a correctness/availability issue, the suppression of all key events is a defence-in-depth concern: if an attacker can trigger UI states where input is expected (e.g., a PIN or numeric entry widget), no characters will reach those widgets, potentially bypassing intended input validation flows entirely.

**A20-4** · LOW · Input Handling — `m_rightKeyPressed` initialisation missing in constructor
**File:** `/c/Projects/cig-audit/repos/mark3-pvd/ui/keyfilter.cpp:8-18`
**Description:** The constructor member-initialiser list sets `m_leftKeyPressed(false)` (line 14) but does not explicitly initialise `m_rightKeyPressed`, `m_upKeyPressed`, or `m_downKeyPressed`. In C++, non-static bool members of a class that are not initialised in the constructor initialiser list or at the point of declaration are left with indeterminate values. If `getPressState` is called for Right, Up, or Down before `setPressState` has been called, the returned value is undefined. This could cause the key-repeat suppression logic (line 31: `!getPressState(key)`) to behave incorrectly, potentially allowing key events to be processed multiple times or ignored.

---

### 4. Build Security

Build Security: no issues found in the audited files (build configuration files were not part of this assignment).

---

### 5. Device and Firmware

**A20-5** · HIGH · Device and Firmware — Unauthenticated access to sensitive device information via hidden key sequences
**File:** `/c/Projects/cig-audit/repos/mark3-pvd/ui/keyfilter.cpp:26-43`
**Description:** As noted in A20-2, two hidden key sequences open a diagnostic screen without any authentication. The information exposed on that screen includes: kernel and rootfs version strings (useful for targeting exploits), GMTP server addresses and ports, APN credentials, modem and WiFi MAC addresses, GPS satellite count and coordinates, Wiegand card IDs, on-demand (super-master) status including operator IDs and session timing, shock sensor thresholds, and SIM card ICCID. The combination of unauthenticated physical access and the breadth of information disclosed represents a significant device and firmware security weakness for a deployed safety-critical proximity detection device.

**A20-6** · INFO · Device and Firmware — Kernel and rootfs version disclosed on information screen
**File:** `/c/Projects/cig-audit/repos/mark3-pvd/ui/informationdialog.cpp:44-63`
**Description:** The constructor reads `/proc/version` and `/home/root_version` and displays both on the System tab. While not independently a vulnerability, exposing the precise kernel version string assists an attacker in identifying known CVEs applicable to the device firmware. This information should be restricted to authenticated maintenance personnel.

---

### 6. Qt-Specific Security

**A20-7** · INFO · Qt-Specific Security — `QProcess` included but not used
**File:** `/c/Projects/cig-audit/repos/mark3-pvd/ui/informationdialog.cpp:6`
**Description:** `#include <QProcess>` is present in `informationdialog.cpp` but no `QProcess` call appears anywhere in the file. This is dead code / an unused include. While not a vulnerability on its own, unused includes that reference process-spawning capabilities may indicate previously removed or future-planned use of `QProcess`. If `QProcess` usage is ever added to this file with arguments derived from the configuration data displayed here (server addresses, ICCID, etc.), it would become a command-injection risk. The include should be removed.

**A20-8** · LOW · Qt-Specific Security — Translation filename from resource file loaded via `QTranslator::load()` without path sanitisation
**File:** `/c/Projects/cig-audit/repos/mark3-pvd/mytranslator.cpp:37, 94`
**Description:** `loadLocalLanguage()` and `updateLocalLanguage()` read a language-to-filename mapping from the embedded Qt resource `:/lang.dat`, split each line on a space, and pass `list[1]` (the filename field) directly to `mTranslator.load(filename)` without any path sanitisation (lines 37 and 94). `QTranslator::load()` accepts both resource paths and filesystem paths, and will attempt to open the file if it is not found as a resource. If an attacker can modify the `:/lang.dat` resource (e.g., via a firmware replacement attack or if the resource is somehow writable at runtime), they could cause `QTranslator::load()` to load a crafted `.qm` file from an arbitrary filesystem path. The risk is mitigated because `:/lang.dat` is an embedded read-only Qt resource in normal builds, but the absence of filename validation is a latent path traversal weakness if the resource origin is ever changed or the binary is tampered with.
