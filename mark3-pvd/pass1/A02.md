# A02 — Build Configuration Security Audit
**Auditor:** Pass 1 A02
**Date:** 2026-02-28
**Branch:** master
**Files reviewed:** `mk3.pro`, `mk3-test.pro`

---

## Reading Evidence

### mk3.pro

**TARGET:** `FleetFocus`
**TEMPLATE:** `app`

**SOURCES:**
- `main.cpp`
- `mytranslator.cpp`
- `platform/internalrfid.cpp`
- `platform/wiegandrfid.cpp`
- `platform/pwmbeeper.cpp`
- `platform/pwmbacklight.cpp`
- `platform/internalrtc.cpp`
- `platform/powersupply.cpp`
- `platform/blecentral.cpp`
- `app/globalconfigs.cpp`
- `ui/amberimpactalertdialog.cpp`
- `ui/languagedialog.cpp`
- `ui/onScreenKeyboard.cpp`
- `ui/broadcastuidialog.cpp`
- `ui/pindialog.cpp`
- `ui/authoriseddialog.cpp`
- `ui/checkstartdialog.cpp`
- `ui/checkquestiondialog.cpp`
- `ui/checkconfirmationdialog.cpp`
- `ui/checkcompleteddialog.cpp`
- `ui/lockeddialog.cpp`
- `ui/supervisordialog.cpp`
- `ui/unlockeddialog.cpp`
- `ui/warningdialog.cpp`
- `utils/logger.cpp`
- `platform/canbus.cpp`
- `app/checklist.cpp`
- `app/driverlist.cpp`
- `app/crctable.cpp`
- `platform/gnssreceiver.cpp`
- `comm/canmonitor.cpp`
- `comm/canstatehandler.cpp`
- `comm/bleexpansion.cpp`
- `comm/bleexpansionuuid.cpp`
- `comm/bleinputhandler.cpp`
- `platform/modemport.cpp`
- `comm/modemchat.cpp`
- `app/backgroundworker.cpp`
- `platform/userport.cpp`
- `comm/gmtpchat.cpp`
- `comm/ntpsync.cpp`
- `ui/messagedialog.cpp`
- `ui/dialog.cpp`
- `comm/ftpclient.cpp`
- `platform/seriallogger.cpp`
- `platform/aescrypto.cpp`
- `comm/canexpansion.cpp`
- `ui/keyfilter.cpp`
- `ui/informationdialog.cpp`
- `utils/barcode128.cpp`
- `ui/ondemanddialog.cpp`
- `ui/optionalcheckconfirmationdialog.cpp`
- `platform/wifi.cpp`
- `ui/vorwarningdialog.cpp`
- `ui/vorconfirmationdialog.cpp`
- `ui/commentdialog.cpp`
- `ui/preopscreenoverlay.cpp`
- `ui/unlockreasondialog.cpp`

**HEADERS:**
- `mytranslator.h`
- `platform/internalrfid.h`
- `platform/wiegandrfid.h`
- `platform/pwmbeeper.h`
- `platform/pwmbacklight.h`
- `platform/internalrtc.h`
- `platform/powersupply.h`
- `ui/amberimpactalertdialog.h`
- `ui/languagedialog.h`
- `ui/onScreenKeyboard.h`
- `ui/supervisordialog.h`
- `ui/broadcastuidialog.h`
- `ui/warningdialog.h`
- `utils/logger.h` (listed twice)
- `platform/blecentral.h`
- `ui/pindialog.h`
- `ui/authoriseddialog.h`
- `ui/checkstartdialog.h`
- `ui/checkquestiondialog.h`
- `ui/checkconfirmationdialog.h`
- `ui/checkcompleteddialog.h`
- `ui/lockeddialog.h`
- `ui/unlockeddialog.h`
- `platform/canbus.h`
- `app/cigconfigs.h`
- `app/checklist.h`
- `app/driverlist.h`
- `app/globalconfigs.h`
- `comm/canmonitor.h`
- `comm/canstatehandler.h`
- `comm/bleexpansion.h`
- `comm/bleexpansionuuid.h`
- `comm/bleinputhandler.h`
- `platform/gnssreceiver.h`
- `platform/modemport.h`
- `comm/modemchat.h`
- `app/backgroundworker.h`
- `platform/userport.h`
- `comm/gmtpchat.h`
- `utils/bytearray.h`
- `comm/ntpsync.h`
- `ui/messagedialog.h`
- `ui/dialog.h`
- `comm/ftpclient.h`
- `platform/seriallogger.h`
- `platform/aescrypto.h`
- `comm/canexpansion.h`
- `ui/keyfilter.h`
- `ui/informationdialog.h`
- `utils/barcode128.h`
- `ui/ondemanddialog.h`
- `ui/optionalcheckconfirmationdialog.h`
- `platform/wifi.h`
- `ui/vorwarningdialog.h`
- `ui/vorconfirmationdialog.h`
- `ui/commentdialog.h`
- `ui/preopscreenoverlay.h`
- `ui/unlockreasondialog.h`

**LIBS:**
- `-L../sdk/3rd/lib` (linux-conditional; no specific `-l` library names specified in the .pro file itself)

**DEFINES:**
- `TEST_MODE=0`
- `QT_DEPRECATED_WARNINGS`

**QT modules:**
- `core`
- `gui`
- `serialport`
- `serialbus`
- `bluetooth`
- `network`
- `widgets` (Qt 5+)

**CONFIG entries:** None explicitly set (no `CONFIG +=` lines present)

**QMAKE_STRIP:** Not set

---

### mk3-test.pro

**TARGET:** `FleetFocus`
**TEMPLATE:** `app`

**SOURCES:** Same as mk3.pro plus:
- `test/test_ota.cpp`
- `test/test_dialog.cpp`
- `test/test_backgroundworker.cpp`
- `test/test_canbus.cpp`

**HEADERS:** Same as mk3.pro plus:
- `test/test_ota.h`
- `test/test_dialog.h`
- `test/test_backgroundworker.h`
- `test/test_canbus.h`

**LIBS:**
- `-L../sdk/3rd/lib` (linux-conditional; no specific `-l` library names)

**DEFINES:**
- `TEST_MODE=0`
- `UNIT_TEST`
- `QT_DEPRECATED_WARNINGS`

**QT modules:**
- `core`
- `gui`
- `serialport`
- `serialbus`
- `bluetooth`
- `network`
- `testlib`
- `widgets` (Qt 5+)

**CONFIG entries:** None explicitly set

**QMAKE_STRIP:** Not set

---

## Security Review

### 1. Memory Safety

Memory Safety: no issues found at the .pro file level. (Memory safety issues in source files are out of scope for this file assignment.)

### 2. Communication Security

Communication Security: no issues found at the .pro file level. (The presence of `comm/ftpclient.cpp`, `comm/gmtpchat.cpp`, `comm/modemchat.cpp`, and `comm/ntpsync.cpp` are noted as subjects requiring deeper source-level review in subsequent passes.)

### 3. Input Handling

Input Handling: no issues found at the .pro file level.

### 4. Build Security

**A02-1** · HIGH · Build Security — Missing stack protection flag
**File:** `mk3.pro:1`
**Description:** Neither `mk3.pro` nor `mk3-test.pro` sets `-fstack-protector-strong` via `QMAKE_CXXFLAGS`. Stack buffer overflows on this embedded device will not be detected at runtime. On a vehicle proximity detection device a stack smash could cause a silent crash or unsafe state with no trap.

**A02-2** · HIGH · Build Security — Missing FORTIFY_SOURCE
**File:** `mk3.pro:1`
**Description:** `-D_FORTIFY_SOURCE=2` is absent from `DEFINES` and `QMAKE_CXXFLAGS` in both .pro files. Standard library buffer overflow checks (e.g. for `memcpy`, `sprintf`) will not be enabled, removing a defence-in-depth layer for the embedded binary.

**A02-3** · HIGH · Build Security — Missing position-independent executable flags
**File:** `mk3.pro:1`
**Description:** Neither `-fPIE` nor `-pie` appear in either .pro file. Without PIE the binary cannot benefit from ASLR on Linux-based embedded targets, making exploitation of any memory corruption significantly easier.

**A02-4** · MEDIUM · Build Security — Missing format-string warning flags
**File:** `mk3.pro:1`
**Description:** `-Wformat` and `-Wformat-security` are not set in either .pro file. Format string vulnerabilities in `printf`/`qDebug` call sites will not be caught at compile time. The project includes `utils/logger.cpp` and multiple UI components that may pass dynamic strings to format functions.

**A02-5** · MEDIUM · Build Security — No explicit release CONFIG
**File:** `mk3.pro:1`
**Description:** Neither .pro file contains `CONFIG += release`. Without this, qmake may default to a debug build depending on the invoking environment, potentially shipping a debug-optimised binary with extra diagnostic output and without full optimisation. Production firmware builds should explicitly enforce `CONFIG += release`.

**A02-6** · MEDIUM · Build Security — QMAKE_STRIP not configured
**File:** `mk3.pro:1`
**Description:** `QMAKE_STRIP` is not set in `mk3.pro`. Debug symbols will not be stripped from the production binary unless the build environment provides a default strip step. Unstripped firmware shipped to the field exposes internal symbol names, function signatures, and string literals, aiding reverse engineering of the proximity detection logic and communication protocols.

**A02-7** · LOW · Build Security — Third-party SDK library path without explicit library names
**File:** `mk3.pro:15`
**Description:** `LIBS += -L../sdk/3rd/lib` adds a third-party library search path under a relative `../sdk` directory without specifying which libraries are linked (`-l` flags). Any library present in that path at build time will be silently available for linking. The contents and provenance of `../sdk/3rd/lib` cannot be audited from the repository alone, and the absence of explicit `-l` entries makes dependency tracking difficult.

### 5. Device and Firmware

Device and Firmware: no issues found at the .pro file level. (The presence of `platform/aescrypto.cpp` warrants source-level review in a subsequent pass to confirm key material is not hardcoded.)

### 6. Qt-Specific Security

Qt-Specific Security: no issues found at the .pro file level. (The `network` Qt module is included; TLS configuration in `comm/ftpclient.cpp` and `comm/gmtpchat.cpp` requires source-level review in a subsequent pass.)

---

## Summary

| ID | Severity | Category |
|----|----------|----------|
| A02-1 | HIGH | Missing `-fstack-protector-strong` |
| A02-2 | HIGH | Missing `-D_FORTIFY_SOURCE=2` |
| A02-3 | HIGH | Missing `-fPIE` / `-pie` |
| A02-4 | MEDIUM | Missing `-Wformat -Wformat-security` |
| A02-5 | MEDIUM | No `CONFIG += release` |
| A02-6 | MEDIUM | `QMAKE_STRIP` not set |
| A02-7 | LOW | Unspecified third-party SDK libraries |
