# Pass 1 Security Review — Agent B09
**Date:** 2026-02-27
**Repo:** forkliftiqws
**Branch:** master
**Auditor:** B09
**Files reviewed:**
- `src/main/java/com/journaldev/spring/jdbc/controller/ReportAPI.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/RestURIConstants.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java`

**Supporting files read for context:**
- `src/main/java/com/journaldev/spring/jdbc/controller/ConfigurationController.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java`
- `src/main/java/com/journaldev/spring/jdbc/util/HttpDownloadUtility.java`
- `src/main/webapp/WEB-INF/web.xml`
- `src/main/webapp/WEB-INF/spring/spring-security.xml`
- `src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml`
- `src/main/resources/fleetiq360ws.properties`
- `environment.dev.properties`
- `environment.prod.properties`
- `environment.uat.properties`
- `pom.xml`
- `.gitignore`

---

## STEP 3 — Reading Evidence

### File 1: `ReportAPI.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.controller.ReportAPI`

**Interfaces implemented / classes extended:** None.

**Class-level annotations:** None.

**Fields:**

| Access    | Type   | Name     | Notes                   |
|-----------|--------|----------|-------------------------|
| protected | String | subject  |                         |
| protected | String | title    |                         |
| protected | String | content  |                         |
| protected | String | sEmail   |                         |
| protected | String | rEmail   |                         |
| protected | String | fileURL  |                         |
| protected | String | name     | report name             |
| protected | String | input    |                         |

**Public methods:**

| Line | Return Type | Method Signature | Annotations |
|------|-------------|------------------|-------------|
| 17   | (constructor) | `ReportAPI(String name, String input)` | None |
| 25   | `String` | `downloadPDF() throws Exception` | None |
| 47   | `String` | `getSubject()` | None |
| 51   | `void` | `setSubject(String subject)` | None |
| 55   | `String` | `getTitle()` | None |
| 59   | `void` | `setTitle(String title)` | None |
| 64   | `String` | `getContent()` | None |
| 68   | `void` | `setContent(String content)` | None |
| 72   | `String` | `getsEmail()` | None |
| 76   | `void` | `setsEmail(String sEmail)` | None |
| 80   | `String` | `getrEmail()` | None |
| 84   | `void` | `setrEmail(String rEmail)` | None |
| 88   | `String` | `getFileURL()` | None |
| 92   | `void` | `setFileURL(String fileURL)` | None |
| 96   | `String` | `getName()` | None |
| 100  | `void` | `setName(String name)` | None |

**Protected methods:**

| Line | Return Type | Method Signature | Annotations |
|------|-------------|------------------|-------------|
| 34   | `String` | `getExportDir(String dirctory) throws Exception` | None |

**Notes:** `ReportAPI` is a plain Java class (not a Spring controller). It is a helper/model class instantiated by `ResumeController`. `downloadPDF()` calls `HttpDownloadUtility.sendPost(name, input, ...)` which in turn builds a URL as `RuntimeConfig.APIURL + fname` and posts the JSON `input` payload to an external API.

---

### File 2: `RestURIConstants.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.controller.RestURIConstants`

**Interfaces implemented / classes extended:** None.

**Class-level annotations:** None.

**Fields (all `public static final String`):**

| Constant Name           | Value                                                                    |
|------------------------|--------------------------------------------------------------------------|
| ACCEPT_USRS            | `/rest/users/permission/acceptall/{pids}`  (comment: unused)            |
| DECLINE_USRS           | `/rest/users/permission/deleteall/{pids}`  (comment: unused)            |
| CREATE_APPUSR          | `/rest/appuser/register`                                                 |
| RESET_PASSWORD         | `/rest/appuser/reset`                                                    |
| VALIDATE_USR           | `/rest/appuser/validate`                                                 |
| SAVE_EMAILS            | `/rest/appuser/emails`                                                   |
| GET_EMAILS             | `/rest/appuser/emails/get/{uid}`                                         |
| UPLOAD_PROFILE         | `/rest/appuser/photo/{uid}`                                              |
| UPLOAD_PROFILE_APP     | `/rest/appuser/photo/app/{uid}`                                          |
| GET_USR                | `/rest/appuser/get/{uid}`                                                |
| UPDATE_USERS           | `/rest/appuser/update/{uid}`                                             |
| GET_EQUIPMENT          | `/rest/equipment/get/{uid}`                                              |
| SAVE_LICENCE           | `/rest/licence/save`                                                     |
| GET_COMPANY            | `/rest/company/get/{uid}`                                                |
| GET_COMPANY_DRIVERS    | `/rest/company/owner/{uid}/drivers`                                      |
| SEARCH_COMPANY         | `/rest/company/search/{keyword}`                                         |
| ADD_COMPANY            | `/rest/company/add`                                                      |
| COMPANY_ACCEPT         | `/rest/company/accept/{pid}`                                             |
| COMPANY_ACCEPT_WEB     | `/rest/company/accept/web/{token}`                                       |
| COMPANY_DELETE         | `/rest/company/delete/{pid}`                                             |
| ADD_EQUIPMENT          | `/rest/equip/add`                                                        |
| GET_MANUFACTURER       | `/rest/manu/get`                                                         |
| GET_TYPE               | `/rest/type/get/{mid}`                                                   |
| GET_FUELTYPE           | `/rest/fuletype/get/manuid/{mid}/typeid/{tid}`                           |
| GET_QUESTION           | `/rest/question/get/{eid}`                                               |
| GET_FORMS              | `/rest/forms/get/question/{qid}/type/{type}`                             |
| SEARCH_FORMS           | `/rest/forms/unit/{uid}/type/{type}/search/{keyword}`                    |
| SAVE_RESULT            | `/rest/result/save`                                                      |
| DRIVRR_ACCESS          | `/rest/driveraccess/save/sid/{sid}/imageno/{imageno}`                    |
| START_SESSION          | `/rest/session/start`                                                    |
| END_SESSION            | `/rest/session/end`                                                      |
| SAVE_OFFLINE           | `/rest/offline/save`                                                     |
| ABORT_SESSION          | `/rest/session/abort/session/{sid}`                                      |
| SAVE_INCIDENT          | `/rest/impact/save`                                                      |
| SAVE_IMPACT            | `/rest/impactdata/save`                                                  |
| SAVE_IMPACTIMAGE       | `/rest/impactimage/{impid}`                                              |
| SAVE_IMPACTIMAGE_APP   | `/rest/impactimage/impid/{impid}/type/{type}`                            |
| GET_SERVICE            | `/rest/service/get/{uid}`                                                |
| GET_SERVICEDTL         | `/rest/sericedetail/get/{userid}`                                        |
| SAVE_SERVICE           | `/rest/service/save`                                                     |
| RESUME_EQUIPMENT       | `/rest/driverresume/get/{uid}/frequencey/{frequencey}`                   |
| RESUME_DRIVER          | `/rest/resume/get/{uid}`                                                 |
| GET_REPORT             | `/rest/reportlist/get/{uid}`                                             |
| GENERATE_REPORT        | `/rest/reportlist/generate/user/{uid}/report/{rid}`                      |
| SEND_REPORT            | `/rest/reportlist/freq/{freq}`                                           |
| GET_GPS_LOC            | `/rest/gps/get/{uid}`                                                    |
| SAVE_GPS_LOC           | `/rest/gps/save`                                                         |
| SAVE_GPS_LOCS          | `/rest/gps/save/all`                                                     |

---

### File 3: `ResumeController.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.controller.ResumeController`

**Interfaces implemented / classes extended:** Extends `com.journaldev.spring.jdbc.controller.ConfigurationController` (which is `@Controller`, `@Autowired DataSource dataSource`, `@Autowired Configuration configuration`).

**Class-level annotations:**
- `@Controller`

**Fields:**
- `private static final Logger logger` — SLF4J logger (LoggerFactory.getLogger)
- Inherits from `ConfigurationController`: `@Autowired Configuration configuration`, `@Autowired @Qualifier("dataSource") DataSource dataSource`

**Public methods:**

| Line | Return Type | Method Signature | Annotations |
|------|-------------|------------------|-------------|
| 35   | `List<Reports>` | `getResumeDriver(@PathVariable("uid") int uid)` | `@RequestMapping(value = RESUME_DRIVER, method = GET)`, `@ResponseBody` |
| 120  | `List<Charts>` | `getResumeEquipment(@PathVariable("uid") int uid, @PathVariable("frequencey") String frequencey)` | `@RequestMapping(value = RESUME_EQUIPMENT, method = GET)`, `@ResponseBody` |
| 262  | `List<ReportLists>` | `getReportList(@PathVariable("uid") int uid)` | `@RequestMapping(value = GET_REPORT, method = GET)`, `@ResponseBody` |
| 283  | `ResponseEntity<Results>` | `generateReport(@PathVariable("uid") int uid, @PathVariable("rid") int rid)` | `@RequestMapping(value = GENERATE_REPORT, method = GET)`, `@ResponseBody` |
| 369  | `ResponseEntity<Results>` | `sendReportList(@PathVariable("freq") String frq)` | `@RequestMapping(value = SEND_REPORT, method = GET)`, `@ResponseBody` |

**URI mappings in `ResumeController`:**

| Method            | HTTP Method | URI Pattern                                              |
|-------------------|-------------|----------------------------------------------------------|
| getResumeDriver   | GET         | `/rest/resume/get/{uid}`                                 |
| getResumeEquipment| GET         | `/rest/driverresume/get/{uid}/frequencey/{frequencey}`   |
| getReportList     | GET         | `/rest/reportlist/get/{uid}`                             |
| generateReport    | GET         | `/rest/reportlist/generate/user/{uid}/report/{rid}`      |
| sendReportList    | GET         | `/rest/reportlist/freq/{freq}`                           |

---

## STEP 4 — Checklist Review

### Section 1: Secrets and Configuration

**1.1 — `RuntimeConfig.java` hardcoded credentials**

Multiple plaintext secrets are hardcoded directly in source:

- `GCMKEY = "key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs"` — GCM/Firebase API key
- `PASSWORD = "OVLOaICXccaNUS"` — Clickatell SMS API password
- `USERNAME = "ciclickatell"` — Clickatell username
- `API_ID = "3629505"` — Clickatell API ID
- `APIURL = "http://ec2-52-5-205-104.compute-1.amazonaws.com/api/export/pdf/"` — internal backend URL over plain HTTP

See finding **B09-1**.

**1.2 — `HttpDownloadUtility.java` hardcoded API token**

At line 109: `con.setRequestProperty("X-AUTH-TOKEN", "w6_zaejLjssvw02XqIiKdVmv7kP6nOHAw2Ve5mj-qug");` — hardcoded bearer token used to authenticate the internal PDF export API call.

See finding **B09-2**.

**1.3 — `generateReport` and `sendReportList` in `ResumeController.java` hardcoded admin credentials in JSON payload**

At line 322 and line 410: `String input = "{\"admin_password\":\"ciiadmin\", \"username\": \"hui\"," + filters + "}";` — admin credentials are hardcoded in source and logged via `logger.info("Input URL is:" + input)`.

See finding **B09-3** and **B09-4**.

**1.4 — Environment property files committed to git**

`environment.dev.properties`, `environment.prod.properties`, `environment.uat.properties` are all tracked in git. They contain:
- `cognitoAPIUsername=ciiadmin` and `cognitoAPIPassword=ciiadmin` (dev and prod/uat)
- `environment.uat.properties` is also used as prod (`environment.prod.properties` has the same UAT AWS host)

Only `environment.local.properties` is gitignored. All other environment files — including UAT (which appears to be production) — are committed.

See finding **B09-5**.

**1.5 — `pom.xml` Flyway credentials hardcoded in profiles**

Local profile: `flyway.password=gmtp-postgres` and `flyway.password=fleetiq360`.
Dev profile: `flyway.password=fleetiq360`.
UAT profile: `flyway.user=dev_admin`, `flyway.password=C!1admin`.

All committed to source control.

See finding **B09-6**.

**1.6 — `pom.xml` Maven repository over HTTP**

`http://splunk.jfrog.io/splunk/ext-releases-local` — dependency fetched over plain HTTP; susceptible to MITM/dependency substitution.

See finding **B09-7**.

**1.7 — No bitbucket-pipelines.yml found.** N/A.

**1.8 — `web.xml`, `context.xml`:** No Tomcat manager credentials directly in `web.xml`. `pom.xml` Tomcat plugin uses `${tomcat.server}` reference to Maven `settings.xml` (not committed) — CLEAR for that specific item.

---

### Section 2: Authentication and Authorization

**2.1 — Security filter chain (`spring-security.xml`)**

The filter chain for `/rest/**` requires `ROLE_DRIVER`, `ROLE_COMPANY_GROUP`, `ROLE_SYS_ADMIN`, or `ROLE_CLIENT` — so every `/rest/**` endpoint nominally requires an OAuth2 token. `web.xml` confirms `springSecurityFilterChain` is mapped to `/*`. However:

- `/oauth/cache_approvals` and `/oauth/uncache_approvals` are configured `security="none"` (lines 13–14). The comment reads "Just for testing..." — these two URLs are fully public on production.

See finding **B09-8**.

**2.2 — `SEND_REPORT` endpoint — no caller-identity check, effectively an unauthenticated trigger for organisation-wide report dispatch**

`sendReportList` at line 369 accepts `{freq}` (e.g., `w`, `m`, `d`) and dispatches reports to ALL companies in the database matching that frequency. Any authenticated user of any role (including `ROLE_DRIVER`) can call `/rest/reportlist/freq/w` and trigger bulk report generation and email dispatch across the entire customer base. There is no check that the caller has an administrative role.

See finding **B09-9**.

**2.3 — IDOR on `RESUME_DRIVER`, `RESUME_EQUIPMENT`, `GET_REPORT`, `GENERATE_REPORT`**

All four endpoints accept a `{uid}` path variable as the target driver/user identifier. None of the methods extract the caller's identity from the OAuth2 token and compare it to `uid`. Any authenticated user who knows (or guesses) another user's integer `uid` can retrieve that user's inspection history, equipment usage statistics, and report list, or trigger report generation and email delivery for that user.

See finding **B09-10**.

**2.4 — No `@PreAuthorize` or `@Secured` on any method in `ResumeController`.** Role differentiation is entirely at the URL pattern level in `spring-security.xml`, with no per-method role enforcement. CLEAR for role-pattern coverage (all `/rest/**` requires a role), but flagged under IDOR above.

**2.5 — Password hashing: MD5**

`spring-security.xml` line 74: `<password-encoder hash="md5"/>`. MD5 is a broken hash for passwords; it is not a key-derivation function and is trivially reversible with rainbow tables. However this applies to the OAuth2 resource-owner password grant user lookup, not the Cognito path — still a concern if any user accounts are stored locally.

See finding **B09-11**.

**2.6 — OAuth2 client secrets hardcoded in `spring-security.xml`**

Line 113: `secret="8752361E593A573E86CA558FFD39E"` and line 117: `secret="rihah8eey4faibuengaixo6leiL1awii"` — OAuth2 client secrets in committed XML.

See finding **B09-12**.

**2.7 — Token validity: `access-token-validity="0"` on client `987654321`**

Line 113: `access-token-validity="0"`. In Spring Security OAuth2, a value of `0` means the token never expires. A non-expiring access token significantly extends the window of compromise if a token is stolen.

See finding **B09-13**.

---

### Section 3: Input Validation and Injection

**3.1 — SQL injection: all queries use parameterised `JdbcTemplate` with `?` placeholders.** The SQL queries in `ResumeController` consistently use `new Object[]{uid}` or similar as bound parameters — CLEAR for SQL injection in the direct query parameters.

**3.2 — String concatenation in JSON payload construction**

In `generateReport` (lines 314–320) and `sendReportList` (lines 404–408), date strings from `DateUtil` and integer IDs from the database are concatenated directly into a JSON string that is then POSTed to the external PDF API:

```java
String filters = "\"filters\":["
        + "{\"report_end_date\":\"" + DateUtil.getYesterdayDateString() + "\"},"
        + "{\"report_start_date\":\"" + DateUtil.dateToString(DateUtil.getStartDate(new Date(), report.getFrequency())) + "\"},"
        + "{\"max_driver_id\":" + uid + "},"
        + "{\"min_driver_id\":" + uid + "},"
        + "{\"company_id\":" + comp_id + "}"
        + "]";
```

`uid` and `comp_id` are integers derived from the database (low risk of injection), but `report.getFrequency()` is a string from the `subscription` table and is passed into `DateUtil.getStartDate()` then into the JSON string. If `frequency` contains characters such as `"` or `\`, the constructed JSON will be malformed or could be used to inject additional JSON fields. No JSON library is used for construction.

See finding **B09-14**.

**3.3 — `frequencey` path variable in `getResumeEquipment` — string concatenation in SQL interval casts**

At lines 189, 202, 231, 244, the `frequencey` string path variable is NOT used in SQL directly. The method branches on `equalsIgnoreCase("y")`, `equalsIgnoreCase("m")`, else defaults to weekly — so arbitrary values fall into the weekly branch without validation. No SQL injection vector here because the value is not interpolated into SQL. However there is no input validation on `frequencey`; any string value is accepted and silently treated as weekly. CLEAR for injection; LOW concern for missing validation.

**3.4 — `frq` path variable in `sendReportList`** — similarly branches on `w`, `m`, else defaults to `"Daily"`. No injection. CLEAR.

**3.5 — No `@Valid`, `@NotNull`, `@Size`, or `@Pattern` on any parameter in `ResumeController`.** Inputs are integers (`uid`, `rid`) or strings (`freq`, `frequencey`) with no bean validation. Negative or zero integer IDs would be accepted and would result in empty query results with no error. CLEAR for injection but noted as missing validation.

**3.6 — No `Runtime.exec()`, `ProcessBuilder`, file path from user input, XML parsing, or `ObjectInputStream` observed in the reviewed files.** N/A for command injection, path traversal, XXE, deserialization.

---

### Section 4: Session and CSRF

**4.1 — CSRF:** The security filter chain is configured with `create-session="never"` for `/rest/**`, which is consistent with a stateless REST API. Spring Security OAuth2 resource server filters operate statelessly. CSRF is not applicable to stateless token-authenticated REST endpoints — CLEAR.

**4.2 — CORS:** No `@CrossOrigin` annotation on any reviewed class or method. No `CorsRegistry` bean observed in `servlet-context.xml`. Cannot confirm global CORS configuration without reviewing all controllers — partial coverage only in this pass.

**4.3 — Security headers (`X-Frame-Options`, `X-Content-Type-Options`, `Strict-Transport-Security`):** Spring Security 3.1.1 does not add security headers by default (header support was added in 3.2). No header configuration observed in `spring-security.xml`. These headers are absent unless added by the Tomcat connector or a servlet filter not observed in this pass.

See finding **B09-15**.

**4.4 — `web.xml` declares `CONFIDENTIAL` transport guarantee on `/*`**, which instructs the container to redirect HTTP to HTTPS. This is a positive control, though enforcement depends on the Tomcat connector's `redirectPort` configuration.

---

### Section 5: Data Exposure

**5.1 — `getResumeDriver` returns operator inspection pass/fail rates, incomplete inspection counts, equipment names, service history counts, and usage hours.** This is sensitive operator PII and safety record data. No organisation scoping check: the query uses `where p.driver_id = ?` filtering by the supplied `uid`. Since `uid` is attacker-controlled (IDOR — see B09-10), data for any driver is accessible.

**5.2 — `getResumeEquipment` returns forklift unit identifiers and hour-by-hour/day-by-day usage telemetry.** Same IDOR concern.

**5.3 — `getReportList` returns subscription report names and filenames scoped to the caller-supplied `uid`'s company. Scoping is via `where p.driver_id = ?`** — same IDOR concern.

**5.4 — `generateReport` logs admin credentials and full JSON payload at INFO level**

Line 323: `logger.info("Input URL is:" + input);`

`input` contains `"admin_password":"ciiadmin"` and `"username": "hui"`. This logs plaintext credentials to the application log (and potentially to Splunk, given the Splunk logging dependency). Operator email addresses are also logged at INFO on lines 334, 339, 344, 349.

See finding **B09-16**.

**5.5 — `sendReportList` similarly logs admin credentials at INFO level** (line 411).

**5.6 — Exception handling: `e.printStackTrace()`**

In `generateReport` line 353 and in `HttpDownloadUtility` line 86 and line 147: `e.printStackTrace()` writes stack traces to `System.err`. Depending on Tomcat configuration, this may be written to `catalina.out` but not to a structured log; however if any middleware or proxy relays error output to the HTTP response (unlikely in a Spring MVC setup), stack traces could be exposed. More importantly, there is no structured error logging: the full exception detail (including class names, file paths, and line numbers) is sent to stderr rather than through SLF4J. MEDIUM concern.

See finding **B09-17**.

**5.7 — No operator PII returned directly in error responses** — errors return a `Results` object with `message_id` and `error` string constants. CLEAR for client-facing PII in error responses.

---

### Section 6: Dependencies

**6.1 — Spring Framework 3.2.14.RELEASE** — EOL. Multiple CVEs exist. Spring 3.x received its last patch in December 2016. Running on an unsupported major version.

See finding **B09-18**.

**6.2 — Spring Security 3.1.1.RELEASE** — EOL. Spring Security 3.1.x is critically out of date; numerous CVEs including authentication bypass issues have been disclosed since this version.

See finding **B09-19**.

**6.3 — Spring Security OAuth2 1.0.0.RELEASE** — Very old. OAuth2 1.x is unmaintained. Multiple CVEs including token endpoint bypass (CVE-2016-4977, others).

See finding **B09-20**.

**6.4 — jackson-databind 2.6.7** — This version is vulnerable to multiple deserialization gadget chain CVEs (CVE-2017-7525, CVE-2019-14379, CVE-2019-14540 and many others). The 2.6.x line reached EOL long ago.

See finding **B09-21**.

**6.5 — commons-fileupload 1.3.1** — Vulnerable to CVE-2016-1000031 (remote code execution via deserialization). The fix was in 1.3.3.

See finding **B09-22**.

**6.6 — commons-io 1.3.2** — This artifact ID `org.apache.commons:commons-io` version 1.3.2 does not exist in Maven Central (the Apache Commons IO groupId is `commons-io:commons-io`; the `org.apache.commons` groupId starts at 2.x). This may resolve unexpectedly or fail silently. Regardless, if it resolves at all, it is ancient.

See finding **B09-23**.

**6.7 — aws-java-sdk 1.11.163** — Released 2017; several security patches have been applied in subsequent versions. Not a critical CVE but significantly outdated.

**6.8 — PostgreSQL JDBC driver 9.1-901.jdbc3** (Flyway dependency) — Extremely old; multiple CVEs.

**6.9 — No SNAPSHOT dependencies observed.** CLEAR.

**6.10 — Third-party Maven repository over HTTP:** `http://splunk.jfrog.io/splunk/ext-releases-local` — see B09-7.

---

### Section 7: Build and CI

**7.1 — No `bitbucket-pipelines.yml` found.** Cannot verify CI pipeline configuration. Unknown whether tests are skipped in deployment.

**7.2 — `pom.xml` has `<compilerArgument>-Xlint:all</compilerArgument>` with `showWarnings=true`** — compiler is configured to surface warnings. CLEAR for intent; actual warning output not verifiable without running the build.

**7.3 — Tests:** JUnit 4.7 is listed as a test dependency. No test source files were observed in this pass. Cannot verify test coverage.

**7.4 — Default active profile is `uat`** (`<activeByDefault>true</activeByDefault>` on the `uat` profile). A developer running `mvn install` without specifying a profile will use UAT database credentials and connect to `ec2-54-86-82-22.compute-1.amazonaws.com`. This is a build reproducibility and accidental-data-access risk.

See finding **B09-24**.

---

## STEP 5 — Findings

---

**B09-1** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:13-21`
**Description:** Multiple third-party API credentials and service passwords are hardcoded as public static fields in source code. Any developer with read access to the repository has immediate access to these credentials. The GCM key allows sending push notifications to all registered devices. The Clickatell credentials allow sending arbitrary SMS messages billed to the application account.
**Evidence:**
```java
public static String GCMKEY = "key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs";
public static String USERNAME = "ciclickatell";
public static String PASSWORD = "OVLOaICXccaNUS";
public static String SMSFROM = "13234862361";
public static String API_ID = "3629505";
```

---

**B09-2** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/util/HttpDownloadUtility.java:109`
**Description:** A hardcoded bearer token is committed to source and used to authenticate every call to the internal PDF export API. This token cannot be rotated without a code change and redeployment. Anyone with repository read access can impersonate the application to the PDF export service.
**Evidence:**
```java
con.setRequestProperty("X-AUTH-TOKEN", "w6_zaejLjssvw02XqIiKdVmv7kP6nOHAw2Ve5mj-qug");
```

---

**B09-3** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java:322`
**Description:** Hardcoded admin username and password for the backend PDF report API are embedded in source code. These credentials are concatenated into a JSON payload sent on every report generation request and are also written to the INFO-level application log (see B09-16).
**Evidence:**
```java
String input = "{\"admin_password\":\"ciiadmin\", \"username\": \"hui\"," + filters + "}";
```

---

**B09-4** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java:410`
**Description:** Same hardcoded admin credentials as B09-3 also appear in the `sendReportList` method, which is called for bulk scheduled report dispatch. Same impact and same logging risk.
**Evidence:**
```java
String input = "{\"admin_password\":\"ciiadmin\", \"username\": \"hui\"," + filters + "}";
```

---

**B09-5** — HIGH
**Section:** 1. Secrets and Configuration
**File:** `environment.dev.properties:15-16`, `environment.prod.properties:15-16`, `environment.uat.properties:15-16`
**Description:** Environment-specific property files containing Cognito API credentials (`cognitoAPIUsername=ciiadmin`, `cognitoAPIPassword=ciiadmin`) are committed to the repository for all non-local environments. Only `environment.local.properties` is gitignored. UAT and prod credentials are permanently in version control history.
**Evidence:**
```
cognitoAPIUsername=ciiadmin
cognitoAPIPassword=ciiadmin
```
(present in all three committed environment files)

---

**B09-6** — HIGH
**Section:** 1. Secrets and Configuration
**File:** `pom.xml:29-30`, `pom.xml:46`, `pom.xml:76`
**Description:** Flyway database credentials for local, dev, and UAT environments are hardcoded in `pom.xml` Maven profiles and committed to source control. The UAT profile credential (`C!1admin`) appears to be the database password for the live UAT/production AWS RDS instance at `forkliftiq360.cmjwsurtk4tn.us-east-1.rds.amazonaws.com`.
**Evidence:**
```xml
<!-- local profile -->
<flyway.password>gmtp-postgres</flyway.password>
<!-- dev profile -->
<flyway.password>fleetiq360</flyway.password>
<!-- uat profile -->
<flyway.user>dev_admin</flyway.user>
<flyway.password>C!1admin</flyway.password>
```

---

**B09-7** — MEDIUM
**Section:** 1. Secrets and Configuration / 6. Dependencies
**File:** `pom.xml:87-90`
**Description:** A Maven dependency repository is configured using a plain HTTP URL. Dependencies fetched over HTTP are susceptible to man-in-the-middle attacks that could substitute malicious artifacts.
**Evidence:**
```xml
<url>http://splunk.jfrog.io/splunk/ext-releases-local</url>
```

---

**B09-8** — MEDIUM
**Section:** 2. Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:13-14`
**Description:** Two URL patterns are explicitly configured with `security="none"`, making them fully unauthenticated. The comment "Just for testing..." indicates these were added during development and not removed before production deployment. The practical risk depends on what controllers map these paths, but the intent to leave them public is clearly a development artefact.
**Evidence:**
```xml
<!-- Just for testing... -->
<http pattern="/oauth/cache_approvals" security="none" xmlns="http://www.springframework.org/schema/security" />
<http pattern="/oauth/uncache_approvals" security="none" xmlns="http://www.springframework.org/schema/security" />
```

---

**B09-9** — CRITICAL
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java:367-432`
**Description:** The `sendReportList` endpoint (`GET /rest/reportlist/freq/{freq}`) iterates over every company in the database that has subscriptions matching the requested frequency and dispatches report PDFs via email to all of them. Any authenticated user holding any role (`ROLE_DRIVER`, `ROLE_COMPANY_GROUP`, `ROLE_CLIENT`, or `ROLE_SYS_ADMIN`) can trigger this operation. There is no admin-role check, no rate limiting, and no idempotency guard. A `ROLE_DRIVER` user (a forklift operator) can trigger bulk report dispatch across the entire customer base simply by calling `/rest/reportlist/freq/d`. This exposes all customers' report data and creates a significant operational disruption risk.
**Evidence:**
```java
@RequestMapping(value = RestURIConstants.SEND_REPORT, method = RequestMethod.GET)
public @ResponseBody
ResponseEntity<Results> sendReportList(@PathVariable("freq") String frq) {
    // ...
    // No role check. Queries ALL companies:
    String query = "select s.name,s.file_name,s.frequency,c.id as comp_id "
            + " from package_subscription_rel as r "
            + " left outer join subscription as s  on r.subscritpion_id = s.id "
            + " left outer join company as c on c.package_id = r.package_id  "
            + " where frequency = ? "
            + " and s.type = 'Report' "
            + " order by c.id ";
```

---

**B09-10** — HIGH
**Section:** 2. Authentication and Authorization / 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java:35,120,262,283`
**Description:** IDOR vulnerability across four endpoints. The `uid` path variable is accepted directly as the target user/driver identifier without verifying that it matches the authenticated caller's identity. Any authenticated user who can enumerate or guess integer user IDs can access the inspection records, equipment usage telemetry, report list, and trigger report generation (including email delivery) for any other user in the system. The data exposed includes: inspection pass/fail rates, incomplete inspection counts, forklift usage hours by unit, service history counts, and operator email addresses.

Affected endpoints:
- `GET /rest/resume/get/{uid}` — `getResumeDriver`
- `GET /rest/driverresume/get/{uid}/frequencey/{frequencey}` — `getResumeEquipment`
- `GET /rest/reportlist/get/{uid}` — `getReportList`
- `GET /rest/reportlist/generate/user/{uid}/report/{rid}` — `generateReport`

**Evidence:**
```java
// getResumeDriver - no token identity check:
List<Reports> getResumeDriver(@PathVariable("uid") int uid) {
    // uid used directly as driver_id filter; no comparison to authenticated principal

// generateReport - uid used to look up emails and generate reports:
ResponseEntity<Results> generateReport(@PathVariable("uid") int uid, @PathVariable("rid") int rid) {
    // ...
    List<DriverEmails> emaillst = jdbcTemplate.query(query, new Object[]{uid}, ...);
    // Emails sent to addresses associated with uid, regardless of who is calling
```

---

**B09-11** — HIGH
**Section:** 2. Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:74`
**Description:** The authentication provider for the local user service (used in the OAuth2 resource-owner password grant flow) is configured with MD5 password hashing. MD5 is not a password hashing algorithm: it has no work factor, is GPU-acceleratable, and rainbow tables exist for common passwords. Any database exposure would result in rapid mass password recovery.
**Evidence:**
```xml
<authentication-provider user-service-ref="userDetailsService">
    <password-encoder hash="md5"/>
</authentication-provider>
```

---

**B09-12** — HIGH
**Section:** 1. Secrets and Configuration / 2. Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:113-117`
**Description:** OAuth2 client secrets are hardcoded in a committed XML configuration file. Any party with repository read access can obtain these secrets and request OAuth2 tokens on behalf of the registered clients.
**Evidence:**
```xml
<oauth:client client-id="987654321" ... secret="8752361E593A573E86CA558FFD39E" .../>
<oauth:client client-id="fleetiq360" ... secret="rihah8eey4faibuengaixo6leiL1awii" .../>
```

---

**B09-13** — HIGH
**Section:** 2. Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:113`
**Description:** The OAuth2 client `987654321` is configured with `access-token-validity="0"`. In Spring Security OAuth2, a validity of `0` configures the token to never expire. A stolen or leaked access token for this client will remain valid indefinitely with no forced re-authentication.
**Evidence:**
```xml
<oauth:client client-id="987654321" authorized-grant-types="password,authorization_code,implicit"
              secret="8752361E593A573E86CA558FFD39E" authorities="ROLE_CLIENT" scope="read,write"
              access-token-validity="0"/>
```

---

**B09-14** — MEDIUM
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java:314-320`, `404-408`
**Description:** JSON for the PDF export API request is constructed by string concatenation rather than a JSON serialisation library. The `report.getFrequency()` field (sourced from the database `subscription` table) and `DateUtil` date strings are concatenated directly into the JSON string without escaping. If the `frequency` field in the database contains a double-quote, backslash, or JSON control characters, the resulting payload will be malformed or could carry injected JSON fields to the downstream PDF API. While the integer fields (`uid`, `comp_id`) are safe from this particular issue, the string fields are not escaped.
**Evidence:**
```java
String filters = "\"filters\":["
        + "{\"report_end_date\":\"" + DateUtil.getYesterdayDateString() + "\"},"
        + "{\"report_start_date\":\"" + DateUtil.dateToString(DateUtil.getStartDate(new Date(), report.getFrequency())) + "\"},"
        + "{\"max_driver_id\":" + uid + "},"
        + "{\"min_driver_id\":" + uid + "},"
        + "{\"company_id\":" + comp_id + "}"
        + "]";
String input = "{\"admin_password\":\"ciiadmin\", \"username\": \"hui\"," + filters + "}";
```

---

**B09-15** — MEDIUM
**Section:** 4. Session and CSRF
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml` (entire file)
**Description:** Spring Security 3.1.1 does not automatically add HTTP security headers (`X-Frame-Options`, `X-Content-Type-Options`, `X-XSS-Protection`, `Strict-Transport-Security`). No header configuration is present in `spring-security.xml` or `servlet-context.xml`. These headers are absent from API responses unless added by Tomcat connector configuration (not reviewed in this pass). While a JSON REST API is lower risk for clickjacking, the absence of `Strict-Transport-Security` is notable given that the `web.xml` `CONFIDENTIAL` transport guarantee relies on Tomcat redirecting rather than browser-enforced HSTS.
**Evidence:**
Spring Security 3.1.x has no `<headers>` element in the security namespace. No equivalent `Filter` bean is configured.

---

**B09-16** — HIGH
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java:323`, `334`, `339`, `344`, `349`, `411`
**Description:** The full JSON payload sent to the PDF export API — which includes plaintext admin credentials — is written to the INFO-level application log. Additionally, operator email addresses are logged at INFO level for each email sent. With the Splunk logging dependency present in `pom.xml`, these log entries are likely forwarded to Splunk, meaning admin credentials and operator PII are stored in the log aggregation platform accessible to anyone with Splunk access.
**Evidence:**
```java
// Line 323 - credentials in log:
logger.info("Input URL is:" + input);
// where input = "{\"admin_password\":\"ciiadmin\", \"username\": \"hui\", ..."

// Lines 334, 339, 344, 349 - operator PII in log:
logger.info("Report sent to " + emails.getEmail_addr1());
logger.info("Report sent to " + emails.getEmail_addr2());
// etc.

// Line 411 - same credential logging in sendReportList:
logger.info("Input URL is:" + input);
```

---

**B09-17** — MEDIUM
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java:353`, `src/main/java/com/journaldev/spring/jdbc/util/HttpDownloadUtility.java:86,147`
**Description:** Caught exceptions are handled exclusively via `e.printStackTrace()`, which writes full Java stack traces to `System.err`. This bypasses the structured SLF4J logging framework and means exception detail is not written at a controlled log level. If `System.err` is captured (e.g., in `catalina.out` and then forwarded to Splunk), stack traces containing internal class names, file paths, and potentially SQL fragments appear in logs. Additionally, the HTTP response returned to the client on exception (`HttpStatus.BAD_REQUEST` with a generic error message) is acceptable, but the underlying cause is not logged through SLF4J, making production incident diagnosis more difficult.
**Evidence:**
```java
// ResumeController.java:353
} catch (Exception e) {
    e.printStackTrace();
    results.setMessage_id(RuntimeConfig.MSGID_CODEERRORR);
    results.setError(RuntimeConfig.ERRORMSG_CODEERRORR);
    return new ResponseEntity<Results>(results, HttpStatus.BAD_REQUEST);
}

// HttpDownloadUtility.java:86
}catch(Exception e) {
    e.printStackTrace();
}
```

---

**B09-18** — CRITICAL
**Section:** 6. Dependencies
**File:** `pom.xml:13`
**Description:** Spring Framework 3.2.14.RELEASE is end-of-life. The 3.x line reached end-of-life in December 2016. Numerous CVEs have been published since then, including Spring4Shell (CVE-2022-22965, RCE via data binding on Tomcat with JDK 9+). While Spring4Shell requires JDK 9+, this project targets Java 8, mitigating that specific CVE; however other unpatched vulnerabilities in Spring 3.x remain.
**Evidence:**
```xml
<org.springframework-version>3.2.14.RELEASE</org.springframework-version>
```

---

**B09-19** — CRITICAL
**Section:** 6. Dependencies
**File:** `pom.xml:231-237`
**Description:** Spring Security 3.1.1.RELEASE is critically out of date and end-of-life. The Spring Security 3.1.x line has not received security patches since approximately 2013. Multiple authentication and authorisation bypass CVEs have been disclosed since this version.
**Evidence:**
```xml
<groupId>org.springframework.security</groupId>
<artifactId>spring-security-web</artifactId>
<version>3.1.1.RELEASE</version>
...
<artifactId>spring-security-config</artifactId>
<version>3.1.1.RELEASE</version>
```

---

**B09-20** — CRITICAL
**Section:** 6. Dependencies
**File:** `pom.xml:238-242`
**Description:** Spring Security OAuth2 1.0.0.RELEASE is the oldest possible release of this library. CVE-2016-4977 (SpEL injection in Spring Security OAuth2 1.0.x–2.0.9) allows unauthenticated remote code execution via a crafted `response_type` parameter on the authorisation endpoint. This exact version is in the affected range.
**Evidence:**
```xml
<groupId>org.springframework.security.oauth</groupId>
<artifactId>spring-security-oauth2</artifactId>
<version>1.0.0.RELEASE</version>
```

---

**B09-21** — HIGH
**Section:** 6. Dependencies
**File:** `pom.xml:99-101`
**Description:** `jackson-databind` 2.6.7 is vulnerable to multiple critical deserialization gadget chain vulnerabilities (CVE-2017-7525, CVE-2018-14718, CVE-2018-14719, CVE-2019-14379, CVE-2019-14540, and others). These can lead to remote code execution when deserializing attacker-controlled JSON if polymorphic type handling is enabled or if vulnerable classes are on the classpath.
**Evidence:**
```xml
<artifactId>jackson-databind</artifactId>
<version>2.6.7</version>
```

---

**B09-22** — HIGH
**Section:** 6. Dependencies
**File:** `pom.xml:199-202`
**Description:** `commons-fileupload` 1.3.1 is vulnerable to CVE-2016-1000031, a remote code execution vulnerability via a crafted multipart request exploiting Java object deserialization in the `DiskFileItem` class. The fix was introduced in version 1.3.3.
**Evidence:**
```xml
<groupId>commons-fileupload</groupId>
<artifactId>commons-fileupload</artifactId>
<version>1.3.1</version>
```

---

**B09-23** — LOW
**Section:** 6. Dependencies
**File:** `pom.xml:168-171`
**Description:** The dependency `org.apache.commons:commons-io:1.3.2` uses a groupId/artifactId combination that does not exist in Maven Central (Apache Commons IO under `org.apache.commons` groupId starts at version 2.x; 1.x was published under `commons-io:commons-io`). This dependency may silently fail to resolve or resolve an unexpected artifact, creating a build reproducibility risk.
**Evidence:**
```xml
<groupId>org.apache.commons</groupId>
<artifactId>commons-io</artifactId>
<version>1.3.2</version>
```

---

**B09-24** — MEDIUM
**Section:** 7. Build and CI
**File:** `pom.xml:68-82`
**Description:** The Maven `uat` build profile is configured as `activeByDefault=true`. The UAT profile contains the AWS RDS production database connection string and credentials. Any developer running `mvn` commands without explicitly specifying a profile (`-Plocal`, `-Pdev`) will by default connect Flyway to the live UAT/production RDS instance. This risks accidental database migrations against production data.
**Evidence:**
```xml
<profile>
    <id>uat</id>
    <activation>
        <activeByDefault>true</activeByDefault>
    </activation>
    <properties>
        <flyway.url>jdbc:postgresql://forkliftiq360.cmjwsurtk4tn.us-east-1.rds.amazonaws.com:5432/postgres</flyway.url>
        <flyway.user>dev_admin</flyway.user>
        <flyway.password>C!1admin</flyway.password>
        <tomcat.url>http://ec2-54-86-82-22.compute-1.amazonaws.com:8080/manager/text</tomcat.url>
```

---

**B09-25** — INFO
**Section:** 2. Authentication and Authorization / 3. Input Validation
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RestURIConstants.java:5-6`
**Description:** Two URI constants (`ACCEPT_USRS`, `DECLINE_USRS`) are marked with the comment "unused". These patterns refer to bulk permission acceptance and deletion operations (`/rest/users/permission/acceptall/{pids}`, `/rest/users/permission/deleteall/{pids}`). If any controller maps to these paths despite the comment, they would be sensitive bulk admin operations. The comment should be confirmed by code search; if truly unused, the constants should be removed to avoid confusion.
**Evidence:**
```java
//unused
public static final String ACCEPT_USRS = "/rest/users/permission/acceptall/{pids}";
public static final String DECLINE_USRS = "/rest/users/permission/deleteall/{pids}";
```

---

**B09-26** — INFO
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:30`
**Description:** The internal PDF export API (`APIURL`) is configured to use plain HTTP, not HTTPS. All traffic between this application server and the PDF export backend — including the JSON payload containing admin credentials — travels unencrypted. On a shared network or cloud environment with traffic inspection, these credentials and report data would be exposed in transit.
**Evidence:**
```java
public static String APIURL = "http://ec2-52-5-205-104.compute-1.amazonaws.com/api/export/pdf/";
```

---

## Summary Table

| ID     | Severity | Section | Description (brief)                                                   |
|--------|----------|---------|-----------------------------------------------------------------------|
| B09-1  | CRITICAL | 1       | Hardcoded GCM key, Clickatell credentials in `RuntimeConfig.java`    |
| B09-2  | CRITICAL | 1       | Hardcoded API bearer token in `HttpDownloadUtility.java`              |
| B09-3  | CRITICAL | 1       | Hardcoded admin credentials in `generateReport` JSON payload          |
| B09-4  | CRITICAL | 1       | Hardcoded admin credentials in `sendReportList` JSON payload          |
| B09-5  | HIGH     | 1       | Environment property files with credentials committed to git           |
| B09-6  | HIGH     | 1       | Flyway DB passwords hardcoded in `pom.xml` profiles                  |
| B09-7  | MEDIUM   | 1/6     | Maven repository served over plain HTTP                               |
| B09-8  | MEDIUM   | 2       | Test-only OAuth endpoints left as `security="none"` in production     |
| B09-9  | CRITICAL | 2       | `sendReportList` reachable by any role; triggers org-wide report blast|
| B09-10 | HIGH     | 2/5     | IDOR: `uid` not validated against authenticated principal (4 endpoints)|
| B09-11 | HIGH     | 2       | MD5 used as password encoder in local auth provider                   |
| B09-12 | HIGH     | 1/2     | OAuth2 client secrets hardcoded in `spring-security.xml`             |
| B09-13 | HIGH     | 2       | OAuth2 client `987654321` has non-expiring access token               |
| B09-14 | MEDIUM   | 3       | JSON payload built by string concatenation; unescaped string fields   |
| B09-15 | MEDIUM   | 4       | HTTP security headers absent (Spring Security 3.1.x)                 |
| B09-16 | HIGH     | 5       | Admin credentials and operator email PII logged at INFO level         |
| B09-17 | MEDIUM   | 5       | `e.printStackTrace()` bypasses structured logging; stack traces to stderr|
| B09-18 | CRITICAL | 6       | Spring 3.2.14.RELEASE is EOL                                         |
| B09-19 | CRITICAL | 6       | Spring Security 3.1.1.RELEASE is EOL and unpatched                   |
| B09-20 | CRITICAL | 6       | Spring Security OAuth2 1.0.0.RELEASE — CVE-2016-4977 RCE in range   |
| B09-21 | HIGH     | 6       | jackson-databind 2.6.7 — multiple deserialization CVEs               |
| B09-22 | HIGH     | 6       | commons-fileupload 1.3.1 — CVE-2016-1000031 RCE                     |
| B09-23 | LOW      | 6       | `org.apache.commons:commons-io:1.3.2` — invalid groupId/version      |
| B09-24 | MEDIUM   | 7       | UAT profile `activeByDefault=true` — dev builds target prod DB       |
| B09-25 | INFO     | 2/3     | "Unused" URI constants for bulk permission ops — verify no controller |
| B09-26 | INFO     | 1       | PDF export API called over plain HTTP                                 |
