# Pass 1 Security Review — Agent B02
**Date:** 2026-02-27
**Repo:** forkliftiqws
**Branch:** master
**Assigned files:**
- `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAO.java`
- `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAOImpl.java`
- `src/main/java/com/journaldev/spring/jdbc/DAO/EmailLayoutDAO.java`

**Supporting files read (for context):**
- `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java`
- `src/main/java/com/journaldev/spring/jdbc/service/DriverService.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Driver.java`
- `src/main/java/com/journaldev/spring/jdbc/model/EmailLayout.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/RestURIConstants.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/ConfigurationController.java`
- `src/main/webapp/WEB-INF/spring/spring-security.xml`
- `src/main/webapp/WEB-INF/web.xml`
- `environment.dev.properties`
- `environment.prod.properties`
- `environment.uat.properties`
- `src/main/resources/fleetiq360ws.properties`
- `pom.xml`

---

## Step 3 — Reading Evidence

### File 1: `com.journaldev.spring.jdbc.DAO.DriverDAO`

**Fully qualified class name:** `com.journaldev.spring.jdbc.DAO.DriverDAO`

**Type:** Interface

**Interfaces implemented / classes extended:** None

**Fields:** None

**Public methods:**

| Line | Return type | Method signature | Annotations |
|------|-------------|-----------------|-------------|
| 12 | `boolean` | `isDriverExist(String email)` | none |
| 13 | `Driver` | `findByID(int userId) throws EntityNotFoundException` | none |
| 14 | `List<Driver>` | `findAllByCompanyOwner(int ownerId)` | none |
| 15 | `List<DriverTraining>` | `findAllTraining(int driverId)` | none |
| 16 | `int` | `save(Driver user)` | none |
| 17 | `Driver` | `update(Driver user) throws SQLException` | none |
| 18 | `Driver` | `updateLastLoginTime(Driver driver) throws SQLException` | none |
| 19 | `void` | `updatePassword(String email, String password) throws SQLException` | none |
| 22 | `Optional<Driver>` | `findByEmailAndPassword(String email, String password)` | `@Deprecated` |

---

### File 2: `com.journaldev.spring.jdbc.DAO.DriverDAOImpl`

**Fully qualified class name:** `com.journaldev.spring.jdbc.DAO.DriverDAOImpl`

**Class annotations:** `@Repository`, `@Slf4j`

**Interfaces implemented / classes extended:**
- extends `org.springframework.jdbc.core.support.JdbcDaoSupport`
- implements `com.journaldev.spring.jdbc.DAO.DriverDAO`

**Fields:**

| Modifier | Type | Name | Annotations |
|----------|------|------|-------------|
| `private static final` | `String` | `BASE_QUERY_DRIVER` | none |
| `private` | `Configuration` | `configuration` | `@Autowired` |
| `private static final` | `String` | `UPDATE_PASSWORD` | none (line 90) |

**Public methods:**

| Line | Return type | Method signature | Annotations |
|------|-------------|-----------------|-------------|
| 35 | `void` | `setDbDataSource(DataSource dataSource)` | `@Autowired`, `@Qualifier("dataSource")` |
| 40 | `boolean` | `isDriverExist(String email)` | `@Override` |
| 48 | `int` | `save(Driver user)` | `@Override` |
| 63 | `Driver` | `update(Driver driver) throws SQLException` | `@Override` |
| 77 | `Driver` | `updateLastLoginTime(Driver driver) throws SQLException` | `@Override` |
| 93 | `void` | `updatePassword(String email, String password) throws SQLException` | `@Override` |
| 102 | `Driver` | `findByID(int userId) throws EntityNotFoundException` | `@Override` |
| 120 | `Optional<Driver>` | `findByEmailAndPassword(String email, String password)` | `@Override` |
| 138 | `List<Driver>` | `findAllByCompanyOwner(int ownerId)` | `@Override` |
| 151 | `List<DriverTraining>` | `findAllTraining(int driverId)` | `@Override` |

**Key SQL constants:**

- `BASE_QUERY_DRIVER` (line 23–28): SELECT joining `driver`, `permission`, `company` tables with an `inner join permission p on p.driver_id = d.id and p.enabled = true` guard.
- `UPDATE_PASSWORD` (line 90): `"update driver set password = md5(?) where email = ? "`

---

### File 3: `com.journaldev.spring.jdbc.DAO.EmailLayoutDAO`

**Fully qualified class name:** `com.journaldev.spring.jdbc.DAO.EmailLayoutDAO`

**Type:** Concrete class (no `@Repository`, no `@Component`, no `@Service`)

**Class annotations:** None

**Interfaces implemented / classes extended:** None

**Fields:**

| Modifier | Type | Name | Annotations |
|----------|------|------|-------------|
| `private` | `JdbcTemplate` | `jdbcTemplate` | none |
| `private static final` | `Logger` | `logger` | none |

**Methods:**

| Line | Return type | Method signature | Annotations |
|------|-------------|-----------------|-------------|
| 16 | — (constructor) | `EmailLayoutDAO(DataSource dataSource)` | none |
| 21 | `EmailLayout` | `getEmailLayoutByType(String type)` | none |

**Note:** `getEmailLayoutByType` (lines 21–28) instantiates an empty `EmailLayout` and returns it immediately — the body contains no SQL, no logic, and no use of `jdbcTemplate` or `logger`.

---

## Step 4 — Checklist Review

### Section 1 — Secrets and Configuration

**Finding: Hardcoded Cognito API credentials committed to repository**

All three environment property files (`environment.dev.properties`, `environment.uat.properties`, `environment.prod.properties`) contain:
```
cognitoAPIUsername=ciiadmin
cognitoAPIPassword=ciiadmin
```
These are literal credential values committed in source control. (See B02-1 below.)

**Finding: Database credentials hardcoded in pom.xml profiles**

The `pom.xml` `local` profile (lines 28–31) contains:
```xml
<flyway.password>gmtp-postgres</flyway.password>
<flyway.password>fleetiq360</flyway.password>
```
The `uat` profile (lines 76–78) contains:
```xml
<flyway.user>dev_admin</flyway.user>
<flyway.password>C!1admin</flyway.password>
```
(See B02-2 below.)

**Finding: OAuth2 client secret hardcoded in spring-security.xml**

`spring-security.xml` line 117 contains a literal OAuth2 client secret:
```xml
secret="rihah8eey4faibuengaixo6leiL1awii"
```
(See B02-3 below.)

**Finding: Production infrastructure details exposed in pom.xml**

`pom.xml` line 73 exposes the production AWS RDS hostname:
```xml
<flyway.url>jdbc:postgresql://forkliftiq360.cmjwsurtk4tn.us-east-1.rds.amazonaws.com:5432/postgres</flyway.url>
```
(See B02-4 below.)

**No bitbucket-pipelines.yml found** — N/A for pipeline credential checks.

**application.properties / application.yml** — Not present. Properties are supplied via `fleetiq360ws.properties` which uses placeholder substitution from environment property files. JDBC datasource is configured via JNDI (`jdbc/PreStartDB` in `web.xml`), so no raw JDBC credentials appear in source — CLEAR for JDBC password in source files (aside from pom.xml Flyway noted above).

---

### Section 2 — Authentication and Authorization

**Spring Security configuration (spring-security.xml):**

The filter chain covers `/rest/**` and requires one of: `ROLE_DRIVER`, `ROLE_COMPANY_GROUP`, `ROLE_SYS_ADMIN`, `ROLE_CLIENT`. All four are acceptable to reach any `/rest/**` endpoint except `/rest/db/**` (which requires `ROLE_SYS_ADMIN`) and `/rest/apk/**` (which requires `ROLE_CLIENT`). `ROLE_CLIENT` is a machine/API client role and can therefore reach all `/rest/**` endpoints.

**No `@PreAuthorize` or `@Secured` annotations are present** on any `DriverController` method or `DriverDAO` method. There is no method-level ownership check anywhere in the reviewed code.

**Finding: `findByID` has no organisation-scoping — IDOR**

`DriverDAOImpl.findByID(int userId)` (line 107) queries by `d.id` only:
```java
String sql = BASE_QUERY_DRIVER + "where d.id = ? and d.active = true";
```
`DriverController.getDriver(int uid)` (line 228–231) passes the `{uid}` path variable directly to this method with no check that the authenticated user belongs to the same organisation as the requested driver. Any authenticated token holder can retrieve full driver records (name, licence number, security number, address, expiry date) for any driver in the system. (See B02-5 below.)

**Finding: `findAllTraining` has no organisation-scoping — IDOR**

`DriverDAOImpl.findAllTraining(int driverId)` (line 151–158):
```java
String sql = "select id, manufacture_id,type_id,fuel_type_id,training_date, expiration_date"
           + " from driver_training where driver_id = ? ";
```
Called from `DriverController.getLoginAuth` (line 68), which is marked `@Deprecated` but is still mapped and reachable. The query contains no company filter. Any caller that can supply a `driverId` can retrieve training records for any driver. (See B02-6 below.)

**Finding: `uploadProfile` / `uploadProfileAPP` have no ownership check — IDOR**

`DriverController.uploadProfile` (line 132) and `uploadProfileAPP` (line 163) accept `{uid}` as a path variable and execute:
```java
String query = "update driver set photo_url = ? where id = ? ";
jdbcTemplate.update(query, imageFilename, uid);
```
No check is made that the authenticated user is the driver identified by `uid`. Any authenticated user can overwrite another driver's profile photo. (See B02-7 below.)

**Finding: `saveLicence` has no ownership check — IDOR**

`DriverController.saveLicence` (line 235–249) updates licence number, expiry date, address, and social security number for a driver identified by `user.getId()` from the request body, with no check that the caller owns that record. (See B02-8 below.)

**Finding: `updateDrivers` has no ownership check — IDOR**

`DriverController.updateDrivers` (line 253–265) updates `first_name`, `last_name`, `compliance_date` for `driver.getId()` from the request body with no ownership check. (See B02-9 below.)

**Finding: `saveEmails` / `getEmails` have no ownership check — IDOR**

`DriverController.saveEmails` (line 187–205) reads `driver_id` from the request body and performs upsert on `driver_emails` with no ownership check. `getEmails` (line 209–224) reads `{uid}` from the path and returns email addresses with no ownership check. (See B02-10 below.)

**Finding: `acceptDrivers` and `declineDriver` have no organisation check**

`DriverController.acceptDrivers` (line 108–116) and `declineDriver` (line 118–128) operate on permission records by ID (`idpermission`) with no check that the authenticated user administers the company associated with those permissions. (See B02-11 below.)

**Finding: Password reset requires no authentication**

`POST /rest/appuser/reset` is reachable by `ROLE_DRIVER` (any driver). `DriverService.resetPassword` (line 99–117) accepts a `Driver` body containing only an email address and resets the password for that email. Any authenticated driver can trigger a password reset for any other driver's account. (See B02-12 below.)

**Finding: `registerDrivers` is accessible to all authenticated roles with no admin guard**

`POST /rest/appuser/register` is accessible to `ROLE_DRIVER`. A regular driver can register new driver accounts or company-owner accounts. (See B02-13 below.)

**Finding: Deprecated authentication endpoint still active**

`POST /rest/appuser/validate` is annotated `@Deprecated` (line 58) in the controller but is still mapped and reachable at runtime. This endpoint uses MD5-hashed email/password authentication (see B02-17 below for the MD5 issue) and is not protected beyond the generic role check. (See B02-14 below.)

**OAuth2 token validity misconfiguration:**

`spring-security.xml` line 114 shows `access-token-validity="0"` for client `987654321`. In Spring Security OAuth2 1.x, a value of `0` means the token never expires. (See B02-15 below.)

---

### Section 3 — Input Validation and Injection

**SQL queries in the assigned files** all use parameterised `?` placeholders with JdbcTemplate — CLEAR for SQL injection in `DriverDAOImpl` and `EmailLayoutDAO`.

**`DriverController` inline SQL** (not in the assigned DAO files but reviewed as the caller): All inline `JdbcTemplate` calls in `DriverController` also use `?` placeholders — CLEAR for SQL injection in the controller.

**`@RequestBody` and `@RequestParam` inputs** — No `@Valid` annotation is present on any `@RequestBody` parameter in `DriverController`. No JSR-303/JSR-380 constraint annotations (`@NotNull`, `@Size`, `@Pattern`) are present on the `Driver` model class. (See B02-16 below.)

**`getLoginAuth` logs full driver object via Gson:** Line 60 logs `gson.toJson(driverExample)`, which will include the `password` field from the request body. (See finding under Section 5 — Logging, B02-21.)

**No command injection, SSRF, XXE, path traversal, or deserialization vulnerabilities** identified in the three assigned files. `EmailLayoutDAO.getEmailLayoutByType` has an unused `String type` parameter but performs no operation with it — CLEAR.

---

### Section 4 — Session and CSRF

**CSRF:** Spring Security OAuth2 resource server filter (`resourceServerFilter`) is used. The security configuration uses `create-session="never"` for `/rest/**`, meaning no session is created. CSRF protection is not relevant for stateless token-authenticated REST APIs — CLEAR.

**CORS:** No `@CrossOrigin` annotation on `DriverController` or its parent `ConfigurationController`. No `CorsRegistry` configuration found in reviewed files. CORS policy is not visible in these files — flagged for wider review.

**Security headers:** Not configured in the reviewed Spring Security XML. No explicit `X-Frame-Options`, `X-Content-Type-Options`, or `Strict-Transport-Security` headers are set in the security configuration. Transport-level HTTPS is enforced via the `web.xml` `<transport-guarantee>CONFIDENTIAL</transport-guarantee>` constraint. (See B02-18 below.)

**Cookie configuration:** `create-session="never"` means no session cookie is created for API requests — CLEAR for session cookie issues on the API layer.

---

### Section 5 — Data Exposure

**Finding: `Driver` model serialises `password` and `securityno` in all API responses**

The `Driver` class (model) has no `@JsonIgnore` annotation on `password` (line 25) or `securityno` (line 29). Any endpoint returning a `Driver` object will include the password hash and social/security number in the JSON response. (See B02-19 below.)

**Finding: Error message leaks driver ID / email**

`DriverDAOImpl.update` (line 70): `"Unable to update driver detail for driver " + driver.getId()` — this message is included in `SQLException` which propagates up. Similar patterns at lines 84 and 97. These exception messages may reach the client if there is no global exception handler that strips them. (See B02-20 below.)

**Finding: Logging of sensitive driver data (PII)**

`DriverController.getLoginAuth` line 60: `log.info("Start getLoginAuth." + " : " + gson.toJson(driverExample))` — serialises the entire `Driver` request body (including `password`, `email`, `securityno`, `licno`, `addr`) to the application log at INFO level.

`DriverController.registerDrivers` line 78: `log.info("Start registerDrivers." + " : " + gson.toJson(driver))` — same issue.

`DriverController.saveLicence` line 236: `log.info("Start saveLicence." + " : " + gson.toJson(user))` — serialises licence number, security number, address to INFO log.

`DriverController.resetPassword` line 92: `log.info("ResetPassword:" + " : " + gson.toJson(driver))` — logs the email triggering the reset.

`DriverController.updateDrivers` line 254: `log.info("Start UPDATE_USERS." + " : " + gson.toJson(driver))` — logs full driver update payload.

`DriverService.resetPassword` lines 108–112: the new plaintext password is included in the log message indirectly (it appears in the `msg` string assigned at line 108, which is then passed to `SendEmail` — the new password is not logged directly, but if any logging were added in `SendEmail`, it would appear). Not a finding on its own, but reviewed.

(See B02-21 below.)

**`EmailLayoutDAO.getEmailLayoutByType`** — method body is a stub returning an empty object; no data exposure risk — CLEAR.

---

### Section 6 — Dependencies

**Finding: Critically outdated Spring Framework (3.2.14.RELEASE)**

`pom.xml` line 13: `org.springframework-version` is `3.2.14.RELEASE`. Spring 3.2 reached end-of-life in December 2016. It is affected by numerous CVEs including CVE-2018-1270 (RCE via STOMP), CVE-2018-1272 (privilege escalation), and many others. (See B02-22 below.)

**Finding: Critically outdated Spring Security (3.1.1.RELEASE)**

`pom.xml` lines 231 and 236: `spring-security-web` and `spring-security-config` are version `3.1.1.RELEASE`. Spring Security 3.1 reached end-of-life in 2016 and contains numerous known vulnerabilities. (See B02-23 below.)

**Finding: Outdated Jackson (2.6.7)**

`pom.xml` line 15: `jackson.databind-version` is `2.6.7`. CVE-2017-17485, CVE-2018-5968, CVE-2019-14379, and many other Jackson deserialization CVEs affect this version. (See B02-24 below.)

**Finding: Outdated Spring Security OAuth2 (1.0.0.RELEASE)**

`pom.xml` line 241: `spring-security-oauth2` version `1.0.0.RELEASE`. This library was deprecated and replaced; version 1.0.0 is extremely old and carries CVE-2018-15758 (token privilege escalation) among others. (See B02-25 below.)

**Finding: Outdated AWS SDK (1.11.163)**

`pom.xml` line 272: `aws-java-sdk` version `1.11.163` (released ~2017). Multiple security advisories exist for versions in this range. (See B02-26 below.)

**Finding: Outdated commons-fileupload (1.3.1)**

`pom.xml` line 201: `commons-fileupload` version `1.3.1` is affected by CVE-2016-3092 (DoS) and CVE-2014-0050 (DoS). (See B02-27 below.)

**Finding: Third-party Maven repository over HTTP**

`pom.xml` line 88: Splunk JFrog repository URL is `http://splunk.jfrog.io/splunk/ext-releases-local` (plain HTTP). Dependencies fetched over HTTP are vulnerable to MITM/supply-chain substitution attacks. (See B02-28 below.)

**Finding: Deprecated `@Deprecated` authentication method still callable at runtime**

`findByEmailAndPassword` uses MD5 for password comparison (see `spring-security.xml` line 74 `password-encoder hash="md5"` and the SQL `md5(d.email) = ?`). MD5 is cryptographically broken and not suitable for password storage. (See B02-17 below.)

---

### Section 7 — Build and CI

**No bitbucket-pipelines.yml found** — build pipeline not present in this repository. N/A for pipeline-specific checks.

**Test skipping:** Cannot verify — no CI file present.

**`-Xlint:all` is configured** in `maven-compiler-plugin` (pom.xml line 307) — CLEAR.

---

## Step 5 — Findings

---

**B02-1** — HIGH
**Section:** 1. Secrets and Configuration
**File:** `environment.dev.properties:15-16`, `environment.uat.properties:15-16`, `environment.prod.properties:15-16`
**Description:** Cognito API credentials are hardcoded as literal values in all three environment property files committed to source control. If the repository is accessed by an unauthorised party, the credentials can be used to authenticate directly against the Cognito API proxy.
**Evidence:**
```
cognitoAPIUsername=ciiadmin
cognitoAPIPassword=ciiadmin
```

---

**B02-2** — HIGH
**Section:** 1. Secrets and Configuration
**File:** `pom.xml:28-31`, `pom.xml:76-78`
**Description:** Database passwords are hardcoded in Maven build profile properties. The `local` profile contains `gmtp-postgres` and `fleetiq360`, and the `uat` profile contains `C!1admin`. These are committed to source control.
**Evidence:**
```xml
<!-- local profile -->
<flyway.password>gmtp-postgres</flyway.password>
<flyway.password>fleetiq360</flyway.password>

<!-- uat profile -->
<flyway.user>dev_admin</flyway.user>
<flyway.password>C!1admin</flyway.password>
```

---

**B02-3** — HIGH
**Section:** 1. Secrets and Configuration
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:117`
**Description:** The OAuth2 client secret for the `fleetiq360` client is hardcoded as a literal string in the Spring Security XML configuration file, which is committed to source control.
**Evidence:**
```xml
<oauth:client client-id="fleetiq360" authorized-grant-types="password,authorization_code,refresh_token,implicit"
              secret="rihah8eey4faibuengaixo6leiL1awii" authorities="ROLE_DRIVER,ROLE_COMPANY_GROUP,ROLE_SYS_ADMIN" scope="read,write" access-token-validity="300" refresh-token-validity="300"/>
```

---

**B02-4** — MEDIUM
**Section:** 1. Secrets and Configuration
**File:** `pom.xml:73`
**Description:** The production AWS RDS hostname is hardcoded in the `uat` Flyway URL. This leaks infrastructure topology to anyone with repository access and facilitates targeted attack planning.
**Evidence:**
```xml
<flyway.url>jdbc:postgresql://forkliftiq360.cmjwsurtk4tn.us-east-1.rds.amazonaws.com:5432/postgres</flyway.url>
```

---

**B02-5** — CRITICAL
**Section:** 2. Authentication and Authorization / 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAOImpl.java:107`, `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:228-231`
**Description:** IDOR — `findByID` looks up a driver record using only the supplied `userId` with no company/organisation filter. The controller endpoint `GET /rest/appuser/get/{uid}` passes the path variable directly to this method without verifying that the authenticated user belongs to the same organisation as the requested driver. Any holder of a valid OAuth token can retrieve full driver records — including name, licence number (`licno`), security/social number (`securityno`), address (`addr`), expiry date (`expirydt`), phone — for any driver in the system by enumerating integer IDs.
**Evidence:**
```java
// DriverDAOImpl.java line 107
String sql = BASE_QUERY_DRIVER + "where d.id = ? and d.active = true";

// DriverController.java lines 228-231
@RequestMapping(value = RestURIConstants.GET_USR, method = RequestMethod.GET)
public @ResponseBody
List<Driver> getDriver(@PathVariable("uid") int uid) {
    log.info("Start getDriver for " + uid);
    return Collections.singletonList(driverDAO.findByID(uid));
}
```

---

**B02-6** — HIGH
**Section:** 2. Authentication and Authorization / 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAOImpl.java:151-158`
**Description:** IDOR — `findAllTraining` queries the `driver_training` table using only `driver_id` with no company scoping. Training records for any driver in the system (equipment types, training dates, expiration dates) are accessible to any authenticated user who knows or enumerates a driver ID.
**Evidence:**
```java
String sql = "select id, manufacture_id,type_id,fuel_type_id,training_date, expiration_date"
           + " from driver_training where driver_id = ? ";
return getJdbcTemplate().query(sql, new Object[]{driverId}, new BeanPropertyRowMapper<>(DriverTraining.class));
```

---

**B02-7** — HIGH
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:132-158`, `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:161-183`
**Description:** IDOR — `POST /rest/appuser/photo/{uid}` and `POST /rest/appuser/photo/app/{uid}` update the `photo_url` column for the driver identified by the `{uid}` path variable without verifying the caller is that driver or belongs to the same organisation. Any authenticated user can overwrite another driver's profile photo.
**Evidence:**
```java
// uploadProfile, line 146-147
String query = "update driver set photo_url = ? where id = ? ";
jdbcTemplate.update(query, imageFilename, uid);

// uploadProfileAPP, line 171-172
String query = "update driver set photo_url = ? where id = ? ";
jdbcTemplate.update(query, imageFilename, uid);
```

---

**B02-8** — CRITICAL
**Section:** 2. Authentication and Authorization / 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:233-249`
**Description:** IDOR — `POST /rest/licence/save` updates licence number, expiry date, address, and security/social number for a driver identified by `user.getId()` sourced from the request body. There is no verification that the authenticated caller owns that driver record. Any authenticated user can overwrite sensitive PII (licence, address, security number) for any other driver.
**Evidence:**
```java
String query = "update driver set licno = ?, expirydt = ?, addr= ?, securityno = ? where id = ?";
jdbcTemplate.update(query, user.getLicno(), expDate, user.getAddr(), user.getSecurityno(), user.getId());
```

---

**B02-9** — HIGH
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:251-265`
**Description:** IDOR — `POST /rest/appuser/update/{uid}` updates `first_name`, `last_name`, and `compliance_date` for a driver identified by `driver.getId()` from the request body. No check that the authenticated caller owns or administers that record.
**Evidence:**
```java
String query = "update driver set first_name = ?, last_name = ?, compliance_date = ?, updatedat = now() where id = ? ";
jdbcTemplate.update(query, driver.getFirst_name(), driver.getLast_name(), complianceDate, driver.getId());
```

---

**B02-10** — HIGH
**Section:** 2. Authentication and Authorization / 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:185-224`
**Description:** IDOR — `POST /rest/appuser/emails` performs upsert on `driver_emails` using `driver_id` from the request body; `GET /rest/appuser/emails/get/{uid}` returns up to four email addresses using the `{uid}` path variable. Neither endpoint verifies that the authenticated caller is that driver or belongs to the same organisation.
**Evidence:**
```java
// saveEmails: driver_id from request body, no ownership check
int count = jdbcTemplate.queryForObject(sql, Integer.class, driverEmails.getDriver_id());

// getEmails: uid from path variable, no ownership check
String query = "select email_addr1,email_addr2,email_addr3,email_addr4 from driver_emails where driver_id = ?";
List<DriverEmails> emailList = jdbcTemplate.query(query, new Object[]{uid}, new BeanPropertyRowMapper<>(DriverEmails.class));
```

---

**B02-11** — HIGH
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:106-128`
**Description:** IDOR — `PUT /rest/users/permission/acceptall/{pids}` and `DELETE /rest/users/permission/deleteall/{pids}` operate on `tblpermission` rows by primary key ID, with no check that the authenticated user administers the company owning those permission records. Any authenticated user can accept or delete permission records belonging to other organisations.
**Evidence:**
```java
for (int perId : perIds)
    jdbcTemplate.update("update tblpermission set acceptedbyuser = true, totalhoursview = true, updatedat = now() where idpermission = ? ", perId);

for (int perId : perIds)
    jdbcTemplate.update("delete from tblpermission where idpermission = ?  and acceptedbyuser is false", perId);
```

---

**B02-12** — HIGH
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:89-104`, `src/main/java/com/journaldev/spring/jdbc/service/DriverService.java:99-117`
**Description:** The password reset endpoint `POST /rest/appuser/reset` accepts a `Driver` body containing an email address and resets the password for that account without verifying the caller is the account owner. Any authenticated driver can trigger a password reset (and receive the new password by email) for any other driver account whose email address they know.
**Evidence:**
```java
// DriverController.java lines 89-104
@RequestMapping(value = RestURIConstants.RESET_PASSWORD, method = RequestMethod.POST)
public @ResponseBody ResponseEntity<Results> resetPassword(@RequestBody Driver driver) {
    // ...
    driverService.resetPassword(driver);
    // ...
}

// DriverService.java lines 99-106
public void resetPassword(Driver driver) throws DriverServiceException {
    String pass = generateRandomPassword();
    driverDAO.updatePassword(driver.getEmail(), pass);
    // sends new password to driver.getEmail()
}
```

---

**B02-13** — MEDIUM
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:75-87`
**Description:** `POST /rest/appuser/register` is accessible to any authenticated user including `ROLE_DRIVER`. A regular driver can register new driver accounts or company-owner accounts (`contactperson=true`). There is no role guard restricting registration to administrators or company group owners.
**Evidence:**
```java
@RequestMapping(value = RestURIConstants.CREATE_APPUSR, method = RequestMethod.POST)
public @ResponseBody ResponseEntity<Driver> registerDrivers(@RequestBody Driver driver) {
    // no role check — any ROLE_DRIVER can reach this
    driver = driverService.registerDriver(driver);
    // ...
}
```

---

**B02-14** — MEDIUM
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:56-73`
**Description:** The `@Deprecated` authentication endpoint `POST /rest/appuser/validate` is still mapped and reachable at runtime. It performs credential-based authentication using MD5-hashed email lookup and returns the full driver record including subordinate driver lists. The `@Deprecated` annotation has no effect at runtime.
**Evidence:**
```java
@RequestMapping(value = RestURIConstants.VALIDATE_USR, method = RequestMethod.POST)
public @ResponseBody
@Deprecated
ResponseEntity<List<Driver>> getLoginAuth(@RequestBody Driver driverExample) {
```

---

**B02-15** — HIGH
**Section:** 2. Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:114`
**Description:** OAuth2 client `987654321` is configured with `access-token-validity="0"`. In Spring Security OAuth2 1.x, a validity of `0` results in tokens that never expire. If a token issued to this client is compromised, it cannot be invalidated by expiry.
**Evidence:**
```xml
<oauth:client client-id="987654321" authorized-grant-types="password,authorization_code,implicit"
              secret="8752361E593A573E86CA558FFD39E" authorities="ROLE_CLIENT" scope="read,write" access-token-validity="0"/>
```

---

**B02-16** — MEDIUM
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java` (multiple methods)
**Description:** No `@Valid` annotation is present on any `@RequestBody` parameter in `DriverController`. The `Driver` model has no JSR-303/JSR-380 constraint annotations (`@NotNull`, `@Size`, `@Pattern`, etc.). Inputs such as `email`, `first_name`, `last_name`, `licno`, `securityno`, and `addr` are accepted without validation and passed directly to SQL statements.
**Evidence:**
```java
// e.g. line 77 — no @Valid
ResponseEntity<Driver> registerDrivers(@RequestBody Driver driver)

// e.g. line 91
ResponseEntity<Results> resetPassword(@RequestBody Driver driver)

// Driver model — no constraints on any field
private String email;
private String licno;
private String securityno;
```

---

**B02-17** — HIGH
**Section:** 2. Authentication and Authorization / 3. Input Validation and Injection
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:74`, `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAOImpl.java:90`, `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAOImpl.java:126`
**Description:** Passwords are stored and compared using MD5, which is a broken cryptographic hash unsuitable for password storage. MD5 has no salt, is extremely fast, and is trivially reversible via rainbow tables. This affects the legacy `findByEmailAndPassword` endpoint and the `updatePassword` / `UPDATE_PASSWORD` path. Additionally, `findByEmailAndPassword` uses `md5(d.email)` for lookup — hashing the email as a comparison key is unusual and may indicate the caller is sending an MD5-hashed email, which provides no security benefit over sending the plaintext email.
**Evidence:**
```sql
-- UPDATE_PASSWORD constant (line 90)
"update driver set password = md5(?) where email = ? "

-- findByEmailAndPassword query (line 126)
"where d.active = true and md5(d.email) = ? and d.password = ?"
```
```xml
<!-- spring-security.xml line 74 -->
<password-encoder hash="md5"/>
```

---

**B02-18** — MEDIUM
**Section:** 4. Session and CSRF
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml`
**Description:** No HTTP security headers (`X-Frame-Options`, `X-Content-Type-Options`, `Strict-Transport-Security`, `X-XSS-Protection`) are configured in the Spring Security XML. HTTPS is enforced by the Tomcat `CONFIDENTIAL` transport constraint, but security headers are absent.
**Evidence:** No `<headers>` element present in `spring-security.xml`. Spring Security 3.1 does not automatically add security headers (that feature was introduced in Spring Security 3.2).

---

**B02-19** — HIGH
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Driver.java:25`, `src/main/java/com/journaldev/spring/jdbc/model/Driver.java:29`
**Description:** The `Driver` model serialises `password` (line 25) and `securityno` (line 29) in JSON responses. No `@JsonIgnore` annotation is present on these fields. Any endpoint returning a `Driver` object (e.g., `GET /rest/appuser/get/{uid}`, `POST /rest/appuser/validate`, `POST /rest/appuser/register`) will include the password hash and the driver's social/security number in the response body.
**Evidence:**
```java
private String password;   // line 25 — included in serialised JSON
private String securityno; // line 29 — included in serialised JSON
```

---

**B02-20** — LOW
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAOImpl.java:70`, `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAOImpl.java:84`, `src/main/java/com/journaldev/spring/jdbc/DAO/DriverDAOImpl.java:97`
**Description:** `SQLException` messages include driver IDs and email addresses. If these exceptions propagate to the HTTP response (no global exception handler was verified to sanitise them), internal identifiers are exposed to clients.
**Evidence:**
```java
// line 70
throw new SQLException("Unable to update driver detail for driver " + driver.getId());
// line 84
throw new SQLException("Unable to update last login time for driver " + driver.getId());
// line 97
throw new SQLException("Unable to update driver password for driver " + email);
```

---

**B02-21** — HIGH
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:60`, `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:78`, `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:92`, `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:236`, `src/main/java/com/journaldev/spring/jdbc/controller/DriverController.java:254`
**Description:** Multiple controller methods log the full Gson-serialised request body at INFO level. Because the `Driver` model includes `password`, `email`, `licno`, `securityno`, and `addr`, sensitive PII and credential material is written to application logs at a level that will appear in production. This violates operator data privacy requirements and constitutes a regulatory risk.
**Evidence:**
```java
// line 60 — logs password, email, all driver fields
log.info("Start getLoginAuth." + " : " + gson.toJson(driverExample));

// line 78 — logs new driver registration including password
log.info("Start registerDrivers."  + " : " + gson.toJson(driver));

// line 92 — logs email of account being reset
log.info("ResetPassword:"  + " : " + gson.toJson(driver));

// line 236 — logs licno, securityno, addr, expirydt
log.info("Start saveLicence."  + " : " + gson.toJson(user));

// line 254 — logs first_name, last_name, compliance_date
log.info("Start UPDATE_USERS."  + " : " + gson.toJson(driver));
```

---

**B02-22** — CRITICAL
**Section:** 6. Dependencies
**File:** `pom.xml:13`
**Description:** Spring Framework 3.2.14.RELEASE is end-of-life (EOL since December 2016) and affected by multiple critical CVEs. Running EOL Spring Framework in a production system handling operator PII and safety-critical data is unacceptable.
**Evidence:**
```xml
<org.springframework-version>3.2.14.RELEASE</org.springframework-version>
```

---

**B02-23** — CRITICAL
**Section:** 6. Dependencies
**File:** `pom.xml:231`, `pom.xml:236`
**Description:** Spring Security 3.1.1.RELEASE is end-of-life (EOL since 2016) and carries multiple known vulnerabilities.
**Evidence:**
```xml
<groupId>org.springframework.security</groupId>
<artifactId>spring-security-web</artifactId>
<version>3.1.1.RELEASE</version>

<groupId>org.springframework.security</groupId>
<artifactId>spring-security-config</artifactId>
<version>3.1.1.RELEASE</version>
```

---

**B02-24** — HIGH
**Section:** 6. Dependencies
**File:** `pom.xml:15`
**Description:** Jackson Databind 2.6.7 is affected by a large number of deserialization CVEs (CVE-2017-7525, CVE-2017-17485, CVE-2018-5968, CVE-2019-14379, and others) that can allow remote code execution when polymorphic deserialization is enabled or when certain gadget classes are on the classpath.
**Evidence:**
```xml
<jackson.databind-version>2.6.7</jackson.databind-version>
```

---

**B02-25** — HIGH
**Section:** 6. Dependencies
**File:** `pom.xml:241`
**Description:** Spring Security OAuth2 1.0.0.RELEASE is extremely old and carries CVE-2018-15758 (improper token privilege validation) among other issues.
**Evidence:**
```xml
<groupId>org.springframework.security.oauth</groupId>
<artifactId>spring-security-oauth2</artifactId>
<version>1.0.0.RELEASE</version>
```

---

**B02-26** — MEDIUM
**Section:** 6. Dependencies
**File:** `pom.xml:272`
**Description:** AWS Java SDK 1.11.163 (circa 2017) is significantly outdated. Multiple security advisories apply to versions in this range.
**Evidence:**
```xml
<groupId>com.amazonaws</groupId>
<artifactId>aws-java-sdk</artifactId>
<version>1.11.163</version>
```

---

**B02-27** — MEDIUM
**Section:** 6. Dependencies
**File:** `pom.xml:199-202`
**Description:** `commons-fileupload` 1.3.1 is affected by CVE-2016-3092 (CPU-exhausting Denial of Service during multipart parsing) and CVE-2014-0050. The application uses file upload for driver profile photos.
**Evidence:**
```xml
<groupId>commons-fileupload</groupId>
<artifactId>commons-fileupload</artifactId>
<version>1.3.1</version>
```

---

**B02-28** — MEDIUM
**Section:** 6. Dependencies / 7. Build and CI
**File:** `pom.xml:88`
**Description:** The Splunk dependency is fetched from a third-party JFrog repository over plain HTTP (`http://`), not HTTPS. A network-level attacker in a position to intercept Maven dependency fetches could substitute a malicious JAR.
**Evidence:**
```xml
<repository>
    <id>splunk-artifactory</id>
    <name>Splunk Releases</name>
    <url>http://splunk.jfrog.io/splunk/ext-releases-local</url>
</repository>
```

---

## Summary Table

| ID | Severity | Section | Short description |
|----|----------|---------|------------------|
| B02-1 | HIGH | 1 — Secrets | Cognito API credentials hardcoded in all env property files |
| B02-2 | HIGH | 1 — Secrets | Database passwords hardcoded in pom.xml Flyway profiles |
| B02-3 | HIGH | 1 — Secrets | OAuth2 client secret hardcoded in spring-security.xml |
| B02-4 | MEDIUM | 1 — Secrets | Production AWS RDS hostname in pom.xml |
| B02-5 | CRITICAL | 2 — AuthZ / 5 — Data | IDOR: `findByID` / `GET /rest/appuser/get/{uid}` — no org scope |
| B02-6 | HIGH | 2 — AuthZ / 5 — Data | IDOR: `findAllTraining` — no org scope |
| B02-7 | HIGH | 2 — AuthZ | IDOR: `uploadProfile`/`uploadProfileAPP` — no ownership check |
| B02-8 | CRITICAL | 2 — AuthZ / 5 — Data | IDOR: `saveLicence` — overwrite PII (licno, securityno, addr) |
| B02-9 | HIGH | 2 — AuthZ | IDOR: `updateDrivers` — no ownership check |
| B02-10 | HIGH | 2 — AuthZ / 5 — Data | IDOR: `saveEmails`/`getEmails` — no ownership check |
| B02-11 | HIGH | 2 — AuthZ | IDOR: `acceptDrivers`/`declineDriver` — no org check |
| B02-12 | HIGH | 2 — AuthZ | Password reset usable against any account by any auth user |
| B02-13 | MEDIUM | 2 — AuthZ | Driver registration accessible to ROLE_DRIVER — no admin guard |
| B02-14 | MEDIUM | 2 — AuthZ | Deprecated login endpoint still active at runtime |
| B02-15 | HIGH | 2 — AuthZ | OAuth2 client `987654321` tokens never expire (validity=0) |
| B02-16 | MEDIUM | 3 — Validation | No `@Valid` on any `@RequestBody` in DriverController |
| B02-17 | HIGH | 2 — AuthZ / 3 — Injection | Passwords stored/compared with MD5 (broken, no salt) |
| B02-18 | MEDIUM | 4 — Session/CSRF | Security response headers not configured |
| B02-19 | HIGH | 5 — Data Exposure | `password` and `securityno` serialised in all Driver responses |
| B02-20 | LOW | 5 — Data Exposure | SQLException messages leak driver IDs and emails |
| B02-21 | HIGH | 5 — Data Exposure | Full Driver PII logged at INFO level on every request |
| B02-22 | CRITICAL | 6 — Dependencies | Spring Framework 3.2.14 — EOL, multiple critical CVEs |
| B02-23 | CRITICAL | 6 — Dependencies | Spring Security 3.1.1 — EOL, multiple critical CVEs |
| B02-24 | HIGH | 6 — Dependencies | Jackson Databind 2.6.7 — multiple deserialization CVEs |
| B02-25 | HIGH | 6 — Dependencies | Spring Security OAuth2 1.0.0 — CVE-2018-15758 and others |
| B02-26 | MEDIUM | 6 — Dependencies | AWS SDK 1.11.163 — outdated (~2017) |
| B02-27 | MEDIUM | 6 — Dependencies | commons-fileupload 1.3.1 — CVE-2016-3092 (DoS) |
| B02-28 | MEDIUM | 6 / 7 — Build | Splunk Maven repo served over plain HTTP |
