# Security Audit — Pass 1 — Agent B15
**Date:** 2026-02-27
**Repo:** forkliftiqws (branch: master)
**Agent:** B15
**Assigned files:**
- `src/main/java/com/journaldev/spring/jdbc/model/EquipmentType.java`
- `src/main/java/com/journaldev/spring/jdbc/model/ErrorMessage.java`
- `src/main/java/com/journaldev/spring/jdbc/model/FormDtl.java`

---

## STEP 3 — Reading Evidence

### File 1: EquipmentType.java

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.EquipmentType`

**Interfaces implemented / classes extended:**
- implements `java.io.Serializable`

**Annotations on class:** none

**Fields:**

| Modifier | Type | Name |
|---|---|---|
| private static final | long | serialVersionUID = 172500681596273029L |
| private | int | id |
| private | String | name |
| private | String | icon |

**Public methods:**

| Return type | Method signature | Line |
|---|---|---|
| int | getId() | 16 |
| void | setId(int id) | 19 |
| String | getName() | 22 |
| void | setName(String name) | 25 |
| String | getIcon() | 28 |
| void | setIcon(String icon) | 31 |

**Annotations on methods:** none

---

### File 2: ErrorMessage.java

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.ErrorMessage`

**Interfaces implemented / classes extended:**
- implements `java.io.Serializable`

**Annotations on class:**
- `@Data` (Lombok — generates getters, setters, equals, hashCode, toString)
- `@NoArgsConstructor` (Lombok — generates no-arg constructor)

**Fields:**

| Modifier | Type | Name |
|---|---|---|
| private static final | long | serialVersionUID = -7636476173287405171L |
| private | String | message |
| private | String | code |
| private | String | detail |

**Public methods (Lombok-generated):**
All getters and setters are generated by `@Data` at compile time; no explicit method declarations appear in source. Effective public API:

| Return type | Method signature |
|---|---|
| String | getMessage() |
| void | setMessage(String message) |
| String | getCode() |
| void | setCode(String code) |
| String | getDetail() |
| void | setDetail(String detail) |

**Annotations on methods:** none (methods are Lombok-generated)

**Usage context (cross-reference):**
`ErrorMessage` is embedded in `ResponseWrapper` (`src/main/java/com/journaldev/spring/jdbc/model/ResponseWrapper.java`, line 20) as `private List<ErrorMessage> errors`. `ResponseWrapper` is the standard HTTP response envelope returned to clients, including via `AuthenticationResponse` which extends `ResponseWrapper`. There is no `@ControllerAdvice` / `@ExceptionHandler` in this codebase; exception handling is ad hoc inside controllers.

---

### File 3: FormDtl.java

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.FormDtl`

**Interfaces implemented / classes extended:**
- implements `java.io.Serializable`

**Annotations on class:** none

**Fields:**

| Modifier | Type | Name |
|---|---|---|
| private static final | long | serialVersionUID = 1718755713311858420L |
| private | int | id |
| private | String | input_type |
| private | String | input_label |
| private | String | input_value |
| private | String | input_image |
| private | int | input_order |
| private | String | expected_answer |

**Public methods:**

| Return type | Method signature | Line |
|---|---|---|
| int | getId() | 20 |
| void | setId(int id) | 35 |
| String | getInput_type() | 23 |
| void | setInput_type(String input_type) | 26 |
| String | getInput_label() | 38 |
| void | setInput_label(String input_label) | 41 |
| String | getInput_value() | 29 |
| void | setInput_value(String input_value) | 32 |
| String | getInput_image() | 44 |
| void | setInput_image(String input_image) | 47 |
| int | getInput_order() | 50 |
| void | setInput_order(int input_order) | 53 |
| String | getExpected_answer() | 56 |
| void | setExpected_answer(String expected_answer) | 59 |

**Annotations on methods:** none

**Usage context (cross-reference):**
`FormDtl` is returned directly as a `List<FormDtl>` to HTTP clients by two endpoints in `SessionController`:

- `getForm()` at line 138: `@RequestMapping(value = RestURIConstants.GET_FORMS, method = RequestMethod.GET)` — query explicitly selects `expected_answer` column and maps it into `FormDtl` via `BeanPropertyRowMapper`.
- `searchForm()` at line 154: does NOT select `expected_answer` (query selects `id, input_type, input_label, input_value, input_image, input_order` only), however the full `FormDtl` object including the `expected_answer` field is returned; in this case the field will be null/empty.

Neither endpoint annotates the controller method or the class with `@Valid`, nor does `FormDtl` carry any JSR-303 constraints.

---

## STEP 4 — Checklist Review

### Section 1: Secrets and Configuration

These model files contain no credentials, API keys, database URLs, or hardcoded secrets. No `DriverManager.getConnection()`, `BasicDataSource`, or similar JDBC setup is present in these files.

**Result: N/A for these three model files** (secrets analysis belongs to config/bootstrap files not assigned here).

---

### Section 2: Authentication and Authorization

These model files contain no security filter chain configuration, no `@PreAuthorize`, no `@Secured`, and no IDOR-relevant logic.

**Result: N/A for these three model files** (auth configuration belongs to SecurityConfig and controller files).

---

### Section 3: Input Validation and Injection

No `@Valid`, `@NotNull`, `@Size`, `@Pattern`, or any JSR-303 bean validation annotations exist on any field in `EquipmentType`, `ErrorMessage`, or `FormDtl`. This is expected for model classes; the responsibility for validation lies at the controller boundary. Cross-reference with `SessionController` confirms that `FormDtl` instances are populated from query results (not from direct user-supplied JSON bodies), so the absence of bean validation constraints on this class is contextually low-risk for injection — however, the `type` and `keyword` path variables passed into the queries are not validated.

**Deserialization (@JsonTypeInfo):** No `@JsonTypeInfo` annotation is present on any of the three assigned files. No globally configured `ObjectMapper.enableDefaultTyping()` or `activateDefaultTyping()` was found anywhere in the `src/main/java` tree.

**Result: CLEAR** for assigned files. No deserialization concerns in these three classes.

---

### Section 4: Session and CSRF

Model classes. No CSRF, CORS, or cookie configuration is present.

**Result: N/A for these three model files.**

---

### Section 5: Data Exposure

#### 5a — ErrorMessage.detail field (HIGH PRIORITY)

`ErrorMessage` has three fields: `message`, `code`, and `detail`. The class is annotated `@Data` (Lombok), meaning `getDetail()` is generated and all three fields will be serialized to JSON with no `@JsonIgnore` or `@JsonInclude` restriction on `ErrorMessage` itself.

`ErrorMessage` is embedded in `ResponseWrapper.errors` (a `List<ErrorMessage>`), which is the standard API response envelope. `ResponseWrapper` uses `@JsonInclude(JsonInclude.Include.NON_NULL)` so null fields are suppressed — however if `detail` is populated it will be serialized to clients.

Cross-referencing usage of `ErrorMessage.setDetail()` / the `detail` field across the codebase: no call site directly sets `detail` via Lombok setter in the audited files or discovered in the wider search. However, the field is fully public-gettable and un-annotated. Its name (`detail`) is semantically ambiguous — it could receive exception messages, SQL error text, or internal system information from any future or existing call site.

**Separate concern discovered in `ImpactController` line 189 (cross-reference, not in assigned files):**
`results.setError(e.getMessage())` sets the raw exception message from an `IllegalArgumentException` into `Results.error` which is returned to clients. This is a data-exposure risk in a related but non-assigned file; it is noted here for completeness but is outside B15's assigned scope.

#### 5b — FormDtl.expected_answer returned to clients (HIGH PRIORITY finding)

`getForm()` in `SessionController` (line 143-148) explicitly includes `expected_answer` in the SQL SELECT and maps it through `BeanPropertyRowMapper` into `FormDtl`. The entire `FormDtl` list — including `expected_answer` — is then returned directly as the HTTP response body (`@ResponseBody`). No `@JsonIgnore` annotation exists on the `expected_answer` field.

In a forklift operator pre-use inspection/checklist context, `expected_answer` represents the correct answer to a pre-operation check question. Returning the expected answer to the client allows a client application (or a malicious actor) to trivially automate passing of safety inspections without the operator actually performing the check. This is both a data integrity risk and a safety-critical concern.

#### 5c — ErrorMessage: no stack trace fields present

The `detail` field is the only potentially problematic field. There are no fields for `stackTrace`, `exceptionClass`, `sqlState`, `errorCode`, or `internalPath` in `ErrorMessage`. The class does not expose Java exception internals by structure. Risk is bounded to whatever is assigned to `detail` at call sites.

**Logging:** No PII or sensitive telemetry data is logged within the three assigned model files themselves (they contain no logging code).

---

### Section 6: Dependencies

**Result: N/A** — model classes; dependency analysis applies to `pom.xml`.

---

### Section 7: Build and CI

**Result: N/A** — model classes; build/CI analysis applies to pipeline and Maven configuration files.

---

## STEP 5 — Findings

---

**B15-1** — HIGH
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/FormDtl.java:17` / `src/main/java/com/journaldev/spring/jdbc/controller/SessionController.java:143-148`
**Description:** The `expected_answer` field in `FormDtl` is included in the SQL SELECT query in `getForm()` and is serialized in full to the HTTP response body. There is no `@JsonIgnore` or equivalent suppression on the field. Returning the expected/correct answer to the client undermines the integrity of operator pre-use safety inspections: a caller can read the expected answer and submit it without actually performing the physical check. This is a safety-critical data exposure in a forklift management system.
**Evidence:**
```java
// FormDtl.java line 17
private String expected_answer;

// FormDtl.java line 56-61
public String getExpected_answer() {
    return expected_answer;
}
public void setExpected_answer(String expected_answer) {
    this.expected_answer = expected_answer;
}

// SessionController.java lines 136-148
@RequestMapping(value = RestURIConstants.GET_FORMS, method = RequestMethod.GET)
public @ResponseBody
List<FormDtl> getForm(@PathVariable("qid") int qid, @PathVariable("type") String type) {
    ...
    String query = "select id,input_type,input_label,input_value,"
            + "  case when input_image is null then '' else ?||input_image end as input_image,expected_answer,input_order from formdtl "
            + " where form_id in ( select id from form_library where question_id = ? and type ilike ?) "
            + " order by input_order";
    return jdbcTemplate.query(query, new Object[]{configuration.getImageURL(), qid, type}, new BeanPropertyRowMapper<FormDtl>(FormDtl.class));
}
```

---

**B15-2** — MEDIUM
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/ErrorMessage.java:18`
**Description:** `ErrorMessage` has a `detail` field that is fully serialized to clients (no `@JsonIgnore`, no `@JsonInclude` restriction on the field itself). The field name is generic and its contents are caller-determined. There is no global exception handler (`@ControllerAdvice`) to control what populates `detail`. If any call site assigns exception messages, SQL error text, internal paths, or stack trace fragments to `detail`, that information will be returned verbatim to the client. The field represents a standing data-exposure risk that is one bad assignment away from leaking internal system details. The absence of a `@ControllerAdvice` means error handling is scattered and inconsistent across controllers, increasing the probability that sensitive detail eventually flows into this field.
**Evidence:**
```java
// ErrorMessage.java lines 8-19
@Data
@NoArgsConstructor
public class ErrorMessage implements Serializable {
    private static final long serialVersionUID = -7636476173287405171L;
    private String message;
    private String code;
    private String detail;   // no @JsonIgnore, no @JsonInclude restriction
}

// ResponseWrapper.java lines 10-22
@Data
@NoArgsConstructor
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ResponseWrapper implements Serializable {
    ...
    private List<ErrorMessage> errors;  // ErrorMessage.detail serialized if non-null
}
```

---

**B15-3** — LOW
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/model/FormDtl.java`
**Description:** `FormDtl` has no JSR-303 validation constraints on any field (`@NotNull`, `@Size`, `@Pattern`, etc.). While the class is populated from database results rather than direct user JSON bodies in its current usages, the absence of constraints means it could be used unsafely as a `@RequestBody` parameter in future endpoints without any enforcement. This is a low-severity hygiene issue.
**Evidence:**
```java
// FormDtl.java — no import of javax.validation or jakarta.validation
// No @NotNull, @Size, @Pattern, or @Valid annotations on any field
private int id;
private String input_type;
private String input_label;
private String input_value;
private String input_image;
private int input_order;
private String expected_answer;
```

---

**B15-4** — LOW
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/model/EquipmentType.java`
**Description:** `EquipmentType` has no JSR-303 validation constraints on any field. Same hygiene concern as B15-3; lower risk as it is a lookup/reference data model.
**Evidence:**
```java
// EquipmentType.java — no validation constraints
private int id;
private String name;
private String icon;
```

---

*End of B15 report.*
