# Pass 1 Security Review — Agent B05
**Date:** 2026-02-27
**Branch:** master
**Auditor:** B05
**Files assigned:**
- `src/main/java/com/journaldev/spring/jdbc/controller/APKUpdaterController.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java`

**Supporting files read for context:**
- `src/main/java/com/journaldev/spring/jdbc/controller/ConfigurationController.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/RestURIConstants.java`
- `src/main/java/com/journaldev/spring/jdbc/service/APKUpdaterService.java`
- `src/main/java/com/journaldev/spring/jdbc/DAO/CompanyDAO.java`
- `src/main/webapp/WEB-INF/spring/spring-security.xml`
- `src/main/webapp/WEB-INF/web.xml`
- `src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml`
- `src/main/resources/fleetiq360ws.properties`
- `environment.dev.properties`
- `environment.uat.properties`
- `environment.prod.properties`
- `pom.xml`
- `.gitignore`

---

## STEP 3 — Reading Evidence

### File 1: APKUpdaterController.java

**Fully qualified class name:** `com.journaldev.spring.jdbc.controller.APKUpdaterController`

**Class-level annotations:**
- `@Controller` (line 20)
- `@Slf4j` (line 21)

**Interfaces implemented / classes extended:** None.

**Fields:**
- `private APKUpdaterService apkUpdaterService` — `@Autowired` (lines 24–25)

**Public methods:**

| Line | Return type | Method signature | Annotations |
|------|-------------|-----------------|-------------|
| 38 | `PackageEntry` | `getAvailablePackage(HttpServletRequest request, @PathVariable("pkgname") String pkgname, @RequestParam(value = "version") String version)` | `@RequestMapping(value="/rest/apk/{pkgname}/update", method=RequestMethod.GET)`, `@ResponseBody` |
| 56 | `ResponseEntity<Resource>` | `downloadPackage(@PathVariable("pkgname") String pkgname, @RequestParam("version") String version)` | `@RequestMapping(value="/rest/apk/{pkgname}", method=RequestMethod.GET)` |

**Private methods:**

| Line | Return type | Method signature |
|------|-------------|-----------------|
| 28 | `String` | `getURLBase(HttpServletRequest request, String pkgName) throws MalformedURLException` |

**No `@PreAuthorize`, `@Secured`, or `@CrossOrigin` annotations present.**

---

### File 2: CompanyController.java

**Fully qualified class name:** `com.journaldev.spring.jdbc.controller.CompanyController`

**Class-level annotations:**
- `@Controller` (line 24)

**Interfaces implemented / classes extended:** Extends `ConfigurationController` (line 25).

**Inherited fields from ConfigurationController:**
- `protected Configuration configuration` — `@Autowired`
- `protected DataSource dataSource` — `@Autowired @Qualifier("dataSource")`

**Fields declared in CompanyController:**
- `private static final Logger logger` (line 27)
- `private DriverDAO driverDAO` — `@Autowired` (lines 29–30)
- `private CompanyDAO companyDAO` — `@Autowired` (lines 32–33)

**Public methods:**

| Line | Return type | Method signature | Annotations |
|------|-------------|-----------------|-------------|
| 37 | `List<Company>` | `getCompany(@PathVariable("uid") Long uid)` | `@RequestMapping(value=GET_COMPANY "/rest/company/get/{uid}", method=GET)`, `@ResponseBody` |
| 44 | `List<Driver>` | `getCompanyDrivers(@PathVariable("uid") int uid)` | `@RequestMapping(value=GET_COMPANY_DRIVERS "/rest/company/owner/{uid}/drivers", method=GET)` |
| 52 | `List<Company>` | `searchCompany(@PathVariable("keyword") String keyword)` | `@RequestMapping(value=SEARCH_COMPANY "/rest/company/search/{keyword}", method=GET)` |
| 61 | `ResponseEntity<Permissions>` | `addCompany(@RequestBody Permissions permission)` | `@RequestMapping(value=ADD_COMPANY "/rest/company/add", method=POST)`, `@ResponseBody` |
| 121 | `ResponseEntity<Results>` | `companyAcceptWeb(@PathVariable("token") String token)` | `@RequestMapping(value=COMPANY_ACCEPT_WEB "/rest/company/accept/web/{token}", method=GET)` |
| 148 | `ResponseEntity<Results>` | `companyAccept(@PathVariable("pid") int pid)` | `@RequestMapping(value=COMPANY_ACCEPT "/rest/company/accept/{pid}", method=PUT)` |
| 163 | `ResponseEntity<Results>` | `companyDelete(@PathVariable("pid") int pid)` | `@RequestMapping(value=COMPANY_DELETE "/rest/company/delete/{pid}", method=PUT)` |

**No `@PreAuthorize`, `@Secured`, or `@CrossOrigin` annotations present on any method.**

---

## STEP 4 — Security Review Findings

### Section 1: Secrets and Configuration

**B05-1** — CRITICAL
**Section:** Secrets and Configuration
**File:** `environment.uat.properties:15-16`
**Description:** Production/UAT database credentials hardcoded in a properties file committed to the repository. The file is not listed in `.gitignore` (only `environment.local.properties` is excluded). These credentials are for the AWS RDS PostgreSQL instance referenced in `pom.xml`.
**Evidence:**
```
cognitoAPIUsername=ciiadmin
cognitoAPIPassword=ciiadmin
```
(Same values also appear in `environment.dev.properties:15-16` and `environment.prod.properties:15-16`.)

---

**B05-2** — HIGH
**Section:** Secrets and Configuration
**File:** `pom.xml:76-77`
**Description:** UAT database password hardcoded in `pom.xml` in the `<uat>` Maven profile. The password `C!1admin` for user `dev_admin` on the AWS RDS instance `forkliftiq360.cmjwsurtk4tn.us-east-1.rds.amazonaws.com` is committed to source control. The prod profile has no password set (empty `<flyway.url>` with no credentials), suggesting a separate mechanism for production, but the UAT credential is fully exposed.
**Evidence:**
```xml
<flyway.url>jdbc:postgresql://forkliftiq360.cmjwsurtk4tn.us-east-1.rds.amazonaws.com:5432/postgres
</flyway.url>
<flyway.user>dev_admin</flyway.user>
<flyway.password>C!1admin</flyway.password>
```

---

**B05-3** — HIGH
**Section:** Secrets and Configuration
**File:** `pom.xml:29-30` (local profile), `pom.xml:45-46` (dev profile)
**Description:** Database credentials hardcoded in `pom.xml` for local and dev profiles. The local profile contains two different sets of credentials (one for a `PreStart` PostgreSQL DB and one overriding it for `fleetiq360`), both with plaintext passwords. The dev profile exposes the Azure Canada East database hostname, username, and password.
**Evidence:**
```xml
<!-- local profile -->
<flyway.password>gmtp-postgres</flyway.password>
<flyway.password>fleetiq360</flyway.password>

<!-- dev profile -->
<flyway.url>jdbc:postgresql://forklift360.canadaeast.cloudapp.azure.com:5432/fleetiq360</flyway.url>
<flyway.user>fleetiq360</flyway.user>
<flyway.password>fleetiq360</flyway.password>
```

---

**B05-4** — MEDIUM
**Section:** Secrets and Configuration
**File:** `environment.dev.properties:1-2`, `environment.uat.properties:1-2`, `environment.prod.properties:1-2`
**Description:** AWS EC2 public DNS hostname and Azure Canada East hostname hardcoded in committed property files, exposing infrastructure topology. The EC2 instance `ec2-54-86-82-22.compute-1.amazonaws.com` is referenced with port 8443, and the Azure URL `forklift360.canadaeast.cloudapp.azure.com` is visible.
**Evidence:**
```
# environment.prod.properties / environment.uat.properties
imageURL=https://ec2-54-86-82-22.compute-1.amazonaws.com:8443/fleetiq360ws/image/

# environment.dev.properties
imageURL=https://forklift360.canadaeast.cloudapp.azure.com:8443/fleetiq360ws/image/
```

---

**B05-5** — MEDIUM
**Section:** Secrets and Configuration
**File:** `environment.dev.properties:1`, `.gitignore:6`
**Description:** Environment property files (`environment.dev.properties`, `environment.uat.properties`, `environment.prod.properties`) are tracked by git and contain credentials and infrastructure details. Only `environment.local.properties` is excluded by `.gitignore`. All environment-specific config files containing credentials should be excluded from version control and injected at deployment time.
**Evidence:**
```
# .gitignore — only excludes local:
environment.local.properties
```

---

**B05-6** — HIGH
**Section:** Secrets and Configuration
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:113-117`
**Description:** OAuth2 client credentials hardcoded in the Spring Security XML configuration committed to source control. Two OAuth2 clients are defined with plaintext `secret` values. The `fleetiq360` client secret `rihah8eey4faibuengaixo6leiL1awii` and the numeric client `987654321` with secret `8752361E593A573E86CA558FFD39E` are exposed to anyone with repository access.
**Evidence:**
```xml
<oauth:client client-id="987654321" authorized-grant-types="password,authorization_code,implicit"
              secret="8752361E593A573E86CA558FFD39E" authorities="ROLE_CLIENT" scope="read,write" access-token-validity="0"/>

<oauth:client client-id="fleetiq360" authorized-grant-types="password,authorization_code,refresh_token,implicit"
              secret="rihah8eey4faibuengaixo6leiL1awii" authorities="ROLE_DRIVER,ROLE_COMPANY_GROUP,ROLE_SYS_ADMIN" scope="read,write" access-token-validity="300" refresh-token-validity="300"/>
```

---

**B05-7** — MEDIUM
**Section:** Secrets and Configuration
**File:** `src/main/resources/fleetiq360ws.properties:10`
**Description:** A hardcoded production URL (`https://pandora.fleetiq360.com/pandora/acceptDriver?token=`) is committed as a literal string for the `acceptURL` property. While not a credential, this is a production infrastructure detail that should be parameterised by environment like all other URLs in the same file.
**Evidence:**
```
acceptURL=https://pandora.fleetiq360.com/pandora/acceptDriver?token=
```

---

**B05-8** — LOW
**Section:** Secrets and Configuration
**File:** `pom.xml:87-90`
**Description:** A third-party Maven repository (`http://splunk.jfrog.io/splunk/ext-releases-local`) is referenced over plain HTTP, not HTTPS. Dependencies fetched over HTTP are vulnerable to man-in-the-middle substitution. Verified: no authentication credentials are present in the repository definition, but the use of HTTP is a supply-chain integrity concern.
**Evidence:**
```xml
<repository>
    <id>splunk-artifactory</id>
    <name>Splunk Releases</name>
    <url>http://splunk.jfrog.io/splunk/ext-releases-local</url>
</repository>
```

---

### Section 2: Authentication and Authorization

**B05-9** — CRITICAL
**Section:** Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/APKUpdaterController.java:36-53`
**Description:** The APK update check endpoint (`GET /rest/apk/{pkgname}/update`) is protected only by `ROLE_CLIENT` in the Spring Security filter chain (spring-security.xml line 31). The `access-token-validity="0"` for the `987654321` client (spring-security.xml line 113) means the token never expires. Any caller that has obtained the client credentials (which are hardcoded and committed to source, see B05-6) can call this endpoint as `ROLE_CLIENT`, enumerate available APK versions, and download APK packages. There is no `@PreAuthorize` or user-identity check in the controller.
**Evidence:**
```java
// spring-security.xml line 31:
<intercept-url pattern="/rest/apk/**" access="ROLE_CLIENT" />

// spring-security.xml line 113 — token never expires:
access-token-validity="0"

// APKUpdaterController.java lines 36-38 — no auth annotation:
@RequestMapping(value = "/rest/apk/{pkgname}/update", method = RequestMethod.GET)
@ResponseBody
public PackageEntry getAvailablePackage(HttpServletRequest request, @PathVariable("pkgname") String pkgname, ...)
```

---

**B05-10** — CRITICAL
**Section:** Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:147-158`
**Description:** The `companyAccept` endpoint (`PUT /rest/company/accept/{pid}`) accepts any permission ID and unconditionally sets `enabled = true`. There is no check that the authenticated user owns or is authorised to accept the permission record identified by `pid`. Any authenticated user with `ROLE_DRIVER`, `ROLE_COMPANY_GROUP`, `ROLE_SYS_ADMIN`, or `ROLE_CLIENT` can accept any pending company-driver association in the entire system by guessing or incrementing `pid`. This is a direct IDOR vulnerability on a state-changing endpoint.
**Evidence:**
```java
@RequestMapping(value= RestURIConstants.COMPANY_ACCEPT, method=RequestMethod.PUT)
public @ResponseBody ResponseEntity<Results> companyAccept( @PathVariable("pid") int pid) {
    // ...
    String query = "update permission set enabled = true, updatedat = now() where id = ?";
    jdbcTemplate.update(query, new Object[] {pid});
    // No ownership check. Any authenticated user can accept any permission.
    results.setMessage_id(RuntimeConfig.MSGID_SUCCESS);
    return new ResponseEntity<Results>(results, HttpStatus.OK);
}
```

---

**B05-11** — CRITICAL
**Section:** Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:162-174`
**Description:** The `companyDelete` endpoint (`PUT /rest/company/delete/{pid}`) accepts any permission ID and unconditionally executes `DELETE FROM permission WHERE id = ?`. There is no verification that the authenticated caller owns or administers the company or the permission record. Any authenticated user can delete any company-driver permission record by supplying an arbitrary `pid`. This is a critical IDOR vulnerability on a destructive state-changing endpoint.
**Evidence:**
```java
@RequestMapping(value= RestURIConstants.COMPANY_DELETE, method=RequestMethod.PUT)
public @ResponseBody ResponseEntity<Results> companyDelete( @PathVariable("pid") int pid) {
    // ...
    String query = "delete from permission where id = ?";
    jdbcTemplate.update(query, new Object[] {pid});
    // No ownership check. Any authenticated user can delete any permission.
    results.setMessage_id(RuntimeConfig.MSGID_SUCCESS);
    return new ResponseEntity<Results>(results, HttpStatus.OK);
}
```

---

**B05-12** — HIGH
**Section:** Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:36-41`
**Description:** The `getCompany` endpoint (`GET /rest/company/get/{uid}`) returns company data for the driver ID passed as `{uid}`. There is no verification that the `uid` in the path corresponds to the authenticated user's identity. Any authenticated user can retrieve company associations for any other user by substituting a different `uid`. This is an IDOR vulnerability on a data-disclosure endpoint.
**Evidence:**
```java
@RequestMapping(value= RestURIConstants.GET_COMPANY, method=RequestMethod.GET)
public @ResponseBody List<Company> getCompany( @PathVariable("uid") Long uid) {
    logger.info("Start getCompany for {}", uid);
    return this.companyDAO.findAllByDriverId(uid);
    // uid is taken directly from the path — not validated against the authenticated principal.
}
```

---

**B05-13** — HIGH
**Section:** Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:43-50`
**Description:** The `getCompanyDrivers` endpoint (`GET /rest/company/owner/{uid}/drivers`) returns all drivers for a company owner identified by the path variable `uid`. There is no check that the caller is the owner of company `uid`. Any authenticated user can enumerate all drivers belonging to any company owner by substituting a different `uid`.
**Evidence:**
```java
@RequestMapping(value= RestURIConstants.GET_COMPANY_DRIVERS, method=RequestMethod.GET)
public @ResponseBody List<Driver> getCompanyDrivers(@PathVariable("uid") int uid) {
    logger.info("Start getCompanyDrivers.");
    List<Driver> drivers = driverDAO.findAllByCompanyOwner(uid);
    return drivers;
    // No caller identity check against uid.
}
```

---

**B05-14** — HIGH
**Section:** Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:52-59`
**Description:** The `searchCompany` endpoint (`GET /rest/company/search/{keyword}`) returns matching company records — including email addresses, contact driver details, role assignments, and permission IDs — for any keyword search. The results are not scoped to the authenticated user's organisation. Any authenticated user can search for and enumerate company records across all organisations in the system.
**Evidence:**
```java
@RequestMapping(value= RestURIConstants.SEARCH_COMPANY, method=RequestMethod.GET)
public @ResponseBody List<Company> searchCompany(@PathVariable("keyword") String keyword) {
    List<Company> complst = companyDAO.findAllByKeyword(keyword);
    return complst;
    // No scoping to caller's organisation.
}
```
CompanyDAO `findAllByKeyword` (CompanyDAO.java:87-95) selects across all companies with `ilike` on name or email — no tenant filter.

---

**B05-15** — MEDIUM
**Section:** Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:74`
**Description:** The `authenticationManager` bean (used by the OAuth2 password grant) configures MD5 as the password hashing algorithm. MD5 is cryptographically broken for password storage — it is fast, unsalted (no salt is configured), and vulnerable to rainbow-table and brute-force attacks. Any database breach would allow rapid recovery of user passwords.
**Evidence:**
```xml
<authentication-provider user-service-ref="userDetailsService">
    <password-encoder hash="md5"/>
</authentication-provider>
```

---

**B05-16** — INFO
**Section:** Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:12-14`
**Description:** Two OAuth2 endpoints (`/oauth/cache_approvals` and `/oauth/uncache_approvals`) are declared with `security="none"`, meaning they require no authentication whatsoever. The inline comment acknowledges these are "just for testing". These endpoints must be removed or properly secured before any production deployment.
**Evidence:**
```xml
<!-- Just for testing... -->
<http pattern="/oauth/cache_approvals" security="none" xmlns="http://www.springframework.org/schema/security" />
<http pattern="/oauth/uncache_approvals" security="none" xmlns="http://www.springframework.org/schema/security" />
```

---

### Section 3: Input Validation and Injection

**B05-17** — HIGH
**Section:** Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/service/APKUpdaterService.java:56`
**Description:** Path traversal vulnerability in `loadPackageAsResource`. The `pkgname` and `version` parameters from the HTTP request (passed through from `APKUpdaterController.downloadPackage`) are used directly in `Paths.get(packageDir).resolve(String.format("%s-%s.apk", pkgname, version))` without sanitisation. A caller supplying `pkgname=../../etc/passwd` or `version=../../../etc/shadow` could cause `resolve()` to produce a path outside the intended `packageDir`, potentially serving arbitrary files from the server filesystem as APK downloads.

Although `UrlResource` wraps the path and requires `resource.exists()` to be true, the path is constructed from user input without checking that the resolved path remains under `packageDir`. The `Paths.resolve()` method will follow `..` components.
**Evidence:**
```java
// APKUpdaterController.java line 56:
public ResponseEntity<Resource> downloadPackage(@PathVariable("pkgname") String pkgname, @RequestParam("version") String version)

// APKUpdaterService.java line 56:
Path filePath = Paths.get(packageDir).resolve(String.format("%s-%s.apk", pkgname, version));
Resource resource = new UrlResource(filePath.toUri());
if(resource.exists()) {
    return resource;
}
```
There is no call to `filePath.normalize()` followed by a check that the result starts with `Paths.get(packageDir).normalize()`.

---

**B05-18** — MEDIUM
**Section:** Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/APKUpdaterController.java:38,56`
**Description:** No input validation on `pkgname` or `version` parameters in either APK endpoint. The `pkgname` path variable and `version` request parameter are passed directly to the service with no length checks, character-class validation, or `@Valid` / constraint annotations. Beyond the path traversal risk (B05-17), very long or malformed values could cause unexpected service behaviour or denial of service.
**Evidence:**
```java
public PackageEntry getAvailablePackage(HttpServletRequest request,
    @PathVariable("pkgname") String pkgname,      // no @Pattern, no @Size
    @RequestParam(value = "version") String version) { ... }

public ResponseEntity<Resource> downloadPackage(
    @PathVariable("pkgname") String pkgname,      // no @Pattern, no @Size
    @RequestParam("version") String version) { ... }
```

---

**B05-19** — MEDIUM
**Section:** Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:62`
**Description:** The `addCompany` endpoint accepts a `@RequestBody Permissions permission` object with no `@Valid` annotation and no JSR-303 constraint annotations evident on the `Permissions` model. The `driver_id`, `comp_id`, and `gsm_token` fields are passed directly into SQL queries (lines 68–76). While parameterised queries are used (preventing SQL injection), there is no validation that the supplied `driver_id` or `comp_id` belong to the authenticated user, and no bounds checking on `gsm_token` length.
**Evidence:**
```java
@RequestMapping(value= RestURIConstants.ADD_COMPANY, method=RequestMethod.POST)
public @ResponseBody ResponseEntity<Permissions> addCompany(@RequestBody Permissions permission) {
    // No @Valid annotation on parameter
    // ...
    jdbcTemplate.update(query, new Object[] {id, permission.getDriver_id(), permission.getComp_id(), permission.getGsm_token()});
```

---

**B05-20** — MEDIUM
**Section:** Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:52-59`
**Description:** The `searchCompany` endpoint passes the raw `keyword` path variable directly into the DAO. While CompanyDAO uses parameterised queries with `%keyword%` wildcards (preventing SQL injection), there is no length limit or character validation on the keyword. An attacker can send an extremely long keyword string causing excessive database load (denial of service via expensive `ilike` pattern matching). No `@Size` or similar constraint is enforced.
**Evidence:**
```java
public @ResponseBody List<Company> searchCompany(@PathVariable("keyword") String keyword) {
    List<Company> complst = companyDAO.findAllByKeyword(keyword);
    // keyword is unbounded; passed to: WHERE c.name ilike ? or c.email ilike ?
```

---

**B05-21** — LOW
**Section:** Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:97-105`
**Description:** Driver name and email are concatenated into an email message body without sanitisation. While this is not a traditional injection risk (the email is sent to a company administrator, not rendered as HTML), the content is derived from database values that originated from user input. There is no encoding or sanitisation applied before inclusion in the message string, which could enable social engineering if an attacker can control their driver name.
**Evidence:**
```java
String msg = "Your have a request from driver "+ driver +" "+email+
    ". Please click the link to accept the request." + url;
SendEmail.sendMail(configuration.getDriverRequestSubject(), msg, email);
```

---

### Section 4: Session and CSRF

**B05-22** — HIGH
**Section:** Session and CSRF
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:28`
**Description:** CSRF protection is not explicitly configured. The Spring Security XML configuration defines the REST filter chain with `create-session="never"` (stateless), which implies session-based CSRF tokens are not in use. However, the security configuration is Spring Security 3.1 + Spring Security OAuth2 1.0.0.RELEASE, both of which are very old and may not provide CSRF protection by default for the `/rest/**` pattern. There is no explicit `<csrf>` element, no `CsrfFilter`, and no `SameSite` cookie configuration present. The state-changing endpoints (`PUT /rest/company/accept/{pid}`, `PUT /rest/company/delete/{pid}`, `POST /rest/company/add`) rely on OAuth2 bearer token authentication, which inherently provides CSRF protection only if the token cannot be obtained cross-origin — but this should be explicitly documented and verified.
**Evidence:**
```xml
<http pattern="/rest/**" create-session="never" entry-point-ref="oauthAuthenticationEntryPoint" ...>
    <!-- No <csrf> element. No explicit CSRF disable either. -->
```

---

**B05-23** — MEDIUM
**Section:** Session and CSRF
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml`; `src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml`
**Description:** No security response headers are configured anywhere in the application. There is no `X-Frame-Options`, `X-Content-Type-Options`, or `Strict-Transport-Security` header configured in Spring Security, web.xml, or the servlet context. The `web.xml` `<transport-guarantee>CONFIDENTIAL</transport-guarantee>` enforces HTTPS at the container level, but does not set the HSTS response header.
**Evidence:**
```xml
<!-- spring-security.xml: no <headers> element -->
<!-- servlet-context.xml: no header configuration -->
<!-- web.xml line 43-45: -->
<user-data-constraint>
    <transport-guarantee>CONFIDENTIAL</transport-guarantee>
</user-data-constraint>
```

---

**B05-24** — INFO
**Section:** Session and CSRF
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/APKUpdaterController.java`, `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java`
**Description:** No `@CrossOrigin` annotations are present on either controller or any method in the two assigned files. CORS is not configured in `servlet-context.xml` either. This means the default same-origin policy applies at the browser level. This is CLEAR for the two assigned files. However, the absence of explicit CORS configuration means any future addition of `@CrossOrigin` without review could silently open all endpoints.
**Evidence:** N/A — absence of `@CrossOrigin` confirmed.

---

### Section 5: Data Exposure

**B05-25** — HIGH
**Section:** Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/APKUpdaterController.java:43-50`
**Description:** Error handling in `getAvailablePackage` swallows exceptions silently and returns `null` to the client instead of a proper error response. This means a client cannot distinguish between "no update available" and "an internal error occurred". More importantly, the error is logged at ERROR level with the full exception (including stack trace) to the application log, which may reveal internal file system paths (`packageDir`), server hostname, and APK file structure. The `TODO Handle error` comment confirms this is unfinished error handling.
**Evidence:**
```java
} catch (MalformedURLException e) {
    log.error("Unable to prepare url for package " + pkgname + ", version " + version, e);
    // TODO Handle error
    return null;
}
```

---

**B05-26** — HIGH
**Section:** Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/service/APKUpdaterService.java:62`
**Description:** The `FileNotFoundException` thrown by `loadPackageAsResource` includes the full server-side filesystem path in its message: `"Unable to find " + pkgname + ", version " + version + " at location : " + filePath.toString() + " on server"`. If this exception propagates to the client as an error response body (which depends on the exception handler, but no custom handler was found for this controller), the server's internal file system path (`packageDir`, e.g., `/var/local/tomcat8/upload/apk`) would be disclosed to the caller.
**Evidence:**
```java
throw new FileNotFoundException("Unable to find " + pkgname + ", version " + version +
    " at location : " + filePath.toString() + " on server");
```
(Cross-referenced with `environment.uat.properties`: `packageDir=/var/local/tomcat8/upload/apk`)

---

**B05-27** — MEDIUM
**Section:** Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/CompanyDAO.java:183-186`
**Description:** The `mapCompany` method in `CompanyDAO` maps the `password` column from the company table into the `Company` model object (`rs.getString(3)`), and this model is returned directly to the API caller from `getCompany` and `searchCompany` (and potentially other endpoints). Even if the stored value is MD5-hashed, returning a password hash to API clients is unnecessary and creates an information-disclosure risk. API responses should exclude credential fields.
**Evidence:**
```java
// CompanyDAO.java line 183-186:
cie = Company.builder()
    .id(rs.getLong(1))
    .name(rs.getString(2))
    .password(rs.getString(3))   // password hash included in returned model
    .email(rs.getString(4))
    ...

// BASE_QUERY_COMPANY line 52: selects c.password
```

---

**B05-28** — MEDIUM
**Section:** Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java:103-105`
**Description:** Sensitive PII (driver email address and full name) is logged at INFO level — a level that will appear in production logs. The log messages at lines 103 and 105 log the email address of the company contact. Additionally, line 101 embeds the driver's full name and email into the email message body. In a system handling operator safety records, logging PII at INFO level may violate privacy requirements and creates risk if logs are shipped to a SIEM or logging platform without appropriate access controls.
**Evidence:**
```java
logger.info("Start Sending Email to " + email);
// ...
logger.info("Finish Sending Email to " + email);
```

---

### Section 6: Dependencies

**B05-29** — CRITICAL
**Section:** Dependencies
**File:** `pom.xml:231-237`
**Description:** Spring Security 3.1.1.RELEASE is end-of-life and contains multiple known critical CVEs. It was released in 2012. Multiple high and critical vulnerabilities have been disclosed in Spring Security 3.x, including authentication bypass and privilege escalation issues. This version should not be used in any environment.
**Evidence:**
```xml
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-web</artifactId>
    <version>3.1.1.RELEASE</version>
</dependency>
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-config</artifactId>
    <version>3.1.1.RELEASE</version>
</dependency>
```

---

**B05-30** — CRITICAL
**Section:** Dependencies
**File:** `pom.xml:239-242`
**Description:** Spring Security OAuth2 1.0.0.RELEASE is end-of-life. This version dates from approximately 2012 and has known vulnerabilities. The Spring Security OAuth project itself reached end-of-life in 2022 with recommendation to migrate to Spring Authorization Server.
**Evidence:**
```xml
<dependency>
    <groupId>org.springframework.security.oauth</groupId>
    <artifactId>spring-security-oauth2</artifactId>
    <version>1.0.0.RELEASE</version>
</dependency>
```

---

**B05-31** — HIGH
**Section:** Dependencies
**File:** `pom.xml:12`
**Description:** Spring Framework 3.2.14.RELEASE is end-of-life and has known CVEs. The 3.x branch reached end-of-life many years ago. Spring 3.2.14 is the last release of the 3.x line (released 2016) and is missing security patches applied to later branches.
**Evidence:**
```xml
<org.springframework-version>3.2.14.RELEASE</org.springframework-version>
```

---

**B05-32** — HIGH
**Section:** Dependencies
**File:** `pom.xml:15`
**Description:** Jackson Databind 2.6.7 has multiple known critical CVEs, including CVE-2017-7525, CVE-2018-5968, and others related to unsafe deserialization and polymorphic type handling. This version predates numerous security patches. The current maintained release is 2.18.x.
**Evidence:**
```xml
<jackson.databind-version>2.6.7</jackson.databind-version>
```

---

**B05-33** — HIGH
**Section:** Dependencies
**File:** `pom.xml:199-202`
**Description:** `commons-fileupload` 1.3.1 is vulnerable to CVE-2016-3092 (Denial of Service via malicious multipart requests) and was patched in 1.3.2. The current maintained version is 1.5+. Version 1.3.1 should be updated.
**Evidence:**
```xml
<dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.3.1</version>
</dependency>
```

---

**B05-34** — MEDIUM
**Section:** Dependencies
**File:** `pom.xml:168-171`
**Description:** `commons-io` 1.3.2 is an ancient version (the artifact group ID `org.apache.commons:commons-io` was restructured). The version 1.3.2 corresponds to Apache Commons IO 1.x which dates to 2008. The current version is 2.16+. This dependency should be upgraded.
**Evidence:**
```xml
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-io</artifactId>
    <version>1.3.2</version>
</dependency>
```

---

**B05-35** — MEDIUM
**Section:** Dependencies
**File:** `pom.xml:267-271`
**Description:** `aws-java-sdk` 1.11.163 is a very old version of the AWS SDK (released ca. 2017). Numerous security patches and CVE fixes have been applied in subsequent releases of both the v1 and v2 SDK. The AWS SDK v1 itself is in maintenance mode; v2 is recommended.
**Evidence:**
```xml
<dependency>
    <groupId>com.amazonaws</groupId>
    <artifactId>aws-java-sdk</artifactId>
    <version>1.11.163</version>
</dependency>
```

---

**B05-36** — LOW
**Section:** Dependencies
**File:** `pom.xml:11`
**Description:** The project targets Java 1.8 (Java 8), which reached end-of-life for free public updates. While Oracle and some vendors continue to provide commercial extended support, Java 8 is missing security features available in later LTS releases (Java 11, 17, 21) including improved TLS defaults, stronger default cryptographic algorithms, and JVM security hardening.
**Evidence:**
```xml
<java-version>1.8</java-version>
```

---

### Section 7: Build and CI

**B05-37** — HIGH
**Section:** Build and CI
**File:** No `bitbucket-pipelines.yml` found in repository.
**Description:** No CI/CD pipeline configuration file was found in the repository. There is no automated build, test, or deployment pipeline configured. This means there is no enforced gate on security testing, dependency scanning, or test execution before deployment. Deployments appear to be performed manually using the `tomcat7-maven-plugin` with server credentials stored in `~/.m2/settings.xml` (referenced by `<server>${tomcat.server}</server>` in pom.xml).
**Evidence:** `bitbucket-pipelines.yml` — file not found in repository root or any subdirectory.

---

**B05-38** — MEDIUM
**Section:** Build and CI
**File:** `pom.xml:343-349`
**Description:** The `tomcat7-maven-plugin` deployment configuration references `<server>${tomcat.server}</server>`, which means Tomcat manager credentials are stored in the developer's local `~/.m2/settings.xml`. This is not a code-level issue, but there is no pipeline to enforce that these credentials are managed securely. The Tomcat manager URL is hardcoded into committed profile properties (e.g., `tomcat.url` in the UAT profile).
**Evidence:**
```xml
<plugin>
    <groupId>org.apache.tomcat.maven</groupId>
    <artifactId>tomcat7-maven-plugin</artifactId>
    <version>2.2</version>
    <configuration>
        <url>${tomcat.url}</url>
        <server>${tomcat.server}</server>
    </configuration>
</plugin>
```
UAT tomcat.url from pom.xml line 77: `http://ec2-54-86-82-22.compute-1.amazonaws.com:8080/manager/text` (plain HTTP, not HTTPS).

---

## Summary Table

| ID | Severity | Section | Short Description |
|----|----------|---------|-------------------|
| B05-1 | CRITICAL | Secrets | Cognito API credentials hardcoded in committed properties files |
| B05-2 | HIGH | Secrets | UAT RDS database password hardcoded in pom.xml |
| B05-3 | HIGH | Secrets | Local/dev DB credentials hardcoded in pom.xml |
| B05-4 | MEDIUM | Secrets | Production EC2/Azure hostnames exposed in committed config |
| B05-5 | MEDIUM | Secrets | Environment property files with credentials not in .gitignore |
| B05-6 | HIGH | Secrets | OAuth2 client secrets hardcoded in spring-security.xml |
| B05-7 | MEDIUM | Secrets | Hardcoded production URL in committed properties |
| B05-8 | LOW | Secrets | Third-party Maven repository uses plain HTTP |
| B05-9 | CRITICAL | Auth | ROLE_CLIENT token never expires; client secret exposed; APK endpoints accessible |
| B05-10 | CRITICAL | Auth | IDOR on companyAccept — any user can accept any permission |
| B05-11 | CRITICAL | Auth | IDOR on companyDelete — any user can delete any permission |
| B05-12 | HIGH | Auth | IDOR on getCompany — uid not verified against authenticated principal |
| B05-13 | HIGH | Auth | IDOR on getCompanyDrivers — uid not verified against authenticated principal |
| B05-14 | HIGH | Auth | searchCompany returns cross-tenant data without scoping |
| B05-15 | MEDIUM | Auth | MD5 used for password hashing (broken algorithm, unsalted) |
| B05-16 | INFO | Auth | Testing OAuth endpoints exposed with security="none" |
| B05-17 | HIGH | Injection | Path traversal in APK download — pkgname/version not sanitised |
| B05-18 | MEDIUM | Injection | No input validation on APK endpoint parameters |
| B05-19 | MEDIUM | Injection | No @Valid on addCompany request body |
| B05-20 | MEDIUM | Injection | Unbounded keyword in searchCompany enables DoS via expensive ilike |
| B05-21 | LOW | Injection | Driver name/email concatenated into email body without encoding |
| B05-22 | HIGH | CSRF/CORS | CSRF protection not explicitly configured for state-changing endpoints |
| B05-23 | MEDIUM | CSRF/CORS | No X-Frame-Options, X-Content-Type-Options, or HSTS headers configured |
| B05-24 | INFO | CSRF/CORS | No @CrossOrigin present on assigned files (CLEAR) |
| B05-25 | HIGH | Data Exposure | getAvailablePackage swallows exceptions, returns null; TODO comment present |
| B05-26 | HIGH | Data Exposure | Internal filesystem path exposed in FileNotFoundException message |
| B05-27 | MEDIUM | Data Exposure | Company password hash returned in API responses |
| B05-28 | MEDIUM | Data Exposure | Driver PII (email) logged at INFO level |
| B05-29 | CRITICAL | Dependencies | Spring Security 3.1.1.RELEASE — EOL, multiple CVEs |
| B05-30 | CRITICAL | Dependencies | Spring Security OAuth2 1.0.0.RELEASE — EOL |
| B05-31 | HIGH | Dependencies | Spring Framework 3.2.14.RELEASE — EOL |
| B05-32 | HIGH | Dependencies | Jackson Databind 2.6.7 — multiple known CVEs |
| B05-33 | HIGH | Dependencies | commons-fileupload 1.3.1 — CVE-2016-3092 |
| B05-34 | MEDIUM | Dependencies | commons-io 1.3.2 — very old version |
| B05-35 | MEDIUM | Dependencies | aws-java-sdk 1.11.163 — very old, maintenance-mode SDK |
| B05-36 | LOW | Dependencies | Java 1.8 (EOL for free public updates) |
| B05-37 | HIGH | Build/CI | No CI/CD pipeline present |
| B05-38 | MEDIUM | Build/CI | Tomcat manager URL uses plain HTTP; credentials in local settings.xml |
