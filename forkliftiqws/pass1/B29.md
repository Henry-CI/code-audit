# Pass 1 Security Review — Agent B29
**Date:** 2026-02-27
**Branch:** master
**Assigned files:**
- `src/main/java/com/journaldev/spring/jdbc/service/LocalFileStorageService.java`
- `src/main/java/com/journaldev/spring/jdbc/service/SaveFileInfo.java`
- `src/main/java/com/journaldev/spring/jdbc/service/UserDetailsServiceImpl.java`

**Supporting files read (for full context):**
- `src/main/java/com/journaldev/spring/jdbc/service/AbstractFileStorageService.java`
- `src/main/java/com/journaldev/spring/jdbc/service/FileStorageService.java`
- `src/main/java/com/journaldev/spring/jdbc/service/FileNotFoundException.java`
- `src/main/java/com/journaldev/spring/jdbc/service/FileStorageException.java`
- `src/main/java/com/journaldev/spring/jdbc/DAO/UserDAO.java`
- `src/main/java/com/journaldev/spring/jdbc/model/User.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Roles.java`
- `src/main/java/com/journaldev/spring/jdbc/util/Util.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/ImageController.java`
- `src/main/webapp/WEB-INF/spring/spring-security.xml`
- `src/main/webapp/WEB-INF/web.xml`
- `src/main/resources/fleetiq360ws.properties`
- `environment.dev.properties`
- `environment.uat.properties`
- `environment.prod.properties`
- `pom.xml`

---

## Step 3 — Reading Evidence

### File 1: `LocalFileStorageService.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.service.LocalFileStorageService`

**Extends/Implements:**
- Extends `com.journaldev.spring.jdbc.service.AbstractFileStorageService`
- Implements `com.journaldev.spring.jdbc.service.FileStorageService` (via abstract parent)

**Class annotations:**
- `@Service("localFileStorage")`
- `@Slf4j`

**Fields:** None declared directly. Fields are inherited from `AbstractFileStorageService`:
- `protected String uploadDir` — injected via `@Value("${uploadDir}")`
- `protected String imageDir` — injected via `@Value("${imageDir}")`
- `private String imagePrefix` — injected via `@Value("${imagePrefix}")`
- `protected Path imageStorageLocation`
- `protected Path targetLocation`
- `protected String fileName`
- `protected String imageExt` — initialized to `".jpg"`

**Public methods:**

| Return type | Method name | Parameters | Line |
|---|---|---|---|
| `Resource` | `loadImageAsResource` | `String fileName` | 16 |

**Method annotations:**
- `loadImageAsResource`: `@Override`

---

### File 1 (parent): `AbstractFileStorageService.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.service.AbstractFileStorageService`

**Implements:** `com.journaldev.spring.jdbc.service.FileStorageService`

**Class annotations:** `@Slf4j`

**Fields:**
- `protected String uploadDir` — `@Value("${uploadDir}")`
- `protected String imageDir` — `@Value("${imageDir}")`
- `private String imagePrefix` — `@Value("${imagePrefix}")`
- `protected Path imageStorageLocation`
- `protected Path targetLocation`
- `protected String fileName`
- `protected String imageExt` = `".jpg"`

**Public methods:**

| Return type | Method name | Parameters | Line |
|---|---|---|---|
| `void` | `initialize` | none | 43 |
| `String` | `saveImage` | `InputStream inputStream` | 53 |

**Method annotations:**
- `initialize`: `@PostConstruct`, `@Override` (implicit from interface)
- `saveImage`: `@Override`

---

### File 2: `SaveFileInfo.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.service.SaveFileInfo`

**Implements:** `java.io.Serializable`

**Extends:** none

**Class annotations:**
- `@Data`
- `@Builder`

**Fields:**
- `private static final long serialVersionUID` = `6183703080165788038L`
- `private String fileName`
- `private String fileDownloadUri`
- `private String fileType`
- `private long size`

**Public methods:** All generated by Lombok `@Data` and `@Builder` — getters, setters, `equals`, `hashCode`, `toString`, builder factory. No explicitly declared public methods.

---

### File 3: `UserDetailsServiceImpl.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.service.UserDetailsServiceImpl`

**Implements:** `org.springframework.security.core.userdetails.UserDetailsService`

**Extends:** none

**Class annotations:**
- `@Service("userDetailsService")`

**Fields:**
- `@Autowired private UserDAO dao`

**Public methods:**

| Return type | Method name | Parameters | Line |
|---|---|---|---|
| `UserDetails` | `loadUserByUsername` | `String username` | 26 |

**Method annotations:**
- `loadUserByUsername`: `@Transactional(readOnly = true)`

**Private methods:**

| Return type | Method name | Parameters | Line |
|---|---|---|---|
| `UserDetails` | `buildUserFromUserEntity` | `com.journaldev.spring.jdbc.model.User userEntity` | 34 |

---

## Step 4 — Checklist Review

---

### Section 1 — Secrets and Configuration

**Assigned file scope: LocalFileStorageService / AbstractFileStorageService / SaveFileInfo / UserDetailsServiceImpl**

The `uploadDir`, `imageDir`, and `imagePrefix` properties in `AbstractFileStorageService` are injected via `@Value` from `fleetiq360ws.properties`, which uses Maven property placeholders (`${uploadDir}`). The actual values are supplied by environment-specific property files (`environment.dev.properties`, `environment.uat.properties`, `environment.prod.properties`), which ARE committed to the repository. These files contain:

- **Cognito API credentials:** `cognitoAPIUsername=ciiadmin` / `cognitoAPIPassword=ciiadmin` in all three environment files.
- **AWS infrastructure hostnames and S3 bucket name** (`forkliftiq360`) in all environment files.
- **EC2 public hostname** (`ec2-54-86-82-22.compute-1.amazonaws.com`) used as both UAT and prod endpoint.
- **Dev Flyway/database password** in `pom.xml` `<local>` profile: `fleetiq360` / `fleetiq360`.
- **UAT Flyway/database credentials** in `pom.xml` `<uat>` profile: `flyway.user=dev_admin` / `flyway.password=C!1admin`.

Additionally, `Util.java` (a utility class consumed by `AbstractFileStorageService.saveImage()` via `Util.generateRadomName()`) contains hardcoded AWS SES SMTP credentials:

```java
return new PasswordAuthentication("AKIA**REDACTED**", "****REDACTED****");
```

The `spring-security.xml` file contains two hardcoded OAuth2 client secrets in-source:
- Client `987654321` secret: `8752361E593A573E86CA558FFD39E`
- Client `fleetiq360` secret: `rihah8eey4faibuengaixo6leiL1awii`

The `pom.xml` also references a third-party Maven repository over plain HTTP:
```xml
<url>http://splunk.jfrog.io/splunk/ext-releases-local</url>
```

**FINDING B29-1 through B29-5 below.**

---

### Section 2 — Authentication and Authorization

**`UserDetailsServiceImpl.loadUserByUsername()` analysis (HIGH PRIORITY):**

The method:
1. Calls `dao.findByName(username)` — the username value comes from the OAuth2 password grant flow. The Spring Security OAuth2 stack passes the username from the password grant `username` parameter to `loadUserByUsername`.
2. Throws `UsernameNotFoundException` if not found.
3. Calls `buildUserFromUserEntity()` which constructs a Spring Security `User` object.

**In `buildUserFromUserEntity()`:**
```java
boolean enabled = true;                          // hardcoded — never false
boolean accountNonExpired = true;                // hardcoded — never false
boolean credentialsNonExpired = true;            // hardcoded — never false
boolean accountNonLocked = userEntity.isActive();
```

`enabled`, `accountNonExpired`, and `credentialsNonExpired` are hardcoded to `true`. This means a user account can never be marked as disabled/expired/credentials-expired through the database — only `active = false` is honoured via `accountNonLocked`. If a user's credentials are compromised and the admin marks them in a way that does not flip the `active` flag (e.g., a soft-delete or a separate `enabled` column exists in the DB), Spring Security will still authenticate them.

**Role/authority assignment:**
```java
for (Roles role : userEntity.getRoles()) {
    authorities.add(new SimpleGrantedAuthority(role.getAuthority()));
}
```
Roles are loaded from the database view `v_apiusers` via `UserDAO`. The SQL query is parameterised (no injection risk). Roles come directly from `authority` column. No elevation risk is introduced in `UserDetailsServiceImpl` itself — the roles are whatever is in the DB. No hardcoded ADMIN grant found.

**MD5 username lookup (in `UserDAO`):**
```sql
select ... from v_apiusers u where u.active = true and (u.name = ? or md5(u.name) = ?) order by email
```
The query accepts EITHER the plaintext username OR an MD5 hash of the username. This means an attacker who knows the MD5 of a username can authenticate as that user by passing the MD5 value as the username field. MD5 is also broken as a hash function, making offline hash reversal practical. This is a significant authentication bypass vector.

**Password hashing:**
In `spring-security.xml`:
```xml
<password-encoder hash="md5"/>
```
MD5 is used for password hashing in the authentication manager. MD5 is not a password hashing function — it is a general-purpose hash function with no salting, extremely fast, and subject to rainbow table and GPU-accelerated brute-force attacks. This is a critical authentication weakness.

**OAuth2 access token validity:**
```xml
<oauth:client client-id="fleetiq360" ... access-token-validity="300" refresh-token-validity="300"/>
```
Access and refresh tokens are set to 300 seconds (5 minutes) for the `fleetiq360` client. The `987654321` client has `access-token-validity="0"` which in Spring Security OAuth2 typically means tokens never expire.

**Token endpoint unprotected for testing:**
```xml
<http pattern="/oauth/cache_approvals" security="none" ... />
<http pattern="/oauth/uncache_approvals" security="none" ... />
```
Two endpoints are explicitly left with `security="none"` with a comment "Just for testing..." — these appear to be test/debug endpoints left active in a production build.

**Image endpoint auth:**
`ImageController` maps `GET /image/{fileName:.+}` with no authentication — the `spring-security.xml` only protects `/rest/**` and `/oauth/token`. The `/image/` path falls through with no explicit security rule. Web-accessible file download from the server's filesystem is effectively unauthenticated.

**FINDING B29-6 through B29-11 below.**

---

### Section 3 — Input Validation and Injection

**Path traversal in `loadImageAsResource`:**

```java
Path filePath = imageStorageLocation.resolve(fileName).normalize();
Resource resource = new UrlResource(filePath.toUri());
```

`fileName` arrives directly from `ImageController`:
```java
@RequestMapping(value = "/image/{fileName:.+}", method = RequestMethod.GET)
public ResponseEntity<Resource> downloadFile(@PathVariable("fileName") String fileName) {
    Resource resource = fileStorageService.loadImageAsResource(fileName);
```

The `{fileName:.+}` regex allows dots but does not restrict path separators. While `.normalize()` resolves `..` segments, **it does not then verify the resolved path is still within `imageStorageLocation`**. An attacker submitting a URL-encoded path such as `/image/..%2F..%2Fetc%2Fpasswd` or using `%2F`-encoded separators could potentially escape the storage directory if the servlet container decodes the path before routing. More critically, there is no explicit check of the form:

```java
if (!filePath.startsWith(imageStorageLocation)) {
    throw new FileStorageException(...);
}
```

This is a path traversal vulnerability — the `normalize()` call alone is insufficient without a subsequent `startsWith` boundary check.

**No input validation on `fileName`:** No whitelist of permitted characters (e.g., alphanumeric, hyphen, underscore, dot) is enforced before the path is resolved.

**`saveImage` in `AbstractFileStorageService`:** The filename is server-generated (`imagePrefix + Util.generateRadomName() + imageExt`) so user input does not directly control the stored filename. No injection risk in the save path.

**No command injection, XXE, or SSRF found** in the three assigned files.

**FINDING B29-12 and B29-13 below.**

---

### Section 4 — Session and CSRF

**N/A for the three assigned files directly.** `SaveFileInfo`, `LocalFileStorageService`, and `UserDetailsServiceImpl` do not configure session or CSRF behaviour. The broader security config is in `spring-security.xml`. The API uses stateless OAuth2 tokens (`create-session="never"` / `create-session="stateless"`), so session fixation and CSRF are less directly relevant for the REST endpoints. No `@CrossOrigin` annotations observed in assigned files.

**CLEAR** for these three files on Section 4.

---

### Section 5 — Data Exposure

**Error messages exposing filesystem paths:**

In `LocalFileStorageService.loadImageAsResource()`:
```java
throw new FileNotFoundException("Unable to find " + fileName + " at location : " + filePath.toString() + " on server");
```

`filePath.toString()` returns the **full absolute server filesystem path** (e.g., `/var/local/tomcat8/upload/image/someFile.jpg`). This path is embedded in the exception message. `FileNotFoundException` is annotated with `@ResponseStatus(HttpStatus.NOT_FOUND)` and Spring MVC may return this message body to the client, exposing:
- The server's absolute filesystem directory structure
- The `uploadDir` and `imageDir` configuration values
- Deployment path details useful for server reconnaissance

In `AbstractFileStorageService.saveImage()`:
```java
throw new FileStorageException("Could not store file " + fileName + ". Please try again!", ex);
```
The `fileName` here is server-generated so lower risk, but the `FileStorageException` propagation should be examined by subsequent pass agents to verify no stack trace leaks occur in the global exception handler.

**FINDING B29-14 below.**

---

### Section 6 — Dependencies

Reviewing `pom.xml` for the assigned context:

| Dependency | Version | Issue |
|---|---|---|
| `org.springframework` / spring-webmvc, spring-jdbc, spring-context | `3.2.14.RELEASE` | Spring 3.2 reached end of life in December 2016. Numerous CVEs exist against this version family including CVE-2018-1270 (RCE via STOMP), CVE-2014-3571, and others. No active security patches. |
| `org.springframework.security` / spring-security-web, spring-security-config | `3.1.1.RELEASE` | Spring Security 3.1.1 reached end of life. Numerous CVEs including authentication bypass issues. |
| `org.springframework.security.oauth` / spring-security-oauth2 | `1.0.0.RELEASE` | Spring Security OAuth 1.0.0 is severely outdated (current is 2.5.x, itself deprecated). Known vulnerabilities including CVE-2019-3778 (open redirect/SSRF in OAuth). |
| `com.fasterxml.jackson.core` / jackson-databind | `2.6.7` | Jackson 2.6.7 is end of life and has multiple critical deserialization CVEs (e.g. CVE-2017-7525, CVE-2018-7489, CVE-2019-12086). |
| `commons-fileupload` | `1.3.1` | CVE-2016-3092 (DoS via malicious multipart request). Should be 1.3.3 or later. |
| `commons-io` (`org.apache.commons:commons-io`) | `1.3.2` | This is actually `commons-io` version 1.3.2 under the `org.apache.commons` groupId — this does not exist at Maven Central under this coordinate. The artifact is `commons-io:commons-io`. This may resolve to an incorrect or unavailable artifact. |
| `postgresql` (flyway dependency) | `9.1-901.jdbc3` | Severely outdated JDBC driver. |
| Maven repository | `http://splunk.jfrog.io/...` | Plain HTTP repository — susceptible to MITM/dependency substitution attacks. |
| Java version | `1.8` | Java 8 target — not inherently a CVE but notes the build targets a version approaching EOL for free security updates. |

**FINDING B29-15 through B29-17 below.**

---

### Section 7 — Build and CI

No `bitbucket-pipelines.yml` found in the repository. This means there is no automated CI/CD pipeline configuration present. Build, test, and deployment processes are entirely manual or managed externally.

The `pom.xml` build has `-Xlint:all` and `showWarnings=true` / `showDeprecation=true` configured for the compiler plugin, which is positive for build hygiene.

The `uat` Maven profile is marked `activeByDefault=true`, meaning that a plain `mvn` invocation without specifying a profile will use UAT configuration, including UAT database credentials and Tomcat server references. This is a misconfiguration risk.

No evidence of `-DskipTests` in source, but no pipeline to verify.

**FINDING B29-18 and B29-19 below.**

---

## Findings

---

**B29-1** — CRITICAL
**Section:** 1 — Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/util/Util.java:66`
**Description:** Hardcoded AWS SES SMTP access key ID and secret access key are committed to source. The access key ID `AKIA**REDACTED**` and its corresponding secret are live credentials embedded in source code. Any person with repository access can use these credentials to send email via SES at the account owner's expense and to any recipient, and can enumerate or modify SES configuration. AWS IAM keys beginning with `AKIA` are long-term access keys that do not expire unless rotated.
**Evidence:**
```java
return new PasswordAuthentication("AKIA**REDACTED**", "****REDACTED****");
```

---

**B29-2** — HIGH
**Section:** 1 — Secrets and Configuration
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:113-117`
**Description:** OAuth2 client secrets are hardcoded directly in the Spring Security XML configuration file, which is committed to source control. Two clients are defined with plaintext secrets. Anyone with repository access knows both client secrets, which are used to obtain OAuth2 tokens that grant access to the API.
**Evidence:**
```xml
<oauth:client client-id="987654321" ... secret="8752361E593A573E86CA558FFD39E" .../>
<oauth:client client-id="fleetiq360" ... secret="rihah8eey4faibuengaixo6leiL1awii" .../>
```

---

**B29-3** — HIGH
**Section:** 1 — Secrets and Configuration
**File:** `environment.dev.properties:15-16`, `environment.uat.properties:15-16`, `environment.prod.properties:15-16`
**Description:** Cognito API credentials are committed to source in all three environment property files. The username/password `ciiadmin`/`ciiadmin` is identical across all environments and represents a weak, shared credential stored in plaintext in version control.
**Evidence:**
```
cognitoAPIUsername=ciiadmin
cognitoAPIPassword=ciiadmin
```

---

**B29-4** — HIGH
**Section:** 1 — Secrets and Configuration
**File:** `pom.xml:76-77`
**Description:** UAT database credentials (`dev_admin` / `C!1admin`) are committed to source in the `<uat>` Maven profile. The `uat` profile is marked `activeByDefault=true`, making these the active credentials in a default build. Local profile also contains `fleetiq360`/`fleetiq360` database credentials.
**Evidence:**
```xml
<flyway.user>dev_admin</flyway.user>
<flyway.password>C!1admin</flyway.password>
```
and (local profile):
```xml
<flyway.password>fleetiq360</flyway.password>
```

---

**B29-5** — MEDIUM
**Section:** 1 — Secrets and Configuration
**File:** `pom.xml:88-90`
**Description:** A third-party Maven repository is referenced using plain HTTP (`http://`), not HTTPS. This allows a man-in-the-middle attacker on the network to substitute malicious artifacts during dependency resolution, leading to supply-chain compromise.
**Evidence:**
```xml
<url>http://splunk.jfrog.io/splunk/ext-releases-local</url>
```

---

**B29-6** — CRITICAL
**Section:** 2 — Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:74`
**Description:** MD5 is configured as the password hashing algorithm for the Spring Security authentication provider. MD5 is a broken cryptographic hash function entirely unsuitable for password storage. It provides no salting, is computationally trivial to brute-force on modern hardware, and has pre-computed rainbow tables widely available. All user passwords in the database are effectively recoverable by any party who can read the `password` column.
**Evidence:**
```xml
<password-encoder hash="md5"/>
```

---

**B29-7** — HIGH
**Section:** 2 — Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/UserDAO.java:31`
**Description:** The user lookup SQL query allows authentication using either a user's plaintext name OR the MD5 hash of the name. An attacker who can compute or obtain the MD5 of any username can pass that MD5 value as the `username` field in the OAuth2 password grant request and be looked up as that user. Combined with the MD5 password encoding, this significantly reduces the authentication security boundary.
**Evidence:**
```java
private static final String QUERY_USER_BY_NAME =
  "select ... from v_apiusers u where u.active = true and (u.name = ? or md5(u.name) = ?) order by email";
```

---

**B29-8** — MEDIUM
**Section:** 2 — Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/service/UserDetailsServiceImpl.java:38-41`
**Description:** The `buildUserFromUserEntity()` method hardcodes `enabled`, `accountNonExpired`, and `credentialsNonExpired` to `true`. This means there is no mechanism through which an administrator can disable a user's account, mark credentials as expired, or mark an account as expired via these Spring Security flags — only the `active` field (mapped to `accountNonLocked`) can be used. If the application has any notion of credential expiry or full account disablement beyond the `active` flag, Spring Security will not enforce it.
**Evidence:**
```java
boolean enabled = true;
boolean accountNonExpired = true;
boolean credentialsNonExpired = true;
boolean accountNonLocked = userEntity.isActive();
```

---

**B29-9** — HIGH
**Section:** 2 — Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:113`
**Description:** OAuth2 client `987654321` is configured with `access-token-validity="0"`. In Spring Security OAuth2, a value of `0` means tokens issued to this client never expire. Any token issued to this client remains valid indefinitely, providing a permanent authentication foothold if a token is compromised. There is also no refresh token configured for this client, suggesting the intention was long-lived access tokens.
**Evidence:**
```xml
<oauth:client client-id="987654321" authorized-grant-types="password,authorization_code,implicit"
    secret="8752361E593A573E86CA558FFD39E" authorities="ROLE_CLIENT" scope="read,write" access-token-validity="0"/>
```

---

**B29-10** — MEDIUM
**Section:** 2 — Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:13-14`
**Description:** Two endpoints (`/oauth/cache_approvals` and `/oauth/uncache_approvals`) are explicitly set to `security="none"` with a comment "Just for testing..." These appear to be debug/test endpoints that have been left enabled in production configuration. The implications depend on what these endpoints do in the Spring Security OAuth2 implementation, but they are completely unauthenticated.
**Evidence:**
```xml
<!-- Just for testing... -->
<http pattern="/oauth/cache_approvals" security="none" ... />
<http pattern="/oauth/uncache_approvals" security="none" ... />
```

---

**B29-11** — HIGH
**Section:** 2 — Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ImageController.java:29` / `src/main/webapp/WEB-INF/spring/spring-security.xml:28-35`
**Description:** The `/image/{fileName}` endpoint in `ImageController` is not covered by any security rule in `spring-security.xml`. The `spring-security.xml` only defines intercept rules for `/rest/**` and `/oauth/token`. The `/image/` path has no authentication requirement, meaning any unauthenticated request can retrieve any file accessible via the `loadImageAsResource()` method. This affects forklift/operator image data stored on the server.
**Evidence:**
`spring-security.xml` coverage:
```xml
<http pattern="/rest/**" ...>
    <intercept-url pattern="/rest/**" access="ROLE_DRIVER,ROLE_COMPANY_GROUP,ROLE_SYS_ADMIN,ROLE_CLIENT" />
</http>
```
`ImageController` endpoint:
```java
@RequestMapping(value = "/image/{fileName:.+}", method = RequestMethod.GET)
public ResponseEntity<Resource> downloadFile(@PathVariable("fileName") String fileName) {
```
No authentication annotation or security rule covers `/image/**`.

---

**B29-12** — HIGH
**Section:** 3 — Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/service/LocalFileStorageService.java:19`
**Description:** Path traversal vulnerability. The `loadImageAsResource()` method resolves a caller-supplied `fileName` against `imageStorageLocation` and calls `.normalize()`, but does not verify that the resulting path remains within the `imageStorageLocation` directory. There is no `filePath.startsWith(imageStorageLocation)` boundary check. A `fileName` containing `../` sequences (or URL-encoded equivalents if the servlet container decodes before dispatch) can escape the intended storage directory and read arbitrary files accessible to the JVM process. Since `/image/{fileName}` is also unauthenticated (B29-11), this is exploitable without any credentials.
**Evidence:**
```java
Path filePath = imageStorageLocation.resolve(fileName).normalize();
Resource resource = new UrlResource(filePath.toUri());
if (resource.exists()) {
    return resource;
} else {
    throw new FileNotFoundException("Unable to find " + fileName + " at location : " + filePath.toString() + " on server");
}
```
No `startsWith` check present. `normalize()` alone is insufficient.

---

**B29-13** — MEDIUM
**Section:** 3 — Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ImageController.java:30`
**Description:** No input validation is applied to the `fileName` path variable before it is passed to `loadImageAsResource()`. There is no whitelist of permitted characters (e.g., `[a-zA-Z0-9._-]+`), no maximum length check, and no rejection of path separator characters. This compounds the path traversal risk identified in B29-12.
**Evidence:**
```java
@RequestMapping(value = "/image/{fileName:.+}", method = RequestMethod.GET)
public ResponseEntity<Resource> downloadFile(@PathVariable("fileName") String fileName) {
    Resource resource = fileStorageService.loadImageAsResource(fileName);
```

---

**B29-14** — MEDIUM
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/service/LocalFileStorageService.java:24`
**Description:** When a requested file is not found, the exception message includes the full absolute filesystem path of the server's storage directory. This leaks the server's directory structure, deployment path, and storage configuration to any client that triggers a 404 response. Because `/image/` is unauthenticated, this information is available to any internet-accessible requester.
**Evidence:**
```java
throw new FileNotFoundException("Unable to find " + fileName + " at location : " + filePath.toString() + " on server");
```
`filePath.toString()` will produce a string such as `/var/local/tomcat8/upload/image/requestedFile.jpg`, revealing `uploadDir` and `imageDir` values.

---

**B29-15** — CRITICAL
**Section:** 6 — Dependencies
**File:** `pom.xml:12-13`, `pom.xml:230-237`
**Description:** Spring Framework 3.2.14.RELEASE and Spring Security 3.1.1.RELEASE are both severely end-of-life (EOL since 2016). These versions have multiple unpatched CVEs. Spring 3.2 is affected by CVE-2018-1270 (RCE via STOMP over WebSocket), CVE-2014-0054, and others. Spring Security 3.1.1 predates numerous authentication-related security fixes. The entire security posture of the application is built on an unmaintained foundation.
**Evidence:**
```xml
<org.springframework-version>3.2.14.RELEASE</org.springframework-version>
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-web</artifactId>
    <version>3.1.1.RELEASE</version>
</dependency>
```

---

**B29-16** — CRITICAL
**Section:** 6 — Dependencies
**File:** `pom.xml:99-101`, `pom.xml:199-201`
**Description:** Jackson Databind 2.6.7 and commons-fileupload 1.3.1 are both end-of-life with known critical CVEs. Jackson 2.6.7 is affected by multiple polymorphic deserialization CVEs (CVE-2017-7525, CVE-2018-7489, CVE-2019-12086, CVE-2019-12814, and many others through 2.9.x). commons-fileupload 1.3.1 is affected by CVE-2016-3092 (DoS via malicious multipart request). Spring Security OAuth2 1.0.0.RELEASE is also critically outdated (CVE-2019-3778: open redirect / SSRF).
**Evidence:**
```xml
<jackson.databind-version>2.6.7</jackson.databind-version>
...
<dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.3.1</version>
</dependency>
<dependency>
    <groupId>org.springframework.security.oauth</groupId>
    <artifactId>spring-security-oauth2</artifactId>
    <version>1.0.0.RELEASE</version>
</dependency>
```

---

**B29-17** — LOW
**Section:** 6 — Dependencies
**File:** `pom.xml:168-170`
**Description:** The `commons-io` dependency uses the groupId `org.apache.commons` with artifactId `commons-io`. The correct Maven coordinate for Apache Commons IO is `commons-io:commons-io`. The coordinate `org.apache.commons:commons-io:1.3.2` does not correspond to a published Apache artifact at Maven Central and may resolve incorrectly or fail to resolve, creating a build reproducibility concern.
**Evidence:**
```xml
<groupId>org.apache.commons</groupId>
<artifactId>commons-io</artifactId>
<version>1.3.2</version>
```

---

**B29-18** — MEDIUM
**Section:** 7 — Build and CI
**File:** `pom.xml:69-70`
**Description:** The `uat` Maven profile is marked `<activeByDefault>true</activeByDefault>`. This means that any invocation of `mvn` without an explicit `-P` profile flag will use UAT configuration, including UAT database credentials and Tomcat server URLs. A developer running `mvn flyway:migrate` without specifying a profile will attempt to migrate the UAT/production database. This is a significant operational and data-integrity risk.
**Evidence:**
```xml
<profile>
    <id>uat</id>
    <activation>
        <activeByDefault>true</activeByDefault>
    </activation>
```

---

**B29-19** — INFO
**Section:** 7 — Build and CI
**File:** (repository root — no file)
**Description:** No `bitbucket-pipelines.yml` file is present in the repository. There is no automated CI/CD pipeline configuration. This means builds, tests, and deployments are performed manually, with no automated security scanning, test gates, or controlled deployment process. There is no way to verify that tests are run before deployment, or that `-DskipTests` is not used in production deployments.
**Evidence:** File not found at repository root or any subdirectory.

---

## Summary of Findings

| ID | Severity | Section | Description |
|---|---|---|---|
| B29-1 | CRITICAL | 1 — Secrets | Hardcoded AWS SES credentials in `Util.java` |
| B29-2 | HIGH | 1 — Secrets | Hardcoded OAuth2 client secrets in `spring-security.xml` |
| B29-3 | HIGH | 1 — Secrets | Cognito API credentials committed to all environment property files |
| B29-4 | HIGH | 1 — Secrets | UAT and dev database credentials committed in `pom.xml` |
| B29-5 | MEDIUM | 1 — Secrets | Maven repository configured over plain HTTP |
| B29-6 | CRITICAL | 2 — Auth | MD5 used as password hashing algorithm |
| B29-7 | HIGH | 2 — Auth | MD5 hash accepted as valid username for authentication bypass |
| B29-8 | MEDIUM | 2 — Auth | `enabled`, `accountNonExpired`, `credentialsNonExpired` hardcoded to `true` |
| B29-9 | HIGH | 2 — Auth | OAuth2 client `987654321` has non-expiring tokens (`access-token-validity="0"`) |
| B29-10 | MEDIUM | 2 — Auth | Test OAuth2 endpoints left with `security="none"` in production config |
| B29-11 | HIGH | 2 — Auth | `/image/**` endpoint is unauthenticated — no security rule covers it |
| B29-12 | HIGH | 3 — Injection | Path traversal in `loadImageAsResource` — no `startsWith` boundary check after `normalize()` |
| B29-13 | MEDIUM | 3 — Injection | No input validation on `fileName` path variable in `ImageController` |
| B29-14 | MEDIUM | 5 — Data Exposure | Absolute filesystem path disclosed in 404 error message |
| B29-15 | CRITICAL | 6 — Dependencies | Spring 3.2.14 and Spring Security 3.1.1 — EOL with multiple unpatched CVEs |
| B29-16 | CRITICAL | 6 — Dependencies | Jackson-databind 2.6.7, commons-fileupload 1.3.1, Spring OAuth2 1.0.0 — EOL with critical CVEs |
| B29-17 | LOW | 6 — Dependencies | Incorrect Maven coordinate for commons-io |
| B29-18 | MEDIUM | 7 — Build/CI | UAT profile set as `activeByDefault` — risk of accidental production DB mutation |
| B29-19 | INFO | 7 — Build/CI | No CI/CD pipeline present; no automated test or deployment gates |
