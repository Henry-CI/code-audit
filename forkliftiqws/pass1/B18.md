# Security Audit — Pass 1 Report
**Agent:** B18
**Date:** 2026-02-27
**Branch:** master
**Repo:** forkliftiqws
**Checklist:** PASS1-CHECKLIST-forkliftiq-spring.md

---

## Files Reviewed

- `src/main/java/com/journaldev/spring/jdbc/model/GPSList.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Impact.java`
- `src/main/java/com/journaldev/spring/jdbc/model/ImpactList.java`

Supporting context (read-only, not primary scope):
- `controller/ImpactController.java` — to understand how Impact/ImpactList are consumed
- `DAO/ImpactDAO.java` — to understand persistence and logging of Impact fields
- `model/ImpactNotification.java` — related safety-critical model
- `model/GPS.java` — element type for GPSList
- `controller/ConfigurationController.java` — base class of ImpactController
- `controller/RestURIConstants.java` — endpoint path constants

---

## Reading Evidence

### 1. `com.journaldev.spring.jdbc.model.GPSList`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.GPSList`

**Interfaces implemented:** `java.io.Serializable`

**Class-level annotations:** none

**Fields:**

| Modifier         | Type           | Name            | Line |
|------------------|----------------|-----------------|------|
| private static final | long       | serialVersionUID | 9   |
| (package-private) | List\<GPS\>  | gpsList          | 12  |

Note: `gpsList` has no explicit access modifier — it is package-private, not `private`.

**Public methods:**

| Return Type   | Method Signature                        | Line |
|---------------|-----------------------------------------|------|
| List\<GPS\>   | getGpsList()                            | 15   |
| void          | setGpsList(List\<GPS\> gpsList)         | 20   |

**Method annotations:** none on any method

---

### 2. `com.journaldev.spring.jdbc.model.Impact`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.Impact`

**Interfaces implemented:** `java.io.Serializable`

**Class-level annotations:**
- `@Data` (Lombok — generates getters, setters, equals, hashCode, toString)
- `@NoArgsConstructor` (Lombok — generates public no-arg constructor)

**Fields:**

| Modifier | Type   | Name          | Line |
|----------|--------|---------------|------|
| private  | long   | impact_value  | 16   |
| private  | String | impact_time   | 17   |
| private  | String | mac_address   | 18   |

**Methods (declared):**

| Return Type | Method Signature                                                   | Line | Annotations     |
|-------------|--------------------------------------------------------------------|------|-----------------|
| (constructor) | Impact(long impact_value, String impact_time, String mac_address) | 21   | @Builder (private constructor) |

Lombok `@Data` also generates (implicitly, not declared in source):
- `public long getImpact_value()`
- `public String getImpact_time()`
- `public String getMac_address()`
- `public void setImpact_value(long)`
- `public void setImpact_time(String)`
- `public void setMac_address(String)`
- `public boolean equals(Object)`
- `public int hashCode()`
- `public String toString()`

**Classes extended:** none (implicit `Object`)

---

### 3. `com.journaldev.spring.jdbc.model.ImpactList`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.ImpactList`

**Interfaces implemented:** `java.io.Serializable`

**Class-level annotations:** none

**Fields:**

| Modifier          | Type              | Name        | Line |
|-------------------|-------------------|-------------|------|
| private static final | long           | serialVersionUID | 13 |
| (package-private) | List\<Impact\>  | impactList   | 16  |

Note: `impactList` has no explicit access modifier — it is package-private, not `private`.

**Public methods:**

| Return Type       | Method Signature                          | Line |
|-------------------|-------------------------------------------|------|
| List\<Impact\>    | getImpactList()                           | 19   |
| void              | setImpactList(List\<Impact\> impactList)  | 23   |

**Method annotations:** none on any method

---

## Checklist Review

### Section 1 — Secrets and Configuration

Model classes only. No credentials, API keys, hardcoded connection strings, or configuration properties are present in these three files.

**Result: N/A for this file set** (no configuration content in model classes)

---

### Section 2 — Authentication and Authorization

Model classes carry no auth logic. However, the consumer `ImpactController.saveImpactData()` accepts `@RequestBody ImpactList` at `POST /rest/impactdata/save`. The controller extends `ConfigurationController` which carries no auth enforcement itself. Auth enforcement depends on the Spring Security filter chain reviewed by other agents.

The `Impact` model accepts `mac_address` from the client without any validation annotations. A device submitting impact data identifies itself solely by `mac_address` — if the Spring Security layer does not scope this to an authenticated device or organisation, a caller supplying an arbitrary `mac_address` could inject impact records for equipment it does not own (IDOR-adjacent: spoofing device identity, not user identity). This is noted here as context; the full IDOR finding belongs in the controller review.

**Result: N/A for model-only scope** (no auth logic in these files; flag passed to controller reviewer)

---

### Section 3 — Input Validation and Injection

**3a. No `@Valid` / JSR-303 constraints on Impact fields (MEDIUM)**

`Impact` is annotated `@Data @NoArgsConstructor`. None of its three fields (`impact_value`, `impact_time`, `mac_address`) carry any JSR-303 validation constraint (`@NotNull`, `@NotBlank`, `@Size`, `@Pattern`, `@Min`, `@Max`). When `ImpactList` is bound from a `@RequestBody` in `ImpactController.saveImpactData()`, Spring performs no bean validation because there is no `@Valid` on the parameter and no constraints on the model. This means:

- `mac_address` can be null, empty, or arbitrarily long.
- `impact_time` can be null, malformed, or out of range — passed directly to `DateUtil.parseDateTimeIso()` without pre-validation.
- `impact_value` has no lower or upper bound enforced at the model layer (the DAO applies a `< 80000` floor silently, but that is business logic, not a security constraint, and it is not visible to any validation framework).

**Result: MEDIUM — see finding B18-1**

**3b. No `@JsonTypeInfo` with default typing — deserialization**

No `@JsonTypeInfo` annotation is present on any of the three classes. No global Jackson configuration is set in these files. No `ObjectInputStream.readObject()` usage is present.

**Result: CLEAR**

**3c. SQL injection**

Model classes contain no SQL. SQL is in the DAO/controller layer (other agents' scope).

**Result: N/A**

---

### Section 4 — Session and CSRF

Model classes carry no session or CSRF configuration.

**Result: N/A**

---

### Section 5 — Data Exposure

**5a. Safety-critical Impact model missing operator identity and severity fields**

`Impact` is the primary model for forklift collision/impact events — safety-critical data. The model contains only three fields: `impact_value` (raw sensor reading), `impact_time` (timestamp), and `mac_address` (device identifier).

The model contains **no field for**:
- Operator identity (driver ID, driver name)
- Forklift serial number or unit name (only `mac_address`, an internal device identifier)
- Site ID or company ID
- Severity classification or rating (e.g., LOW/MEDIUM/RED threshold label)
- Session ID linking the impact to an active operator session

This means the API response for an impact event returned to clients carries only raw sensor data with a device MAC address. The business logic in `ImpactDAO.sendImpactNotification()` joins against `v_impacts`, `company`, and user tables to construct a richer notification — but that enriched data is never returned to the API caller or stored in the `Impact` model itself. While the sparse model reduces some exposure, the absence of a severity field means **clients cannot determine from the API response alone whether the event exceeded the safety threshold** — they receive only the raw numeric value and must re-implement the threshold logic (`> equipment.impact_threshold * 10`) on their side, creating a risk of inconsistent safety classification.

**Result: INFO — see finding B18-2**

**5b. `mac_address` exposed in Impact model API response**

`Impact` is serialised to JSON by Jackson (via `@Data` generating getters). The `mac_address` field — a hardware device identifier — is included in every serialised `Impact` response. In the `saveImpactData` path the response body is a `Results` object, not an `Impact`, so `mac_address` is not echoed in that specific response. However, the model itself has no `@JsonIgnore` on `mac_address`. If `Impact` is ever used directly as a response body (e.g., in future endpoints or via ImpactList retrieval endpoints not present in the reviewed controller), `mac_address` will be leaked to API consumers. MAC addresses can be used to fingerprint physical devices and could facilitate spoofing attacks.

**Result: LOW — see finding B18-3**

**5c. `ImpactList.impactList` field is package-private, not private**

In `ImpactList` (line 16) the field `List<Impact> impactList` has no access modifier — it is package-private. Same issue in `GPSList` (line 12): `List<GPS> gpsList` is package-private. This is not a serialisation issue (getters are public), but it allows direct field access from any class in the same package (`com.journaldev.spring.jdbc.model`), bypassing the setter. This is a minor encapsulation defect that could allow internal classes to set the list without going through any future validation added to the setter.

**Result: LOW — see finding B18-4**

**5d. `Impact.toString()` generated by Lombok `@Data` — potential PII/sensitive data in logs**

Lombok `@Data` generates a `toString()` method that includes all fields: `impact_value`, `impact_time`, and `mac_address`. If `Impact` objects are ever logged (e.g., via `logger.debug(impact.toString())` or by passing the object directly to a logger), all three fields including the MAC address will appear in log output. In `ImpactController.saveImpactData()` (line 153), the entire `impactList` is already logged at INFO level via Gson: `logger.info("Start saveImpactData." + " : " + gson.toJson(impactList))`. This causes every incoming impact's MAC address and timestamp to appear in production INFO logs. This is noted primarily in the controller, but the model's unconstrained `@Data` toString makes it easy to accidentally replicate this pattern.

**Result: LOW — see finding B18-5**

**5e. GPSList: location data in GPS element model**

`GPS` (the element type of `GPSList`) carries `longitude`, `latitude`, `gps_time`, `current_location`, `unit_id`, and `unit_name`. `GPSList` wraps these. The `unit_id` (internal database primary key) is exposed. This is a data-exposure concern for the GPS model but is marginal for the list wrapper itself. No `@JsonIgnore` on any field. Noted here as the `GPSList` model contributes to this exposure.

**Result: INFO — see finding B18-6**

---

### Section 6 — Dependencies

N/A — model classes contain no dependency declarations.

---

### Section 7 — Build and CI

N/A — model classes contain no build configuration.

---

## Findings

---

**B18-1** — MEDIUM
**Section:** 3 — Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Impact.java:16-18`
**Description:** The `Impact` model carries no JSR-303 validation constraints on any field. When deserialized from `@RequestBody ImpactList` in `ImpactController.saveImpactData()`, no bean validation is triggered. `mac_address` can be null or arbitrarily long; `impact_time` can be null or malformed (passed directly to `DateUtil.parseDateTimeIso()` without pre-check); `impact_value` has no declared minimum or maximum. Missing validation at the model layer means the API accepts malformed safety-critical event payloads without rejection.
**Evidence:**
```java
// Impact.java lines 10-18
@Data
@NoArgsConstructor
public class Impact implements Serializable{

    private static final long serialVersionUID = -6059977226530435320L;

    private long impact_value;
    private String impact_time;
    private String mac_address;
    // No @NotNull, @NotBlank, @Size, @Pattern, @Min, @Max on any field
```
```java
// ImpactController.java line 152 — no @Valid on @RequestBody
public @ResponseBody ResponseEntity<Results> saveImpactData(@RequestBody ImpactList impactList) {
```

---

**B18-2** — INFO
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Impact.java:16-18`
**Description:** The `Impact` model (the primary safety-critical event model) contains no fields for operator identity, forklift serial number, site ID, or severity classification. The severity threshold evaluation (`impact_value > equipment.impact_threshold * 10`) is performed only in `ImpactController` business logic and is not reflected in the model or API response. Clients receiving impact data must independently re-implement threshold logic to determine safety severity, creating a risk of inconsistent classification between server and client.
**Evidence:**
```java
// Impact.java — full field set:
private long impact_value;    // raw sensor integer
private String impact_time;   // timestamp string
private String mac_address;   // device hardware identifier
// No: operator_id, driver_name, unit_id, unit_serial, site_id, company_id, severity
```
```java
// ImpactDAO.java line 39 — threshold applied in DAO, not reflected in model
if (impactValue < 80000) return;
// ImpactController.java line 168 — RED threshold check, not stored in Impact
if(equipment.getImpact_threshold() != 0 && impact.getImpact_value() > equipment.getImpact_threshold()*10) {
```

---

**B18-3** — LOW
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Impact.java:18`
**Description:** The `mac_address` field in `Impact` has no `@JsonIgnore` annotation. Lombok `@Data` generates a public getter `getMac_address()`, which Jackson will serialise into any JSON response that uses `Impact` as a response body. MAC addresses are hardware device identifiers; their exposure in API responses facilitates device fingerprinting and could assist in device-identity spoofing attacks. The `mac_address` is an input field (device-to-server) and should not be echoed in server-to-client responses.
**Evidence:**
```java
// Impact.java line 18
private String mac_address;
// No @JsonIgnore — Lombok @Data generates public getMac_address()
// Jackson will include this field in any serialised Impact response
```

---

**B18-4** — LOW
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/ImpactList.java:16`, `src/main/java/com/journaldev/spring/jdbc/model/GPSList.java:12`
**Description:** The backing list fields in both `ImpactList` and `GPSList` are package-private (no access modifier), not `private`. Any class within the `com.journaldev.spring.jdbc.model` package can read or replace the list directly, bypassing the public setter. This breaks encapsulation and means any future validation logic added to the setter would be circumventable within the package.
**Evidence:**
```java
// ImpactList.java line 16
List<Impact> impactList = new ArrayList<Impact>();  // package-private

// GPSList.java line 12
List<GPS> gpsList = new ArrayList<GPS>();  // package-private
```

---

**B18-5** — LOW
**Section:** 5 — Data Exposure (Logging)
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Impact.java:10`, `src/main/java/com/journaldev/spring/jdbc/controller/ImpactController.java:153`
**Description:** Lombok `@Data` on `Impact` generates a `toString()` that includes all fields: `impact_value`, `impact_time`, and `mac_address`. In `ImpactController.saveImpactData()` the full incoming `ImpactList` is serialised and logged at INFO level (production-visible) via Gson. Every inbound impact event's MAC address and timestamp therefore appears in production INFO logs. MAC addresses in logs can be used to enumerate physical devices and correlate device movements with impact events. The model's unconstrained `@Data` toString is the enabler.
**Evidence:**
```java
// ImpactController.java line 153
logger.info("Start saveImpactData."  + " : " + gson.toJson(impactList));
// gson.toJson(impactList) serialises all Impact fields including mac_address
// at INFO level — visible in production logs
```

---

**B18-6** — INFO
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/GPSList.java:12`, `src/main/java/com/journaldev/spring/jdbc/model/GPS.java` (supporting context)
**Description:** `GPSList` wraps `GPS` objects that carry `longitude`, `latitude`, `gps_time`, `current_location`, `unit_id` (internal DB primary key), and `unit_name`. No field carries `@JsonIgnore`. The internal `unit_id` (database primary key) is exposed in GPS API responses. Exposing internal integer primary keys in API responses enables enumeration attacks — a caller can infer the range and density of `unit_id` values in the database. This is heightened because GPS data reveals physical asset location.
**Evidence:**
```java
// GPS.java — all fields public via getters, no @JsonIgnore:
private int id;
private int unit_id;      // internal DB PK exposed in API response
private Float longitude;
private Float latitude;
private String gps_time;
private boolean current_location;
private String unit_name;

// GPSList.java line 12
List<GPS> gpsList = new ArrayList<GPS>();  // wraps GPS with all fields
```

---

## Summary Table

| Finding | Severity | Section | Description |
|---------|----------|---------|-------------|
| B18-1   | MEDIUM   | 3 — Input Validation | No JSR-303 constraints on any Impact field; no @Valid at controller boundary |
| B18-2   | INFO     | 5 — Data Exposure | Impact model missing operator identity, unit ID, site ID, and severity classification fields |
| B18-3   | LOW      | 5 — Data Exposure | mac_address has no @JsonIgnore; will be serialised in any Impact response body |
| B18-4   | LOW      | 5 — Data Exposure | ImpactList.impactList and GPSList.gpsList are package-private, not private |
| B18-5   | LOW      | 5 — Data Exposure (Logging) | @Data toString includes mac_address; ImpactController logs full ImpactList at INFO level |
| B18-6   | INFO     | 5 — Data Exposure | GPS.unit_id (internal DB PK) exposed via GPSList with no @JsonIgnore |
