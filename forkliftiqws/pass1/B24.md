# Pass 1 Security Review — Agent B24
**Date:** 2026-02-27
**Repo:** forkliftiqws
**Branch:** master
**Assigned files:**
- `src/main/java/com/journaldev/spring/jdbc/model/Types.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Usage.java`
- `src/main/java/com/journaldev/spring/jdbc/model/User.java`
- `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java`

**Supporting file read (referenced type):**
- `src/main/java/com/journaldev/spring/jdbc/model/Roles.java`

---

## STEP 3 — Reading Evidence

---

### `com.journaldev.spring.jdbc.model.Types`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Types.java`

**Class-level annotations:** none

**Interfaces implemented / classes extended:**
- implements `java.io.Serializable`

**Fields:**

| Modifier | Type | Name |
|---|---|---|
| private static final | long | serialVersionUID = 1060134076107695415L |
| private | int | id |
| private | String | name |
| private | String | url |

**Public methods:**

| Return type | Method | Parameters | Line |
|---|---|---|---|
| int | getId() | (none) | 16 |
| void | setId(int id) | int id | 19 |
| String | getName() | (none) | 22 |
| void | setName(String name) | String name | 25 |
| String | getUrl() | (none) | 28 |
| void | setUrl(String url) | String url | 31 |

**Method-level annotations:** none on any method.

---

### `com.journaldev.spring.jdbc.model.Usage`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Usage.java`

**Class-level annotations:** none

**Interfaces implemented / classes extended:**
- implements `java.io.Serializable`

**Fields:**

| Modifier | Type | Name |
|---|---|---|
| private static final | long | serialVersionUID = -2424248938396693587L |
| private | String | time |
| private | BigDecimal | usage = new BigDecimal(0) |

**Public methods:**

| Return type | Method | Parameters | Line |
|---|---|---|---|
| String | getTime() | (none) | 16 |
| void | setTime(String time) | String time | 19 |
| BigDecimal | getUsage() | (none) | 22 |
| void | setUsage(BigDecimal usage) | BigDecimal usage | 25 |

**Method-level annotations:** none on any method.

---

### `com.journaldev.spring.jdbc.model.User`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/User.java`

**Class-level annotations:**
- `@Data` (Lombok — generates getters, setters, equals, hashCode, toString, requiredArgsConstructor)
- `@NoArgsConstructor` (Lombok)
- `@EqualsAndHashCode(onlyExplicitlyIncluded = true)`
- `@ToString(onlyExplicitlyIncluded = true)`

**Interfaces implemented / classes extended:**
- implements `java.io.Serializable`
- No Spring Security interface (e.g., `UserDetails`) implemented

**Fields:**

| Modifier | Type | Name | Field-level annotations |
|---|---|---|---|
| private static final | long | serialVersionUID = 2514353078919159376L | none |
| private | Long | id | none |
| private | String | name | `@ToString.Include` |
| private | String | email | `@EqualsAndHashCode.Include`, `@ToString.Include` |
| private | String | password | none |
| private | boolean | active | `@ToString.Include` |
| private | Set\<Roles\> | roles = new HashSet<>() | none |

**Public methods** (generated by `@Data` unless otherwise noted; all Lombok-generated unless marked):

| Return type | Method | Parameters | Line | Notes |
|---|---|---|---|---|
| Long | getId() | (none) | Lombok-generated | |
| void | setId(Long id) | Long id | Lombok-generated | |
| String | getName() | (none) | Lombok-generated | |
| void | setName(String name) | String name | Lombok-generated | |
| String | getEmail() | (none) | Lombok-generated | |
| void | setEmail(String email) | String email | Lombok-generated | |
| String | getPassword() | (none) | Lombok-generated | |
| void | setPassword(String password) | String password | Lombok-generated | |
| boolean | isActive() | (none) | Lombok-generated | |
| void | setActive(boolean active) | boolean active | Lombok-generated | |
| Set\<Roles\> | getRoles() | (none) | Lombok-generated | |
| void | setRoles(Set\<Roles\> roles) | Set\<Roles\> roles | Lombok-generated | |
| void | addRoles(Roles role) | Roles role | 41 | explicit |

**Constructor:**
- `@Builder` private User(Long id, String name, String email, String password, boolean active) — line 33, private

**No Jackson annotations present on any field or at class level.**

---

### `com.journaldev.spring.jdbc.model.UserResponse`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java`

**Class-level annotations:**
- `@Data` (Lombok)
- `@NoArgsConstructor` (Lombok)
- `@JsonInclude(JsonInclude.Include.NON_NULL)`

**Interfaces implemented / classes extended:**
- implements `java.io.Serializable`

**Fields:**

| Modifier | Type | Name | Field-level annotations |
|---|---|---|---|
| private static final | long | serialVersionUID = 894041507646078302L | none |
| private | String | username | none |
| private | String | email | none |
| private | String | userCreateDate | none |
| private | String | userStatus | none |
| private | String | lastModifiedDate | none |
| private | String | name | none |
| private | String | lastname | none |
| private | String | phoneNumber | none |

**Public methods** (all Lombok-generated by `@Data`):

| Return type | Method | Parameters |
|---|---|---|
| String | getUsername() | (none) |
| void | setUsername(String username) | String username |
| String | getEmail() | (none) |
| void | setEmail(String email) | String email |
| String | getUserCreateDate() | (none) |
| void | setUserCreateDate(String userCreateDate) | String userCreateDate |
| String | getUserStatus() | (none) |
| void | setUserStatus(String userStatus) | String userStatus |
| String | getLastModifiedDate() | (none) |
| void | setLastModifiedDate(String lastModifiedDate) | String lastModifiedDate |
| String | getName() | (none) |
| void | setName(String name) | String name |
| String | getLastname() | (none) |
| void | setLastname(String lastname) | String lastname |
| String | getPhoneNumber() | (none) |
| void | setPhoneNumber(String phoneNumber) | String phoneNumber |

**No Jackson `@JsonIgnore` annotations present on any field.**

---

### Supporting: `com.journaldev.spring.jdbc.model.Roles` (referenced by User)

**Class-level annotations:** `@Data`, `@NoArgsConstructor`

**Interfaces implemented:** `java.io.Serializable`

**Fields:** `Long id`, `String name`, `String authority`, `String description`

**Nested enum:** `RoleId` with single value `ROLE_COMPANY_GROUP`

---

## STEP 4 — Findings Against Checklist

---

### Section 1 — Secrets and Configuration

**Types.java:** No credentials, connection strings, or hardcoded secrets. CLEAR.
**Usage.java:** No credentials or secrets. CLEAR.
**User.java:** No hardcoded credentials. CLEAR.
**UserResponse.java:** No hardcoded credentials. CLEAR.

---

### Section 2 — Authentication and Authorization

**User.java does not implement `UserDetails` or any Spring Security interface.** This is informational — the auth context confirms Cognito JWT is used rather than Spring Security's UserDetails-based mechanism. However, `User` carries a `password` field, which is concerning given Cognito handles authentication externally (see Section 5). CLEAR for Section 2 mechanics; the password field concern is raised under Section 5.

**UserResponse.java:** Does not implement any security interface. No auth logic present. CLEAR.

**Types.java / Usage.java:** No auth logic. N/A.

---

### Section 3 — Input Validation and Injection (Deserialization focus for model classes)

**User.java:**
- No `@JsonTypeInfo` annotation present at class or field level.
- No `@JsonSubTypes` annotation.
- No `ObjectInputStream.readObject()` usage.
- Implements `Serializable`. The `serialVersionUID` is explicitly declared (2514353078919159376L), which is good practice. However, because the class is `Serializable` and has no `readObject()` override with validation, any deserialization path (e.g., Java object serialization over HTTP, cached sessions) would accept all fields including `password` and `roles` without constraint. This is a low-level concern given the Cognito JWT context but is noted.
- No `@Valid` constraints (`@NotNull`, `@Size`, `@Pattern`, etc.) on any field.

**UserResponse.java:** No `@JsonTypeInfo`. No deserialization risk beyond standard JSON. No input constraints. CLEAR for deserialization.

**Types.java / Usage.java:** No `@JsonTypeInfo`. Implement `Serializable`, explicit `serialVersionUID`. No deserialization risk identified. CLEAR.

---

### Section 4 — Session and CSRF

N/A for model classes. No session, CSRF, CORS, or cookie configuration present in any of the four files.

---

### Section 5 — Data Exposure

This is the primary focus section for these model files.

#### User.java — HIGH PRIORITY

The `User` class is the internal domain user model. It contains the following fields that are exposed via Lombok-generated `@Data` getters with **no Jackson annotations restricting serialization**:

1. `Long id` — internal database primary key. No `@JsonIgnore`.
2. `String password` — plaintext or hashed password field. No `@JsonIgnore`. **This is the most critical finding.**
3. `Set<Roles> roles` — full role objects including `id`, `name`, `authority`, `description`. No `@JsonIgnore`.

Because `@Data` generates public getters for every field, and there is no `@JsonIgnore` or `@JsonProperty(access = JsonProperty.Access.WRITE_ONLY)` on `password`, if this `User` object is ever serialized directly to a JSON API response, the password value will be included in the response body. In a Cognito-managed system, the presence of a `password` field on the domain user model at all is architecturally anomalous, but its lack of serialization protection is independently dangerous.

The `id` field (database primary key) is also returned without protection. Best practice is to use an opaque identifier in API responses; exposing the raw numeric database ID enables enumeration attacks.

The `roles` collection will serialize the full `Roles` objects — including internal `id`, `name`, `authority`, and `description` fields — if `User` is returned directly. Role enumeration assists privilege escalation attempts.

#### UserResponse.java

`UserResponse` appears to be a purpose-built DTO for API responses, sourced from Cognito user attributes. Fields present:
- `username` — Cognito username identifier
- `email`
- `userCreateDate` — account creation timestamp
- `userStatus` — Cognito account status string (e.g., `CONFIRMED`, `FORCE_CHANGE_PASSWORD`, `UNCONFIRMED`)
- `lastModifiedDate`
- `name`
- `lastname`
- `phoneNumber`

The `password` field is correctly absent from `UserResponse`. This is the right design intent.

**However, two concerns exist:**

1. `userStatus` — Exposing the raw Cognito `userStatus` string to API consumers reveals internal account lifecycle state. A value of `FORCE_CHANGE_PASSWORD` discloses that the account has a temporary password set and has never been used, which is reconnaissance-useful for targeting. A value of `UNCONFIRMED` discloses an unverified account. This field should either be omitted from the response or mapped to a sanitized application-level status.

2. `phoneNumber` — Phone numbers are PII and in many jurisdictions (GDPR, PIPEDA) require explicit handling controls. Returning phone numbers in API responses where the caller may not be the account owner (e.g., an admin listing users) may violate data minimisation requirements. No `@JsonIgnore` is present; exposure depends entirely on whether the calling endpoint is properly access-controlled.

**User.java vs. UserResponse.java — subset assessment:**
`UserResponse` correctly excludes `password`, `id` (database key), and `roles`. This indicates intent to use `UserResponse` as the safe external DTO. The risk is that `User` itself has no serialization protection, so if any endpoint accidentally returns a `User` instead of a `UserResponse`, all sensitive fields are exposed.

---

### Section 6 — Dependencies

N/A for model source files.

---

### Section 7 — Build and CI

N/A for model source files.

---

## STEP 5 — Findings Summary

---

**B24-1** — CRITICAL
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/User.java:25`
**Description:** The `password` field on the `User` domain model has no `@JsonIgnore` annotation and no `@JsonProperty(access = WRITE_ONLY)` protection. Lombok `@Data` generates a public `getPassword()` getter. If any controller or DAO returns a `User` object directly (or wraps it in a response without explicit field filtering), the password value will be serialized into the JSON response body and transmitted to the client. In a Cognito-managed environment, the existence of a local `password` field is architecturally suspect; the absence of serialization protection is independently a critical defect.
**Evidence:**
```java
// User.java line 25 — no @JsonIgnore, no @JsonProperty(access = WRITE_ONLY)
private String password;

// Lombok @Data at line 9 generates:
// public String getPassword() { return password; }
```

---

**B24-2** — HIGH
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/User.java:17`
**Description:** The internal database primary key `id` (type `Long`) is exposed via a Lombok-generated `getID()` getter with no `@JsonIgnore`. If `User` is serialized to a response, the raw numeric database ID is returned, enabling sequential/enumeration attacks against user records. An opaque external identifier should be used in API responses.
**Evidence:**
```java
// User.java line 17 — no @JsonIgnore
private Long id;
```

---

**B24-3** — HIGH
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/User.java:30`
**Description:** The `roles` field (type `Set<Roles>`) is exposed via a Lombok-generated `getRoles()` getter with no `@JsonIgnore`. Each `Roles` object contains `id`, `name`, `authority`, and `description`. If `User` is serialized to a response, the complete internal role structure is returned to the client. Role `authority` strings are particularly sensitive as they reveal the exact privilege strings the application checks against, assisting privilege escalation or bypass attempts.
**Evidence:**
```java
// User.java line 30 — no @JsonIgnore
private Set<Roles> roles = new HashSet<>();

// Roles.java fields that would be serialized:
private Long id;
private String name;
private String authority;
private String description;
```

---

**B24-4** — MEDIUM
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java:23`
**Description:** `UserResponse` includes `userStatus`, which will carry raw Cognito account lifecycle state strings such as `FORCE_CHANGE_PASSWORD`, `UNCONFIRMED`, or `COMPROMISED`. These values disclose internal account state to API consumers and are useful for targeting accounts in a weakened state. The field has no `@JsonIgnore` and no mapping to a sanitised application-level value.
**Evidence:**
```java
// UserResponse.java line 23
private String userStatus;
```

---

**B24-5** — MEDIUM
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java:27`
**Description:** `UserResponse` exposes `phoneNumber` (PII) with no access control at the model layer and no `@JsonIgnore`. Phone numbers require data minimisation controls under GDPR and PIPEDA. Whether this field should be returned depends on the caller's relationship to the subject account, which is a controller-layer concern, but the model provides no protection if controller-level checks are absent or misconfigured.
**Evidence:**
```java
// UserResponse.java line 27
private String phoneNumber;
```

---

**B24-6** — MEDIUM
**Section:** 3 — Input Validation and Injection (Deserialization)
**File:** `src/main/java/com/journaldev/spring/jdbc/model/User.java:13`
**Description:** `User` implements `Serializable` with no `readObject()` override performing field validation. All fields — including `password`, `roles`, and `id` — are accepted unconditionally during Java object deserialization. If any deserialization path accepts a `User` object from an untrusted source (e.g., cached session data, inter-service messaging), attacker-controlled values for `password`, `id`, or `roles` could be injected. No field-level constraints (`@NotNull`, `@Size`, `@Pattern`) are present. This finding is conditional on whether a Java serialization deserialization path exists in the application, but the model provides zero defence in depth.
**Evidence:**
```java
// User.java lines 9-13
@Data
@NoArgsConstructor
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
@ToString(onlyExplicitlyIncluded = true)
public class User implements Serializable {
    private static final long serialVersionUID = 2514353078919159376L;
    // No readObject() override; no field validation constraints
    private String password;
    private Set<Roles> roles = new HashSet<>();
```

---

**B24-7** — LOW
**Section:** 2 — Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/model/User.java:13`
**Description:** `User` does not implement `org.springframework.security.core.userdetails.UserDetails` or any Spring Security interface. This is consistent with the stated Cognito JWT auth model. However, the presence of a `password` field (B24-1) and a `roles` field on this model, combined with the lack of Spring Security integration, creates an ambiguity: it is unclear whether this `User` model is ever used in a local authentication path or only as a data carrier. If a local authentication path exists that consults `User.password`, that path must be reviewed separately. This finding flags the ambiguity for follow-on review.
**Evidence:**
```java
// User.java — no implements clause referencing UserDetails or GrantedAuthority
public class User implements Serializable {
    private String password;   // line 25
    private Set<Roles> roles;  // line 30
```

---

**B24-8** — INFO
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java:13`
**Description:** `UserResponse` is correctly designed as a safe external DTO: it omits `password`, the database `id`, and `roles`. `@JsonInclude(NON_NULL)` prevents null fields from appearing in responses. This is the correct pattern. The risk is architectural rather than a defect in `UserResponse` itself — if any code path returns `User` instead of `UserResponse`, all protections are bypassed. Recommend a code-wide search for controllers returning `User` directly (outside the scope of this model-layer review).
**Evidence:**
```java
// UserResponse.java — safe fields only, no password, no id, no roles
@JsonInclude(JsonInclude.Include.NON_NULL)
public class UserResponse implements Serializable {
    private String username;
    private String email;
    private String userCreateDate;
    private String userStatus;
    private String lastModifiedDate;
    private String name;
    private String lastname;
    private String phoneNumber;
}
```

---

## Checklist Section Coverage Summary

| Section | Status |
|---|---|
| 1 — Secrets and Configuration | CLEAR (model files contain no secrets) |
| 2 — Authentication and Authorization | Finding B24-7 (INFO — ambiguity re: local auth path) |
| 3 — Input Validation and Injection | Finding B24-6 (MEDIUM — Serializable without readObject validation) |
| 4 — Session and CSRF | N/A (model classes) |
| 5 — Data Exposure | Findings B24-1 (CRITICAL), B24-2 (HIGH), B24-3 (HIGH), B24-4 (MEDIUM), B24-5 (MEDIUM), B24-8 (INFO) |
| 6 — Dependencies | N/A (model classes) |
| 7 — Build and CI | N/A (model classes) |

---

*Report produced by Agent B24. Pass 1. No source files were modified.*
