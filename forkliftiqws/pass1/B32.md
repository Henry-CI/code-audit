# Pass 1 Security Review — Agent B32
**Date:** 2026-02-27
**Branch:** master
**Assigned files:**
- `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java`
- `src/main/java/com/journaldev/spring/jdbc/util/Util.java`

**Supporting file read (referenced constants):**
- `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java`

---

## Reading Evidence

### SendMessage.java

**Fully qualified class name:** `com.journaldev.spring.jdbc.util.SendMessage`

**Class-level annotations:** None

**Interfaces implemented / classes extended:** None

**Fields:**
- `private static final Logger logger` — SLF4J logger
- `Connection conn` — package-private (no explicit modifier)
- `Statement stmt` — package-private
- `ResultSet rset` — package-private
- `String query` — package-private

**Public methods:**

| Return type | Method | Parameters | Line |
|---|---|---|---|
| `void` | `init` | `String msg, String mobile_no` | 36 |

**Private methods:**

| Return type | Method | Parameters | Line |
|---|---|---|---|
| `void` | `send_sms_message` | `String msg, String mobile_no` | 90 |
| `String[]` | `readLines` | `String url` | 154 |

**Key observations:**
- `send_sms_message` constructs SMS gateway URLs using `RuntimeConfig.LOCATION`, `RuntimeConfig.USERNAME`, `RuntimeConfig.PASSWORD`, `RuntimeConfig.API_ID`, `RuntimeConfig.SMSFROM`, and a session ID returned by the auth call.
- `readLines` opens a `java.net.URL` connection and reads response lines using the deprecated `DataInputStream.readLine()`.
- `mobile_no` is split on `;` and each element is passed directly into the URL as the `&to=` parameter without validation.
- The message body is URL-encoded via `URLEncoder.encode(msg, "UTF-8")` before insertion into the URL.
- Credentials (`USERNAME`, `PASSWORD`, `API_ID`) are resolved at call time from `RuntimeConfig` static fields.

---

### Util.java

**Fully qualified class name:** `com.journaldev.spring.jdbc.util.Util`

**Class-level annotations:** None

**Interfaces implemented / classes extended:** None

**Fields:**
- `private static final Logger logger` — SLF4J logger

**Public methods:**

| Return type | Method | Parameters | Line |
|---|---|---|---|
| `static String` | `generateRadomName` | none | 27 |
| `static boolean` | `sendMail` | `String subject, String mBody, String rName, String rEmail, String sName, String sEmail, String attachment, String attachmentName` | 36 |

**Key observations:**
- `generateRadomName` combines a timestamp with a UUID — no user input involved.
- `sendMail` hardcodes SMTP host (`email-smtp.us-east-1.amazonaws.com`), port (`465`), and — critically — AWS SES SMTP credentials inline in a `PasswordAuthentication` anonymous class (line 66).
- The `attachment` parameter is passed directly to `FileDataSource(attachment)` (line 100) without any path validation or canonicalization.
- The `rEmail` parameter is passed to `InternetAddress.parse(rEmail, false)` (line 79) without sanitisation.
- Exceptions in `Transport.send()` and `message.setRecipients()` are silently swallowed via `e.printStackTrace()` — no propagation to caller.
- Method always returns `true` regardless of whether sending succeeded or failed.

---

### RuntimeConfig.java (supporting read)

**Fully qualified class name:** `com.journaldev.spring.jdbc.controller.RuntimeConfig`

**All fields are `public static String`:**

| Name | Value |
|---|---|
| `GCMSERVER` | `https://gcm-http.googleapis.com/gcm/send` |
| `GCMKEY` | `key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs` |
| `production_database` | `jdbc/PreStartDB` |
| `LOCATION` | `https://api.clickatell.com` |
| `USERNAME` | `ciclickatell` |
| `PASSWORD` | `OVLOaICXccaNUS` |
| `API_ID` | `3629505` |
| `SMSFROM` | `13234862361` |
| `APIURL` | `http://ec2-52-5-205-104.compute-1.amazonaws.com/api/export/pdf/` |
| `PDF_FOLDER` | `temp/` |
| `mailFrom` | `info@forkliftiq360.com` |

---

## Findings

---

**B32-1** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/util/Util.java:66`
**Description:** AWS SES SMTP credentials are hardcoded directly in source code as string literals inside a `PasswordAuthentication` anonymous class. The username `AKIA**REDACTED**` is an AWS IAM access key ID (AKIA prefix confirms this is a long-term IAM credential). The corresponding secret `****REDACTED****` is a 40-character AWS secret access key. These credentials are committed to version control and grant the holder the ability to send email via SES on behalf of this AWS account, and potentially reflect broader IAM permissions depending on the policy attached to this key.
**Evidence:**
```java
return new PasswordAuthentication("AKIA**REDACTED**", "****REDACTED****");
```

---

**B32-2** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:14`
**Description:** A Google Cloud Messaging (GCM) / Firebase Cloud Messaging (FCM) server API key is hardcoded in source as a `public static` field. The value `AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs` is a Google API key. Any party with read access to this repository can use this key to send push notifications to all registered devices in the associated Firebase project, potentially enabling large-scale notification spam or targeted social engineering of forklift operators.
**Evidence:**
```java
public static String GCMKEY = "key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs";
```

---

**B32-3** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:18-21`
**Description:** Clickatell SMS gateway credentials — username, cleartext password, and API ID — are hardcoded as `public static` fields in source code. Any party with read access to the repository can authenticate to the Clickatell API and send SMS messages billed to the organisation's account. This also enables the interception or manipulation of SMS notifications sent to forklift operators, which are safety-critical in a forklift management context.
**Evidence:**
```java
public static String USERNAME = "ciclickatell";
public static String PASSWORD = "OVLOaICXccaNUS";
public static String API_ID = "3629505";
```

---

**B32-4** — HIGH
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java:112`
**Description:** The `mobile_no` parameter is split on `;` and each element is inserted directly into the Clickatell auth URL as-is (in the `&to=` position of the send URL at line 123/127). Although `msg` is URL-encoded, `mobile_no` (and each element of `array_mobile_no`) is not encoded before being embedded in the URL. A caller supplying a crafted mobile number containing `&` or other URL metacharacters could inject additional query parameters into the Clickatell API request (HTTP parameter injection). Depending on how the gateway handles parameter precedence, this could redirect the SMS to an arbitrary recipient, change the sender ID, or alter the message.
**Evidence:**
```java
url = RuntimeConfig.LOCATION + "/http/sendmsg?session_id="+sess_id+"&to="+to+"&text="+text+"&concat=2"+"&mo=1&from="+RuntimeConfig.SMSFROM;
// 'to' is array_mobile_no[i] — no URL encoding applied
```

---

**B32-5** — HIGH
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java:154-168`
**Description:** The `readLines` method constructs a `java.net.URL` from a fully-assembled string and calls `u.openStream()`. The URL is built using `RuntimeConfig.LOCATION` which is a static field, not a validated allow-list. Although `LOCATION` is currently hardcoded to `https://api.clickatell.com`, the field is `public static` and non-final — it can be modified at runtime by any code in the application. If an attacker can influence `RuntimeConfig.LOCATION` (e.g., via a separate injection in a config-update endpoint), this becomes a full SSRF primitive. Additionally, `DataInputStream.readLine()` is deprecated and does not correctly handle multi-byte character encodings.
**Evidence:**
```java
public static String LOCATION = "https://api.clickatell.com";  // non-final, mutable
// ...
u = new URL(url);
is = u.openStream();  // no URL scheme validation, no hostname allow-list
```

---

**B32-6** — HIGH
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/util/Util.java:100`
**Description:** The `attachment` parameter of `sendMail` is passed directly to `FileDataSource` without any path validation, canonicalization, or allow-list check. If a caller supplies a user-controlled value for `attachment`, an attacker could cause the application to attach arbitrary server-side files to outbound emails (path traversal / local file read). In a forklift management system this could expose operator records, telemetry exports, database dumps, or configuration files.
**Evidence:**
```java
FileDataSource source = new FileDataSource(attachment);
messageBodyPart.setDataHandler(new DataHandler(source));
messageBodyPart.setFileName(attachmentName);
```

---

**B32-7** — HIGH
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:30`
**Description:** An internal AWS EC2 instance hostname with a hardcoded public IP address is committed to source. The URL `http://ec2-52-5-205-104.compute-1.amazonaws.com/api/export/pdf/` reveals infrastructure topology (AWS region us-east-1, specific instance). Traffic to this endpoint is over plain HTTP (not HTTPS), exposing PDF report content and any request parameters in transit. The IP `52.5.205.104` is also directly enumerable.
**Evidence:**
```java
public static String APIURL = "http://ec2-52-5-205-104.compute-1.amazonaws.com/api/export/pdf/";
```

---

**B32-8** — MEDIUM
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java:48`
**Description:** The `init` method logs the full mobile number and the complete SMS message body at `INFO` level before sending. In a forklift management system, SMS messages to operators may contain safety event details, operator names, incident descriptions, or forklift identifiers. Logging mobile numbers constitutes logging PII. Both values will appear in production log files at INFO level, which is typically retained and aggregated.
**Evidence:**
```java
logger.info("Start sending short messages to " +mobile_no + "; msg: " + msg);
```

---

**B32-9** — MEDIUM
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java:134,143`
**Description:** After sending, the full destination mobile number is logged at `INFO` level on successful send (line 134). Authentication failure responses from the Clickatell API are logged verbatim (line 143), which may include session tokens or error detail containing account information.
**Evidence:**
```java
logger.info("SMS has been sent successfully to "+array_mobile_no[i]+".\n");
// ...
logger.info("Authentication failure: "+ array_ret[0]+"\n");
```

---

**B32-10** — MEDIUM
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/util/Util.java:79`
**Description:** The `rEmail` parameter is passed to `InternetAddress.parse(rEmail, false)` with the `strict` flag set to `false`. The non-strict mode is more permissive and may accept malformed addresses. While JavaMail's `InternetAddress` is not vulnerable to SMTP header injection in the same way as string concatenation, passing an unvalidated email address from a caller without any format check (`@NotNull`, `@Email`, regex) is a missing validation control. If `sendMail` is called with user-supplied email input (e.g., from a registration or notification flow), a malformed address could cause a silent send failure — particularly since the exception is swallowed at line 80-82.
**Evidence:**
```java
message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(rEmail, false));
// ...
} catch (Exception e) {
    System.out.println("Message Recipents Exception :" + e);
}
```

---

**B32-11** — MEDIUM
**Section:** 4. Session and CSRF
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:13-21`
**Description:** All credential and configuration fields in `RuntimeConfig` are declared `public static` (non-`final`). This means any class in the application can mutate these values at runtime — including the GCM key, Clickatell password, SMTP credentials, and the SMS gateway base URL. There is no immutability guarantee. A vulnerability in any part of the application that allows code execution or reflection could silently redirect messaging to an attacker-controlled endpoint.
**Evidence:**
```java
public static String GCMKEY = "key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs";
public static String PASSWORD = "OVLOaICXccaNUS";
public static String LOCATION = "https://api.clickatell.com";
// all non-final, mutable
```

---

**B32-12** — LOW
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java:53-55` and `Util.java:113-114,116-118`
**Description:** Both classes use `e.printStackTrace()` and `System.out.println()` for exception reporting rather than the SLF4J logger. Stack traces written to stderr/stdout may be captured differently from structured log output, may bypass log-level filtering, and will contain internal class names, method names, and line numbers. In a production environment this information aids attacker reconnaissance if stderr is exposed (e.g., via a misconfigured Tomcat valve or log aggregation that includes stdout).
**Evidence:**
```java
// SendMessage.java:53-55
} catch(Exception e) {
    e.printStackTrace();
}
// Util.java:113-114
} catch (Exception e) {
    e.printStackTrace();
}
// Util.java:116-118
} catch (Throwable t) {
    t.printStackTrace();
}
```

---

**B32-13** — LOW
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java:36`
**Description:** The `init` method accepts `mobile_no` as a plain `String` with no validation that the caller is authorised to trigger SMS delivery to that number. There is no authentication context check, no rate limiting, and no verification that the mobile number belongs to an operator in the caller's organisation. If `init` is reachable through any authenticated but insufficiently authorised code path, an attacker could trigger SMS messages to arbitrary phone numbers billed to the organisation's Clickatell account.
**Evidence:**
```java
public void init(String msg,String mobile_no) {
    // no caller identity check, no number validation, no rate limit
```

---

**B32-14** — INFO
**Section:** 6. Dependencies
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java:163`
**Description:** `DataInputStream.readLine()` has been deprecated since Java 1.1 due to incorrect multi-byte character handling. It is used here to read HTTP response lines from the Clickatell API. While not a direct security vulnerability, use of a deprecated I/O method indicates the code has not been maintained and may produce incorrect behaviour with non-ASCII response content (e.g., error messages containing accented characters), potentially causing silent parse failures in the session ID extraction logic.
**Evidence:**
```java
dis = new DataInputStream(new BufferedInputStream(is));
while ((s = dis.readLine()) != null) {
```

---

## Checklist Section Summary

| Section | Status |
|---|---|
| 1. Secrets and Configuration | FINDINGS: B32-1 (AWS SES key in Util.java), B32-2 (GCM/FCM key in RuntimeConfig), B32-3 (Clickatell credentials in RuntimeConfig), B32-7 (EC2 HTTP URL) |
| 2. Authentication and Authorization | FINDING: B32-13 (no authorisation check on SMS trigger); remainder N/A for these files (no Spring Security config, no endpoints) |
| 3. Input Validation and Injection | FINDINGS: B32-4 (HTTP parameter injection via mobile_no), B32-5 (SSRF potential via mutable LOCATION), B32-6 (path traversal via attachment param in sendMail) |
| 4. Session and CSRF | FINDING: B32-11 (mutable public static credential fields); no session/cookie config in these files |
| 5. Data Exposure | FINDINGS: B32-8, B32-9 (PII in logs), B32-12 (stack traces to stderr) |
| 6. Dependencies | FINDING: B32-14 (deprecated DataInputStream.readLine); pom.xml not in assigned scope |
| 7. Build and CI | N/A — no build configuration in assigned files |
