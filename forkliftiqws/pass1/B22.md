# Pass 1 Security Review — Agent B22
**Repo:** forkliftiqws
**Branch:** master
**Date:** 2026-02-27
**Auditor:** B22
**Files reviewed:** ResponseWrapper.java, Result.java, Results.java
**Supporting context reads:** ErrorMessage.java, AuthenticationResponse.java, RuntimeConfig.java (partial), ImpactController.java (partial)

---

## Reading Evidence

### 1. `com.journaldev.spring.jdbc.model.ResponseWrapper`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/ResponseWrapper.java`

**Interfaces implemented / classes extended:** `java.io.Serializable`

**Class-level annotations:**
- `@Data` (Lombok — generates getters, setters, equals, hashCode, toString for all fields)
- `@NoArgsConstructor` (Lombok — generates no-arg constructor)
- `@JsonInclude(JsonInclude.Include.NON_NULL)` (omit null fields from JSON serialisation)

**Fields:**

| Access    | Type                | Name       | Line |
|-----------|---------------------|------------|------|
| private   | `Object`            | `data`     | 18   |
| private   | `Object`            | `metadata` | 19   |
| private   | `List<ErrorMessage>`| `errors`   | 20   |
| private static final | `long` | `serialVersionUID` | 16 |

**Public methods (Lombok-generated, no explicit source lines):**
- `Object getData()` — getter for `data`
- `void setData(Object data)` — setter for `data`
- `Object getMetadata()` — getter for `metadata`
- `void setMetadata(Object metadata)` — setter for `metadata`
- `List<ErrorMessage> getErrors()` — getter for `errors`
- `void setErrors(List<ErrorMessage> errors)` — setter for `errors`
- `boolean equals(Object o)`, `int hashCode()`, `String toString()` — Lombok `@Data`

No method-level annotations present (all methods are Lombok-generated).

---

### 2. `com.journaldev.spring.jdbc.model.Result`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Result.java`

**Interfaces implemented / classes extended:** `java.io.Serializable`

**Class-level annotations:** None

**Fields:**

| Access  | Type                | Name          | Line |
|---------|---------------------|---------------|------|
| private | `int`               | `id`          | 13   |
| private | `String`            | `comment`     | 14   |
| private | `String`            | `start_time`  | 15   |
| private | `String`            | `finish_time` | 16   |
| private | `int`               | `session_id`  | 17   |
| private | `ArrayList<Answers>`| `arrAnswers`  | 18   |
| private static final | `long` | `serialVersionUID` | 11 |

**Public methods:**

| Return type           | Method signature                              | Line |
|-----------------------|-----------------------------------------------|------|
| `int`                 | `getId()`                                     | 19   |
| `void`                | `setId(int id)`                               | 22   |
| `String`              | `getComment()`                                | 26   |
| `void`                | `setComment(String comment)`                  | 29   |
| `String`              | `getStart_time()`                             | 31   |
| `void`                | `setStart_time(String start_time)`            | 34   |
| `String`              | `getFinish_time()`                            | 37   |
| `void`                | `setFinish_time(String finish_time)`          | 40   |
| `int`                 | `getSession_id()`                             | 43   |
| `void`                | `setSession_id(int session_id)`               | 46   |
| `ArrayList<Answers>`  | `getArrAnswers()`                             | 50   |
| `void`                | `setArrAnswers(ArrayList<Answers> arrAnswers)`| 53   |

No method-level annotations present.

---

### 3. `com.journaldev.spring.jdbc.model.Results`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Results.java`

**Interfaces implemented / classes extended:** `java.io.Serializable`

**Class-level annotations:** None

**Fields:**

| Access  | Type     | Name           | Line |
|---------|----------|----------------|------|
| private | `String` | `message_id`   | 13   |
| private | `String` | `error`        | 14   |
| private static final | `long` | `serialVersionUID` | 12 |

**Public methods:**

| Return type | Method signature                      | Line |
|-------------|---------------------------------------|------|
| `String`    | `getMessage_id()`                     | 16   |
| `void`      | `setMessage_id(String message_id)`    | 19   |
| `String`    | `getError()`                          | 23   |
| `void`      | `setError(String error)`              | 27   |

No method-level annotations present.

---

### Supporting context: `com.journaldev.spring.jdbc.model.ErrorMessage`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/ErrorMessage.java`

**Interfaces implemented / classes extended:** `java.io.Serializable`

**Class-level annotations:** `@Data`, `@NoArgsConstructor`

**Fields:**

| Access  | Type     | Name      | Line |
|---------|----------|-----------|------|
| private | `String` | `message` | 16   |
| private | `String` | `code`    | 17   |
| private | `String` | `detail`  | 18   |

---

## Checklist Review

### Section 1 — Secrets and Configuration

Not directly applicable to these three model files themselves. However, during investigation of the broader usage context of `Results.error`, the file `RuntimeConfig.java` (referenced by every controller that uses `Results`) was read and contains material findings reported below.

**B22-1** — see finding below.

### Section 2 — Authentication and Authorization

CLEAR — These are plain model/DTO classes with no authentication or authorisation logic.

### Section 3 — Input Validation and Injection

**Deserialization:**

`ResponseWrapper.data` is typed as `java.lang.Object` (line 18) and `ResponseWrapper.metadata` is also typed as `java.lang.Object` (line 19). When Jackson deserialises JSON into these fields (e.g., via `@RequestBody ResponseWrapper`), the concrete type is unknown at compile time. If Jackson's global default typing (`ObjectMapper.enableDefaultTyping()` / `activateDefaultTyping()`) were enabled elsewhere in the application, these `Object` fields would be a polymorphic deserialization gadget vector. A search of the codebase found no `@JsonTypeInfo` annotation on these classes and no `ObjectMapper` configuration in the model package, so the risk is contingent on the application-level Jackson configuration (reviewed by other agents). No `@JsonTypeInfo` annotations are present on any of the three assigned classes.

**B22-2** — see finding below.

**SQL / command / path injection:** N/A — these are model classes with no query or I/O logic.

### Section 4 — Session and CSRF

N/A — model classes; no session, CSRF, CORS, or cookie configuration present.

### Section 5 — Data Exposure

**B22-3, B22-4, B22-5** — see findings below.

### Section 6 — Dependencies

N/A — model classes; no dependency management in these files.

### Section 7 — Build and CI

N/A — model classes; no build or CI configuration in these files.

---

## Findings

---

**B22-1** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:13-21` (read as supporting context — referenced by every controller using `Results`)
**Description:** `RuntimeConfig` is a plain Java class in source control that contains multiple hardcoded production credentials: a Google Cloud Messaging (GCM) server API key, a third-party SMS gateway username and password (Clickatell), and an SMS API ID. These values are committed to the repository and would be exposed to anyone with read access to the source. This is out-of-scope for the three assigned model files but is noted here because it was discovered while tracing how `Results` is populated by controllers, and it represents a critical finding that must not be missed.
**Evidence:**
```java
public static String GCMKEY = "key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs";
public static String USERNAME = "ciclickatell";
public static String PASSWORD = "OVLOaICXccaNUS";
public static String API_ID = "3629505";
```

---

**B22-2** — MEDIUM
**Section:** 3. Input Validation and Injection — Deserialization
**File:** `src/main/java/com/journaldev/spring/jdbc/model/ResponseWrapper.java:18-19`
**Description:** `ResponseWrapper.data` and `ResponseWrapper.metadata` are both declared as raw `java.lang.Object`. If this class is used as a `@RequestBody` parameter anywhere in the application (or if a future endpoint adds it), and if Jackson's global default typing is enabled at the `ObjectMapper` level, these fields become polymorphic deserialization sinks that could allow gadget-chain attacks (CVE-2017-7525 class of vulnerability). The risk is contingent on ObjectMapper configuration. Even without default typing, `Object` fields serialise to `{}` on deserialisation unless the caller supplies a type hint, making this a latent deserialization risk that should be made explicit with a concrete type or bounded wildcard.
**Evidence:**
```java
// ResponseWrapper.java lines 18-19
private Object data;
private Object metadata;
```

---

**B22-3** — HIGH
**Section:** 5. Data Exposure — Error responses
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ImpactController.java:189` (discovered while tracing `Results.setError()` call sites)
**Description:** `Results.error` (line 14 of `Results.java`) is serialised directly to the JSON API response body. At `ImpactController.java:189`, the raw `Exception.getMessage()` of an `IllegalArgumentException` is passed directly to `results.setError()`. The `IllegalArgumentException` messages are constructed from internal data including MAC addresses and timestamps (e.g., `"Unable to retrieve equipment for given " + impact.getMac_address()` at line 161 and `"Unable to save impact event " + impact.getMac_address() + " for " + impact.getImpact_time()` at line 172). This means internal data model details and hardware identifiers leak into API error responses. Depending on how exception messages are constructed deeper in the DAO layer, SQL error text or other internal details could also flow through this path.
**Evidence:**
```java
// ImpactController.java line 187-191
} catch(IllegalArgumentException e) {
    logger.error("Unable to record impact event", e);
    results.setError(e.getMessage());   // <-- raw exception message to API response
    results.setMessage_id(RuntimeConfig.MSGID_CODEERRORR);
    return new ResponseEntity(results, HttpStatus.BAD_REQUEST);
}

// IllegalArgumentException constructed at ImpactController.java lines 161-162:
throw new IllegalArgumentException("Unable to retrieve equipment for given " + impact.getMac_address());
// and lines 172-173:
throw new IllegalArgumentException("Unable to save impact event " + impact.getMac_address() + " for " + impact.getImpact_time());
```
```java
// Results.java lines 13-28 — the field that carries this to the wire:
private String error;
public String getError() { return error; }
public void setError(String error) { this.error = error; }
```

---

**B22-4** — MEDIUM
**Section:** 5. Data Exposure — Error responses
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Results.java:14` / `src/main/java/com/journaldev/spring/jdbc/model/ErrorMessage.java:18`
**Description:** `Results` exposes a `String error` field with no length constraint or sanitisation. `ErrorMessage` exposes a `String detail` field in addition to `message` and `code`. Neither class is annotated with `@JsonInclude(NON_NULL)`, meaning if these fields are ever populated with internal exception text, SQL error messages, or class names they will be serialised verbatim into API responses. There is no global exception handler (`@ControllerAdvice` / `@ExceptionHandler`) detected in the codebase that would intercept unhandled exceptions before they reach the client; unhandled Spring MVC exceptions may produce default error pages that expose stack traces depending on server and Spring Boot configuration.
**Evidence:**
```java
// Results.java — no @JsonInclude annotation on class
public class Results implements Serializable {
    private String error;   // line 14 — unbounded, unsanitised error string in API response
}

// ErrorMessage.java — no @JsonInclude annotation on class
public class ErrorMessage implements Serializable {
    private String message;  // line 16
    private String code;     // line 17
    private String detail;   // line 18 — "detail" field name suggests it may carry internal details
}
```

---

**B22-5** — LOW
**Section:** 5. Data Exposure — Serialisation of arbitrary types
**File:** `src/main/java/com/journaldev/spring/jdbc/model/ResponseWrapper.java:18-19`
**Description:** Because `ResponseWrapper.data` and `ResponseWrapper.metadata` are `java.lang.Object`, any object placed into these fields will be serialised in full by Jackson, including any fields on that object that are not explicitly excluded with `@JsonIgnore` or `@JsonInclude`. If a DAO entity or internal model (e.g., one containing a password hash, internal ID, or audit field) is passed directly to `data` without an intermediate DTO projection, sensitive fields will be included in the API response. The `@JsonInclude(NON_NULL)` on the outer `ResponseWrapper` does not protect against this — it only suppresses null fields on the wrapper itself.
**Evidence:**
```java
// ResponseWrapper.java lines 12-21
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ResponseWrapper implements Serializable {
    private Object data;      // line 18 — arbitrary object, serialised in full
    private Object metadata;  // line 19 — arbitrary object, serialised in full
    private List<ErrorMessage> errors;
}
```

---

## Summary Table

| ID    | Severity | Section                  | File (relative)                                               |
|-------|----------|--------------------------|---------------------------------------------------------------|
| B22-1 | CRITICAL | 1. Secrets and Config    | `src/.../controller/RuntimeConfig.java:13-21`                |
| B22-2 | MEDIUM   | 3. Deserialization       | `src/.../model/ResponseWrapper.java:18-19`                   |
| B22-3 | HIGH     | 5. Data Exposure         | `src/.../controller/ImpactController.java:189` / `Results.java:14` |
| B22-4 | MEDIUM   | 5. Data Exposure         | `src/.../model/Results.java:14` / `ErrorMessage.java:18`     |
| B22-5 | LOW      | 5. Data Exposure         | `src/.../model/ResponseWrapper.java:18-19`                   |
