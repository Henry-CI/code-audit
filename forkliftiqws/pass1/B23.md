# Pass 1 Security Review — Agent B23
**Repo:** forkliftiqws
**Branch:** master
**Date:** 2026-02-27
**Auditor:** B23
**Scope:** model classes — Roles.java, Services.java, Sessions.java

---

## Reading Evidence

### 1. `com.journaldev.spring.jdbc.model.Roles`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Roles.java`

**Annotations on class:**
- `@Data` (Lombok — generates getters, setters, equals, hashCode, toString)
- `@NoArgsConstructor` (Lombok — generates public no-arg constructor)

**Interfaces implemented:** `java.io.Serializable`

**Class extends:** none

**Fields (all package-private via Lombok `@Data`):**
| Modifier | Type   | Name        |
|----------|--------|-------------|
| private  | Long   | id          |
| private  | String | name        |
| private  | String | authority   |
| private  | String | description |
| private static final | long | serialVersionUID = 3861900430744018177L |

**Methods (public, generated by Lombok `@Data`):**
- `Long getId()` — generated
- `void setId(Long id)` — generated
- `String getName()` — generated
- `void setName(String name)` — generated
- `String getAuthority()` — generated
- `void setAuthority(String authority)` — generated
- `String getDescription()` — generated
- `void setDescription(String description)` — generated
- `boolean equals(Object o)` — generated
- `int hashCode()` — generated
- `String toString()` — generated

**Declared non-public methods:**
- `@Builder` `private Roles(Long id, String name, String authority, String description)` — line 24 (private constructor with Lombok `@Builder`)

**Nested type:** `public enum RoleId` — line 31
- Single constant: `ROLE_COMPANY_GROUP("ROLE_COMPANY_GROUP")` — line 32
- `private String id` field — line 34
- `RoleId(String name)` constructor — line 36
- `public String getId()` — line 40
- `public static RoleId fromId(String id)` — line 44 (throws `IllegalArgumentException` on unknown id)

---

### 2. `com.journaldev.spring.jdbc.model.Services`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Services.java`

**Annotations on class:** none

**Interfaces implemented:** `java.io.Serializable`

**Class extends:** none

**Fields:**
| Modifier | Type       | Name            |
|----------|------------|-----------------|
| private  | int        | unit_id         |
| private  | String     | unit_name       |
| private  | String     | service_type    |
| private  | BigDecimal | acc_hours       |
| private  | BigDecimal | service_due     |
| private  | int        | last_serv       |
| private  | int        | next_serv       |
| private  | int        | serv_duration   |
| private  | int        | driver_id       |
| private static final | long | serialVersionUID = -1720582328491174646L |

**Public methods (all hand-written getters/setters):**
| Return Type | Method | Line |
|-------------|--------|------|
| `int` | `getDriver_id()` | 23 |
| `void` | `setDriver_id(int driver_id)` | 26 |
| `BigDecimal` | `getAcc_hours()` | 29 |
| `void` | `setAcc_hours(BigDecimal acc_hours)` | 32 |
| `BigDecimal` | `getService_due()` | 35 |
| `void` | `setService_due(BigDecimal service_due)` | 38 |
| `int` | `getUnit_id()` | 41 |
| `void` | `setUnit_id(int unit_id)` | 44 |
| `int` | `getLast_serv()` | 47 |
| `void` | `setLast_serv(int last_serv)` | 50 |
| `int` | `getNext_serv()` | 53 |
| `void` | `setNext_serv(int next_serv)` | 56 |
| `int` | `getServ_duration()` | 59 |
| `void` | `setServ_duration(int serv_duration)` | 62 |
| `String` | `getService_type()` | 65 |
| `void` | `setService_type(String service_type)` | 68 |
| `String` | `getUnit_name()` | 71 |
| `void` | `setUnit_name(String unit_name)` | 74 |

---

### 3. `com.journaldev.spring.jdbc.model.Sessions`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Sessions.java`

**Annotations on class:** none

**Interfaces implemented:** `java.io.Serializable`

**Class extends:** none

**Fields:**
| Modifier | Type    | Name               |
|----------|---------|--------------------|
| private  | int     | id                 |
| private  | int     | driver_id          |
| private  | int     | unit_id            |
| private  | String  | start_time         |
| private  | String  | finish_time        |
| private  | String  | photo_left_url     |
| private  | String  | photo_right_url    |
| private  | String  | photo_front_url    |
| private  | String  | photo_back_url     |
| private  | boolean | prestart_required  |
| private static final | long | serialVersionUID = -631947915399380621L |

**Public methods (all hand-written getters/setters):**
| Return Type | Method | Line |
|-------------|--------|------|
| `boolean` | `isPrestart_required()` | 23 |
| `void` | `setPrestart_required(boolean prestart_required)` | 26 |
| `int` | `getId()` | 29 |
| `void` | `setId(int id)` | 32 |
| `int` | `getDriver_id()` | 35 |
| `void` | `setDriver_id(int driver_id)` | 38 |
| `int` | `getUnit_id()` | 41 |
| `void` | `setUnit_id(int unit_id)` | 44 |
| `String` | `getStart_time()` | 47 |
| `void` | `setStart_time(String start_time)` | 50 |
| `String` | `getFinish_time()` | 53 |
| `void` | `setFinish_time(String finish_time)` | 56 |
| `String` | `getPhoto_left_url()` | 59 |
| `void` | `setPhoto_left_url(String photo_left_url)` | 62 |
| `String` | `getPhoto_right_url()` | 65 |
| `void` | `setPhoto_right_url(String photo_right_url)` | 68 |
| `String` | `getPhoto_front_url()` | 71 |
| `void` | `setPhoto_front_url(String photo_front_url)` | 74 |
| `String` | `getPhoto_back_url()` | 77 |
| `void` | `setPhoto_back_url(String photo_back_url)` | 80 |

---

## Checklist Review

### Section 1 — Secrets and Configuration
**N/A** for these model classes. No configuration files, hardcoded credentials, or JDBC setup present.

---

### Section 2 — Authentication and Authorization

**Item: Enumerate role names/values — check for high-privilege "super admin" roles**

`Roles.RoleId` enum defines exactly one role constant:
```java
ROLE_COMPANY_GROUP("ROLE_COMPANY_GROUP")
```
No "super admin", "ROLE_ADMIN", "ROLE_SUPER", or equivalent elevated-privilege constant is present in the enum. The single defined role represents a company group scope.

CLEAR — no privileged super-admin role constant found in the enum.

**Item: Does the `Roles` model contain any fields whose Lombok-generated `toString()` or `equals()` could leak the `authority` string in logs?**

`@Data` generates `toString()` which will include all fields: `id`, `name`, `authority`, `description`. The `authority` field is the Spring Security authority string (e.g., `ROLE_COMPANY_GROUP`). If a `Roles` object is logged via `toString()`, the authority value is exposed. This is a low-severity information exposure in logs.

See finding **B23-3**.

**Item: Sessions model — does it contain authentication tokens or device credentials that should be internal-only?**

`Sessions` contains `driver_id` (operator identifier), `unit_id` (equipment identifier), `start_time`, `finish_time`, and four photo URL fields. No authentication tokens, passwords, or cryptographic credentials are present. The `driver_id` and `unit_id` fields are integer foreign keys, not credentials.

CLEAR — no authentication tokens or device credentials stored in Sessions.

---

### Section 3 — Input Validation and Injection

**Item: `@JsonTypeInfo` default typing**

None of the three model classes carry a `@JsonTypeInfo` annotation. There is no Jackson annotation of any kind on any of these classes. Default typing cannot be assessed at the model layer alone (it may be configured globally on `ObjectMapper`), but no per-class `@JsonTypeInfo` is present.

CLEAR at model level — no per-class `@JsonTypeInfo` found. Global ObjectMapper configuration must be reviewed separately.

**Item: Input validation annotations**

`Sessions`, `Services`, and `Roles` have no Bean Validation annotations (`@NotNull`, `@Size`, `@Pattern`, etc.) on any field. These models are used as `@RequestBody` targets (inferred from the REST API context). If controllers pass these directly to `@RequestBody` without `@Valid` enforcement, user-supplied values for all fields are accepted without constraint.

See finding **B23-1**.

---

### Section 4 — Session and CSRF
**N/A** for these model classes. CSRF and CORS configuration is in `SecurityConfig` / controller layer, not in models.

---

### Section 5 — Data Exposure

**Item: `Sessions` — operator data, photo URLs, session identifiers exposed without `@JsonIgnore`**

`Sessions` exposes `photo_left_url`, `photo_right_url`, `photo_front_url`, `photo_back_url` as plain public getter methods. These URLs point to operator pre-start check photos — they are safety-critical images of equipment condition. There are no `@JsonIgnore` annotations on any field. All fields, including photo URLs, will be serialized to JSON in any API response that returns a `Sessions` object.

Whether photo URLs should be returned in all API responses, or only in specific privileged endpoints, cannot be determined from the model alone. However, the absence of any access control annotation on these fields means the serialization boundary relies entirely on controller-layer filtering, which must be verified.

See finding **B23-2**.

**Item: `Sessions.driver_id` — operator identifier always serialized**

`driver_id` is an integer foreign key linking to an operator record. It is exposed via `getDriver_id()` with no `@JsonIgnore`. Any API response containing a `Sessions` object will include the operator's internal ID. This can be used to enumerate operators or correlate sessions to individuals.

See finding **B23-2** (covered under same finding — data exposure of session fields).

**Item: `Services.driver_id` — operator identifier always serialized**

`Services` also exposes `driver_id` via `getDriver_id()` with no `@JsonIgnore`. A service record associates a unit with a driver. The driver_id is always included in JSON serialization.

See finding **B23-2**.

**Item: `Roles` — `authority` field serialized by Lombok `@Data`**

The `authority` field on `Roles` contains the Spring Security authority string. When `Roles` objects are returned in API responses (e.g., in a user profile or role listing endpoint), the raw Spring Security authority string is exposed to clients. There is no `@JsonIgnore` on this field.

See finding **B23-4**.

**Item: `Roles` Lombok `toString()` in logs**

The Lombok-generated `toString()` will produce output containing `authority` values. If `Roles` objects are logged (e.g., at DEBUG level in production), the authority strings appear in logs alongside other PII-adjacent data.

See finding **B23-3**.

---

### Section 6 — Dependencies
**N/A** — not assessed for model classes; pom.xml is out of scope for this agent assignment.

---

### Section 7 — Build and CI
**N/A** — not assessed for model classes.

---

## Findings

---

**B23-1** — MEDIUM
**Section:** 3 — Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Sessions.java` (whole class); `src/main/java/com/journaldev/spring/jdbc/model/Services.java` (whole class)
**Description:** No Bean Validation constraints (`@NotNull`, `@Size`, `@Min`, `@Max`, `@Pattern`) are present on any field of `Sessions` or `Services`. These classes are model/DTO objects used in a REST API. Without validation annotations, controllers cannot enforce `@Valid` to reject malformed input. This means fields such as `driver_id`, `unit_id`, `start_time`, and `finish_time` accept arbitrary values, including negative IDs, blank timestamps, or overlong strings. The risk is that unsanitised values reach the data access layer.
**Evidence:**
```java
// Sessions.java — no validation annotations on any field
private int id;
private int driver_id;
private int unit_id;
private String start_time;
private String finish_time;
private String photo_left_url;
// ...

// Services.java — no validation annotations on any field
private int unit_id;
private String unit_name;
private String service_type;
private BigDecimal acc_hours;
// ...
```

---

**B23-2** — MEDIUM
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Sessions.java:12–20`; `src/main/java/com/journaldev/spring/jdbc/model/Services.java:13–22`
**Description:** `Sessions` exposes four photo URL fields (`photo_left_url`, `photo_right_url`, `photo_front_url`, `photo_back_url`) and the `driver_id` operator foreign key with no `@JsonIgnore` annotations. All fields will be included in every JSON serialization of `Sessions` objects. Photo URLs are safety-critical prestart inspection images of equipment; they should be assessed for whether they are appropriate to include in all API responses or should be suppressed or access-controlled at the serialization boundary. Similarly, `Services.driver_id` is always serialized, linking service records to specific operators without any suppression mechanism in the model layer. Neither class uses `@JsonView` or `@JsonIgnore` to restrict field exposure by response context.
**Evidence:**
```java
// Sessions.java lines 17-20
private String photo_left_url;
private String photo_right_url;
private String photo_front_url;
private String photo_back_url;

// Sessions.java lines 59-81 — all four photo URL getters are public with no @JsonIgnore
public String getPhoto_left_url() { return photo_left_url; }
public String getPhoto_right_url() { return photo_right_url; }
public String getPhoto_front_url() { return photo_front_url; }
public String getPhoto_back_url() { return photo_back_url; }

// Services.java lines 23-25
public int getDriver_id() { return driver_id; }
```

---

**B23-3** — LOW
**Section:** 5 — Data Exposure (Logging)
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Roles.java:9`
**Description:** The `@Data` Lombok annotation on `Roles` generates a `toString()` method that includes all fields: `id`, `name`, `authority`, and `description`. If a `Roles` object is passed to a logger (e.g., `log.debug("Role: {}", roles)`), the `authority` string (the Spring Security authority name) is emitted in the log output. While role authority names are not secret credentials, their presence in production logs alongside other context could reveal internal role structure to anyone with log access. The `authority` field should be assessed for whether it warrants `@ToString.Exclude` in production-facing code.
**Evidence:**
```java
// Roles.java lines 9-11
@Data
@NoArgsConstructor
public class Roles implements Serializable {
    // ...
    private String authority;   // included in Lombok-generated toString()
```

---

**B23-4** — LOW
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Roles.java:20`
**Description:** The `authority` field on `Roles` has no `@JsonIgnore` annotation. If `Roles` objects are returned in any API response (e.g., a user profile, role listing, or error payload), the raw Spring Security authority string is serialized and sent to the client. While this is not a critical secret, exposing internal authority names can assist an attacker in crafting privilege escalation attempts or in mapping the application's role model. The field should be assessed for whether it is intentionally public-facing or should be suppressed in responses.
**Evidence:**
```java
// Roles.java line 20
private String authority;
// No @JsonIgnore, no @JsonProperty(access = JsonProperty.Access.WRITE_ONLY)
// Lombok @Data generates public getAuthority() at line 9 (implicit)
```

---

**B23-5** — INFO
**Section:** 2 — Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Roles.java:31–53`
**Description:** The `Roles.RoleId` enum defines only one role: `ROLE_COMPANY_GROUP`. This single-role model means that all authenticated users operate under the same authority. There is no evidence of a finer-grained role hierarchy (e.g., operator vs. supervisor vs. administrator) in this enum. This is informational: the role model may be intentionally flat, but it should be confirmed that endpoints requiring elevated privileges (e.g., managing operators, viewing all sites) enforce additional access controls beyond membership in `ROLE_COMPANY_GROUP`. If role-based differentiation is handled elsewhere (e.g., in Cognito groups mapped dynamically rather than this enum), that mapping must be audited separately.
**Evidence:**
```java
// Roles.java lines 31-33
public enum RoleId {
    ROLE_COMPANY_GROUP("ROLE_COMPANY_GROUP");
    // No other role constants defined
```

---

**B23-6** — INFO
**Section:** 3 — Input Validation and Injection (Deserialization)
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Sessions.java:1`; `src/main/java/com/journaldev/spring/jdbc/model/Services.java:1`; `src/main/java/com/journaldev/spring/jdbc/model/Roles.java:1`
**Description:** No `@JsonTypeInfo` annotation is present on any of the three model classes. Per-class polymorphic type inclusion is not configured. However, global Jackson default typing (enabled via `ObjectMapper.enableDefaultTyping()` or `ObjectMapper.activateDefaultTyping()`) cannot be assessed from model files alone. This item is CLEAR at the model layer; a separate review of the Spring `ObjectMapper` bean configuration is required to confirm global default typing is not enabled.
**Evidence:**
```java
// No @JsonTypeInfo annotation on Sessions, Services, or Roles
// All three classes are plain POJOs / use Lombok @Data with no Jackson type metadata
```

---

## Summary Table

| Finding | Severity | Section | File |
|---------|----------|---------|------|
| B23-1 | MEDIUM | 3 — Input Validation | Sessions.java, Services.java |
| B23-2 | MEDIUM | 5 — Data Exposure | Sessions.java:17-20, Services.java:22 |
| B23-3 | LOW | 5 — Data Exposure (Logging) | Roles.java:9 |
| B23-4 | LOW | 5 — Data Exposure | Roles.java:20 |
| B23-5 | INFO | 2 — Auth/Authorization | Roles.java:31-33 |
| B23-6 | INFO | 3 — Deserialization | Sessions.java, Services.java, Roles.java |

**Sections 1, 4, 6, 7:** N/A for model classes.
