# Security Audit Report — B04
**Audit:** 2026-02-27-01 / Pass 1 (Security Review)
**Agent:** B04
**Branch:** master
**Date:** 2026-02-27

---

## Assigned Files

1. `src/main/java/com/journaldev/spring/jdbc/DAO/ManufacturerDAO.java`
2. `src/main/java/com/journaldev/spring/jdbc/DAO/ManufacturerDAOImpl.java`
3. `src/main/java/com/journaldev/spring/jdbc/DAO/UserDAO.java`

Supporting files read for context:
- `src/main/java/com/journaldev/spring/jdbc/model/User.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Roles.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Manufacturer.java`
- `src/main/java/com/journaldev/spring/jdbc/service/UserDetailsServiceImpl.java`
- `src/main/java/com/journaldev/spring/jdbc/service/DriverService.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java`
- `src/main/java/com/journaldev/spring/jdbc/DAO/APIDAO.java`
- `src/main/java/com/journaldev/spring/jdbc/DAO/APIDAOImpl.java`
- `src/main/webapp/WEB-INF/spring/spring-security.xml`
- `src/main/webapp/WEB-INF/web.xml`
- `src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml`
- `src/main/resources/fleetiq360ws.properties`
- `environment.dev.properties`
- `environment.prod.properties`
- `environment.uat.properties`
- `src/main/resources/META-INF/context.xml`
- `src/main/resources/logback.xml`
- `src/main/resources/db/migration/V9__create_users_view.sql`
- `src/main/resources/db/migration/V48__add_company_to_users_view.sql`
- `pom.xml`
- `.gitignore`

---

## STEP 3 — Reading Evidence

### File 1: `ManufacturerDAO.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.DAO.ManufacturerDAO`

**Type:** Interface

**Methods (public):**

| Line | Return Type | Method Name | Parameters |
|------|-------------|-------------|------------|
| 8 | `List<Manufacturer>` | `getManufacturersForUser` | `String username` |

**Annotations:** None on class or method.

**Fields:** None.

**Interfaces implemented / classes extended:** None (this is an interface).

---

### File 2: `ManufacturerDAOImpl.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.DAO.ManufacturerDAOImpl`

**Type:** Class

**Class-level annotations:**
- `@Component("manufacturerDAO")`

**Extends:** `JdbcDaoSupport`

**Implements:** `ManufacturerDAO`

**Fields:**

| Access | Type | Name |
|--------|------|------|
| `private static final` | `Logger` | `logger` |

**Methods (public):**

| Line | Return Type | Method Name | Parameters | Annotations |
|------|-------------|-------------|------------|-------------|
| 21 | `void` | `setDbDataSource` | `DataSource dataSource` | `@Autowired`, `@Qualifier("dataSource")` |
| 26 | `List<Manufacturer>` | `getManufacturersForUser` | `String username` | `@Override` |

**SQL executed in `getManufacturersForUser` (lines 29–33):**
```java
String query = "select id, name from manufacture where company_id in " +
        "(select comp_id from permission where driver_id in (select id from driver where email = ?))" +
        "or company_id in" +
        "(select id from company where email = ?)" +
        "or company_id is null order by name";
```
Executed via: `getJdbcTemplate().query(query, new Object[]{username, username}, new BeanPropertyRowMapper<>(Manufacturer.class))`

---

### File 3: `UserDAO.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.DAO.UserDAO`

**Type:** Class

**Class-level annotations:**
- `@Component`
- `@Transactional`

**Extends:** `JdbcDaoSupport`

**Implements:** None explicitly.

**Fields:**

| Access | Type | Name | Value / Notes |
|--------|------|------|---------------|
| `private static final` | `Logger` | `logger` | SLF4J logger |
| `private static final` | `String` | `QUERY_USER_BY_NAME` | Query on `v_apiusers` — see line 31 |
| `private static final` | `String` | `QUERY_ROLE_BY_AUTHORITY` | Query on `roles` — see line 60 |

**Methods (public):**

| Line | Return Type | Method Name | Parameters | Annotations |
|------|-------------|-------------|------------|-------------|
| 27 | `void` | `setDbDataSource` | `DataSource dataSource` | `@Autowired`, `@Qualifier("dataSource")` |
| 33 | `Optional<User>` | `findByName` | `final String name` | None |
| 61 | `Optional<Roles>` | `findByAuthority` | `final String authority` | None |

**SQL in `findByName` (line 31):**
```java
private static final String QUERY_USER_BY_NAME =
    "select name, email, password, active, authority, role_title from v_apiusers u " +
    "where u.active = true and (u.name = ? or md5(u.name) = ?) order by email";
```

**SQL in `findByAuthority` (line 60):**
```java
private static final String QUERY_ROLE_BY_AUTHORITY =
    "select id, name, authority, description from roles where authority = ?";
```

**Callers of `UserDAO`:**
- `UserDetailsServiceImpl.loadUserByUsername()` — called by Spring Security authentication pipeline; passes the username presented at login.
- `DriverService.registerDriver()` — calls `findByAuthority()` only; no user lookup.
- `UserController.getUserByEmail()` — calls `findByName(email)` via HTTP GET `/rest/admin/user?email=<value>` and returns the full `User` object in the response body.

---

## STEP 4 — Checklist Review

### Section 1 — Secrets and Configuration

**`environment.dev.properties` (lines 15–16):**
```
cognitoAPIUsername=ciiadmin
cognitoAPIPassword=ciiadmin
```

**`environment.uat.properties` (lines 15–16) — identical plaintext credentials.**

**`pom.xml` — `local` profile (lines 29–31):**
```xml
<flyway.password>gmtp-postgres</flyway.password>
...
<flyway.password>fleetiq360</flyway.password>
```

**`pom.xml` — `uat` profile (lines 76–77):**
```xml
<flyway.user>dev_admin</flyway.user>
<flyway.password>C!1admin</flyway.password>
```

**`spring-security.xml` — OAuth2 client secrets (lines 113–117):**
```xml
<oauth:client client-id="987654321" ... secret="8752361E593A573E86CA558FFD39E" .../>
<oauth:client client-id="fleetiq360" ... secret="rihah8eey4faibuengaixo6leiL1awii" .../>
```

**`.gitignore`:** Only `environment.local.properties` is excluded. `environment.dev.properties`, `environment.uat.properties`, and `environment.prod.properties` are all tracked in git.

**`pom.xml` repository (line 88):** Splunk dependency fetched over plain HTTP:
```xml
<url>http://splunk.jfrog.io/splunk/ext-releases-local</url>
```

**`fleetiq360ws.properties` (lines 17–19):** Cognito credentials present as Maven property placeholders; they resolve at build time from the environment property files which contain plaintext values — see finding B04-1.

**`bitbucket-pipelines.yml`:** File not present in repository. No CI pipeline configuration found.

**`context.xml`:** No credentials. DataSource configured via JNDI at container level (correct).

---

**Finding B04-1** — CRITICAL
**Section:** 1. Secrets and Configuration
**File:** `environment.dev.properties:15-16`, `environment.uat.properties:15-16`, `environment.prod.properties:15-16`
**Description:** Plaintext Cognito API credentials committed to the repository and tracked by git. The `.gitignore` only excludes `environment.local.properties`; dev, uat, and prod environment files are all committed with live credentials.
**Evidence:**
```
# environment.dev.properties lines 15–16
cognitoAPIUsername=ciiadmin
cognitoAPIPassword=ciiadmin

# environment.uat.properties lines 15–16 (identical)
cognitoAPIUsername=ciiadmin
cognitoAPIPassword=ciiadmin
```

---

**Finding B04-2** — HIGH
**Section:** 1. Secrets and Configuration
**File:** `pom.xml:76-77`
**Description:** Production/UAT database credentials committed in plaintext inside `pom.xml` under the `uat` Maven profile. This includes a real-looking password (`C!1admin`) for the `dev_admin` database account on an RDS instance.
**Evidence:**
```xml
<flyway.user>dev_admin</flyway.user>
<flyway.password>C!1admin</flyway.password>
```
The RDS hostname is also exposed: `forkliftiq360.cmjwsurtk4tn.us-east-1.rds.amazonaws.com`

---

**Finding B04-3** — HIGH
**Section:** 1. Secrets and Configuration
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:113-117`
**Description:** OAuth2 client secrets hardcoded in plain XML committed to the repository. Any developer or reader of the repo can obtain these and mint valid OAuth tokens for the API.
**Evidence:**
```xml
<oauth:client client-id="987654321"
              secret="8752361E593A573E86CA558FFD39E"
              authorities="ROLE_CLIENT" .../>
<oauth:client client-id="fleetiq360"
              secret="rihah8eey4faibuengaixo6leiL1awii"
              authorities="ROLE_DRIVER,ROLE_COMPANY_GROUP,ROLE_SYS_ADMIN" .../>
```

---

**Finding B04-4** — MEDIUM
**Section:** 1. Secrets and Configuration
**File:** `pom.xml:27-35`
**Description:** Additional database passwords committed in the `local` Maven profile. Two conflicting `flyway.password` entries exist (a sign of copy-paste history), one containing `gmtp-postgres`.
**Evidence:**
```xml
<flyway.password>gmtp-postgres</flyway.password>
...
<flyway.password>fleetiq360</flyway.password>
```

---

**Finding B04-5** — MEDIUM
**Section:** 1. Secrets and Configuration
**File:** `pom.xml:88`
**Description:** Splunk dependency is fetched from a third-party JFrog repository over plain HTTP (not HTTPS). This is a dependency-confusion and man-in-the-middle risk — a malicious artifact could be substituted in transit.
**Evidence:**
```xml
<url>http://splunk.jfrog.io/splunk/ext-releases-local</url>
```

---

### Section 2 — Authentication and Authorization

**Security filter chain (spring-security.xml):**
```xml
<http pattern="/rest/**" create-session="never" ...>
    <intercept-url pattern="/rest/db/**"  access="ROLE_SYS_ADMIN" />
    <intercept-url pattern="/rest/apk/**" access="ROLE_CLIENT" />
    <intercept-url pattern="/rest/**"     access="ROLE_DRIVER,ROLE_COMPANY_GROUP,ROLE_SYS_ADMIN,ROLE_CLIENT" />
</http>
```

`UserController` maps to `/rest/admin/user`. This path matches `ROLE_DRIVER,...` — meaning any authenticated driver can call it, not only administrators.

**`/rest/admin/user` (UserController.java lines 22–32):** Returns the full `User` object — including `password` field (plaintext MD5 hash) — to any authenticated caller. No role restriction specific to admin is applied; the `/rest/admin/**` sub-path is not listed as a protected pattern in `spring-security.xml`.

**Password hashing (spring-security.xml line 74):**
```xml
<password-encoder hash="md5"/>
```
MD5 is configured as the password hashing algorithm. MD5 is cryptographically broken and is unsuitable for password storage.

**OAuth2 token validity (spring-security.xml line 117):**
```xml
access-token-validity="300" refresh-token-validity="300"
```
Access tokens expire after 300 seconds (5 minutes). Refresh tokens also expire in 300 seconds — effectively no long-lived session, which is acceptable. However, no token revocation mechanism is visible.

**Token testing endpoints (spring-security.xml lines 13–14):**
```xml
<http pattern="/oauth/cache_approvals"   security="none" />
<http pattern="/oauth/uncache_approvals" security="none" />
```
These endpoints are marked `security="none"` with a comment "Just for testing." If present in production deployment, they represent an unauthenticated token management surface.

---

**Finding B04-6** — CRITICAL
**Section:** 2. Authentication and Authorization
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java:22-32` + `src/main/webapp/WEB-INF/spring/spring-security.xml:30-35`
**Description:** The `/rest/admin/user` endpoint is accessible to any authenticated user with `ROLE_DRIVER`, `ROLE_COMPANY_GROUP`, `ROLE_SYS_ADMIN`, or `ROLE_CLIENT`. The security configuration has no intercept rule for `/rest/admin/**` — this path falls through to the broad `/rest/**` rule. Any forklift driver can query any other user's full record (including hashed password) by supplying an email address. This is both a broken access control (IDOR) and a privilege escalation issue.
**Evidence:**
```java
// UserController.java:22-32
@RequestMapping(value = "/rest/admin/user", method = RequestMethod.GET)
public @ResponseBody ResponseEntity<User> getUserByEmail(@RequestParam("email") String email) {
    Optional<User> user = userDao.findByName(email);
    if (user.isPresent()) {
        return new ResponseEntity<>(user.get(), HttpStatus.OK);
    } else {
        return new ResponseEntity<>(HttpStatus.BAD_GATEWAY);
    }
}
```
```xml
<!-- spring-security.xml — no /rest/admin/** rule -->
<intercept-url pattern="/rest/db/**"  access="ROLE_SYS_ADMIN" />
<intercept-url pattern="/rest/apk/**" access="ROLE_CLIENT" />
<intercept-url pattern="/rest/**"     access="ROLE_DRIVER,ROLE_COMPANY_GROUP,ROLE_SYS_ADMIN,ROLE_CLIENT" />
```

---

**Finding B04-7** — HIGH
**Section:** 2. Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:74`
**Description:** MD5 is configured as the password hashing algorithm. MD5 produces no salt, is trivially reversed via rainbow tables and GPU cracking, and has been broken as a cryptographic primitive for over two decades. Passwords stored (and compared) with MD5 are effectively reversible by any attacker who gains read access to the database.
**Evidence:**
```xml
<password-encoder hash="md5"/>
```

---

**Finding B04-8** — MEDIUM
**Section:** 2. Authentication and Authorization
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml:13-14`
**Description:** Two token-management endpoints are marked `security="none"` with an inline comment stating they are "Just for testing." If these paths are reachable in production, they allow unauthenticated interaction with the OAuth2 approval cache.
**Evidence:**
```xml
<!-- Just for testing... -->
<http pattern="/oauth/cache_approvals"   security="none" />
<http pattern="/oauth/uncache_approvals" security="none" />
```

---

### Section 3 — Input Validation and Injection

**ManufacturerDAOImpl.java — `getManufacturersForUser` (lines 29–35):** Uses parameterized placeholders (`?`) for both `username` substitutions. No string concatenation. CLEAR for SQL injection in this method.

**UserDAO.java — `findByName` (lines 31, 35):** `QUERY_USER_BY_NAME` uses two `?` placeholders. CLEAR for SQL injection in this method.

**UserDAO.java — `findByAuthority` (lines 60, 62):** `QUERY_ROLE_BY_AUTHORITY` uses one `?` placeholder. CLEAR for SQL injection.

**`UserController.java` — `@RequestParam("email")` (line 23):** The `email` parameter is accepted directly from the HTTP request with no `@Valid`, no size constraint, no format validation, and no `@Pattern`. It is passed directly to `findByName()`. While `findByName` itself uses parameterized queries (no SQL injection), the absence of input validation means arbitrarily long strings can be sent to the database query, and any malformed input is passed through unchecked.

**`ManufacturerDAO`-level note on `username` parameter:** The interface accepts a raw `String username` with no documented contract. The caller supplies the email from the Cognito JWT principal — not from direct user input to this DAO — so injection risk is lower in practice, but there is no input validation at the DAO boundary either.

---

**Finding B04-9** — LOW
**Section:** 3. Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java:23`
**Description:** The `email` request parameter is not validated before use. No `@Valid`, no `@Size`, no `@Pattern(regexp = "...")` annotation. Arbitrarily long or malformed strings are accepted and forwarded to the database layer. Parameterized queries protect against SQL injection here, but length and format validation is absent.
**Evidence:**
```java
public @ResponseBody ResponseEntity<User> getUserByEmail(@RequestParam("email") String email) {
    Optional<User> user = userDao.findByName(email);
```

---

### Section 4 — Session and CSRF

**CSRF:** The application uses stateless OAuth2 bearer tokens with `create-session="never"`. CSRF does not apply to bearer-token-authenticated stateless APIs. The Spring Security filter chain does not show `.csrf().disable()` in Java config (the configuration is XML-based), and stateless OAuth2 is inherently not subject to CSRF since cookies are not used. CLEAR.

**CORS:** No `@CrossOrigin` annotation found on `UserController`, `ManufacturerDAOImpl`, or `UserDAO`. No `CorsRegistry` configuration found in the scanned XML files. CLEAR for the assigned files; broader codebase not audited here.

**Security headers (`X-Frame-Options`, `X-Content-Type-Options`, `Strict-Transport-Security`):** Not configured in the Spring Security XML or `web.xml`. However, `web.xml` enforces `CONFIDENTIAL` transport (lines 38–46), requiring HTTPS at the Tomcat container level. HSTS and other response security headers are not set by the application. This is noted but is out of scope for the assigned files; flagged as informational.

**Finding B04-10** — INFO
**Section:** 4. Session and CSRF
**File:** `src/main/webapp/WEB-INF/spring/spring-security.xml`
**Description:** No HTTP security response headers (`X-Frame-Options`, `X-Content-Type-Options`, `Strict-Transport-Security`) are configured in the Spring Security XML. The container enforces HTTPS via `CONFIDENTIAL` transport guarantee in `web.xml`, but HSTS and anti-clickjacking headers are not set.
**Evidence:** The `<http>` blocks in `spring-security.xml` contain no `<headers>` child element. No Spring Security `<headers>` configuration is present.

---

### Section 5 — Data Exposure

**`UserDAO.findByName` — password field returned in `User` object:**
The query at line 31 selects the `password` column from `v_apiusers`:
```java
"select name, email, password, active, authority, role_title from v_apiusers u ..."
```
The `User.builder()` call at line 39–44 populates `user.password` from the result set:
```java
.password(rs.getString("password"))
```
This `User` object is then returned as an `Optional<User>` to callers.

- In `UserDetailsServiceImpl`, the password is used only for Spring Security's internal `UserDetails` object — this is expected and correct.
- In `UserController.getUserByEmail()`, however, the entire `User` object — including the `password` field — is serialized as JSON and returned in the HTTP response body to the calling client. Even though the password is MD5-hashed, returning password hashes to API clients is a data exposure vulnerability.

**`ManufacturerDAOImpl.getManufacturersForUser` — organisation scoping:**
The query includes `or company_id is null` (line 33):
```java
"or company_id is null order by name"
```
This causes manufacturers with no assigned `company_id` (i.e., global or unassigned manufacturers) to be returned to all users regardless of their company. Depending on the intended data model this may be by design (system-wide reference data), but it means the company scoping is not strict — every user, from any organisation, sees the same set of uncompany-scoped manufacturer entries. If any manufacturer records have `company_id = NULL` that should be company-private, they would be exposed cross-organisation.

**`UserDAO.findByName` — cross-organisation user lookup:**
The query on `v_apiusers` (and the `v_users` view definition in V48) is not scoped by organisation/company when called from `UserController`. The caller supplies any email address; there is no check that the requesting user belongs to the same organisation as the looked-up user. Any authenticated user can retrieve any other user's record.

---

**Finding B04-11** — CRITICAL
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java:27-29` + `src/main/java/com/journaldev/spring/jdbc/DAO/UserDAO.java:39-44`
**Description:** The `/rest/admin/user` endpoint returns the full serialized `User` object to the HTTP client, including the `password` field (MD5 hash of the user's password). Password hashes must never be returned in API responses; even a hash is sensitive — it can be cracked offline and confirms which hashing algorithm is in use.
**Evidence:**
```java
// UserDAO.java lines 39-44 — password populated from DB
user = User.builder()
            .name(rs.getString("name"))
            .email(rs.getString("email"))
            .password(rs.getString("password"))  // <-- hash loaded
            .active(rs.getBoolean("active"))
            .build();

// UserController.java lines 27-29 — returned to client
if (user.isPresent()) {
    return new ResponseEntity<>(user.get(), HttpStatus.OK);  // full User including password
}
```

---

**Finding B04-12** — HIGH
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/UserDAO.java:31` + `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java:22-32`
**Description:** `UserDAO.findByName` performs a global lookup across all organisations. The query has no company/organisation scope. When called via `UserController`, any authenticated user can retrieve the full profile (name, email, password hash, active status, roles) of any other user in the system by supplying their email address. This is an IDOR (Insecure Direct Object Reference) allowing cross-organisation user record enumeration.
**Evidence:**
```java
// UserDAO.java line 31 — no organisation scope in query
private static final String QUERY_USER_BY_NAME =
    "select name, email, password, active, authority, role_title from v_apiusers u " +
    "where u.active = true and (u.name = ? or md5(u.name) = ?) order by email";

// UserController.java line 25 — arbitrary email lookup, no ownership check
Optional<User> user = userDao.findByName(email);
```

---

**Finding B04-13** — MEDIUM
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/ManufacturerDAOImpl.java:33`
**Description:** The manufacturer query returns all records where `company_id IS NULL`, unconditionally across all authenticated users. If any manufacturer rows have `company_id = NULL` that are intended to be company-private (not system-wide reference data), they would be exposed to every user regardless of organisation. The intent of this clause should be confirmed and documented; if it is correct, the table schema should enforce this with a constraint, not rely on query logic.
**Evidence:**
```java
String query = "select id, name from manufacture where company_id in " +
        "(select comp_id from permission where driver_id in (select id from driver where email = ?))" +
        "or company_id in" +
        "(select id from company where email = ?)" +
        "or company_id is null order by name";   // <-- cross-org exposure if any row is unexpectedly NULL
```

---

**Finding B04-14** — INFO
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/UserDAO.java:31`
**Description:** The `v_apiusers` view is referenced in the DAO query but its DDL is not found in the Flyway migration scripts (no migration file creates or names `v_apiusers`). The view may have been created outside the tracked schema migrations, meaning its column definitions and data exposure scope cannot be verified from this repository alone. This is a schema governance gap.
**Evidence:**
```java
"select name, email, password, active, authority, role_title from v_apiusers u ..."
```
No Flyway migration file in `src/main/resources/db/migration/` contains `CREATE VIEW v_apiusers` or any reference to `v_apiusers`.

---

**Finding B04-15** — LOW
**Section:** 5. Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/DAO/APIDAOImpl.java:29`
**Description:** `APIDAOImpl.checkKey()` logs the raw API key value at INFO level before performing any validation. In the current implementation the method returns `true` unconditionally (no actual key check), but the logging statement logs potentially sensitive key material to the application log (and Splunk, per logback configuration).
**Evidence:**
```java
public boolean checkKey(String key){
    logger.info("Start checkKey : {}", key);  // API key logged in plaintext
    return true;
}
```

---

### Section 6 — Dependencies

**Spring Framework:** `3.2.14.RELEASE` — End-of-life as of December 2016. Multiple CVEs exist against this version including remote code execution in Spring MVC data binding (CVE-2022-22965 "Spring4Shell" affects later 5.x, but 3.x misses all security patches since 2016).

**Spring Security:** `3.1.1.RELEASE` — Released 2012, end-of-life. Numerous security fixes in subsequent versions are missing.

**Spring Security OAuth2:** `1.0.0.RELEASE` — This is the first release of the Spring Security OAuth2 library from 2012. The Spring Security OAuth project reached end-of-life in May 2022; this version has had no security patches for over a decade.

**Jackson Databind:** `2.6.7` — Numerous CVEs: CVE-2017-7525, CVE-2018-7489, CVE-2019-12384, CVE-2019-14379, and many more polymorphic deserialization vulnerabilities. This version is severely outdated.

**commons-fileupload:** `1.3.1` — CVE-2016-3092 (denial of service via large multipart upload), CVE-2023-24998 (excessive resource usage). Version 1.3.1 is significantly outdated.

**commons-io:** `1.3.2` — This is `org.apache.commons:commons-io:1.3.2` which is an unusual artifact coordinates (the standard library is `commons-io:commons-io`). Version 1.3.2 is very old.

**aws-java-sdk:** `1.11.163` — Released circa 2017. The current release of the v1 SDK is 1.12.x with numerous security fixes.

**logback-classic / logback-core:** `1.2.3` — CVE-2021-42550 (JNDI injection via logback configuration) affects versions prior to 1.2.9. This version is vulnerable.

**postgresql JDBC (Flyway dependency):** `9.1-901.jdbc3` — Extremely old PostgreSQL JDBC driver.

---

**Finding B04-16** — CRITICAL
**Section:** 6. Dependencies
**File:** `pom.xml:12-17, 229-242`
**Description:** Core framework dependencies are severely end-of-life. Spring 3.2.14 (EOL 2016), Spring Security 3.1.1 (EOL ~2014), and Spring Security OAuth2 1.0.0 (the original 2012 release) are all unsupported and carry accumulated unpatched CVEs. These versions predated Java 11, modern TLS requirements, and a decade of security research against Spring applications.
**Evidence:**
```xml
<org.springframework-version>3.2.14.RELEASE</org.springframework-version>
...
<spring-security-web>     version 3.1.1.RELEASE</spring-security-web>
<spring-security-config>  version 3.1.1.RELEASE</spring-security-config>
<spring-security-oauth2>  version 1.0.0.RELEASE</spring-security-oauth2>
```

---

**Finding B04-17** — HIGH
**Section:** 6. Dependencies
**File:** `pom.xml:99-101`
**Description:** Jackson Databind `2.6.7` has a large number of published CVEs related to polymorphic deserialization (CVE-2017-7525 et al.). While the servlet-context does not show `enableDefaultTyping()`, the version is critically outdated and multiple attack vectors exist.
**Evidence:**
```xml
<jackson.databind-version>2.6.7</jackson.databind-version>
```

---

**Finding B04-18** — HIGH
**Section:** 6. Dependencies
**File:** `pom.xml:130-137`
**Description:** Logback `1.2.3` is vulnerable to CVE-2021-42550, a JNDI injection vulnerability in logback's `JMSAppender` and SMTPAppender configuration. Fixed in version 1.2.9. The application uses logback as its primary logging framework, and the `logback.xml` is configurable via `${logDir}` which is externally supplied.
**Evidence:**
```xml
<logback-classic version="1.2.3"/>
<logback-core    version="1.2.3"/>
```

---

**Finding B04-19** — MEDIUM
**Section:** 6. Dependencies
**File:** `pom.xml:198-201`
**Description:** `commons-fileupload 1.3.1` is vulnerable to CVE-2016-3092 (DoS via crafted multipart request) and later CVEs. The application configures a `CommonsMultipartResolver` with a 20 MB upload limit, which relies on this library.
**Evidence:**
```xml
<groupId>commons-fileupload</groupId>
<artifactId>commons-fileupload</artifactId>
<version>1.3.1</version>
```

---

### Section 7 — Build and CI

**`pom.xml` compiler plugin (lines 304–310):**
```xml
<compilerArgument>-Xlint:all</compilerArgument>
<showWarnings>true</showWarnings>
<showDeprecation>true</showDeprecation>
```
`-Xlint:all` is configured, which is good practice.

**`bitbucket-pipelines.yml`:** No CI pipeline file was found in the repository. There is no automated build, test, or deployment pipeline configuration committed.

**Test skipping:** Cannot be verified without a pipeline file. No `<skipTests>` was found in `pom.xml` build configuration itself — tests are not skipped in the Maven POM.

**SNAPSHOT dependencies:** No SNAPSHOT dependencies found in `pom.xml`. CLEAR.

**Reproducibility:** All dependencies have explicit version numbers. CLEAR.

---

**Finding B04-20** — MEDIUM
**Section:** 7. Build and CI
**File:** (repository root — file absent)
**Description:** No `bitbucket-pipelines.yml` or equivalent CI/CD configuration is present in the repository. There is no automated build, test, or deployment pipeline. Deployments are presumably performed manually via `mvn tomcat7:deploy`, which creates a risk that untested code or the wrong profile is deployed, and that deployment credentials are managed outside any audited process.
**Evidence:** `bitbucket-pipelines.yml` — file not found. No CI configuration file present in repository root or `.bitbucket/` directory.

---

## Summary of Findings

| ID | Severity | Section | Short Description |
|----|----------|---------|-------------------|
| B04-1 | CRITICAL | 1. Secrets | Plaintext Cognito credentials committed in environment property files |
| B04-2 | HIGH | 1. Secrets | UAT/RDS database password committed in pom.xml |
| B04-3 | HIGH | 1. Secrets | OAuth2 client secrets hardcoded in spring-security.xml |
| B04-4 | MEDIUM | 1. Secrets | Local database passwords in pom.xml |
| B04-5 | MEDIUM | 1. Secrets | Splunk dependency repository over HTTP (MitM risk) |
| B04-6 | CRITICAL | 2. Auth | `/rest/admin/user` accessible to ROLE_DRIVER — no admin role restriction |
| B04-7 | HIGH | 2. Auth | MD5 used as password hashing algorithm |
| B04-8 | MEDIUM | 2. Auth | OAuth test endpoints (`/oauth/cache_approvals`) marked `security="none"` |
| B04-9 | LOW | 3. Injection | No input validation on `email` request parameter in UserController |
| B04-10 | INFO | 4. Session/CSRF | No HTTP security response headers configured |
| B04-11 | CRITICAL | 5. Data Exposure | Password hash returned in API response body via UserController |
| B04-12 | HIGH | 5. Data Exposure | Cross-organisation IDOR: user records accessible without org scoping |
| B04-13 | MEDIUM | 5. Data Exposure | `company_id IS NULL` in manufacturer query — potential cross-org exposure |
| B04-14 | INFO | 5. Data Exposure | `v_apiusers` view not defined in tracked Flyway migrations |
| B04-15 | LOW | 5. Data Exposure | API key value logged in plaintext at INFO level |
| B04-16 | CRITICAL | 6. Dependencies | Spring 3.x, Spring Security 3.x, Spring OAuth2 1.0 — all end-of-life |
| B04-17 | HIGH | 6. Dependencies | Jackson Databind 2.6.7 — multiple CVEs (polymorphic deserialization) |
| B04-18 | HIGH | 6. Dependencies | Logback 1.2.3 — CVE-2021-42550 (JNDI injection) |
| B04-19 | MEDIUM | 6. Dependencies | commons-fileupload 1.3.1 — CVE-2016-3092 and later CVEs |
| B04-20 | MEDIUM | 7. Build/CI | No CI/CD pipeline configuration present in repository |

**Critical:** 4 | **High:** 6 | **Medium:** 5 | **Low:** 2 | **Info:** 3
