# Security Audit — Pass 1 — Agent B12
**Date:** 2026-02-27
**Repo:** forkliftiqws
**Branch:** master
**Auditor:** B12
**Files assigned:**
- `src/main/java/com/journaldev/spring/jdbc/model/AuthenticationResponse.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Charts.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Company.java`

**Supporting files read for context:**
- `src/main/java/com/journaldev/spring/jdbc/model/ResponseWrapper.java`
- `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Driver.java`
- `src/main/java/com/journaldev/spring/jdbc/service/CognitoService.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java`

---

## Reading Evidence

### 1. `AuthenticationResponse.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.AuthenticationResponse`

**Extends:** `com.journaldev.spring.jdbc.model.ResponseWrapper`
**Implements:** (none directly; `ResponseWrapper` implements `java.io.Serializable`)

**Class-level annotations:**
- `@Data` (Lombok — generates getters, setters, toString, equals, hashCode)
- `@EqualsAndHashCode(callSuper=true)`
- `@NoArgsConstructor`
- `@JsonInclude(JsonInclude.Include.NON_NULL)` (suppresses null fields in JSON output)

**Fields (all `private`):**
| Modifier | Type | Name |
|---|---|---|
| private static final | long | serialVersionUID = 408336884318011949L |
| private | String | accessToken |
| private | String | sessionToken |
| private | String | expiresIn |
| private | String | actualDate |
| private | String | expirationDate |
| private | UserResponse | userData |
| private | String | username |
| private | String | message |

**Public methods:** None declared explicitly. Lombok `@Data` generates public getters and setters for every field. No method annotations present.

**Inherited fields (from `ResponseWrapper`):**
| Modifier | Type | Name |
|---|---|---|
| private | Object | data |
| private | Object | metadata |
| private | List\<ErrorMessage\> | errors |

**`UserResponse` fields (embedded in `userData`):**
- `String username`, `String email`, `String userCreateDate`, `String userStatus`, `String lastModifiedDate`, `String name`, `String lastname`, `String phoneNumber`

---

### 2. `Charts.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.Charts`

**Extends:** (none)
**Implements:** `java.io.Serializable`

**Class-level annotations:** None
**Method-level annotations:** None

**Fields (all `private`):**
| Modifier | Type | Name |
|---|---|---|
| private static final | long | serialVersionUID = -2487058812368828477L |
| private | int | unit_id |
| private | String | unit |
| private | BigDecimal | total |
| private | List\<Usage\> | usageList |

**Public methods:**
| Return type | Method | Parameters | Line |
|---|---|---|---|
| String | getUnit() | (none) | 21 |
| void | setUnit(String unit) | String unit | 24 |
| BigDecimal | getTotal() | (none) | 27 |
| void | setTotal(BigDecimal total) | BigDecimal total | 30 |
| List\<Usage\> | getUsageList() | (none) | 33 |
| void | setUsageList(List\<Usage\> usageList) | List\<Usage\> usageList | 36 |
| void | addUsageList(Usage usage) | Usage usage | 40 |
| int | getUnit_id() | (none) | 43 |
| void | setUnit_id(int unit_id) | int unit_id | 46 |

---

### 3. `Company.java`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.Company`

**Extends:** (none)
**Implements:** `java.io.Serializable`

**Class-level annotations:**
- `@Data` (Lombok — generates getters, setters, toString, equals, hashCode)
- `@NoArgsConstructor`

**Fields (all `private`):**
| Modifier | Type | Name |
|---|---|---|
| private static final | long | serialVersionUID = 8023991868841881837L |
| private | Long | id |
| private | String | name |
| private | String | email |
| private | String | password |
| private | List\<Roles\> | arrRoles |
| private | Permissions | permission |
| private | Integer | timezone |
| private | String | dateFormat |
| private | Integer | maxSessionLength |
| private | Driver | contactDriver |

**Public methods:** None explicitly declared. Lombok `@Data` generates public getters/setters for all fields above.

**Private methods:**
| Return type | Method | Parameters | Annotations | Line |
|---|---|---|---|---|
| (constructor) | Company(...) | Long id, String name, String email, String password, Integer timezone, String dateFormat, Integer maxSessionLength, @Singular List\<Roles\> arrRoles, Permissions permission, Driver contactDriver | `@Builder` | 33 |

**Notable constructor logic (lines 44–49):** When a `contactDriver` is provided, the constructor overwrites `name`, `email`, and `password` on the Company with the values from the Driver object — including `Driver.password`.

---

## Checklist Review

### Section 1 — Secrets and Configuration
**N/A** for these model files. No application.properties, JDBC connections, credentials, or pipeline configuration in scope. CLEAR for these three files.

---

### Section 2 — Authentication and Authorization
**N/A** for these model files directly. No security filter chain, URL access rules, or `@PreAuthorize` annotations present.

However, `AuthenticationResponse` is the object returned to the client on login. Findings related to what it exposes are captured under Section 5 below.

---

### Section 3 — Input Validation and Injection

**3a — Deserialization / @JsonTypeInfo**
No `@JsonTypeInfo` annotation is present on any of the three files. No `ObjectInputStream` usage. No Jackson polymorphic type handling configured on these classes.
**CLEAR** for `@JsonTypeInfo` default typing risk.

**3b — Input constraints on fields used as request bodies**
`Company` and `Charts` do not bear JSR-303/Bean Validation annotations (`@NotNull`, `@Size`, `@Pattern`, `@Email`, etc.) on any field. `Company` carries a `password` field — if this model were used as a `@RequestBody` there would be no validation of its content.

`AuthenticationResponse` is an outbound response object and is not used as a `@RequestBody` (confirmed by reviewing `CognitoService`). CLEAR for `AuthenticationResponse` as a request body.

`Company` is returned by `CompanyController.getCompany()` and `CompanyController.searchCompany()` — it is the response type, not the request body, in those endpoints. The input body for `addCompany` is `Permissions`, not `Company`. **CLEAR** for `Company` as an inbound request body in current controller usage.

`Charts` is used only as a response type in `ResumeController`. **CLEAR** for `Charts` as a request body.

Overall for Section 3 on assigned files: **CLEAR** (no deserialization risk; these are not used as `@RequestBody` types in the reviewed controllers; no `@JsonTypeInfo`).

---

### Section 4 — Session and CSRF
**N/A** for model classes.

---

### Section 5 — Data Exposure

Multiple HIGH and MEDIUM findings follow.

---

### Section 6 — Dependencies
**N/A** for model classes.

---

### Section 7 — Build and CI
**N/A** for model classes.

---

## Findings

---

**B12-1** — HIGH
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Company.java:23`
**Description:** The `Company` model contains a `password` field with no `@JsonIgnore` annotation. Lombok `@Data` generates a public `getPassword()` method. Because `Company` is directly serialised and returned in API responses — `CompanyController.getCompany()` (line 37) returns `List<Company>` and `CompanyController.searchCompany()` (line 53) returns `List<Company>` — the password value will be included in every matching JSON response unless it happens to be null. There is no `@JsonInclude(NON_NULL)` on the `Company` class, so even an empty string would be serialised. Returning password material to the client is a critical data exposure.
**Evidence:**
```java
// Company.java lines 13, 23
@Data
@NoArgsConstructor
public class Company implements Serializable {
    ...
    private String password;   // line 23 — no @JsonIgnore
    ...
}

// CompanyController.java line 37
public @ResponseBody List<Company> getCompany(@PathVariable("uid") Long uid) {
    return this.companyDAO.findAllByDriverId(uid);
}

// CompanyController.java line 53
public @ResponseBody List<Company> searchCompany(@PathVariable("keyword") String keyword) {
    List<Company> complst = companyDAO.findAllByKeyword(keyword);
    return complst;
}
```

---

**B12-2** — HIGH
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Company.java:33-49`
**Description:** The `@Builder`-annotated private constructor for `Company` explicitly copies `Driver.password` into `Company.password` (line 48). The `Driver` model also lacks `@JsonIgnore` on its own `password` field (see B12-6). When a `Company` is built from a `contactDriver`, the driver's password is copied directly onto the Company object and then exposed via the getter generated by Lombok `@Data`. This propagation of a credential from `Driver` into `Company` and then into an API response compounds the exposure at B12-1.
**Evidence:**
```java
// Company.java lines 44-49
if (this.contactDriver != null) {
    // Override user information with the driver
    this.name = this.contactDriver.getFirst_name() + " " + this.contactDriver.getLast_name();
    this.email = this.contactDriver.getEmail();
    this.password = this.contactDriver.getPassword();  // line 48 — driver password copied here
}
```

---

**B12-3** — HIGH
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/AuthenticationResponse.java:19`
**Description:** `AuthenticationResponse` exposes a `sessionToken` field. In Cognito terminology a "session token" is the short-lived opaque token used to continue an authentication challenge (e.g., MFA) — it is distinct from the `accessToken` and should never be returned to the client in a long-lived response. Even if the field name is being misused here as an alias for something else, returning a `sessionToken` alongside an `accessToken` in the same response doubles the credential surface. No `@JsonIgnore` or scoping annotation limits its serialisation. There is no refresh token field, which is positive, but the session token exposure warrants review.
**Evidence:**
```java
// AuthenticationResponse.java lines 18-19
private String accessToken;
private String sessionToken;   // line 19 — no @JsonIgnore; serialised in login response
```

---

**B12-4** — MEDIUM
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Company.java:20`
**Description:** The `Company` model exposes an internal database primary key (`id`, type `Long`) directly in API responses with no obfuscation or `@JsonIgnore`. Combined with the unprotected `searchCompany` endpoint (`/search/{keyword}`) there is no evidence of tenant-scoping on that query, meaning an authenticated user who knows or guesses company names could harvest internal `id` values for use in further IDOR attacks against other endpoints that accept a company or permission ID.
**Evidence:**
```java
// Company.java line 20
private Long id;   // no @JsonIgnore — included in all Company API responses

// CompanyController.java lines 52-59
@RequestMapping(value= RestURIConstants.SEARCH_COMPANY, method=RequestMethod.GET)
public @ResponseBody List<Company> searchCompany(@PathVariable("keyword") String keyword) {
    List<Company> complst = companyDAO.findAllByKeyword(keyword);
    return complst;   // returns id alongside all other Company fields
}
```

---

**B12-5** — MEDIUM
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/AuthenticationResponse.java:13`
**Description:** `AuthenticationResponse` extends `ResponseWrapper`, which declares an `Object data` field and an `Object metadata` field. Both are of raw `Object` type and both are serialised into the JSON response body (`ResponseWrapper` is annotated `@JsonInclude(NON_NULL)` but `data` and `metadata` can hold arbitrary objects). If any code path populates `data` or `metadata` with an object that itself contains sensitive fields (e.g., a user record, an internal configuration object), those fields will be fully serialised to the client with no type-level guard. The use of `Object` as the response container type is a latent data-exposure channel that cannot be statically bounded.
**Evidence:**
```java
// ResponseWrapper.java lines 18-20
private Object data;
private Object metadata;
private List<ErrorMessage> errors;

// AuthenticationResponse.java line 13
public class AuthenticationResponse extends ResponseWrapper {
    // inherits data, metadata, errors with no override or @JsonIgnore
}
```

---

**B12-6** — HIGH
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Driver.java:25` (supporting file, not directly assigned — recorded here because it is the source of the password copied into `Company` at B12-2)
**Description:** `Driver.password` has no `@JsonIgnore`. Lombok `@Data` generates `getPassword()`. `CompanyController.getCompanyDrivers()` (line 44) returns `List<Driver>` directly. `Driver` is therefore serialised — including the `password` field — in the `GET /company/{uid}/drivers` response. Additionally, `Driver.securityno` (line 29, a security/national identity number) and `Driver.licno` (line 27, driving licence number) are both serialised without restriction, representing significant PII exposure.
**Evidence:**
```java
// Driver.java lines 25, 27, 29
private String password;     // line 25 — no @JsonIgnore
private String licno;        // line 27 — licence number, no @JsonIgnore
private String securityno;   // line 29 — security/ID number, no @JsonIgnore

// CompanyController.java lines 43-50
@RequestMapping(value= RestURIConstants.GET_COMPANY_DRIVERS, method=RequestMethod.GET)
public @ResponseBody List<Driver> getCompanyDrivers(@PathVariable("uid") int uid) {
    List<Driver> drivers = driverDAO.findAllByCompanyOwner(uid);
    return drivers;   // serialises full Driver object including password, licno, securityno
}
```

---

**B12-7** — MEDIUM
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Charts.java:16`
**Description:** `Charts` exposes `unit_id` (the internal database primary key for a forklift/equipment unit) in API responses. The field name follows snake_case convention matching the DB column name, confirming it is a raw DB identifier. Exposing internal primary keys in telemetry responses enables enumeration: an attacker could iterate `unit_id` values to probe for equipment belonging to other organisations. There is no `@JsonIgnore` or aliasing. This is lower severity than the credential exposures but is a design-level data exposure concern.
**Evidence:**
```java
// Charts.java line 16
private int unit_id;   // DB PK, serialised via getUnit_id() at line 43

// ResumeController.java line 120
public @ResponseBody List<Charts> getResumeEquipment(
    @PathVariable("uid") int uid,
    @PathVariable("frequencey") String frequencey)
// Returns List<Charts> including unit_id in every element
```

---

**B12-8** — INFO
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/AuthenticationResponse.java:21-22`
**Description:** `AuthenticationResponse` returns both `actualDate` and `expirationDate` as plain strings. There is no standard naming for these fields in OAuth/Cognito responses — the conventional field is `expires_in` (an integer seconds count). Returning absolute expiration timestamps alongside `expiresIn` is redundant and leaks server-side time information. More importantly, if `expirationDate` represents the Cognito token expiry, clients should be using the expiry embedded in the JWT itself rather than relying on a server-supplied string that could diverge. This is informational — the fields themselves cause no direct harm but indicate a non-standard token response shape that could confuse token lifecycle handling.
**Evidence:**
```java
// AuthenticationResponse.java lines 20-22
private String expiresIn;
private String actualDate;
private String expirationDate;
```

---

## Summary Table

| Finding | Severity | Section | Topic |
|---|---|---|---|
| B12-1 | HIGH | 5 | `Company.password` serialised in API response — no `@JsonIgnore` |
| B12-2 | HIGH | 5 | `@Builder` constructor copies `Driver.password` into `Company.password` |
| B12-3 | HIGH | 5 | `AuthenticationResponse.sessionToken` exposed in login response |
| B12-4 | MEDIUM | 5 | `Company.id` (DB PK) exposed; combined with open `searchCompany`, enables IDOR enumeration |
| B12-5 | MEDIUM | 5 | `ResponseWrapper.data`/`metadata` are raw `Object` — unbounded serialisation risk |
| B12-6 | HIGH | 5 | `Driver.password`, `licno`, `securityno` serialised in `getCompanyDrivers` response |
| B12-7 | MEDIUM | 5 | `Charts.unit_id` (DB PK) serialised — enables equipment enumeration across tenants |
| B12-8 | INFO | 5 | Non-standard token expiry fields in `AuthenticationResponse` |
