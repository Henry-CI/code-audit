# Audit Report — Agent B16
**Pass:** 1 (Security Review)
**Date:** 2026-02-27
**Repo:** forkliftiqws
**Branch:** master
**Assigned files:**
- `src/main/java/com/journaldev/spring/jdbc/model/FuelType.java`
- `src/main/java/com/journaldev/spring/jdbc/model/GCMData.java`
- `src/main/java/com/journaldev/spring/jdbc/model/GCMDataPermission.java`

**Supporting files read during review (for context/call-graph):**
- `src/main/java/com/journaldev/spring/jdbc/model/Permissions.java`
- `src/main/java/com/journaldev/spring/jdbc/model/GCMEntity.java`
- `src/main/java/com/journaldev/spring/jdbc/model/GCMResponse.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java`
- `src/main/java/com/journaldev/spring/jdbc/controller/CompanyController.java`

---

## Reading Evidence

### 1. `com.journaldev.spring.jdbc.model.FuelType`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.FuelType`

**Interfaces implemented:** `java.io.Serializable`

**Class annotations:** none

**Fields:**

| Access    | Type   | Name            | Notes                          |
|-----------|--------|-----------------|--------------------------------|
| private static final | long | serialVersionUID | `8705969780919933138L` |
| private   | int    | id              |                                |
| private   | String | name            |                                |

**Public methods:**

| Return type | Method signature         | Line |
|-------------|--------------------------|------|
| int         | `getId()`                | 16   |
| void        | `setId(int id)`          | 19   |
| String      | `getName()`              | 22   |
| void        | `setName(String name)`   | 25   |

**Class/method annotations:** none

---

### 2. `com.journaldev.spring.jdbc.model.GCMData`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.GCMData`

**Interfaces implemented:** none

**Class extended:** none (plain `Object`)

**Class annotations:** none

**Fields:**

| Access    | Type   | Name | Notes                                    |
|-----------|--------|------|------------------------------------------|
| protected | String | to   | GCM device token / registration ID      |

**Public methods:**

| Return type | Method signature        | Line |
|-------------|-------------------------|------|
| String      | `getTo()`               | 7    |
| void        | `setTo(String to)`      | 11   |

**Class/method annotations:** none

---

### 3. `com.journaldev.spring.jdbc.model.GCMDataPermission`

**Fully qualified class name:** `com.journaldev.spring.jdbc.model.GCMDataPermission`

**Class extended:** `com.journaldev.spring.jdbc.model.GCMData`

**Interfaces implemented:** `java.io.Serializable`

**Class annotations:** none

**Fields:**

| Access  | Type                | Name            | Notes                              |
|---------|---------------------|-----------------|------------------------------------|
| private static final | long | serialVersionUID | `-6506991783027460200L` |
| private | Permissions         | data            | Full `Permissions` object embedded |

**Public methods:**

| Return type  | Method signature                    | Line |
|--------------|-------------------------------------|------|
| Permissions  | `getData()`                         | 14   |
| void         | `setData(Permissions data)`         | 18   |

**Class/method annotations:** none

---

### Supporting context — `com.journaldev.spring.jdbc.model.Permissions`

This is the payload object nested inside `GCMDataPermission.data`. Its fields (all exposed via Lombok `@Data`-generated getters/setters) are:

| Access  | Type   | Name         |
|---------|--------|--------------|
| private | Long   | id           |
| private | Long   | driver_id    |
| private | String | driver_name  |
| private | Long   | comp_id      |
| private | String | enabled      |
| private | String | gsm_token    |

Lombok annotations on class: `@Data`, `@NoArgsConstructor`, `@EqualsAndHashCode(onlyExplicitlyIncluded = true)`

---

### Supporting context — `com.journaldev.spring.jdbc.controller.RuntimeConfig`

Hardcoded static fields of security relevance:

| Field      | Value (literal)                                      |
|------------|------------------------------------------------------|
| GCMSERVER  | `"https://gcm-http.googleapis.com/gcm/send"`         |
| GCMKEY     | `"key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs"`    |
| USERNAME   | `"ciclickatell"`                                     |
| PASSWORD   | `"OVLOaICXccaNUS"`                                   |
| SMSFROM    | `"13234862361"`                                      |
| API_ID     | `"3629505"`                                          |

---

## Checklist Review

### Section 1 — Secrets and Configuration

**Finding B16-1 — CRITICAL**

The GCM server API key (a Google Cloud Messaging bearer credential) is hardcoded as a public static field in source code.

**Finding B16-2 — CRITICAL**

The Clickatell SMS gateway credentials (username, password, API ID) are hardcoded as public static fields in source code. Although these fields are in `RuntimeConfig.java` and not in the three directly assigned model files, the GCM model classes are the downstream consumers of the GCM key — `GCMData.to` receives the device token and `RuntimeConfig.GCMKEY` is the authorization header used when the GCM POST is constructed. These findings are raised here as they are the direct dependency of the assigned GCM models.

All other Section 1 checks (application.properties, web.xml, pom.xml, bitbucket-pipelines.yml) are outside scope for this agent's assigned files. Flagged for cross-referencing by agents assigned those files.

### Section 2 — Authentication and Authorization

N/A for model classes. No controller, security configuration, or endpoint logic in the assigned files.

### Section 3 — Input Validation and Injection

**`@JsonTypeInfo` default typing:** No `@JsonTypeInfo` annotation is present on any of the three assigned classes. No global ObjectMapper configuration is visible in these files. CLEAR for this specific check.

**Deserialization via `Serializable`:** `FuelType`, `GCMDataPermission`, and `Permissions` all implement `java.io.Serializable`. No `readObject()` override is present. The serialVersionUID values are explicitly declared, which is correct practice. No direct `ObjectInputStream` usage in these model files. CLEAR for these files in isolation; risk depends on whether these objects are ever deserialized from untrusted input at a higher layer (outside scope for this agent).

**Input validation (`@Valid`, constraint annotations):** `GCMDataPermission` carries a full `Permissions` object as its `data` field. `Permissions` has no `@NotNull`, `@Size`, or any JSR-303 constraint annotations on any field — including `driver_id`, `comp_id`, and `gsm_token`. This is relevant because `Permissions` is also used as a `@RequestBody` in `CompanyController.addCompany()` (line 62), where it is used directly in SQL queries via `JdbcTemplate`. However, because `JdbcTemplate` uses parameterized queries at that call site, SQL injection is mitigated there. The absence of validation constraints on the model is still a weakness.

### Section 4 — Session and CSRF

N/A for model classes.

### Section 5 — Data Exposure

**Finding B16-3 — HIGH**

`GCMDataPermission` embeds a complete `Permissions` object as its `data` field. The `Permissions` class (read as a supporting file to trace the payload) contains `gsm_token` — the device's GCM registration token. This means the push notification payload sent to an Android device via GCM includes the recipient device's own registration token within the message body. Sending a device token back to the device that owns it is redundant, but more importantly the `Permissions` object also contains `driver_id`, `driver_name`, `comp_id`, `enabled`, and the internal database `id` (primary key). This is a data over-exposure issue: a GCM push notification payload should contain only the minimum information needed to display or process the notification on the device. Internal database IDs, company IDs, and the device's own token should not be included unless explicitly required by the client-side logic.

**Finding B16-4 — MEDIUM**

`GCMData.to` is typed as a `protected` (package-accessible) `String` field with no access control, validation, or masking. It holds the GCM device registration token — a sensitive identifier that, if leaked in logs or error responses, allows push notifications to be sent to a specific device by any party with GCM server access. No `@JsonIgnore` or equivalent annotation prevents this field from being serialized in responses.

**Logging check:** In `CompanyController.java` (supporting file), `logger.info("Start Sending Email to " + email)` (lines 103, 105) logs operator email addresses at INFO level, which will appear in production logs. This is a PII-in-logs issue; it is outside the three assigned model files but is in scope for the GCM/Permissions data flow traced here.

### Section 6 — Dependencies

N/A for model classes.

### Section 7 — Build and CI

N/A for model classes.

---

## Findings Summary

**B16-1** — CRITICAL
**Section:** 1 — Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:14`
**Description:** GCM server API key hardcoded as a public static string literal in source code. Anyone with read access to the repository can use this key to send push notifications to any registered device in the application.
**Evidence:**
```java
public static String GCMKEY = "key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs";
```

---

**B16-2** — CRITICAL
**Section:** 1 — Secrets and Configuration
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java:18-21`
**Description:** Clickatell SMS gateway credentials (username, plaintext password, and API ID) hardcoded as public static string literals. These credentials authorize SMS sending on behalf of the application's account and will be exposed in any repository clone or build artifact.
**Evidence:**
```java
public static String USERNAME = "ciclickatell";
public static String PASSWORD = "OVLOaICXccaNUS";
public static String SMSFROM = "13234862361";
public static String API_ID = "3629505";
```

---

**B16-3** — HIGH
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/GCMDataPermission.java:12` / `src/main/java/com/journaldev/spring/jdbc/model/Permissions.java`
**Description:** The GCM push notification payload (`GCMDataPermission`) embeds a complete `Permissions` object including internal database IDs (`id`, `driver_id`, `comp_id`), driver name, enabled state, and the device's own `gsm_token`. GCM notification payloads should carry only the minimum data necessary to render or act on the notification. Embedding internal relational IDs, company identifiers, and the device token in the outbound message body constitutes data over-exposure. If the GCM channel or device is compromised, this data is disclosed.
**Evidence:**
```java
// GCMDataPermission.java
private Permissions data;  // full Permissions object in push payload

// Permissions.java — all fields serialized by Lombok @Data
private Long id;
private Long driver_id;
private String driver_name;
private Long comp_id;
private String enabled;
private String gsm_token;  // device token echoed back in payload
```

---

**B16-4** — MEDIUM
**Section:** 5 — Data Exposure
**File:** `src/main/java/com/journaldev/spring/jdbc/model/GCMData.java:5`
**Description:** The `to` field (GCM device registration token) is `protected` with no `@JsonIgnore` or equivalent annotation. The `GCMData` object (and its subclass `GCMDataPermission`) is serialized and sent as the request body to the GCM API endpoint. If `GCMData`/`GCMDataPermission` instances are also returned in any API response (or logged), the device token is exposed to the caller. Device registration tokens are sensitive: possession of a valid token combined with the GCM server key (already hardcoded — see B16-1) enables targeted push notification delivery to that device.
**Evidence:**
```java
public class GCMData {
    protected String to;  // GCM device registration token, no @JsonIgnore

    public String getTo() {
        return to;
    }
```

---

**B16-5** — LOW
**Section:** 3 — Input Validation and Injection
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Permissions.java`
**Description:** The `Permissions` class is used directly as a `@RequestBody` parameter in `CompanyController.addCompany()`. None of its fields carry JSR-303 Bean Validation constraints (`@NotNull`, `@Size`, `@Pattern`, etc.), and the controller method has no `@Valid` annotation. While the immediate SQL calls use parameterized queries (mitigating SQL injection), the absence of validation means null or malformed `driver_id`/`comp_id` values will reach database layer code, potentially causing unhandled `NullPointerException` or unexpected query behavior that reveals internal state via error responses.
**Evidence:**
```java
// Permissions.java — no constraints on any field
private Long id;
private Long driver_id;
private String driver_name;
private Long comp_id;
private String enabled;
private String gsm_token;

// CompanyController.java line 62 — no @Valid
public @ResponseBody ResponseEntity<Permissions> addCompany(@RequestBody Permissions permission) {
```

---

*End of B16 report.*
