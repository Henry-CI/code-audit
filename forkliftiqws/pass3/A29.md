# Audit Report A29 — Pass 3: Documentation
**Date:** 2026-02-27
**Agent:** A29
**Pass:** 3 (Documentation)
**Scope:** Javadoc existence and accuracy for all public methods across three service files.

---

## Source Files Examined

1. `src/main/java/com/journaldev/spring/jdbc/service/LocalFileStorageService.java`
2. `src/main/java/com/journaldev/spring/jdbc/service/SaveFileInfo.java`
3. `src/main/java/com/journaldev/spring/jdbc/service/UserDetailsServiceImpl.java`

Supporting files read for context:
- `src/main/java/com/journaldev/spring/jdbc/service/AbstractFileStorageService.java`
- `src/main/java/com/journaldev/spring/jdbc/service/FileStorageService.java`
- `src/main/java/com/journaldev/spring/jdbc/DAO/UserDAO.java`
- `src/main/java/com/journaldev/spring/jdbc/model/User.java`

---

## Reading Evidence

### File 1: LocalFileStorageService.java (31 lines)

```java
@Service("localFileStorage")
@Slf4j
public class LocalFileStorageService extends AbstractFileStorageService {

    @Override
    public Resource loadImageAsResource(String fileName) {
        log.info("Start loadImageAsResource");
        try {
            Path filePath = imageStorageLocation.resolve(fileName).normalize();
            Resource resource = new UrlResource(filePath.toUri());
            if (resource.exists()) {
                return resource;
            } else {
                throw new FileNotFoundException("Unable to find " + fileName
                    + " at location : " + filePath.toString() + " on server");
            }
        } catch (MalformedURLException ex) {
            throw new FileStorageException("Invalid filename, unable to build url for " + fileName, ex);
        }
    }
}
```

- Class-level Javadoc: ABSENT
- Method `loadImageAsResource(String fileName)` — public, `@Override` from `FileStorageService` interface — Javadoc: ABSENT
- No `@param`, `@return`, or `@throws` documentation present anywhere in the file.

### File 2: SaveFileInfo.java (18 lines)

```java
@Data
@Builder
public class SaveFileInfo implements Serializable {
    private static final long serialVersionUID = 6183703080165788038L;
    private String fileName;
    private String fileDownloadUri;
    private String fileType;
    private long size;
}
```

- Class-level Javadoc: ABSENT
- This class uses Lombok `@Data` and `@Builder`. Lombok generates the following public API at compile time:
  - `getFileName()`, `setFileName(String)`
  - `getFileDownloadUri()`, `setFileDownloadUri(String)`
  - `getFileType()`, `setFileType(String)`
  - `getSize()`, `setSize(long)`
  - `equals(Object)`, `hashCode()`, `toString()`
  - `SaveFileInfo.SaveFileInfoBuilder builder()` (static)
  - Builder inner class with `fileName(String)`, `fileDownloadUri(String)`, `fileType(String)`, `size(long)`, `build()`
- No field-level Javadoc comments present.
- No class-level documentation explaining the purpose or usage of the DTO.

### File 3: UserDetailsServiceImpl.java (52 lines)

```java
@Service("userDetailsService")
public class UserDetailsServiceImpl implements UserDetailsService {

    @Autowired
    private UserDAO dao;

    @Transactional(readOnly = true)
    public UserDetails loadUserByUsername(String username)
            throws UsernameNotFoundException, DataAccessException {
        User userEntity = dao.findByName(username).orElseThrow(
            () -> new UsernameNotFoundException("user not found"));
        return buildUserFromUserEntity(userEntity);
    }

    private UserDetails buildUserFromUserEntity(
            com.journaldev.spring.jdbc.model.User userEntity) {
        String username = userEntity.getEmail();
        String password = userEntity.getPassword();
        boolean enabled = true;
        boolean accountNonExpired = true;
        boolean credentialsNonExpired = true;
        boolean accountNonLocked = userEntity.isActive();
        Collection<GrantedAuthority> authorities = new ArrayList<>();
        for (Roles role : userEntity.getRoles()) {
            authorities.add(new SimpleGrantedAuthority(role.getAuthority()));
        }
        org.springframework.security.core.userdetails.User user =
            new org.springframework.security.core.userdetails.User(
                username, password, enabled, accountNonExpired,
                credentialsNonExpired, accountNonLocked, authorities);
        return user;
    }
}
```

- Class-level Javadoc: ABSENT
- Method `loadUserByUsername(String username)` — public, implements `UserDetailsService` contract — Javadoc: ABSENT
- Method `buildUserFromUserEntity(User userEntity)` — private; out of scope for public-API Javadoc requirement, noted for completeness.
- Non-trivial behavioral detail: the `username` parameter is matched against the database by `name` OR `md5(name)` (per `UserDAO.QUERY_USER_BY_NAME`), but the returned `UserDetails` object uses the **email** field as the principal name, not the `username` argument. This discrepancy has no documentation anywhere in the call chain.

---

## Public Method Enumeration

### LocalFileStorageService

| Method | Visibility | Javadoc Present | Notes |
|--------|-----------|-----------------|-------|
| `loadImageAsResource(String fileName)` | public | NO | Override of `FileStorageService`; throws `FileNotFoundException` and `FileStorageException` — neither documented |

### SaveFileInfo (Lombok-generated public API)

| Method | Visibility | Javadoc Present | Notes |
|--------|-----------|-----------------|-------|
| `getFileName()` | public | NO | Lombok-generated |
| `setFileName(String)` | public | NO | Lombok-generated |
| `getFileDownloadUri()` | public | NO | Lombok-generated |
| `setFileDownloadUri(String)` | public | NO | Lombok-generated |
| `getFileType()` | public | NO | Lombok-generated |
| `setFileType(String)` | public | NO | Lombok-generated |
| `getSize()` | public | NO | Lombok-generated |
| `setSize(long)` | public | NO | Lombok-generated |
| `builder()` (static) | public | NO | Lombok-generated |
| `equals(Object)` | public | NO | Lombok-generated |
| `hashCode()` | public | NO | Lombok-generated |
| `toString()` | public | NO | Lombok-generated |

### UserDetailsServiceImpl

| Method | Visibility | Javadoc Present | Notes |
|--------|-----------|-----------------|-------|
| `loadUserByUsername(String username)` | public | NO | Implements `UserDetailsService`; critical security method |

---

## Findings

---

### A29-1
**Severity:** HIGH
**File:** `LocalFileStorageService.java`
**Location:** Class declaration, line 13
**Finding:** The class `LocalFileStorageService` has no class-level Javadoc comment. There is no documentation describing its purpose as the local-filesystem implementation of `FileStorageService`, how it differs from other potential storage backends, or which Spring bean name (`"localFileStorage"`) to use when injecting it by qualifier.

---

### A29-2
**Severity:** HIGH
**File:** `LocalFileStorageService.java`
**Location:** `loadImageAsResource(String fileName)`, line 16
**Finding:** The sole public method has no Javadoc. There is no `@param fileName`, no `@return` describing the `Resource` object returned, and no `@throws` for either `FileNotFoundException` (thrown when the file does not exist on disk) or `FileStorageException` (thrown when the filename produces a malformed URL). Both exceptions are unchecked custom types and their conditions are entirely undiscoverable without reading the implementation.

---

### A29-3
**Severity:** HIGH
**File:** `SaveFileInfo.java`
**Location:** Class declaration, line 10
**Finding:** The class `SaveFileInfo` has no class-level Javadoc. There is no documentation describing its role as a data transfer object (DTO) for file-save response payloads, the context in which it is constructed (file upload operations), or the semantics of the `serialVersionUID` field. A consumer of this DTO cannot determine from documentation alone what each field represents.

---

### A29-4
**Severity:** MEDIUM
**File:** `SaveFileInfo.java`
**Location:** Fields `fileName`, `fileDownloadUri`, `fileType`, `size`, lines 14–17
**Finding:** None of the four fields carry Javadoc or inline comments. The semantic distinctions between `fileName` (storage name on server) and `fileDownloadUri` (client-accessible URL) are not documented. The unit of `size` (bytes is implied but not stated) is undocumented. Without field documentation, Lombok-generated accessor Javadoc is also absent, leaving the entire public API undocumented.

---

### A29-5
**Severity:** CRITICAL
**File:** `UserDetailsServiceImpl.java`
**Location:** `loadUserByUsername(String username)`, lines 26–32
**Finding:** The public method `loadUserByUsername` has no Javadoc. This method is the primary security authentication entry point for the application — it is called by Spring Security's `AuthenticationManager` during every authentication attempt. The absence of documentation on this method is critical because:

1. There is no `@param username` documenting that the parameter accepts either a plaintext username **or** its MD5 hash (as revealed by the SQL query in `UserDAO`).
2. There is no `@return` note clarifying that the returned `UserDetails` principal name is the **email** field of the matched user entity, not the `username` argument passed in. This is a non-obvious identity transformation.
3. There is no `@throws UsernameNotFoundException` documenting when it is raised (user not found in database).
4. There is no `@throws DataAccessException` documenting the declared but undocumented database-error failure path.
5. The `@Transactional(readOnly = true)` behaviour and its implications are not documented.

---

### A29-6
**Severity:** HIGH
**File:** `UserDetailsServiceImpl.java`
**Location:** Class declaration, line 20
**Finding:** The class `UserDetailsServiceImpl` has no class-level Javadoc. There is no documentation describing it as the Spring Security `UserDetailsService` implementation, its dependency on `UserDAO`, the authentication model used (database-backed via JDBC), or the Spring bean name `"userDetailsService"` needed for qualifier injection in security configuration.

---

### A29-7
**Severity:** MEDIUM
**File:** `UserDetailsServiceImpl.java`
**Location:** `loadUserByUsername`, lines 38–42 (inside `buildUserFromUserEntity`)
**Finding:** The private method `buildUserFromUserEntity` hardcodes `enabled = true` and `accountNonExpired = true` and `credentialsNonExpired = true` with no documentation or comment justifying these decisions. While the method is private and outside the strict scope of public Javadoc requirements, these hardcoded security flags have no corresponding documentation in the calling public method, meaning callers have no way to know that account expiry and credential expiry are not enforced. This is a documentation accuracy issue for the contract of `loadUserByUsername`.

---

### A29-8
**Severity:** LOW
**File:** `FileStorageService.java` (supporting interface)
**Location:** Interface methods `saveImage` and `loadImageAsResource`, lines 8–10
**Finding:** The `FileStorageService` interface defines the contract that `LocalFileStorageService` implements, but neither interface method has a Javadoc comment. Per the Java convention, interface-level Javadoc is the canonical location for contract documentation that `@Override` implementations inherit. The absence of interface-level docs compounds the missing override-level docs found in A29-2.

---

## Summary Table

| ID | Severity | File | Subject |
|----|----------|------|---------|
| A29-1 | HIGH | LocalFileStorageService.java | Missing class-level Javadoc |
| A29-2 | HIGH | LocalFileStorageService.java | Missing Javadoc on `loadImageAsResource` including `@throws` |
| A29-3 | HIGH | SaveFileInfo.java | Missing class-level Javadoc on DTO |
| A29-4 | MEDIUM | SaveFileInfo.java | No field documentation; unit of `size` unstated |
| A29-5 | CRITICAL | UserDetailsServiceImpl.java | Missing Javadoc on security-critical `loadUserByUsername`; undocumented username-to-email identity transformation |
| A29-6 | HIGH | UserDetailsServiceImpl.java | Missing class-level Javadoc |
| A29-7 | MEDIUM | UserDetailsServiceImpl.java | Hardcoded security flags undocumented in public method contract |
| A29-8 | LOW | FileStorageService.java | Interface contract methods lack Javadoc, compounding implementation gaps |

**Total findings: 8**
**CRITICAL: 1 | HIGH: 4 | MEDIUM: 2 | LOW: 1**
