# Audit Report A04 — Pass 3: Documentation
**Date:** 2026-02-27
**Agent:** A04
**Pass:** 3 (Documentation)
**Scope:** DAO layer — ManufacturerDAO, ManufacturerDAOImpl, UserDAO

---

## Source Files Examined

| # | File |
|---|------|
| 1 | `src/main/java/com/journaldev/spring/jdbc/DAO/ManufacturerDAO.java` |
| 2 | `src/main/java/com/journaldev/spring/jdbc/DAO/ManufacturerDAOImpl.java` |
| 3 | `src/main/java/com/journaldev/spring/jdbc/DAO/UserDAO.java` |

---

## Reading Evidence

### File 1 — ManufacturerDAO.java (lines 1–9)

```java
public interface ManufacturerDAO {
    List<Manufacturer> getManufacturersForUser(String username);
}
```

- Public interface with one method contract.
- No class-level Javadoc.
- No method-level Javadoc on `getManufacturersForUser`.
- No `@param`, `@return`, or `@throws` tags present anywhere in the file.

---

### File 2 — ManufacturerDAOImpl.java (lines 1–37)

```java
@Component("manufacturerDAO")
public class ManufacturerDAOImpl extends JdbcDaoSupport implements ManufacturerDAO {
    private static final Logger logger = LoggerFactory.getLogger(ManufacturerDAOImpl.class);

    @Autowired
    @Qualifier("dataSource")
    public void setDbDataSource(DataSource dataSource) { ... }

    @Override
    public List<Manufacturer> getManufacturersForUser(String username) { ... }
}
```

- No class-level Javadoc.
- `setDbDataSource(DataSource)` is `public` (Spring wiring method) — no Javadoc, no `@param`.
- `getManufacturersForUser(String)` is `public` — no Javadoc, no `@param`, no `@return`.
- The SQL query spans three logical predicates (by driver email, by company email, and global/null entries); this logic is non-trivial and entirely undocumented.

---

### File 3 — UserDAO.java (lines 1–66)

```java
@Component
@Transactional
public class UserDAO extends JdbcDaoSupport {

    @Autowired
    @Qualifier("dataSource")
    public void setDbDataSource(DataSource dataSource) { ... }

    public Optional<User> findByName(final String name) { ... }

    public Optional<Roles> findByAuthority(final String authority) { ... }
}
```

- No class-level Javadoc.
- `setDbDataSource(DataSource)` is `public` — no Javadoc, no `@param`.
- `findByName(String)` is `public` — no Javadoc.
  - The parameter accepts either a plain username **or** an MD5-hashed username (see SQL: `u.name = ? or md5(u.name) = ?`); this dual-accept behaviour is entirely undocumented.
  - Returns `Optional.empty()` when no matching active user is found; this is not documented.
  - Aggregates multiple role rows for the same user inside the `ResultSetExtractor` — non-obvious behaviour, not documented.
- `findByAuthority(String)` is `public` — no Javadoc, no `@param`, no `@return`.
  - `queryForObject` throws `EmptyResultDataAccessException` when no row matches; the `Optional` wrapping is intended to handle this but the implementation does not catch that exception — potential runtime failure is not documented and is itself a latent bug (out of scope for this pass, noted for cross-reference).

---

## Public Method Inventory

| File | Class / Interface | Method Signature | Javadoc Present |
|------|-------------------|------------------|-----------------|
| ManufacturerDAO.java | `ManufacturerDAO` | `List<Manufacturer> getManufacturersForUser(String username)` | No |
| ManufacturerDAOImpl.java | `ManufacturerDAOImpl` | `void setDbDataSource(DataSource dataSource)` | No |
| ManufacturerDAOImpl.java | `ManufacturerDAOImpl` | `List<Manufacturer> getManufacturersForUser(String username)` | No |
| UserDAO.java | `UserDAO` | `void setDbDataSource(DataSource dataSource)` | No |
| UserDAO.java | `UserDAO` | `Optional<User> findByName(String name)` | No |
| UserDAO.java | `UserDAO` | `Optional<Roles> findByAuthority(String authority)` | No |

**Total public methods across 3 files: 6**
**Methods with Javadoc: 0**
**Methods without Javadoc: 6 (100%)**

---

## Findings

---

### A04-1 — Severity: HIGH
**File:** `ManufacturerDAO.java`
**Location:** Interface declaration (line 7) and method (line 8)
**Description:** The `ManufacturerDAO` interface has no class-level Javadoc and its sole contract method `getManufacturersForUser(String username)` has no Javadoc. As the public API contract for the manufacturer data access layer, the interface is the primary place where callers learn the expected behaviour, parameter semantics, and return contract. The absence of documentation here propagates ignorance to all consumers.
**Missing:** Class Javadoc; `@param username`; `@return` description; any note on what "for user" means (driver vs company vs global entries).

---

### A04-2 — Severity: HIGH
**File:** `ManufacturerDAOImpl.java`
**Location:** Class declaration (line 16), `getManufacturersForUser` (lines 26–36)
**Description:** The implementation class has no class-level Javadoc and the `@Override` method `getManufacturersForUser` has no Javadoc. The SQL executed by this method merges three distinct result sets: manufacturers accessible via driver permission, manufacturers accessible via company ownership, and globally available manufacturers (`company_id is null`). This three-way union logic is completely undocumented and non-obvious.
**Missing:** Class Javadoc; `@param username`; `@return`; inline or Javadoc description of the three-predicate SQL access model.

---

### A04-3 — Severity: MEDIUM
**File:** `ManufacturerDAOImpl.java`
**Location:** `setDbDataSource(DataSource)` (lines 19–23)
**Description:** The Spring `@Autowired` / `@Qualifier` datasource wiring method is public but carries no Javadoc. While Spring-wiring methods are boilerplate, their public visibility makes them part of the class's documented surface. The qualifier name `"dataSource"` and the delegation to `super.setDataSource` are not explained.
**Missing:** `@param dataSource`; note that this is a Spring wiring entry point delegating to `JdbcDaoSupport`.

---

### A04-4 — Severity: HIGH
**File:** `UserDAO.java`
**Location:** Class declaration (line 22) and `findByName` (lines 33–58)
**Description:** `UserDAO` has no class-level Javadoc and `findByName(String name)` has no Javadoc. The method contains non-trivial behaviour: (1) the parameter is matched against both the plain username AND its MD5 hash, meaning callers may pass either form; (2) only `active = true` users are returned; (3) multiple rows for the same user are folded into a single `User` object with multiple `Roles` entries via a `ResultSetExtractor`. None of this contract is documented.
**Missing:** Class Javadoc; `@param name` (with explanation of plain-or-MD5 dual-accept); `@return` (noting `Optional.empty()` on no match); description of role aggregation behaviour; note on the `active` filter.

---

### A04-5 — Severity: HIGH
**File:** `UserDAO.java`
**Location:** `findByAuthority(String authority)` (lines 61–65)
**Description:** `findByAuthority` has no Javadoc of any kind. The method uses `queryForObject` which throws `EmptyResultDataAccessException` if no row is found; the method signature promises `Optional<Roles>` but the exception is not caught, meaning the `Optional.empty()` branch on line 64 is unreachable in practice when the authority does not exist. While the runtime correctness defect is a separate audit concern, the documentation failure means no caller is warned about this discrepancy between the declared contract and actual behaviour.
**Missing:** `@param authority`; `@return`; `@throws` (or a note that `EmptyResultDataAccessException` may propagate despite the `Optional` return type).

---

### A04-6 — Severity: MEDIUM
**File:** `UserDAO.java`
**Location:** `setDbDataSource(DataSource)` (lines 25–29)
**Description:** Same pattern as A04-3 in the implementation class. The public Spring wiring method is undocumented.
**Missing:** `@param dataSource`; note on Spring wiring delegation.

---

### A04-7 — Severity: LOW
**File:** `UserDAO.java`
**Location:** Class declaration (line 22)
**Description:** `UserDAO` is not named with the conventional `Impl` suffix nor does it implement an interface, unlike `ManufacturerDAOImpl` which implements `ManufacturerDAO`. The absence of an interface means there is no contract-level documentation layer at all. This architectural documentation gap compounds the missing method-level Javadoc.
**Missing:** No interface contract exists; class-level Javadoc should at minimum document the class's role in the authentication/security domain.

---

### A04-8 — Severity: LOW
**File:** `UserDAO.java`
**Location:** Line 31 (`QUERY_USER_BY_NAME`) and line 60 (`QUERY_ROLE_BY_AUTHORITY`)
**Description:** Both SQL query constants are `private static final` fields with no inline comment explaining the query's intent, the view they target (`v_apiusers`), or why `md5(u.name)` is used as a secondary match criterion. While private fields are not subject to Javadoc requirements, SQL constants of this complexity warrant an explanatory comment.
**Missing:** Inline comments on `QUERY_USER_BY_NAME` and `QUERY_ROLE_BY_AUTHORITY`.

---

## Summary Table

| ID | Severity | File | Element | Issue |
|----|----------|------|---------|-------|
| A04-1 | HIGH | ManufacturerDAO.java | Interface + `getManufacturersForUser` | No class or method Javadoc on the public contract interface |
| A04-2 | HIGH | ManufacturerDAOImpl.java | Class + `getManufacturersForUser` | No class or method Javadoc; non-trivial three-predicate SQL undocumented |
| A04-3 | MEDIUM | ManufacturerDAOImpl.java | `setDbDataSource` | Public Spring wiring method undocumented |
| A04-4 | HIGH | UserDAO.java | Class + `findByName` | No class or method Javadoc; dual-accept param, role aggregation, and active filter undocumented |
| A04-5 | HIGH | UserDAO.java | `findByAuthority` | No Javadoc; unreachable `Optional.empty()` and uncaught exception not warned in any documentation |
| A04-6 | MEDIUM | UserDAO.java | `setDbDataSource` | Public Spring wiring method undocumented |
| A04-7 | LOW | UserDAO.java | Class level | No interface contract; no class-level Javadoc for security-domain DAO |
| A04-8 | LOW | UserDAO.java | SQL constants | Complex SQL constants have no inline explanatory comments |

**Finding counts by severity:**
- HIGH: 4 (A04-1, A04-2, A04-4, A04-5)
- MEDIUM: 2 (A04-3, A04-6)
- LOW: 2 (A04-7, A04-8)
- CRITICAL: 0
- INFO: 0

---

*End of report A04.*
