# Audit Report A32 — Pass 2: Test Coverage
**Date:** 2026-02-27
**Agent:** A32
**Scope:** `SendMessage.java`, `Util.java`
**Working directory:** `C:\Projects\cig-audit\repos\forkliftiqws`

---

## Reading Evidence

### File 1: `src/main/java/com/journaldev/spring/jdbc/util/SendMessage.java`

**Class:** `SendMessage` (public, concrete, non-annotated)

| Method | Visibility | Line | Signature |
|--------|-----------|------|-----------|
| `init` | public | 36 | `void init(String msg, String mobile_no)` |
| `send_sms_message` | private | 90 | `void send_sms_message(String msg, String mobile_no) throws SQLException, IOException` |
| `readLines` | private | 154 | `String[] readLines(String url) throws IOException` |

**Fields (instance):**
- `Connection conn` (line 29) — uninitialized instance field
- `Statement stmt` (line 30) — uninitialized instance field
- `ResultSet rset` (line 31) — uninitialized instance field
- `String query` (line 32) — uninitialized instance field

**Static fields:**
- `Logger logger` (line 27) — SLF4J logger via `LoggerFactory`

**Constants / External config consumed (all from `RuntimeConfig`):**
- `RuntimeConfig.production_database` — JNDI datasource name
- `RuntimeConfig.LOCATION` — SMS gateway base URL (`https://api.clickatell.com`)
- `RuntimeConfig.USERNAME` — Clickatell username (hardcoded in RuntimeConfig)
- `RuntimeConfig.PASSWORD` — Clickatell password (hardcoded in RuntimeConfig)
- `RuntimeConfig.API_ID` — Clickatell API ID (hardcoded in RuntimeConfig)
- `RuntimeConfig.SMSFROM` — SMS sender number

**Error / Exception types referenced:**
- `Exception` — thrown explicitly if `InitialContext` is null (line 41); caught broadly at line 53
- `SQLException` — declared thrown by `send_sms_message` (line 91); caught in finally for `rset`, `stmt`, `conn` close operations (lines 60, 65, 70)
- `IOException` — declared thrown by `send_sms_message` (line 91) and `readLines` (line 154)
- `ArrayIndexOutOfBoundsException` — possible (not caught) if `array_ret` is empty (lines 114, 131)
- `NullPointerException` — possible (not caught) if `array_ret` is null (lines 114, 131)

**Key logic branches in `send_sms_message`:**
1. `array_mobile_no != null` check (line 102) — always true (split never returns null in Java)
2. Auth response: `array_sess[0].equalsIgnoreCase("OK")` (line 116) — success path
3. Auth response: else branch (line 142) — authentication failure path
4. `text.length() > 160` (line 121) — concat=2 (multi-part SMS) path
5. `text.length() <= 160` (line 125) — single SMS path
6. Send response: `array_send[0].equalsIgnoreCase("ID")` (line 132) — send success path
7. Send response: else branch (line 137) — send failure path

---

### File 2: `src/main/java/com/journaldev/spring/jdbc/util/Util.java`

**Class:** `Util` (public, concrete, no constructor — utility class pattern but not final, not private constructor)

| Method | Visibility | Line | Signature |
|--------|-----------|------|-----------|
| `generateRadomName` | public static | 27 | `String generateRadomName()` |
| `sendMail` | public static | 36 | `boolean sendMail(String subject, String mBody, String rName, String rEmail, String sName, String sEmail, String attachment, String attachmentName)` |

**Static fields:**
- `Logger logger` (line 25) — declared but never used inside this class

**Constants / External config consumed:**
- SMTP host: `email-smtp.us-east-1.amazonaws.com` (hardcoded, line 46)
- SMTP port: `465` (hardcoded, line 58)
- SSL socket factory: `javax.net.ssl.SSLSocketFactory` (line 54)
- AWS SES SMTP username: `AKIA**REDACTED**` (hardcoded literal, line 66)
- AWS SES SMTP password: `****REDACTED****` (hardcoded literal, line 66)

**Error / Exception types referenced:**
- `Exception` — caught at line 80 for `setRecipients` failure (swallowed, printed to stdout only)
- `Throwable` — caught at line 116, top-level catch-all (swallowed, stack trace to stderr only)
- `Exception` — caught at line 112 for `Transport.send` failure (swallowed, stack trace to stderr only)

**Key logic branches in `sendMail`:**
1. `sEmail != null` (line 72) — explicit sender address vs default sender
2. `!attachment.equalsIgnoreCase("")` (line 98) — with-attachment path vs body-only path
3. `Transport.send` success — no explicit return value differentiation (always returns `true`)
4. `Transport.send` failure — caught, printed, still returns `true`

**Parameters with no null-guard:**
- `attachment` (line 98) — `NullPointerException` if null is passed (`.equalsIgnoreCase` on null)
- `rEmail` (line 79) — `InternetAddress.parse` will throw on malformed input (caught, but silently)
- `mBody`, `subject`, `attachmentName` — no null checks, passed directly to JavaMail

---

## Test Coverage Summary

The test tree contains exactly three test files:

| Test File | Covers |
|-----------|--------|
| `DateUtilTest.java` | `DateUtil` only |
| `PackageEntryTest.java` | `PackageEntry.compareTo` only |
| `APKUpdaterServiceTest.java` | All test methods commented out — effectively empty |

**Neither `SendMessage` nor `Util` appears in any test file.** No indirect coverage was found via search for the class names, method names (`sendMail`, `generateRadomName`, `init`, `send_sms_message`, `readLines`), or any import of these classes in test sources.

---

## Findings

---

### A32-1 — Severity: CRITICAL
**Hardcoded AWS SES SMTP credentials in `Util.sendMail`**

File: `src/main/java/com/journaldev/spring/jdbc/util/Util.java`, line 66

```java
return new PasswordAuthentication("AKIA**REDACTED**", "****REDACTED****");
```

An AWS IAM access key ID and SMTP secret are embedded as string literals directly in source code. These credentials are checked into version control and are exposed to anyone with repository access. No test exists that would catch regression from credential rotation or externalization. The IAM key format (`AKIA...`) is recognizable by automated secret-scanning tools and can be exploited externally if the repository is leaked.

---

### A32-2 — Severity: CRITICAL
**Hardcoded Clickatell SMS gateway credentials in `RuntimeConfig` consumed by `SendMessage`**

File: `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java`, lines 18-21
Consumed by: `SendMessage.send_sms_message`, lines 112, 123, 127

```java
public static String USERNAME = "ciclickatell";
public static String PASSWORD = "OVLOaICXccaNUS";
public static String API_ID   = "3629505";
```

Clickatell username, password, and API ID are hardcoded static fields. There are no tests that verify these values come from an external/injectable source, and no tests that verify correct behavior when credentials are absent or invalid.

---

### A32-3 — Severity: CRITICAL
**Zero test coverage for `SendMessage` (all three methods)**

No test class exists for `SendMessage`. The following methods have 0% test coverage:

- `init(String, String)` (line 36)
- `send_sms_message(String, String)` (line 90) — private, reachable via `init`
- `readLines(String)` (line 154) — private, reachable via `send_sms_message`

Live SMS messages are sent in production via `ImpactDAO` (line 85-86) with no test harness, mocking, or seam to intercept the HTTP call to the Clickatell gateway.

---

### A32-4 — Severity: CRITICAL
**Zero test coverage for `Util.sendMail`**

No test class exercises `Util.sendMail`. This method dispatches real email through AWS SES. Called from `ResumeController` (lines 333, 338, 343, 348, 417). No mock `Transport`, no spy, no integration test exists. Failures are silently swallowed (see A32-9).

---

### A32-5 — Severity: HIGH
**`sendMail` always returns `true` regardless of success or failure**

File: `Util.java`, line 119

```java
} catch (Throwable t) {
    t.printStackTrace();
}
return true;
```

The method signature `boolean sendMail(...)` implies a success/failure signal, but `true` is unconditionally returned even when `Transport.send` throws, when recipient parsing fails, or when any `Throwable` is caught. All callers in `ResumeController` ignore the return value, but the broken contract means future callers cannot rely on the return value. No test verifies the return value under failure conditions.

---

### A32-6 — Severity: HIGH
**`NullPointerException` on null `attachment` parameter in `sendMail`**

File: `Util.java`, line 98

```java
if (!attachment.equalsIgnoreCase("")) {
```

If `attachment` is `null`, a `NullPointerException` is thrown, bubbles up to the `Throwable` catch, and is silently swallowed. The method returns `true` as though mail was sent. There is no null-guard and no test for the null-attachment path.

---

### A32-7 — Severity: HIGH
**`ArrayIndexOutOfBoundsException` risk in `send_sms_message` when HTTP response is empty**

File: `SendMessage.java`, lines 114 and 131

```java
array_ret = readLines(url);
array_sess = array_ret[0].split(":");  // line 114 — AIOOBE if array_ret is empty
...
array_ret = readLines(url);
array_send = array_ret[0].split(":");  // line 131 — AIOOBE if array_ret is empty
```

If the Clickatell auth or send endpoint returns an empty HTTP body, `readLines` returns an empty array. Accessing `array_ret[0]` then throws `ArrayIndexOutOfBoundsException`. This exception is not explicitly caught; the outer `init` catch-all (`catch(Exception e)`) absorbs it without logging the failure reason. No test covers the empty-response path.

---

### A32-8 — Severity: HIGH
**`null` check on `array_mobile_no` is dead code; empty-string element risk unaddressed**

File: `SendMessage.java`, line 102

```java
if(array_mobile_no != null)
```

`String.split()` never returns `null` in Java — it always returns a non-null array. The null branch at line 147 (`logger.info("No SMS messages to send.")`) is therefore unreachable dead code. The actual edge case — an empty `mobile_no` string producing `array_mobile_no = [""]` — is not guarded, and will result in sending an SMS to an empty `to` address. No test covers this path.

---

### A32-9 — Severity: HIGH
**Silent exception swallowing in `sendMail` and `init` — errors are not propagated or logged**

File: `Util.java`, lines 80-82, 112-114, 116-118
File: `SendMessage.java`, lines 53-55, 60-62, 65-67, 70-72

In `Util.sendMail`:
- `setRecipients` exception is caught and printed to `System.out` (not logged, not rethrown).
- `Transport.send` exception is caught and stack-traced to stderr (not logged via SLF4J, not rethrown).
- The entire method body is wrapped in `catch (Throwable t)` which also only stack-traces.

In `SendMessage.init`:
- The entire operation is wrapped in `catch(Exception e) { e.printStackTrace(); }` — no SLF4J logging of the exception.
- JDBC close failures in `finally` are printed to `System.out`, not via SLF4J.

No test verifies that failures surface to calling code or monitoring systems.

---

### A32-10 — Severity: HIGH
**`rset` (`ResultSet`) is declared as an instance field but never assigned — misleading resource cleanup**

File: `SendMessage.java`, lines 31 and 58-62

```java
ResultSet rset;  // instance field, never written in any method
...
if (rset != null) { try { rset.close(); } ... }
```

`rset` is never assigned anywhere in `SendMessage`. The `finally` block that attempts to close it is dead code. The field declaration suggests a `ResultSet` is expected to be used, implying either incomplete implementation or a copy-paste remnant. No test would detect this latent bug.

---

### A32-11 — Severity: HIGH
**`query` field declared but never used**

File: `SendMessage.java`, line 32

```java
String query;
```

The instance field `query` is declared but never read or written anywhere in `SendMessage`. It is dead code. No test would expose this.

---

### A32-12 — Severity: MEDIUM
**Zero test coverage for `Util.generateRadomName`**

File: `Util.java`, lines 27-34

```java
public static String generateRadomName() { ... }
```

This pure utility method (no I/O, no external dependencies) is directly testable in isolation. It is called from `HttpDownloadUtility` (line 130) and `AbstractFileStorageService` (line 65). No test verifies:
- Output format (timestamp prefix + UUID suffix with `-` separator)
- Uniqueness across invocations
- Correct timestamp format (`yyyyMMddHHmmss`)

Note: the method name contains a typo (`Radom` instead of `Random`) which is not caught by any test or review gate.

---

### A32-13 — Severity: MEDIUM
**`SendMessage` uses instance fields for JDBC resources — not thread-safe**

File: `SendMessage.java`, lines 29-31

```java
Connection conn;
Statement stmt;
ResultSet rset;
```

`conn`, `stmt`, and `rset` are instance-level (not local) fields. If a `SendMessage` instance were shared across threads (e.g., if it were a Spring bean), concurrent calls to `init` would race on these fields. Currently `SendMessage` is instantiated per-call in `ImpactDAO` (line 85: `new SendMessage()`), which avoids the race, but the design is fragile and no test documents or enforces the per-call instantiation requirement.

---

### A32-14 — Severity: MEDIUM
**`DataInputStream.readLine()` is deprecated; character encoding not guaranteed**

File: `SendMessage.java`, line 163

```java
while ((s = dis.readLine()) != null) {
```

`DataInputStream.readLine()` is deprecated since Java 1.1. It does not handle character encoding correctly (treats all bytes as ISO-8859-1 characters). The Clickatell API may return UTF-8 responses. Using `BufferedReader` with an explicit `Charset` is the correct approach. No test verifies encoding behavior of the response parser.

---

### A32-15 — Severity: MEDIUM
**`sendMail` recipient-parse failure does not abort send — malformed email proceeds**

File: `Util.java`, lines 78-82

```java
try {
    message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(rEmail, false));
} catch (Exception e) {
    System.out.println("Message Recipents Exception :" + e);
}
```

If `InternetAddress.parse` throws (malformed `rEmail`), execution continues to `Transport.send` with no recipient set. JavaMail will throw during send, which is caught by the outer `Transport.send` try-catch. The net result: mail is silently not sent but `true` is returned. No test covers the malformed recipient path.

---

### A32-16 — Severity: MEDIUM
**`Util` is an instantiable utility class — missing private constructor**

File: `Util.java`, lines 24-121

`Util` has only `public static` methods and a `private static final Logger`. There is no private no-arg constructor to prevent instantiation (`new Util()`). The class is not declared `final`. Standard practice for static utility classes (Effective Java Item 4) requires a private constructor with a comment or `UnsupportedOperationException`. No test enforces this contract.

---

### A32-17 — Severity: MEDIUM
**`logger` declared in `Util` but never used**

File: `Util.java`, line 25

```java
private static final Logger logger = LoggerFactory.getLogger(Util.class);
```

The logger is declared but never invoked within `Util`. All error reporting uses `System.out.println` and `e.printStackTrace()`. This is consistent with the broader issue of exception swallowing (A32-9) but also indicates the logging framework integration is incomplete. No test validates that `Util` errors surface via SLF4J.

---

### A32-18 — Severity: LOW
**`sendMail` parameter `rName` and `sName` are accepted but never used**

File: `Util.java`, line 36

```java
public static boolean sendMail(String subject, String mBody, String rName, String rEmail, String sName,
                               String sEmail, String attachment, String attachmentName)
```

Parameters `rName` (recipient name) and `sName` (sender name) are accepted but never referenced in the method body. All callers pass `"unknown"` for both. These unused parameters pollute the API surface and could mislead future developers. No test enforces their absence of use.

---

### A32-19 — Severity: LOW
**`sendMail` SMTP configuration is entirely hardcoded with no externalization path**

File: `Util.java`, lines 44-60

All SMTP connection properties (host, port, TLS settings, socket factory class) are hardcoded string literals. There is no mechanism to override these values for testing, staging, or environment-specific deployment. This makes integration testing against a local/mock SMTP server structurally impossible without source modification. No test exists.

---

### A32-20 — Severity: LOW
**`send_sms_message` Javadoc is incorrect and copy-pasted from PHP**

File: `SendMessage.java`, lines 78-88

```java
/**
 * This function is responsible for sending out email
 *
 * @param integer $id
 * @param string $mobile_no
 * ...
 */
private void send_sms_message(String msg, String mobile_no)
```

The Javadoc says "sending out email", uses PHP parameter syntax (`$id`, `$mobile_no`), and includes parameters (`$id`, `$event_name`, `$time_stamp`, `$unit_name`, `$driver_name`, `$extra_info`) that do not exist in the actual method signature. No test would catch this mismatch, but it indicates the code was adapted from another codebase without review.

---

## Summary Table

| ID | Severity | File | Description |
|----|----------|------|-------------|
| A32-1 | CRITICAL | `Util.java:66` | Hardcoded AWS SES SMTP credentials in source |
| A32-2 | CRITICAL | `RuntimeConfig.java:18-21` | Hardcoded Clickatell SMS credentials consumed by `SendMessage` |
| A32-3 | CRITICAL | `SendMessage.java` | Zero test coverage — all three methods untested |
| A32-4 | CRITICAL | `Util.java` | Zero test coverage — `sendMail` completely untested |
| A32-5 | HIGH | `Util.java:119` | `sendMail` always returns `true`; failure not signalled |
| A32-6 | HIGH | `Util.java:98` | NPE on null `attachment` parameter, silently swallowed |
| A32-7 | HIGH | `SendMessage.java:114,131` | `ArrayIndexOutOfBoundsException` on empty HTTP response |
| A32-8 | HIGH | `SendMessage.java:102` | Dead null-check on split result; empty mobile_no unguarded |
| A32-9 | HIGH | `Util.java`, `SendMessage.java` | Silent exception swallowing — errors not propagated or logged |
| A32-10 | HIGH | `SendMessage.java:31,58` | `rset` never assigned; finally-block close is dead code |
| A32-11 | HIGH | `SendMessage.java:32` | `query` field declared but never used |
| A32-12 | MEDIUM | `Util.java:27` | `generateRadomName` completely untested (pure, testable method) |
| A32-13 | MEDIUM | `SendMessage.java:29-31` | Instance JDBC fields — not thread-safe by design |
| A32-14 | MEDIUM | `SendMessage.java:163` | Deprecated `DataInputStream.readLine()` — encoding not guaranteed |
| A32-15 | MEDIUM | `Util.java:78-82` | Malformed recipient silently proceeds to send with no `TO` |
| A32-16 | MEDIUM | `Util.java:24` | Instantiable utility class — missing private constructor |
| A32-17 | MEDIUM | `Util.java:25` | `logger` declared but never used in `Util` |
| A32-18 | LOW | `Util.java:36` | Parameters `rName`, `sName` accepted but never used |
| A32-19 | LOW | `Util.java:44-60` | All SMTP config hardcoded — no environment override or test seam |
| A32-20 | LOW | `SendMessage.java:78` | Javadoc is wrong (PHP syntax, wrong description, wrong params) |
