# A17 — Pass 2: Test Coverage Audit
**Agent:** A17
**Date:** 2026-02-27
**Scope:** Model classes GPS, GPSList, and Impact
**Source files audited:**
- `src/main/java/com/journaldev/spring/jdbc/model/GPS.java`
- `src/main/java/com/journaldev/spring/jdbc/model/GPSList.java`
- `src/main/java/com/journaldev/spring/jdbc/model/Impact.java`

---

## Reading Evidence

### 1. GPS.java

**File:** `src/main/java/com/journaldev/spring/jdbc/model/GPS.java`
**Class:** `GPS` (implements `Serializable`)
**Package:** `com.journaldev.spring.jdbc.model`

**Constants / Fields:**
| Name | Type | Line |
|------|------|------|
| `serialVersionUID` | `static final long` | 10 |
| `id` | `int` | 12 |
| `unit_id` | `int` | 13 |
| `longitude` | `Float` | 14 |
| `latitude` | `Float` | 15 |
| `gps_time` | `String` | 16 |
| `current_location` | `boolean` | 17 |
| `unit_name` | `String` | 18 |

**Methods (all hand-written, no Lombok):**
| Method | Signature | Line |
|--------|-----------|------|
| `getId` | `public int getId()` | 20 |
| `setId` | `public void setId(int id)` | 23 |
| `getUnit_id` | `public int getUnit_id()` | 26 |
| `setUnit_id` | `public void setUnit_id(int unit_id)` | 29 |
| `getLongitude` | `public Float getLongitude()` | 32 |
| `setLongitude` | `public void setLongitude(Float longitude)` | 35 |
| `getLatitude` | `public Float getLatitude()` | 38 |
| `setLatitude` | `public void setLatitude(Float latitude)` | 41 |
| `getGps_time` | `public String getGps_time()` | 44 |
| `setGps_time` | `public void setGps_time(String gps_time)` | 47 |
| `isCurrent_location` | `public boolean isCurrent_location()` | 50 |
| `setCurrent_location` | `public void setCurrent_location(boolean current_location)` | 53 |
| `getUnit_name` | `public String getUnit_name()` | 56 |
| `setUnit_name` | `public void setUnit_name(String unit_name)` | 59 |

**No `equals()`, `hashCode()`, or `toString()` overrides present.**
**No `@JsonIgnore` or validation annotations present.**
**`longitude` and `latitude` typed as boxed `Float` (nullable), not primitive `float`.**

---

### 2. GPSList.java

**File:** `src/main/java/com/journaldev/spring/jdbc/model/GPSList.java`
**Class:** `GPSList` (implements `Serializable`)
**Package:** `com.journaldev.spring.jdbc.model`

**Constants / Fields:**
| Name | Type | Line |
|------|------|------|
| `serialVersionUID` | `static final long` | 9 |
| `gpsList` | `List<GPS>` (eager init: `new ArrayList<GPS>()`) | 12 |

**Methods:**
| Method | Signature | Line |
|--------|-----------|------|
| `getGpsList` | `public List<GPS> getGpsList()` | 15 |
| `setGpsList` | `public void setGpsList(List<GPS> gpsList)` | 20 |

**No `equals()`, `hashCode()`, or `toString()` overrides present.**
**No null-guard or unmodifiable-list protection on `getGpsList()`.**
**Inner list is eagerly initialized; `setGpsList(null)` replaces it with `null`, leaving `getGpsList()` returning `null` on subsequent calls.**

---

### 3. Impact.java

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Impact.java`
**Class:** `Impact` (implements `Serializable`)
**Package:** `com.journaldev.spring.jdbc.model`
**Lombok annotations:** `@Data`, `@NoArgsConstructor`

**Constants / Fields:**
| Name | Type | Line |
|------|------|------|
| `serialVersionUID` | `static final long` | 14 |
| `impact_value` | `long` | 16 |
| `impact_time` | `String` | 17 |
| `mac_address` | `String` | 18 |

**Methods (Lombok `@Data` generated — not explicitly coded):**
| Method | Generated by | Notes |
|--------|-------------|-------|
| `getImpact_value()` | `@Data` | returns `long` |
| `setImpact_value(long)` | `@Data` | |
| `getImpact_time()` | `@Data` | returns `String` |
| `setImpact_time(String)` | `@Data` | |
| `getMac_address()` | `@Data` | returns `String` |
| `setMac_address(String)` | `@Data` | |
| `equals(Object)` | `@Data` | all-fields |
| `hashCode()` | `@Data` | all-fields |
| `toString()` | `@Data` | all-fields |
| `Impact()` (no-arg) | `@NoArgsConstructor` | |

**Explicit constructor (line 21):**
| Constructor | Visibility | Line |
|-------------|-----------|------|
| `Impact(long, String, String)` annotated `@Builder` | `private` | 21–25 |

**Builder:**
`Impact.builder().impact_value(...).impact_time(...).mac_address(...).build()` — builder is the only way to construct a fully-initialised `Impact`; the `@NoArgsConstructor` produces a zero-value / null-field instance.

**Downstream constant used against `impact_value`:**
`ImpactDAO.save()` line 39: hardcoded threshold `80000` — impacts below this value are silently discarded.

---

## Test Coverage Search Results

**Test directory:** `src/test/java/com/journaldev/spring/jdbc/`

**Test files found:**
| File | Tests | Covers |
|------|-------|--------|
| `model/PackageEntryTest.java` | `compareTo()` | `PackageEntry` only |
| `service/APKUpdaterServiceTest.java` | All tests commented out (`/* ... */`) | Nothing (dead test class) |
| `util/DateUtilTest.java` | 6 tests | `DateUtil` only |

**Direct reference search for `GPS`, `GPSList`, `Impact` in `src/test/`:** No matches found.

**Conclusion:** Zero test coverage exists for `GPS`, `GPSList`, or `Impact` — directly or indirectly.

---

## Findings

### A17-1, Severity: CRITICAL
**GPS, GPSList, and Impact have zero unit test coverage**

No test file in `src/test/` references or instantiates `GPS`, `GPSList`, or `Impact`. The three model classes are completely untested. All getters, setters, constructors, and builder paths are exercised only at runtime through controller and DAO integration flows (`LocationController`, `ImpactController`, `ImpactDAO`) that themselves have no tests.

---

### A17-2, Severity: HIGH
**`GPS.longitude` and `GPS.latitude` are boxed `Float` (nullable) — null-dereference risk is untested**

`longitude` (line 14) and `latitude` (line 15) are declared as `Float`, not primitive `float`. `LocationController.saveGPSLocation()` (line 57) evaluates `gps.getLatitude()!=0 || gps.getLongitude()!=0` — Java auto-unboxes both values. If either field is `null` (e.g., a JSON payload that omits them), a `NullPointerException` is thrown at runtime with no catch block. `LocationController.saveGPSLocations()` line 78 has the same pattern inside a `forEach` lambda. No test exists to verify null-coordinate handling.

---

### A17-3, Severity: HIGH
**`Impact.@Builder` constructor is `private` while `@NoArgsConstructor` is public — inconsistent construction contract is untested**

`Impact` declares a `private` `@Builder`-annotated constructor (line 21) alongside a Lombok-generated public `@NoArgsConstructor`. The no-arg constructor yields an object with `impact_value = 0`, `impact_time = null`, `mac_address = null`. In `ImpactDAO.save()` (line 43), `DateUtil.parseDateTimeIso(impact.getImpact_time())` is called directly on the value returned by `getImpact_time()`, which will be `null` for a default-constructed `Impact`. This propagates into `DateUtil.parseDateIso(null)` (which returns `null`) — silently inserting a null `impact_time` into the database. No test validates the behaviour of `Impact` when constructed via the no-arg path.

---

### A17-4, Severity: HIGH
**Silent discard of impacts below threshold 80,000 is untested**

`ImpactDAO.save()` line 39 contains `if (impactValue < 80000) return;` — any `Impact` with `impact_value` below 80,000 is silently dropped without logging or exception. This is a data-loss path. `ImpactController.saveImpactData()` reports `MSGID_SUCCESS` back to the caller regardless (line 179). No test exists to verify this threshold boundary or that callers are notified of the discard.

---

### A17-5, Severity: HIGH
**`GPSList.setGpsList(null)` nullifies the internal list — NPE in subsequent `getGpsList().forEach()` is untested**

`GPSList` initialises `gpsList` to `new ArrayList<GPS>()` at field-declaration time (line 12). However, `setGpsList(List<GPS> gpsList)` (line 20) replaces this reference unconditionally. Calling `setGpsList(null)` then `getGpsList()` returns `null`. `LocationController.saveGPSLocations()` (line 76) calls `gpsList.getGpsList().forEach(...)` with no null guard. A caller that posts a JSON body `{"gpsList": null}` would trigger a `NullPointerException` inside the controller. No test exercises this path.

---

### A17-6, Severity: MEDIUM
**`GPS` has no `equals()`, `hashCode()`, or `toString()` — equality semantics and logging behaviour are undefined and untested**

`GPS` is a hand-written POJO with no `@Data`, `@EqualsAndHashCode`, or manual overrides. Default `Object.equals()` and `Object.hashCode()` are inherited, meaning two `GPS` instances with identical field values will not be considered equal. If `GPS` objects are ever placed in collections, compared, or deduplicated, the behaviour will be incorrect. `toString()` emits only the object identity string, which limits log traceability. No test verifies or documents the intended equality contract.

---

### A17-7, Severity: MEDIUM
**`GPSList` has no `equals()`, `hashCode()`, or `toString()` — same as GPS**

Identical issue to A17-6 for `GPSList`. The class wraps a `List<GPS>` but inherits reference equality. No test documents the intended contract.

---

### A17-8, Severity: MEDIUM
**`Impact.impact_value` uses `long` but is received from JSON — overflow and negative value paths are untested**

`impact_value` is declared `long` (line 16). Incoming JSON from Bluetooth hardware could supply a negative value, zero, or a value exceeding `Long.MAX_VALUE`. The threshold comparison in `ImpactDAO.save()` (`< 80000`) handles the below-threshold case silently, but negative values pass the threshold check (`-1 < 80000` is `true`) — yet a negative impact value written to the database would be semantically invalid. No test validates the range constraints on `impact_value`.

---

### A17-9, Severity: MEDIUM
**`GPS.gps_time` is an unvalidated raw `String` — date parsing failure in `saveGPSLocations` is untested**

`GPS.gps_time` (line 16) is a raw `String` with no format validation. `LocationController.saveGPSLocations()` passes `gps.getGps_time()` directly to `DateUtil.parseDateTimeIso()` (line 84). `DateUtil.parseDateTimeIso()` throws `IllegalArgumentException` for unparseable input (confirmed in `DateUtilTest.parseDateTimeIsoThrowsIfInvalid`). The `saveGPSLocations` method has no try-catch block. An invalid timestamp string in any element of the GPS batch will cause an unhandled `IllegalArgumentException` to propagate through the Spring MVC exception resolver, resulting in an uncontrolled 500 error. No test covers this path.

---

### A17-10, Severity: MEDIUM
**`Impact.mac_address` is not validated for format or nullity — downstream DAO query uses it directly**

`Impact.mac_address` (line 18) is set by JSON deserialization with no `@NotNull` or format constraint. `ImpactDAO.isImpactRecorded()` (line 54) passes `impact.getMac_address()` directly as a JDBC parameter. `ImpactDAO.save()` (line 47) includes it in an exception message. A null or malformed MAC address could produce silent incorrect SQL matches or misleading error messages. No test validates null or malformed MAC address handling.

---

### A17-11, Severity: LOW
**`LocationController` is marked "Not in Use" (line 26 comment) but GPS model is still active production code**

The class-level Javadoc comment on `LocationController` (line 26) reads `"Not in Use"`, yet the class remains `@Controller`-annotated and registers three live HTTP endpoints (`GET /rest/gps/get/{uid}`, `POST /rest/gps/save`, `POST /rest/gps/save/all`). The `GPS` and `GPSList` models are actively bound to these endpoints via `@RequestBody` and `BeanPropertyRowMapper`. Lack of tests means there is no regression safety net if this "unused" designation is incorrect or if the endpoints are ever reached.

---

### A17-12, Severity: LOW
**`APKUpdaterServiceTest` is entirely commented out — test suite is effectively empty for that service**

`src/test/java/com/journaldev/spring/jdbc/service/APKUpdaterServiceTest.java` contains two test methods, both wrapped in a block comment (`/* ... */`), leaving the class with no executable tests. While unrelated to the three audited model classes, this indicates a broader pattern of test abandonment in this codebase.

---

## Summary Table

| ID | Severity | Description |
|----|----------|-------------|
| A17-1 | CRITICAL | Zero unit test coverage for GPS, GPSList, Impact |
| A17-2 | HIGH | Boxed `Float` null-dereference in GPS coordinate comparison — untested |
| A17-3 | HIGH | `Impact` no-arg constructor yields null `impact_time` silently written to DB — untested |
| A17-4 | HIGH | Silent discard of impacts below value 80,000 with no caller notification — untested |
| A17-5 | HIGH | `GPSList.setGpsList(null)` causes NPE in `saveGPSLocations` forEach — untested |
| A17-6 | MEDIUM | `GPS` missing `equals`/`hashCode`/`toString` — contract undefined and untested |
| A17-7 | MEDIUM | `GPSList` missing `equals`/`hashCode`/`toString` — same as A17-6 |
| A17-8 | MEDIUM | Negative or zero `impact_value` passes 80,000 threshold silently — untested |
| A17-9 | MEDIUM | Invalid `gps_time` string causes unhandled `IllegalArgumentException` in batch GPS save |
| A17-10 | MEDIUM | `mac_address` null or malformed — not validated, used directly in DAO SQL |
| A17-11 | LOW | Controller marked "Not in Use" but GPS endpoints are live and untested |
| A17-12 | LOW | `APKUpdaterServiceTest` entirely commented out — dead test class |
