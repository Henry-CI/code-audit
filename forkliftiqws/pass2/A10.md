# Audit Report A10 - Pass 2: Test Coverage
**Date:** 2026-02-27
**Agent:** A10
**Scope:** UserController, APIConnections, Answers

---

## Reading Evidence

### 1. UserController
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java`
**Class:** `UserController` (line 17) — `@Controller`

**Fields:**
- `userDao` : `UserDAO` — `@Autowired` (line 20)

**Methods:**
| Method | Line | Signature |
|--------|------|-----------|
| `getUserByEmail` | 23 | `@ResponseBody ResponseEntity<User> getUserByEmail(@RequestParam("email") String email)` |

**Annotations / Mappings:**
- `@RequestMapping(value = "/rest/admin/user", method = RequestMethod.GET)` (line 22)

**Return paths in `getUserByEmail`:**
- Line 28: `ResponseEntity<User>` with `HttpStatus.OK` — when `userDao.findByName(email)` returns a non-empty `Optional<User>`
- Line 30: `ResponseEntity<>(HttpStatus.BAD_GATEWAY)` — when `Optional` is empty (user not found)

**Types used:** `UserDAO`, `User`, `Optional<User>`, `ResponseEntity<User>`, `HttpStatus.OK`, `HttpStatus.BAD_GATEWAY`

**Imports:**
- `com.journaldev.spring.jdbc.DAO.UserDAO`
- `com.journaldev.spring.jdbc.model.User`
- `org.springframework.http.HttpStatus`
- `org.springframework.http.ResponseEntity`
- `java.util.Optional`

---

### 2. APIConnections
**File:** `src/main/java/com/journaldev/spring/jdbc/model/APIConnections.java`
**Class:** `APIConnections` (line 5) — `implements Serializable`

**Constants:**
- `serialVersionUID = 4127356077977670047L` (line 12)

**Fields:**
- `IDAPIConnection` : `int` (line 15)
- `APIConnectionKey` : `String` (line 16)

**Methods:**
| Method | Line | Signature |
|--------|------|-----------|
| `getIDAPIConnection` | 18 | `int getIDAPIConnection()` |
| `setIDAPIConnection` | 21 | `void setIDAPIConnection(int iDAPIConnection)` |
| `getAPIConnectionKey` | 24 | `String getAPIConnectionKey()` |
| `setAPIConnectionKey` | 27 | `void setAPIConnectionKey(String aPIConnectionKey)` |

**Types used:** `int`, `String`, `Serializable`

**Notes:** No constructor defined; uses default no-arg constructor. No `equals`, `hashCode`, or `toString` override.

---

### 3. Answers
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Answers.java`
**Class:** `Answers` (line 5) — `implements Serializable`

**Constants:**
- `serialVersionUID = -2642278162514242302L` (line 10)

**Fields:**
- `id` : `int` (line 13)
- `answer` : `String` (line 14)
- `question_id` : `int` (line 15)

**Methods:**
| Method | Line | Signature |
|--------|------|-----------|
| `getId` | 16 | `int getId()` |
| `setId` | 19 | `void setId(int id)` |
| `getAnswer` | 22 | `String getAnswer()` |
| `setAnswer` | 25 | `void setAnswer(String answer)` |
| `getQuestion_id` | 29 | `int getQuestion_id()` |
| `setQuestion_id` | 32 | `void setQuestion_id(int question_id)` |

**Types used:** `int`, `String`, `Serializable`

**Notes:** No constructor defined; uses default no-arg constructor. No `equals`, `hashCode`, or `toString` override.

---

## Test Coverage Analysis

### Existing Test Files
The following test files exist under `src/test/java/`:

| File | Tests |
|------|-------|
| `model/PackageEntryTest.java` | `compareTo()` for `PackageEntry` version comparison |
| `service/APKUpdaterServiceTest.java` | All `@Test` methods are **commented out**; effectively zero live tests |
| `util/DateUtilTest.java` | `parseDateIso` and `parseDateTimeIso` (null, valid, invalid) |

**None of the three files under audit (`UserController`, `APIConnections`, `Answers`) are referenced, imported, or exercised in any test file.**

---

## Findings

---

### A10-1, Severity: CRITICAL
**UserController — Zero test coverage**

`UserController.getUserByEmail` (`/rest/admin/user GET`) has no unit tests, no integration tests, and no MockMvc tests anywhere in `src/test/`. This is the sole HTTP endpoint of the class and represents an untested entry point into the application's user-lookup logic.

**Untested branches:**
- Happy path: `Optional` present, returns `200 OK` with `User` body (line 28)
- Not-found path: `Optional` empty, returns `502 BAD_GATEWAY` (line 30)

**File:** `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java`

---

### A10-2, Severity: HIGH
**UserController — Incorrect HTTP status code for user-not-found**

The not-found branch returns `HttpStatus.BAD_GATEWAY` (502) at line 30. HTTP 502 semantically means "the server received an invalid response from an upstream server." A missing user record is a client-side condition and should return `404 NOT_FOUND` or at minimum `204 NO_CONTENT`. Because there are no tests, this semantic error has gone undetected and is currently shipped to callers. Any client relying on a standard REST contract will misinterpret a 502 as an infrastructure or upstream failure rather than a missing resource.

**File:** `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java`, line 30

---

### A10-3, Severity: HIGH
**UserController — No test for null or blank email parameter**

`getUserByEmail` accepts an unconstrained `String email` from `@RequestParam`. There is no null-check, blank-check, format validation, or Bean Validation annotation (`@NotBlank`, `@Email`). No test exercises:
- Null `email` (Spring will throw `MissingServletRequestParameterException` — untested)
- Empty string `""`
- Whitespace-only string
- An email string that is syntactically malformed

Each of these inputs exercises a different code path through `userDao.findByName()` and none are covered.

**File:** `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java`, line 23–31

---

### A10-4, Severity: HIGH
**UserController — DAO exception propagation is untested**

If `userDao.findByName(email)` throws a `DataAccessException` or any `RuntimeException` (e.g., database unavailable, JDBC timeout), the exception will propagate unhandled out of the controller, resulting in a 500 Internal Server Error with a stack trace. There is no `try/catch`, no `@ExceptionHandler`, and no test that injects a DAO mock throwing an exception to verify the error response contract.

**File:** `src/main/java/com/journaldev/spring/jdbc/controller/UserController.java`, lines 25–31

---

### A10-5, Severity: MEDIUM
**APIConnections — Zero test coverage**

`APIConnections` has no tests anywhere in the test suite. None of its four accessor methods are exercised. The class is also not referenced by any other production class (grep across `src/main/` finds no imports), making it dead or orphaned code with no coverage.

**Untested methods:** `getIDAPIConnection`, `setIDAPIConnection`, `getAPIConnectionKey`, `setAPIConnectionKey`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/APIConnections.java`

---

### A10-6, Severity: MEDIUM
**Answers — Zero test coverage**

`Answers` has no tests anywhere in the test suite. None of its six accessor methods are exercised. While `Answers` is imported by `SessionController`, no test in the suite exercises the `SessionController` path that instantiates or populates `Answers` objects.

**Untested methods:** `getId`, `setId`, `getAnswer`, `setAnswer`, `getQuestion_id`, `setQuestion_id`

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Answers.java`

---

### A10-7, Severity: LOW
**APIConnections — Missing equals/hashCode/toString**

`APIConnections implements Serializable` but defines no `equals()`, `hashCode()`, or `toString()` override. If instances are placed into collections (`HashSet`, `HashMap`) or compared by value, they will use object identity semantics, which is almost certainly incorrect for a data model. No test exercises or validates collection or equality behaviour.

**File:** `src/main/java/com/journaldev/spring/jdbc/model/APIConnections.java`

---

### A10-8, Severity: LOW
**Answers — Missing equals/hashCode/toString**

Same issue as A10-7. `Answers implements Serializable` but provides no `equals()`, `hashCode()`, or `toString()`. The `answer` field (type `String`) can legitimately be `null` after default construction — no test covers the null-answer case passed to any downstream consumer.

**File:** `src/main/java/com/journaldev/spring/jdbc/model/Answers.java`

---

### A10-9, Severity: LOW
**APIConnections — Orphaned class with no production consumers**

A full-codebase grep finds that `APIConnections` is never imported or instantiated outside its own source file. It appears to be dead code. No test validates any integration path because no integration path exists.

**File:** `src/main/java/com/journaldev/spring/jdbc/model/APIConnections.java`

---

### A10-10, Severity: INFO
**APKUpdaterServiceTest — All tests commented out**

`APKUpdaterServiceTest` contains two meaningful tests (`getAvailablePackage`, `getAvailablePackageWhenAlreadyHaveLatest`) that were commented out (lines 17–44). The class compiles to an empty test class with no live `@Test` methods. These tests previously validated the APK update availability logic, including the edge case where the device already has the latest version. Their removal leaves `APKUpdaterService` with zero test coverage.

**File:** `src/test/java/com/journaldev/spring/jdbc/service/APKUpdaterServiceTest.java`

---

## Summary Table

| ID | Severity | Class | Description |
|----|----------|-------|-------------|
| A10-1 | CRITICAL | UserController | Zero test coverage for the only HTTP endpoint |
| A10-2 | HIGH | UserController | 502 BAD_GATEWAY returned for user-not-found (wrong status) |
| A10-3 | HIGH | UserController | No tests for null/blank/malformed email parameter |
| A10-4 | HIGH | UserController | DAO exception propagation is untested |
| A10-5 | MEDIUM | APIConnections | Zero test coverage; all accessors untested |
| A10-6 | MEDIUM | Answers | Zero test coverage; all accessors untested |
| A10-7 | LOW | APIConnections | Missing equals/hashCode/toString |
| A10-8 | LOW | Answers | Missing equals/hashCode/toString; null answer field unchecked |
| A10-9 | LOW | APIConnections | Orphaned class — no production consumers found |
| A10-10 | INFO | APKUpdaterServiceTest | All test methods commented out, leaving APKUpdaterService uncovered |
