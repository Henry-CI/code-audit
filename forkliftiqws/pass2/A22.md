# A22 – Pass 2: Test Coverage Audit
**Agent:** A22
**Date:** 2026-02-27
**Scope:** `model/Results.java`, `model/Roles.java`, `model/Services.java`

---

## Reading Evidence

### 1. `Results.java`
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Results.java`
**Class:** `Results implements Serializable`

| Element | Line | Notes |
|---|---|---|
| `serialVersionUID` | 12 | `1460020432004206866L` (static final long) |
| Field: `message_id` | 13 | `private String` |
| Field: `error` | 14 | `private String` |
| Method: `getMessage_id()` | 16 | getter, returns `String` |
| Method: `setMessage_id(String)` | 19 | setter |
| Method: `getError()` | 23 | getter, returns `String` |
| Method: `setError(String)` | 27 | setter |

**Types imported:** `java.io.Serializable`
**No constructors declared** (default no-arg constructor only)
**No `equals`, `hashCode`, or `toString` overrides**

---

### 2. `Roles.java`
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Roles.java`
**Class:** `Roles implements Serializable` (Lombok `@Data`, `@NoArgsConstructor`)

| Element | Line | Notes |
|---|---|---|
| `serialVersionUID` | 16 | `3861900430744018177L` |
| Field: `id` | 18 | `private Long` |
| Field: `name` | 19 | `private String` |
| Field: `authority` | 20 | `private String` |
| Field: `description` | 21 | `private String` |
| Constructor: `Roles(Long, String, String, String)` | 24 | `private`, annotated `@Builder` |
| Enum: `RoleId` | 31–53 | Nested public enum |
| Enum constant: `ROLE_COMPANY_GROUP` | 32 | Value `"ROLE_COMPANY_GROUP"` |
| Enum field: `id` | 34 | `private String` |
| Enum constructor: `RoleId(String)` | 36 | Assigns `this.id = name` |
| Enum method: `getId()` | 40 | Returns `String id` |
| Enum method: `fromId(String)` | 44 | Static; iterates `values()`, throws `IllegalArgumentException` on no match |

**Lombok-generated (from `@Data`):** `getId()`, `getName()`, `getAuthority()`, `getDescription()`, `setId(Long)`, `setName(String)`, `setAuthority(String)`, `setDescription(String)`, `equals(Object)`, `hashCode()`, `toString()`
**Lombok-generated (from `@NoArgsConstructor`):** public no-arg constructor
**Lombok-generated (from `@Builder` on private constructor):** `Roles.builder()` static factory, `RolesBuilder` inner class

**Types imported:** `lombok.Builder`, `lombok.Data`, `lombok.NoArgsConstructor`, `java.io.Serializable`

**Error/exception thrown:**
- `IllegalArgumentException` at line 51 – thrown by `RoleId.fromId(String)` when no matching enum value is found; message format: `"Name " + id + " is not valid role identifier"`

---

### 3. `Services.java`
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Services.java`
**Class:** `Services implements Serializable`

| Element | Line | Notes |
|---|---|---|
| `serialVersionUID` | 11 | `-1720582328491174646L` |
| Field: `unit_id` | 13 | `private int` |
| Field: `unit_name` | 14 | `private String` |
| Field: `service_type` | 15 | `private String` |
| Field: `acc_hours` | 16 | `private BigDecimal` |
| Field: `service_due` | 17 | `private BigDecimal` |
| Field: `last_serv` | 18 | `private int` |
| Field: `next_serv` | 19 | `private int` |
| Field: `serv_duration` | 20 | `private int` |
| Field: `driver_id` | 21 | `private int` |
| Method: `getDriver_id()` | 23 | getter, returns `int` |
| Method: `setDriver_id(int)` | 26 | setter |
| Method: `getAcc_hours()` | 29 | getter, returns `BigDecimal` |
| Method: `setAcc_hours(BigDecimal)` | 32 | setter |
| Method: `getService_due()` | 35 | getter, returns `BigDecimal` |
| Method: `setService_due(BigDecimal)` | 38 | setter |
| Method: `getUnit_id()` | 41 | getter, returns `int` |
| Method: `setUnit_id(int)` | 44 | setter |
| Method: `getLast_serv()` | 47 | getter, returns `int` |
| Method: `setLast_serv(int)` | 50 | setter |
| Method: `getNext_serv()` | 53 | getter, returns `int` |
| Method: `setNext_serv(int)` | 56 | setter |
| Method: `getServ_duration()` | 59 | getter, returns `int` |
| Method: `setServ_duration(int)` | 62 | setter |
| Method: `getService_type()` | 65 | getter, returns `String` |
| Method: `setService_type(String)` | 68 | setter |
| Method: `getUnit_name()` | 71 | getter, returns `String` |
| Method: `setUnit_name(String)` | 74 | setter |

**Types imported:** `java.io.Serializable`, `java.math.BigDecimal`
**No constructors declared** (default no-arg constructor only)
**No `equals`, `hashCode`, or `toString` overrides**

---

## Test Coverage Summary

### Existing test files found under `src/test/java/`
| Test File | Classes Covered |
|---|---|
| `model/PackageEntryTest.java` | `PackageEntry` only |
| `service/APKUpdaterServiceTest.java` | `APKUpdaterService` – all test methods commented out; effectively empty |
| `util/DateUtilTest.java` | `DateUtil` only |

**Grep results for `Results`, `Roles`, `Services` in `src/test/java/`:** No matches found.
All three classes under audit have **zero direct or indirect test coverage**.

---

## Findings

---

### A22-1 – Severity: CRITICAL
**`Results`, `Roles`, `Services`: Zero test coverage across all three model classes**

No test file in `src/test/java/` references `Results`, `Roles`, or `Services` by any means — no import, no instantiation, no usage. The three existing test files cover entirely unrelated classes. These model classes are actively used in production request/response paths (e.g., `EquipmentController`, `DriverController`, `ImpactController`, `SessionController`, `LocationController`, `CompanyController`) without any automated verification that they behave correctly.

---

### A22-2 – Severity: CRITICAL
**`Roles.RoleId.fromId(String)` – untested `IllegalArgumentException` error path**

`fromId(String id)` at line 44 throws `IllegalArgumentException` when no `RoleId` enum constant matches the supplied string. This method is the sole lookup mechanism for role resolution. The happy path (valid id `"ROLE_COMPANY_GROUP"`) and the error path (any non-matching string) have no test coverage. A regression in the loop logic or enum constant naming would go undetected. The error message string at line 51 (`"Name " + id + " is not valid role identifier"`) is also unverified.

---

### A22-3 – Severity: HIGH
**`Roles.RoleId.fromId(String)` – missing edge case: null input**

`fromId(String id)` calls `r.id.equals(id)` inside the loop. If `null` is passed as the argument, `r.id.equals(null)` returns `false` for each iteration and the method ultimately throws `IllegalArgumentException` with the message `"Name null is not valid role identifier"`. This is arguably correct behaviour, but it is undocumented, untested, and callers are given no indication that `null` is a valid input. There is no null-guard or explicit null check; the behaviour is a side effect of `String.equals`. A dedicated null-input test case is absent.

---

### A22-4 – Severity: HIGH
**`Results`: no `equals`, `hashCode`, or `toString` – untestable state assertions**

`Results` is a hand-written POJO with no `equals` or `hashCode` override. It is used as the return type for REST endpoint responses across at least eleven controller call sites. Any test that attempts to assert equality between two `Results` instances will compare object identity rather than field values, making state-level assertions impossible without reflection. No tests currently exist to expose this, but the design flaw creates a latent defect in any future test authoring.

---

### A22-5 – Severity: HIGH
**`Services`: no `equals`, `hashCode`, or `toString` – untestable state assertions**

Same issue as A22-4. `Services` is a hand-written POJO with nine fields (`int unit_id`, `String unit_name`, `String service_type`, `BigDecimal acc_hours`, `BigDecimal service_due`, `int last_serv`, `int next_serv`, `int serv_duration`, `int driver_id`) and no `equals` or `hashCode` override. It is used as the `@RequestBody` parameter in `EquipmentController.SaveService()`. Correctness of field deserialization and field-level equality cannot be asserted in unit tests without reference-identity workarounds.

---

### A22-6 – Severity: HIGH
**`Services`: `BigDecimal` fields `acc_hours` and `service_due` – missing null and boundary tests**

`acc_hours` and `service_due` are `BigDecimal` typed (nullable objects), while all other numeric fields are primitive `int` (not nullable). There are no tests verifying behaviour when these fields are `null` (e.g., when a JSON body omits them), nor are there boundary tests for zero, negative, or very large values. Callers that perform arithmetic on these values without null-checks risk `NullPointerException` at runtime. No test coverage exists to detect this.

---

### A22-7 – Severity: MEDIUM
**`Roles.RoleId`: only one enum constant defined – `fromId` loop logic untested for multi-value scenarios**

`RoleId` currently contains exactly one constant: `ROLE_COMPANY_GROUP`. The `fromId` method iterates `values()` looking for a match. While this works correctly with a single value, the loop iteration logic itself (correct `equals` comparison, correct `return` on match) is not tested. If a future constant is added, there is no regression test to confirm the loop correctly selects among multiple values, or that the first-match-wins behaviour is correct.

---

### A22-8 – Severity: MEDIUM
**`Results`: `message_id` field naming convention deviates from Java standards – no test enforces serialization contract**

The field is named `message_id` (snake_case) rather than `messageId` (camelCase). The getter is `getMessage_id()` and the setter is `setMessage_id(String)`. This naming is non-standard for Java and affects JSON serialization key names (Jackson by default will serialize using the getter name, producing `"message_id"` as the JSON key). No test verifies the JSON serialization output, meaning a refactor to standard naming would silently change the wire format and break clients.

---

### A22-9 – Severity: MEDIUM
**`Services`: nine snake_case fields with non-standard getter/setter names – serialization contract untested**

All nine fields in `Services` use snake_case naming (`unit_id`, `unit_name`, `service_type`, etc.) with matching non-standard getter names (`getUnit_id()`, `getUnit_name()`, etc.). As with `Results`, Jackson serialization behaviour is tied to getter names, producing snake_case JSON keys. No test verifies the serialized output or confirms that the `@RequestBody` deserialization in `EquipmentController.SaveService()` round-trips correctly.

---

### A22-10 – Severity: LOW
**`Roles` Lombok-generated methods are not explicitly tested**

`@Data` generates `equals`, `hashCode`, and `toString` for `Roles`. While Lombok itself is trusted library code, the generated `equals` and `hashCode` are based on all four fields (`id`, `name`, `authority`, `description`). There are no tests confirming field-level equality semantics (e.g., two `Roles` instances with identical fields are equal, or that a `Long id` of `null` is handled correctly in `hashCode`). The builder created by `@Builder` on the private constructor is used in production DAOs (`UserDAO`, `CompanyDAO`) but is never exercised in tests.

---

### A22-11 – Severity: LOW
**`APKUpdaterServiceTest` – only active test class in test suite is entirely commented out**

`APKUpdaterServiceTest` at line 17 contains two test methods wrapped in a block comment. The class compiles and runs but executes zero assertions. This means the project's effective test count across all three existing test files is limited to `PackageEntryTest` (5 assertions) and `DateUtilTest` (5 tests). The overall test suite provides no coverage safety net for the model layer.

---

## Coverage Matrix

| Class | Methods | Directly Tested | Indirectly Tested | Total Covered |
|---|---|---|---|---|
| `Results` | 4 (getMessage_id, setMessage_id, getError, setError) | 0 | 0 | 0% |
| `Roles` (hand-written) | 2 (private constructor, RoleId.getId, RoleId.fromId) | 0 | 0 | 0% |
| `Roles` (Lombok-generated) | ~10 (getters, setters, equals, hashCode, toString, builder) | 0 | 0 | 0% |
| `Services` | 18 (9 getters + 9 setters) | 0 | 0 | 0% |

**Overall coverage for audited files: 0%**
