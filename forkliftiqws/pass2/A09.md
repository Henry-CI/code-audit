# A09 - Pass 2: Test Coverage Audit
**Date:** 2026-02-27
**Auditor:** A09
**Scope:** ResumeController, RuntimeConfig, SessionController

---

## Test Infrastructure Summary

Three test files exist under `src/test/java/`:

| Test File | Covers |
|---|---|
| `model/PackageEntryTest.java` | `PackageEntry.compareTo()` only |
| `service/APKUpdaterServiceTest.java` | Entire test body is commented out; zero active assertions |
| `util/DateUtilTest.java` | `DateUtil.parseDateIso()` and `DateUtil.parseDateTimeIso()` |

No test file references `ResumeController`, `RuntimeConfig`, or `SessionController` by name or by any of their endpoint paths. Zero indirect coverage was found via grep across the entire `src/test/` tree.

---

## Reading Evidence

### File 1: ResumeController.java
**Path:** `src/main/java/com/journaldev/spring/jdbc/controller/ResumeController.java`
**Class:** `ResumeController extends ConfigurationController`
**Annotation:** `@Controller`

#### Methods

| Method | Line | HTTP Method | URI Constant |
|---|---|---|---|
| `getResumeDriver(int uid)` | 35 | GET | `RestURIConstants.RESUME_DRIVER` (`/rest/resume/get/{uid}`) |
| `getResumeEquipment(int uid, String frequencey)` | 120 | GET | `RestURIConstants.RESUME_EQUIPMENT` (`/rest/driverresume/get/{uid}/frequencey/{frequencey}`) |
| `getReportList(int uid)` | 262 | GET | `RestURIConstants.GET_REPORT` (`/rest/reportlist/get/{uid}`) |
| `generateReport(int uid, int rid)` | 283 | GET | `RestURIConstants.GENERATE_REPORT` (`/rest/reportlist/generate/user/{uid}/report/{rid}`) |
| `sendReportList(String frq)` | 369 | GET | `RestURIConstants.SEND_REPORT` (`/rest/reportlist/freq/{freq}`) |

#### Types Used
- `Reports`, `Charts`, `Usage`, `ReportLists`, `Permissions`, `DriverEmails`, `Results`, `ReportAPI`
- `JdbcTemplate`, `BeanPropertyRowMapper`, `BigDecimal`, `ResponseEntity`, `HttpStatus`
- `DateUtil`, `Util`, `RuntimeConfig`

#### Constants Referenced (from RuntimeConfig)
- `RuntimeConfig.MSGID_SUCCESS` ("1")
- `RuntimeConfig.MSGID_CODEERRORR` ("2")
- `RuntimeConfig.ERRORMSG_CODEERRORR` ("Code throws exceptions")
- `RuntimeConfig.emailContent`
- `RuntimeConfig.mailFrom`
- `RuntimeConfig.file_type`

#### Error Paths
- Line 352-357: `catch (Exception e)` in `generateReport` - returns `HttpStatus.BAD_REQUEST`
- Line 420-425: `catch (Exception e)` in `sendReportList` - returns `HttpStatus.BAD_REQUEST`
- Lines 57-61, 66-70: Division-by-zero guard (`total > 0`) in `getResumeDriver`

#### Frequency Branch Logic (`getResumeEquipment`)
- `"y"` (yearly) - line 126
- `"m"` (monthly) - line 169
- else (weekly, default) - line 211

#### Frequency Branch Logic (`sendReportList`)
- `"w"` -> `"Weekly"` - line 378
- `"m"` -> `"Monthly"` - line 380
- else -> `"Daily"` - line 383

---

### File 2: RuntimeConfig.java
**Path:** `src/main/java/com/journaldev/spring/jdbc/controller/RuntimeConfig.java`
**Class:** `RuntimeConfig` (plain class, no Spring annotation, no interface)

#### Fields (all `public static`)

| Field | Line | Value |
|---|---|---|
| `host` | 5 | `"localhost"` |
| `port` | 6 | `"25"` |
| `sfport` | 7 | `"25"` |
| `sfclass` | 8 | `"javax.net.ssl.SSLSocketFactory"` |
| `mailFrom` | 9 | `"info@forkliftiq360.com"` |
| `emailContent` | 10 | `""` |
| `GCMSERVER` | 13 | `"https://gcm-http.googleapis.com/gcm/send"` |
| `GCMKEY` | 14 | `"key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs"` |
| `production_database` | 16 | `"jdbc/PreStartDB"` |
| `LOCATION` | 17 | `"https://api.clickatell.com"` |
| `USERNAME` | 18 | `"ciclickatell"` |
| `PASSWORD` | 19 | `"OVLOaICXccaNUS"` |
| `SMSFROM` | 20 | `"13234862361"` |
| `API_ID` | 21 | `"3629505"` |
| `MSGID_SUCCESS` | 23 | `"1"` |
| `MSGID_CODEERRORR` | 24 | `"2"` |
| `MSGID_CODEE_DUPLICATE_VEHICLE` | 25 | `"3"` |
| `ERRORMSG_CODEERRORR` | 26 | `"Code throws exceptions"` |
| `MSGID_LOGICERRORR` | 27 | `"3"` |
| `ERRORMSG_LOGICERRORR` | 28 | `"Result already exists."` |
| `APIURL` | 30 | `"http://ec2-52-5-205-104.compute-1.amazonaws.com/api/export/pdf/"` |
| `file_type` | 31 | `".pdf"` |
| `PDF_FOLDER` | 32 | `"temp/"` |

#### Methods
None. `RuntimeConfig` has no methods; it is a pure static constant holder.

#### Collisions / Defects Observed
- `MSGID_CODEE_DUPLICATE_VEHICLE` (line 25) = `"3"` and `MSGID_LOGICERRORR` (line 27) = `"3"`: two distinct semantic error codes share the same string value.

---

### File 3: SessionController.java
**Path:** `src/main/java/com/journaldev/spring/jdbc/controller/SessionController.java`
**Class:** `SessionController extends ConfigurationController`
**Annotation:** `@Controller`

#### Methods

| Method | Line | Visibility | HTTP Method | URI Constant |
|---|---|---|---|---|
| `driverAccess(int sid, int imageno, MultipartFile file)` | 63 | public | POST (multipart) | `RestURIConstants.DRIVRR_ACCESS` (`/rest/driveraccess/save/sid/{sid}/imageno/{imageno}`) |
| `getQuestion(int eid)` | 97 | public | GET | `RestURIConstants.GET_QUESTION` (`/rest/question/get/{eid}`) |
| `getForm(int qid, String type)` | 138 | public | GET | `RestURIConstants.GET_FORMS` (`/rest/forms/get/question/{qid}/type/{type}`) |
| `searchForm(int uid, String type, String keyword)` | 154 | public | GET | `RestURIConstants.SEARCH_FORMS` (`/rest/forms/unit/{uid}/type/{type}/search/{keyword}`) |
| `saveResults(Result result)` | 172 | public | POST | `RestURIConstants.SAVE_RESULT` (`/rest/result/save`) |
| `startSessions(Sessions session)` | 229 | public | POST | `RestURIConstants.START_SESSION` (`/rest/session/start`) |
| `toString(Serializable o)` | 289 | private | — | — |
| `endSessions(Sessions session)` | 299 | public | POST | `RestURIConstants.END_SESSION` (`/rest/session/end`) |
| `abortSessions(int sid)` | 353 | public | PUT | `RestURIConstants.ABORT_SESSION` (`/rest/session/abort/session/{sid}`) |
| `createSession(Sessions session, JdbcTemplate jdbcTemplate)` | 366 | private | — | — |
| `saveOffline(OfflineSessions offlineSession)` | 379 | public | POST | `RestURIConstants.SAVE_OFFLINE` (`/rest/offline/save`) |

#### Types Used
- `Driver`, `Equipment`, `FormDtl`, `OfflineSessions`, `Questions`, `Result`, `Results`, `Sessions`, `Answers`
- `JdbcTemplate`, `BeanPropertyRowMapper`, `EmptyResultDataAccessException`
- `MultipartFile`, `FileStorageService`
- `Gson`, `BigDecimal`, `Base64`, `Serializable`
- `DateUtil`, `RuntimeConfig`
- `ExceptionUtils` (Apache Tika)

#### Error / Exception Paths
- Line 88-91: `catch (IOException e)` in `driverAccess` - returns `HttpStatus.BAD_GATEWAY` with empty `Driver`
- Line 108: Empty equipment list guard in `getQuestion` - returns `HttpStatus.BAD_GATEWAY`
- Line 238-242: Duplicate session guard in `startSessions` - returns `HttpStatus.BAD_REQUEST` with existing session
- Line 218-222: Duplicate result guard in `saveResults` - returns `HttpStatus.BAD_GATEWAY` with logic error
- Line 342-344: `catch (EmptyResultDataAccessException e)` in `endSessions` - logs error but always returns `HttpStatus.OK`
- Line 481-485: `catch (Exception e)` in `saveOffline` - logs error and re-throws

#### imageno Branch Logic (`driverAccess`)
- `imageno == 1`: updates `photo_front_url`
- `imageno == 2`: updates `photo_left_url`
- `imageno == 3`: updates `photo_right_url`
- `imageno == 4`: updates `photo_back_url`
- Any other value: no DB update executed (silent no-op)

#### unit_service Logic (`endSessions` / `saveOffline`)
- `total == 0`: INSERT new unit_service row
- `total > 0, count > 0` (already ended): UPDATE `acc_hours = prev_acc_hours + delta`
- `total > 0, count == 0` (start-of-session trigger): UPDATE `prev_acc_hours = acc_hours`, then UPDATE `acc_hours += delta`

---

## Findings

---

### A09-1, Severity: CRITICAL
**No test coverage for ResumeController (all 5 endpoints)**

`getResumeDriver`, `getResumeEquipment`, `getReportList`, `generateReport`, and `sendReportList` have zero test coverage. These endpoints perform multiple raw SQL queries and control report generation and email dispatch. No test exists in any form - no unit test, no integration test, no MockMvc test, no Spring Boot test slice.

---

### A09-2, Severity: CRITICAL
**No test coverage for SessionController (all 9 public endpoints + 2 private helpers)**

Every method in `SessionController` is entirely untested. This includes `startSessions`, `endSessions`, `abortSessions`, `saveResults`, `saveOffline`, `getQuestion`, `getForm`, `searchForm`, and `driverAccess`. These are the core transactional operations of the application (session lifecycle, pre-op result persistence, offline sync).

---

### A09-3, Severity: CRITICAL
**`endSessions` catches `EmptyResultDataAccessException` but always returns HTTP 200 OK (line 342-347)**

When a session record cannot be found by its ID, the exception is swallowed, the unit_service table is never updated, and the caller receives `HttpStatus.OK` with `MSGID_SUCCESS`. The client has no indication the operation silently failed. This defect is completely undetected due to missing tests for the error path.

---

### A09-4, Severity: CRITICAL
**Hardcoded credentials in `RuntimeConfig` with no runtime override mechanism**

`RuntimeConfig` contains hardcoded plaintext values at lines 14, 19, 20, 21 that appear to be live or former production credentials:
- `GCMKEY` = `"key=AIzaSyDDuQUYLcXkutyIxRToLAeBPHBQNLfayzs"` (Google Cloud Messaging API key)
- `PASSWORD` = `"OVLOaICXccaNUS"` (Clickatell SMS password)
- `USERNAME` = `"ciclickatell"` (Clickatell SMS username)
- `API_ID` = `"3629505"` (Clickatell API ID)
- `APIURL` = `"http://ec2-52-5-205-104.compute-1.amazonaws.com/api/export/pdf/"` (internal AWS EC2 IP)

All fields are `public static` with no `final` modifier, meaning any code can mutate them at runtime. No test validates that these values are externalized or protected.

---

### A09-5, Severity: HIGH
**`driverAccess` silently no-ops when `imageno` is outside the range 1-4 (lines 72-84)**

If `imageno` is 0, 5, or any other out-of-range value, no database update is executed, no error is returned, and `HttpStatus.OK` is sent back to the caller. The caller has no indication that the image was not saved. There is no test covering out-of-range `imageno` values.

---

### A09-6, Severity: HIGH
**`searchForm` contains a broken SQL query with a syntax error (lines 163-164)**

The SQL at line 163 contains `"where u. l.question_id = question_id = ?"` which is malformed SQL and cannot execute. The `keyword` path variable is accepted by the method signature but is never used in the query, and the query joins `question as q` and `unit as u` without any valid join condition. This endpoint (`/rest/forms/unit/{uid}/type/{type}/search/{keyword}`) is effectively non-functional. The absence of tests means this has never been caught.

---

### A09-7, Severity: HIGH
**`generateReport` and `sendReportList` log the full report API input including hardcoded password in plaintext (lines 323, 411)**

Both methods construct a JSON string containing `"admin_password":"ciiadmin"` and log it at INFO level via `logger.info("Input URL is:" + input)`. This causes a credential to appear in application logs. There is no test that would detect or flag log output containing sensitive data.

---

### A09-8, Severity: HIGH
**`saveOffline` re-throws the caught `Exception` unchecked (line 484)**

The `catch (Exception e)` block at line 481 logs the error then calls `throw e`. Since `saveOffline` is declared to return `ResponseEntity<Sessions>`, this propagates an unhandled runtime exception to the framework, which will produce a 500 response rather than a structured error body. No test covers this error path.

---

### A09-9, Severity: HIGH
**`RuntimeConfig.MSGID_CODEE_DUPLICATE_VEHICLE` and `MSGID_LOGICERRORR` share the same value "3" (lines 25, 27)**

Two semantically distinct error message IDs are assigned the same string value `"3"`. Any client or logging infrastructure using these message IDs cannot distinguish between a duplicate vehicle error and a logic error. No test validates the uniqueness or semantics of message ID constants.

---

### A09-10, Severity: MEDIUM
**`getResumeDriver` uses integer division for percentage calculation, silently truncating fractional results (lines 58, 67)**

`failed * 100 / total` and `incomplete * 100 / total` both perform integer division. For example, 1 failure out of 3 total returns `"33"` not `"33.3"`. There is no test verifying expected percentage output or detecting this truncation behavior.

---

### A09-11, Severity: MEDIUM
**`startSessions` has a commented-out concurrent usage check (lines 246-251)**

The block that would detect another driver using the same unit (`driver_id != ?`) is commented out with the note "No need to check other driver uses it". There is no test documenting the intended behavior or confirming the deliberate removal. This is an unvalidated behavioral regression.

---

### A09-12, Severity: MEDIUM
**`APKUpdaterServiceTest` has its only two test methods fully commented out (lines 17-44)**

The sole test class for `APKUpdaterService` contains no active test code. The class body consists entirely of commented-out `@Test` methods. This means `APKUpdaterService` has zero measured test coverage despite the test infrastructure being scaffolded.

---

### A09-13, Severity: MEDIUM
**`getResumeEquipment` frequency parameter uses a misspelled path variable in both the URI constant and method signature**

`RestURIConstants.RESUME_EQUIPMENT` = `/rest/driverresume/get/{uid}/frequencey/{frequencey}` and the method parameter is named `frequencey` (line 120). The misspelling is replicated in both the constant definition and the method signature. No test validates the URL routing or the parameter name, making this a latent API contract defect.

---

### A09-14, Severity: MEDIUM
**`generateReport` does not validate that `perList` is non-empty before processing (line 292-294)**

If `driver_id` has no entries in the `permission` table, `perList` is empty, the outer `for` loop is skipped entirely, and the method returns `HttpStatus.OK` as if the report was generated. No error or empty-result response is returned. No test validates the zero-permission case.

---

### A09-15, Severity: LOW
**`sendReportList` uses an invalid frequency value path: any value that is not "w" or "m" defaults to "Daily" with no validation error (lines 377-384)**

A caller passing `frq = "xyz"` receives a `"Daily"` report silently. There is no HTTP 400 response, no error log, and no test that confirms or challenges this fallback behavior.

---

### A09-16, Severity: LOW
**`RuntimeConfig.emailContent` is an empty string and `host`/`port`/`sfport`/`sfclass` are commented as "unused" (lines 4-11)**

Dead configuration fields remain in a public mutable class. No tests guard against accidental use or mutation of these stale fields. The class comment at line 4 acknowledges this but takes no action.

---

### A09-17, Severity: INFO
**`toString(Serializable o)` at line 289 is a private utility method that is only called in the `EmptyResultDataAccessException` catch block of `endSessions`**

This method is untested. Its usage is in an error path (itself untested per A09-3), meaning the serialization and Base64 encoding logic it implements have never been exercised.

---

## Coverage Summary

| Class | Methods | Tested Methods | Coverage |
|---|---|---|---|
| `ResumeController` | 5 | 0 | 0% |
| `RuntimeConfig` | 0 (constants only) | 0 | 0% |
| `SessionController` | 11 (9 public + 2 private) | 0 | 0% |

**Overall controller coverage: 0%**
