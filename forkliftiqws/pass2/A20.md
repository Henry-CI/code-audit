# Audit Report A20 — Pass 2: Test Coverage
**Date:** 2026-02-27
**Agent:** A20
**Scope:** Model classes — Permissions, Questions, ReportLists
**Working directory:** C:\Projects\cig-audit\repos\forkliftiqws

---

## Reading Evidence

### 1. Permissions.java
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Permissions.java`
**Class:** `public class Permissions implements Serializable`
**Annotations on class:** `@Data`, `@NoArgsConstructor`, `@EqualsAndHashCode(onlyExplicitlyIncluded = true)`

**Fields:**
| Line | Field | Type | Annotations |
|------|-------|------|-------------|
| 15 | `serialVersionUID` | `static final long` | — |
| 17 | `id` | `Long` | — |
| 19–20 | `driver_id` | `Long` | `@EqualsAndHashCode.Include` |
| 22 | `driver_name` | `String` | — |
| 24–25 | `comp_id` | `Long` | `@EqualsAndHashCode.Include` |
| 27 | `enabled` | `String` | — |
| 28 | `gsm_token` | `String` | — |

**Methods (all Lombok-generated via `@Data`, explicit builder constructor):**
| Source | Method | Line |
|--------|--------|------|
| `@Data` | `getId()` | generated |
| `@Data` | `setId(Long)` | generated |
| `@Data` | `getDriver_id()` | generated |
| `@Data` | `setDriver_id(Long)` | generated |
| `@Data` | `getDriver_name()` | generated |
| `@Data` | `setDriver_name(String)` | generated |
| `@Data` | `getComp_id()` | generated |
| `@Data` | `setComp_id(Long)` | generated |
| `@Data` | `getEnabled()` | generated |
| `@Data` | `setEnabled(String)` | generated |
| `@Data` | `getGsm_token()` | generated |
| `@Data` | `setGsm_token(String)` | generated |
| `@Data` | `toString()` | generated |
| `@EqualsAndHashCode` | `equals(Object)` (on `driver_id`, `comp_id`) | generated |
| `@EqualsAndHashCode` | `hashCode()` (on `driver_id`, `comp_id`) | generated |
| `@NoArgsConstructor` | `Permissions()` | generated |
| `@Builder` | `Permissions(Long id, Long driver_id, String driver_name, Long comp_id, String enabled, String gsm_token)` | 31 |
| `@Builder` | `Permissions.builder()` | generated |

**Types/Constants:**
- `Serializable` (java.io)
- Lombok: `@Data`, `@Builder`, `@EqualsAndHashCode`, `@NoArgsConstructor`
- `serialVersionUID = 1871252602934566751L`

**Usages in production code:**
- `CompanyDAO.java:174` — built via `Permissions.builder()` inside a `ResultSetExtractor`
- `CompanyController.java:62` — `@RequestBody Permissions permission` in `addCompany()` endpoint
- `CompanyController.java:109,112,116` — returned as `ResponseEntity<Permissions>`
- `GCMDataPermission.java:12` — field `Permissions data`
- `ResumeController.java:292` — populated via `BeanPropertyRowMapper<Permissions>`
- `Company.java:25` — field `Permissions permission`

---

### 2. Questions.java
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Questions.java`
**Class:** `public class Questions implements Serializable`
**Annotations on class:** none

**Fields:**
| Line | Field | Type |
|------|-------|------|
| 10 | `serialVersionUID` | `static final long` |
| 12 | `id` | `int` |
| 13 | `content` | `String` |
| 14 | `expectedanswer` | `String` |

**Methods (all hand-written):**
| Method | Line |
|--------|------|
| `getId()` | 17 |
| `setId(int)` | 20 |
| `getContent()` | 23 |
| `setContent(String)` | 26 |
| `getExpectedanswer()` | 29 |
| `setExpectedanswer(String)` | 32 |

**No `equals()`, `hashCode()`, or `toString()` methods defined.**

**Types/Constants:**
- `Serializable` (java.io)
- `serialVersionUID = 1443419827915092612L`

**Usages in production code:**
- `SessionController.java:97` — returned as `ResponseEntity<List<Questions>>` from `getQuestion(int eid)`
- `SessionController.java:105,131` — populated via `BeanPropertyRowMapper<>(Questions.class)` and via `BeanPropertyRowMapper<Questions>(Questions.class)`
- `SessionController.java:204,206` — populated and accessed (`getId()`) in answer processing loop
- `SessionController.java:468,470` — same pattern in offline session processing

---

### 3. ReportLists.java
**File:** `src/main/java/com/journaldev/spring/jdbc/model/ReportLists.java`
**Class:** `public class ReportLists implements Serializable`
**Annotations on class:** none
**Comment at line 10:** `// subscription table`

**Fields:**
| Line | Field | Type |
|------|-------|------|
| 11 | `serialVersionUID` | `static final long` |
| 13 | `id` | `int` |
| 14 | `name` | `String` |
| 15 | `file_name` | `String` |
| 16 | `frequency` | `String` |
| 17 | `comp_id` | `int` |

**Methods (all hand-written):**
| Method | Line |
|--------|------|
| `getComp_id()` | 19 |
| `setComp_id(int)` | 22 |
| `getFrequency()` | 25 |
| `setFrequency(String)` | 28 |
| `getFile_name()` | 31 |
| `setFile_name(String)` | 34 |
| `getId()` | 37 |
| `setId(int)` | 40 |
| `getName()` | 43 |
| `setName(String)` | 46 |

**No `equals()`, `hashCode()`, or `toString()` methods defined.**

**Types/Constants:**
- `Serializable` (java.io)
- `serialVersionUID = 583659787962286000L`

**Usages in production code:**
- `ResumeController.java:262` — returned as `List<ReportLists>` from `getReportList(int uid)`
- `ResumeController.java:276` — populated via `BeanPropertyRowMapper<ReportLists>(ReportLists.class)`
- `ResumeController.java:300,303` — populated and accessed (`getFile_name()`, `getName()`, `getFrequency()`, `getComp_id()`) in report dispatch loop
- `ResumeController.java:394,397` — populated and accessed in scheduled report generation

---

## Test Coverage Summary

**Test files examined (entire test suite):**
- `src/test/java/com/journaldev/spring/jdbc/model/PackageEntryTest.java` — tests `PackageEntry` only
- `src/test/java/com/journaldev/spring/jdbc/service/APKUpdaterServiceTest.java` — all tests commented out
- `src/test/java/com/journaldev/spring/jdbc/util/DateUtilTest.java` — tests `DateUtil` only

**Result:** Zero test coverage for `Permissions`, `Questions`, or `ReportLists`. No direct tests, no indirect tests, no integration tests involving these classes were found.

---

## Findings

### A20-1 — Severity: CRITICAL
**No test coverage for any of the three model classes**

`Permissions`, `Questions`, and `ReportLists` have zero test coverage across the entire test suite. None of the three test files in `src/test/java/` reference or exercise these classes either directly or indirectly. These models are central to REST API responses, database row mapping, and business logic in `CompanyController`, `SessionController`, and `ResumeController`. A regression in any getter/setter, equality logic, or serialization contract would be entirely invisible to the test suite.

**Affected classes:** `Permissions`, `Questions`, `ReportLists`

---

### A20-2 — Severity: HIGH
**`Permissions.equals()` silently excludes security-relevant fields**

The `@EqualsAndHashCode(onlyExplicitlyIncluded = true)` annotation restricts equality to `driver_id` and `comp_id` only. The fields `id`, `driver_name`, `enabled`, and `gsm_token` are excluded. If two `Permissions` objects differ in `enabled` ("Y" vs "N") or `gsm_token` but share the same `driver_id` and `comp_id`, they will compare as equal. This is a correctness hazard for any collection deduplication (e.g., `Set<Permissions>`) or equality checks in access control logic. No test verifies this contracted behavior or guards against accidental misuse.

**Affected class:** `Permissions`
**Affected methods:** `equals(Object)`, `hashCode()` (Lombok-generated at class-level)

---

### A20-3 — Severity: HIGH
**`BeanPropertyRowMapper` used against `Permissions` (Lombok model) — no mapping correctness tested**

`ResumeController.java:292` uses `BeanPropertyRowMapper<Permissions>` to map the SQL column `comp_id` to the `Permissions` field `comp_id`. `BeanPropertyRowMapper` relies on the presence of a no-argument constructor and standard JavaBean setter names. While `@NoArgsConstructor` provides the default constructor, the Lombok-generated setter for `comp_id` is `setComp_id(Long)`. The SQL query at line 290 retrieves only `comp_id`; other fields will be left at their default values (null for `Long`). No test verifies that this mapping succeeds, produces non-null `comp_id` values, or handles `null` database values gracefully.

**Affected class:** `Permissions`
**Affected caller:** `ResumeController.java:292`

---

### A20-4 — Severity: HIGH
**`Questions` and `ReportLists` have no `equals()`, `hashCode()`, or `toString()` — no test coverage of absence**

`Questions` and `ReportLists` are plain POJOs with hand-written getters/setters but no `equals()`, `hashCode()`, or `toString()` methods. Both rely on `Object` identity for equality. If either class is placed in a `Set`, used as a `Map` key, or compared in tests via `assertEquals`, the results will be based on reference identity rather than field values. No test verifies this behavior or signals the omission as intentional. The missing `toString()` also means debug logging of these objects produces uninformative output.

**Affected classes:** `Questions`, `ReportLists`

---

### A20-5 — Severity: HIGH
**`ReportLists.id` field is not populated by any observed SQL query — untested data contract gap**

The field `id` (line 13) is defined in `ReportLists`, but the SQL queries mapped to `ReportLists` in `ResumeController` at lines 274–276 and 298–300 select only `name`, `file_name`, `frequency` (and `comp_id` indirectly). The `getId()` method at line 37 will always return `0` (the `int` default) in those mapped instances. No test verifies this omission or documents whether `id` is intentionally excluded. The field at line 17, `comp_id`, also may not always be populated depending on which query is active.

**Affected class:** `ReportLists`
**Affected methods:** `getId()`, `getComp_id()`
**Affected callers:** `ResumeController.java:276`, `ResumeController.java:300`

---

### A20-6 — Severity: MEDIUM
**`Questions` uses `int` (primitive) for `id` — no test of zero/negative boundary values**

`Questions.id` is typed as `int` (primitive, line 12), while `Permissions.id` is typed as `Long` (boxed, line 17). When `BeanPropertyRowMapper` maps a SQL `NULL` for `id` into `Questions`, the result is silently set to `0` (the `int` default). `SessionController.java:208` calls `question.getId()` and passes the result directly as a query parameter. A zero value would produce an incorrect SQL lookup. No test exercises the zero, negative, or null-from-database case.

**Affected class:** `Questions`
**Affected method:** `getId()` (line 17)
**Affected caller:** `SessionController.java:208`

---

### A20-7 — Severity: MEDIUM
**`Permissions` builder constructor is `private` — builder is the only non-default construction path and is entirely untested**

The all-args constructor at line 31 is `private` and annotated with `@Builder`, meaning it is only accessible via `Permissions.builder()`. This builder is used in `CompanyDAO.java:174` to construct `Permissions` instances from a `ResultSetExtractor`. No test verifies that the builder correctly assigns all six fields, that the `@EqualsAndHashCode` contract is consistent with builder-constructed instances, or that omitting optional fields (e.g., `gsm_token`) produces expected defaults (null).

**Affected class:** `Permissions`
**Affected method:** `Permissions(Long, Long, String, Long, String, String)` builder constructor (line 31)
**Affected caller:** `CompanyDAO.java:174`

---

### A20-8 — Severity: MEDIUM
**`Permissions.enabled` is typed `String`, not `boolean` — no test of valid value set or null handling**

The `enabled` field (line 27) is typed as `String`. In the application context (forklift driver permission enablement), this field presumably holds values such as `"Y"`, `"N"`, or `"true"`/`"false"`. There is no validation, enumeration, or null guard anywhere in the model. No test exercises what value `enabled` holds when deserialized from JSON in `CompanyController.addCompany()` or when mapped from the database, nor what happens downstream when `enabled` is `null` or an unexpected string.

**Affected class:** `Permissions`
**Affected field/method:** `enabled` (line 27), `getEnabled()` / `setEnabled(String)` (Lombok-generated)

---

### A20-9 — Severity: MEDIUM
**`Questions.expectedanswer` and `ReportLists.frequency` are unvalidated strings — null/empty edge cases untested**

Neither `Questions.expectedanswer` (line 14) nor `ReportLists.frequency` (line 16) have null or empty-string guards. `SessionController.java:208` uses `question.getId()` and the question content to drive answer evaluation logic; a `null` `expectedanswer` could cause a `NullPointerException` in the calling code. `ResumeController.java:303` accesses `report.getFrequency()` to drive scheduled report dispatch; a `null` or unexpected frequency value could cause silent failures. No tests cover these null-return paths.

**Affected classes:** `Questions` (method `getExpectedanswer()` line 29), `ReportLists` (method `getFrequency()` line 25)

---

### A20-10 — Severity: LOW
**`serialVersionUID` values are non-default but untested for serialization round-trip correctness**

All three classes declare explicit `serialVersionUID` values (`1871252602934566751L`, `1443419827915092612L`, `583659787962286000L`). This indicates an intent to maintain stable serialized form across deployments. However, there are no serialization round-trip tests. If a field is added, removed, or its type changed (as already partially observed between `Questions.id` as `int` vs `Permissions.id` as `Long`), deserialization of persisted data will fail with an `InvalidClassException` at runtime with no test safety net to catch the breakage before deployment.

**Affected classes:** `Permissions` (line 15), `Questions` (line 10), `ReportLists` (line 11)

---

### A20-11 — Severity: LOW
**`ReportLists` class name does not follow Java naming conventions — no test enforces contract**

The class is named `ReportLists` (plural noun suggesting a container), but each instance represents a single report subscription record (a single row from the `subscription` table, as indicated by the comment at line 10). The naming is misleading and inconsistent with the other model classes (`Permissions`, `Questions`). While not a functional defect, the misnaming increases cognitive overhead when reading controller logic (e.g., `List<ReportLists>` reads as "list of report-lists"). No test documents or enforces the intended semantics of a single instance.

**Affected class:** `ReportLists`

---

## Summary Table

| Finding | Class(es) | Severity | Category |
|---------|-----------|----------|----------|
| A20-1 | Permissions, Questions, ReportLists | CRITICAL | No test coverage |
| A20-2 | Permissions | HIGH | Equality contract excludes security fields |
| A20-3 | Permissions | HIGH | BeanPropertyRowMapper mapping untested |
| A20-4 | Questions, ReportLists | HIGH | Missing equals/hashCode/toString |
| A20-5 | ReportLists | HIGH | `id` field unpopulated by SQL queries |
| A20-6 | Questions | MEDIUM | Primitive `int` id — null/zero boundary untested |
| A20-7 | Permissions | MEDIUM | Private builder constructor untested |
| A20-8 | Permissions | MEDIUM | `enabled` as unvalidated String |
| A20-9 | Questions, ReportLists | MEDIUM | Null/empty string fields unvalidated |
| A20-10 | Permissions, Questions, ReportLists | LOW | Serialization round-trip untested |
| A20-11 | ReportLists | LOW | Misleading class name |
