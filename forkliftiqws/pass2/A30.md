# Audit Report A30 — Pass 2: Test Coverage
**Date:** 2026-02-27
**Agent:** A30
**Scope:** Utility classes — Configuration, DateUtil, HttpDownloadUtility

---

## Reading Evidence

### 1. Configuration.java
**File:** `src/main/java/com/journaldev/spring/jdbc/util/Configuration.java`

**Class:** `Configuration` (annotated `@Component`, `@Getter`)

**Methods (Lombok-generated getters only — no explicit method bodies):**

| Getter (Lombok) | Field | Line |
|---|---|---|
| `getUserSetupMsg()` | `userSetupMsg` | 14 |
| `getUserSetupSubject()` | `userSetupSubject` | 17 |
| `getPassResetSubject()` | `passResetSubject` | 20 |
| `getImageURL()` | `imageURL` | 23 |
| `getSystemImageURL()` | `systemImageURL` | 26 |
| `getAcceptURL()` | `acceptURL` | 29 |
| `getDriverRequestSubject()` | `driverRequestSubject` | 32 |
| `getCognitoAPIPort()` | `cognitoAPIPort` | 35 |
| `getCognitoAPIUsername()` | `cognitoAPIUsername` | 38 |
| `getCognitoAPIPassword()` | `cognitoAPIPassword` | 41 |

**Annotations / Imports:**
- `@Component`, `@Getter` (Lombok)
- `@Value("${...}")` on every field (Spring property injection)
- `import org.simpleframework.xml.Element` — unused, not applied to any field
- `import org.simpleframework.xml.Root` — unused, not applied to the class

**Constants / Types / Errors:** None declared explicitly. All fields are `String`. No constructors, no setters, no static members.

---

### 2. DateUtil.java
**File:** `src/main/java/com/journaldev/spring/jdbc/util/DateUtil.java`

**Class:** `DateUtil` (no explicit parent, no annotations)

**Methods:**

| Method | Visibility | Line | Throws |
|---|---|---|---|
| `parseDate(String dateString, String dateFormat)` | `private static` | 11 | `IllegalArgumentException` |
| `formatDate(Date date, String dateFormat)` | `private static` | 25 | — |
| `parseDateIso(String dateString)` | `public static` | 35 | `IllegalArgumentException` |
| `parseDateTimeIso(String dateString)` | `public static` | 39 | `IllegalArgumentException` |
| `parseDateTimeWithSlashes(String oldDateString)` | `public static` | 43 | `IllegalArgumentException` |
| `getStartDate(Date date, String frequency)` | `public static` | 49 | — |
| `getCurrentDate()` | `public static` | 64 | — |
| `getYesterdayDateString()` | `public static` | 68 | — |
| `dateToString(Date date)` | `public static` | 74 | — |

**Formats / Constants used:**
- `"yyyy-MM-dd"` — used by `parseDateIso`, `getCurrentDate`, `getYesterdayDateString`, `dateToString`
- `"yyyy-MM-dd HH:mm:ss"` — used by `parseDateTimeIso`
- `"MM/dd/yyyy HH:mm:ss"` — used by `parseDateTimeWithSlashes` (first parse)
- `"dd/MM/yyyy HH:mm:ss"` — used by `parseDateTimeWithSlashes` (reformat then re-parse)

**Frequency values in `getStartDate`:**
- `"Daily"` — subtracts 1 day (Calendar.DATE)
- `"Weekly"` — subtracts 7 days (Calendar.DATE)
- `"Monthly"` — subtracts 1 month (Calendar.MONTH)
- Default (else) — subtracts 1 day (Calendar.DATE); same behaviour as "Daily"

**Error types:**
- `java.text.ParseException` — caught internally inside `parseDate`, re-thrown as `IllegalArgumentException`
- `IllegalArgumentException` — thrown from `parseDate`, propagated through all public parse methods

**Dependencies:** `org.springframework.util.StringUtils`, `java.text.SimpleDateFormat`, `java.util.Calendar`, `java.util.Date`

---

### 3. HttpDownloadUtility.java
**File:** `src/main/java/com/journaldev/spring/jdbc/util/HttpDownloadUtility.java`

**Class:** `HttpDownloadUtility` (no annotations, no explicit parent)

**Fields:**

| Field | Visibility | Type | Line |
|---|---|---|---|
| `BUFFER_SIZE` | `private static final int` | `int` (4096) | 18 |
| `saveFilePath` | `private static String` | `String` (init `""`) | 19 |
| `fileName` | `private static String` | `String` (init `""`) | 20 |

**Methods:**

| Method | Visibility | Line | Throws |
|---|---|---|---|
| `downloadFile(String fileName, String fileURL, String saveDir)` | `public static` | 29 | `IOException` |
| `sendPost(String fname, String input, String saveDir)` | `public static` | 98 | `Exception` |
| `getSaveFilePath()` | `public static` | 158 | — |
| `setSaveFilePath(String saveFilePath)` | `public static` | 162 | — |
| `getFileName()` | `public static` | 167 | — |
| `setFileName(String fileName)` | `public static` | 172 | — |

**HTTP response codes checked:**
- `HttpURLConnection.HTTP_OK` (200) — happy path in both `downloadFile` and `sendPost`
- Non-200 — only a `System.out.println` message, no exception thrown

**Error handling / exception paths:**
- `downloadFile`: catches `Exception` inside the I/O block (line 84) with only `e.printStackTrace()` — exception is swallowed
- `sendPost`: catches `Exception` inside the I/O block (line 145) with only `e.printStackTrace()` — exception is swallowed
- `sendPost` declares `throws Exception` but network/connection errors from `url.openConnection()` or `con.getOutputStream()` before the try-block would propagate uncaught to the caller
- `downloadFile` declares `throws IOException` — only errors before the inner try-block propagate

**Security-sensitive literals:**
- Hardcoded API token: `"w6_zaejLjssvw02XqIiKdVmv7kP6nOHAw2Ve5mj-qug"` at line 109
- Hardcoded base URL via `RuntimeConfig.APIURL` = `"http://ec2-52-5-205-104.compute-1.amazonaws.com/api/export/pdf/"` (plain HTTP, not HTTPS)

**Commented-out code:**
- `HttpsURLConnection con = (HttpsURLConnection) obj.openConnection();` — commented out at line 102; `HttpURLConnection` used instead

**Static mutable shared state:** Both `saveFilePath` and `fileName` are static class-level fields, mutated by both `downloadFile` and `sendPost`, creating a race condition in concurrent use.

**Unused import:** `javax.net.ssl.HttpsURLConnection` imported at line 12 but only referenced in a comment.

**Dependencies:** `RuntimeConfig.APIURL`, `RuntimeConfig.file_type`, `Util.generateRadomName()` (note: method name is a typo — `generateRadomName` instead of `generateRandomName`)

---

### 4. DateUtilTest.java
**File:** `src/test/java/com/journaldev/spring/jdbc/util/DateUtilTest.java`

**Class:** `DateUtilTest`

**Test methods:**

| Method | Line | Method Under Test | Scenario |
|---|---|---|---|
| `parseDateIsoShouldReturnNullWithEmptyDate` | 13 | `parseDateIso` | null input returns null |
| `parseDateIsoShouldReturnRightResult` | 18 | `parseDateIso` | valid ISO date parses correctly |
| `parseDateIsoThrowsIfInvalid` | 27 | `parseDateIso` | invalid string throws `IllegalArgumentException` |
| `parseDateTimeIsoShouldReturnNullWithEmptyDate` | 33 | `parseDateTimeIso` | null input returns null |
| `parseDateTimeIsoShouldReturnRightResult` | 38 | `parseDateTimeIso` | valid ISO datetime parses correctly |
| `parseDateTimeIsoThrowsIfInvalid` | 47 | `parseDateTimeIso` | invalid string throws `IllegalArgumentException` |

**Helper methods:** `assertDateEquals(Date expected, Date actual)` at line 52

**Indirect Coverage grep result:** No references to `Configuration` or `HttpDownloadUtility` in any test file under `src/test/java/`.

---

## Findings

---

### A30-1 — Severity: CRITICAL
**`HttpDownloadUtility` — Zero test coverage across all methods**

No test of any kind exists for `HttpDownloadUtility`. All six methods (`downloadFile`, `sendPost`, `getSaveFilePath`, `setSaveFilePath`, `getFileName`, `setFileName`) are completely untested. The class is called directly from production code in `ReportAPI.java` (lines 27, 29, 31). Neither direct unit tests nor indirect integration tests were found in `src/test/java/`.

---

### A30-2 — Severity: CRITICAL
**`HttpDownloadUtility.sendPost` — Hardcoded bearer token in source code**

A literal API authentication token (`"w6_zaejLjssvw02XqIiKdVmv7kP6nOHAw2Ve5mj-qug"`) is hardcoded in production source at line 109. No test validates that this token is correctly injected from configuration rather than hardcoded. The token is embedded in version control and visible to all repository readers. The value should come from an injected configuration property (e.g., via `Configuration.java` or `@Value`). The test gap means the misconfiguration has never been surfaced by automation.

---

### A30-3 — Severity: CRITICAL
**`HttpDownloadUtility` — Plain HTTP used instead of HTTPS for file transfer**

`sendPost` opens an `HttpURLConnection` over plain HTTP to `http://ec2-52-5-205-104.compute-1.amazonaws.com/...` (line 103). The prior `HttpsURLConnection` line has been commented out (line 102). The imported `javax.net.ssl.HttpsURLConnection` is therefore unused. No test validates that the connection uses TLS. This means authentication tokens and downloaded binary payloads are transmitted in clear text.

---

### A30-4 — Severity: HIGH
**`HttpDownloadUtility` — I/O exceptions silently swallowed in both methods**

In `downloadFile` (line 84) and `sendPost` (line 145), the inner I/O block catches `Exception` and calls only `e.printStackTrace()`. The caller receives no indication that the file write failed. `saveFilePath` is set before the try block, so `getSaveFilePath()` can return a path to a file that does not exist or is only partially written. No test validates the error propagation contract.

---

### A30-5 — Severity: HIGH
**`HttpDownloadUtility` — Non-200 HTTP responses produce no exception**

In both `downloadFile` (line 91) and `sendPost` (line 152), a non-200 response code causes only a `System.out.println`. No exception is thrown, no error is returned, and `saveFilePath` is left unchanged from its previous (or initial empty) value. Callers cannot distinguish a failed download from a successful one. No test covers any non-200 response path.

---

### A30-6 — Severity: HIGH
**`HttpDownloadUtility` — Static mutable shared state causes race condition**

`saveFilePath` (line 19) and `fileName` (line 20) are `private static` fields mutated by both `downloadFile` and `sendPost`. In any concurrent environment, one thread's write to these fields will corrupt another thread's in-flight operation. No test validates thread-safety or isolates the state between invocations.

---

### A30-7 — Severity: HIGH
**`Configuration.java` — Zero test coverage**

No test of any kind exists for `Configuration`. No `@SpringBootTest` or `@TestPropertySource` test validates that all ten `@Value`-injected properties (`userSetupMsg`, `userSetupSubject`, `passResetSubject`, `imageURL`, `systemImageURL`, `acceptURL`, `driverRequestSubject`, `cognitoAPIPort`, `cognitoAPIUsername`, `cognitoAPIPassword`) bind correctly to application properties at startup. A missing or misnamed property key will only be discovered at runtime.

---

### A30-8 — Severity: HIGH
**`DateUtil.parseDateTimeWithSlashes` — No test coverage**

`parseDateTimeWithSlashes` (line 43) has no test in `DateUtilTest`. The method performs a two-step conversion: it first parses using `"MM/dd/yyyy HH:mm:ss"`, reformats to `"dd/MM/yyyy HH:mm:ss"`, then re-parses. The following cases are all untested:
- Valid US-format datetime (happy path)
- null or empty input (expected: returns null, but relies on `parseDate` null check at intermediate step)
- Invalid string (expected: `IllegalArgumentException`)
- Ambiguous dates where month and day are interchangeable (e.g., `"01/02/2020 00:00:00"`) that would silently produce the wrong date after the reformat step

---

### A30-9 — Severity: HIGH
**`DateUtil.getStartDate` — No test coverage**

`getStartDate` (line 49) has no test. The following branches are all untested:
- `"Daily"` frequency subtracts 1 day
- `"Weekly"` frequency subtracts 7 days
- `"Monthly"` frequency subtracts 1 month
- Case-insensitivity of all three values (uses `equalsIgnoreCase`)
- Default/else branch for any unrecognised frequency string (also subtracts 1 day — identical to "Daily", which may be an unintentional default)
- `null` `date` argument (would throw `NullPointerException` at `c.setTime(date)`)
- `null` `frequency` argument (would throw `NullPointerException` at `frequency.equalsIgnoreCase(...)`)

---

### A30-10 — Severity: MEDIUM
**`DateUtil.getCurrentDate` — No test coverage**

`getCurrentDate` (line 64) has no test. While the method wraps the system clock and is inherently time-dependent, the following are untested:
- Return value format matches `"yyyy-MM-dd"` (non-null, non-empty, correct pattern)
- The method's contract that it returns today's date (could be tested with a tolerance or by mocking the clock)

---

### A30-11 — Severity: MEDIUM
**`DateUtil.getYesterdayDateString` — No test coverage**

`getYesterdayDateString` (line 68) has no test. Same concerns as A30-10 regarding format and correctness. The method is called from `ResumeController.java` in production (line 315) but the controller tests (if any) do not exercise `DateUtil` directly.

---

### A30-12 — Severity: MEDIUM
**`DateUtil.dateToString` — No test coverage**

`dateToString` (line 74) has no test. The following cases are untested:
- Valid `Date` input returns correct `"yyyy-MM-dd"` formatted string
- `null` input returns `null` (delegates to `formatDate` which does handle null, but this is unverified at the public API level)

---

### A30-13 — Severity: MEDIUM
**`DateUtil` — Empty-string input not tested for `parseDateIso` and `parseDateTimeIso`**

`DateUtilTest` tests null input returning null (via `StringUtils.isEmpty`), but `StringUtils.isEmpty` also returns true for an empty string `""`. No test verifies that `parseDateIso("")` and `parseDateTimeIso("")` both return null. This is a distinct edge case from null that should be explicitly asserted.

---

### A30-14 — Severity: MEDIUM
**`DateUtil.parseDateTimeIso` — No test for empty string input**

Related to A30-13 but called out specifically: the test `parseDateTimeIsoShouldReturnNullWithEmptyDate` only passes `null` (line 35). An empty string `""` is a second valid null-equivalent input path that is untested.

---

### A30-15 — Severity: MEDIUM
**`HttpDownloadUtility.downloadFile` — `fileName` parameter shadowed by static field**

The method parameter `fileName` at line 29 shadows the static class field `fileName` (line 20). Inside the method body, lines 52 and 57 assign to the unqualified name `fileName`, which in Java assigns to the parameter (local scope), not to the static field. However, the static field is never updated within `downloadFile`. This is likely a bug — `getSaveFilePath()` and `getFileName()` after calling `downloadFile` would return stale/empty values. No test validates the post-call state of these accessors.

---

### A30-16 — Severity: LOW
**`Configuration.java` — Unused XML serialisation imports**

`import org.simpleframework.xml.Element` (line 4) and `import org.simpleframework.xml.Root` (line 5) are present but neither annotation is applied anywhere in the class. No test validates the class serialises or deserialises as XML. These dead imports suggest a removed feature with no corresponding test cleanup.

---

### A30-17 — Severity: LOW
**`HttpDownloadUtility` — `Util.generateRadomName()` contains a typo in method name**

The dependency call at line 130 is `Util.generateRadomName()` (missing the 'n' in "Random"). This compiles only because the production `Util` class defines the method with this misspelled name. No test validates the generated name format or uniqueness, and any future refactor to correct the spelling would break this call site silently if not covered by tests.

---

### A30-18 — Severity: LOW
**`DateUtil.assertDateEquals` helper does not compare milliseconds**

The private test helper `assertDateEquals` (line 52) compares year, month, date, hour, minute, and second but omits milliseconds. `SimpleDateFormat.parse` sets milliseconds to 0, so this is not currently a defect, but the omission is undocumented and could mask failures if the format were ever changed to include sub-second precision.

---

## Summary Table

| Finding | Severity | File | Description |
|---|---|---|---|
| A30-1 | CRITICAL | HttpDownloadUtility.java | Zero test coverage for all methods |
| A30-2 | CRITICAL | HttpDownloadUtility.java | Hardcoded auth token in source; no test to catch misconfiguration |
| A30-3 | CRITICAL | HttpDownloadUtility.java | Plain HTTP used; HTTPS commented out; no test validates transport security |
| A30-4 | HIGH | HttpDownloadUtility.java | I/O exceptions swallowed silently in both methods |
| A30-5 | HIGH | HttpDownloadUtility.java | Non-200 HTTP responses produce no exception to caller |
| A30-6 | HIGH | HttpDownloadUtility.java | Static mutable shared state — race condition in concurrent use |
| A30-7 | HIGH | Configuration.java | Zero test coverage; property binding never validated |
| A30-8 | HIGH | DateUtil.java | `parseDateTimeWithSlashes` entirely untested |
| A30-9 | HIGH | DateUtil.java | `getStartDate` entirely untested, including null-argument NPE paths |
| A30-10 | MEDIUM | DateUtil.java | `getCurrentDate` untested |
| A30-11 | MEDIUM | DateUtil.java | `getYesterdayDateString` untested |
| A30-12 | MEDIUM | DateUtil.java | `dateToString` untested including null input |
| A30-13 | MEDIUM | DateUtil.java | Empty-string input not tested for parse methods |
| A30-14 | MEDIUM | DateUtil.java | `parseDateTimeIso` empty-string path untested |
| A30-15 | MEDIUM | HttpDownloadUtility.java | `fileName` parameter shadows static field; post-call accessor state untested |
| A30-16 | LOW | Configuration.java | Unused XML imports; no corresponding tests |
| A30-17 | LOW | HttpDownloadUtility.java | Typo `generateRadomName` — no test to catch refactor breakage |
| A30-18 | LOW | DateUtilTest.java | `assertDateEquals` omits millisecond comparison |
