# Audit Report A31 - Pass 2: Test Coverage
**Agent:** A31
**Date:** 2026-02-27
**Pass:** 2 - Test Coverage
**Scope:** `util/RuntimeConf.java`, `util/SMTPAuthenticator.java`, `util/SendEmail.java`

---

## Reading Evidence

### 1. `RuntimeConf.java`
**File:** `src/main/java/com/journaldev/spring/jdbc/util/RuntimeConf.java`

- **Class:** `RuntimeConf` (public, concrete)
- **Methods:** None (no methods declared)
- **Fields / Constants:**
  - `public static String database = "jdbc/PreStartDB"` (line 4)
- **Imports:** None
- **Notes:** This class is a standalone constant-holder. It duplicates the field `production_database = "jdbc/PreStartDB"` that also appears in `com.journaldev.spring.jdbc.controller.RuntimeConfig` (line 16). The class `RuntimeConf` is never referenced anywhere in the main source tree (confirmed by grep: zero callers). `RuntimeConfig` is the class actually used throughout the application.

---

### 2. `SMTPAuthenticator.java`
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SMTPAuthenticator.java`

- **Class:** `SMTPAuthenticator` (public, extends `javax.mail.Authenticator`)
- **Methods:**
  - `getPasswordAuthentication()` — line 7 (overrides `javax.mail.Authenticator`)
    - Returns: `PasswordAuthentication` (line 11)
    - Local variables: `username` (line 9), `password` (line 10)
- **Hardcoded credentials:**
  - `username`: `"AKIA**REDACTED**"` (line 9) — AWS IAM Access Key ID pattern
  - `password`: `"****REDACTED****"` (line 10) — AWS IAM Secret Access Key pattern
- **Imports:** `javax.mail.PasswordAuthentication`
- **Notes:** Class is not referenced anywhere in the main source tree (no callers found). `SendEmail.java` uses JNDI session lookup and never instantiates `SMTPAuthenticator`.

---

### 3. `SendEmail.java`
**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`

- **Class:** `SendEmail` (public, concrete)
- **Methods:**
  - `sendMail(String subject, String msg, String mailTo)` — line 14 (public static void)
    - **JNDI lookup:** `new InitialContext()` (line 18), `initCtx.lookup("java:comp/env")` (line 19), `envCtx.lookup("mail/Session")` (line 20)
    - **Message construction:** `new MimeMessage(session)` (line 23)
    - `message.setFrom(new InternetAddress(RuntimeConfig.mailFrom))` (line 26)
    - `message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(mailTo, false))` (lines 30–31)
    - `message.setSubject(subject)` (line 37)
    - `message.setContent(msg, "text/html;charset=UTF-8")` (line 38)
    - `message.setHeader("X-Mailer", "PRX_Java-Mail_Custom-System")` (line 39)
    - `message.setHeader("Content-Transfer-Encoding", "8bit")` (line 40)
    - `message.setHeader("MIME-Version", "1.0")` (line 41)
    - `message.setSentDate(new Date())` (line 42)
    - `Transport.send(message)` (line 46)
    - **Exception handling:**
      - Inner try/catch `Exception` around `setRecipients` (lines 29–34): swallows exception, prints to stdout only
      - Inner try/catch `Exception` around `Transport.send` (lines 45–49): swallows exception, calls `e.printStackTrace()`
      - Outer catch `MessagingException` (line 50): calls `mex.printStackTrace()`
      - Outer catch `Throwable` (line 52): calls `t.printStackTrace()`
- **Imports:** `java.util.*`, `javax.mail.*`, `javax.mail.internet.*`, `javax.naming.Context`, `javax.naming.InitialContext`, `com.journaldev.spring.jdbc.controller.RuntimeConfig`
- **Callers in production code:**
  - `DriverService.java` line 86, 111
  - `ImpactDAO.java` line 76
  - `CompanyController.java` line 104

---

## Test Coverage Summary

**Test directory searched:** `src/test/java/`
**Test files found:**
- `model/PackageEntryTest.java`
- `service/APKUpdaterServiceTest.java`
- `util/DateUtilTest.java`

**Search results for all three audited classes and their methods:**

| Search Term | Matches in `src/test/` |
|---|---|
| `RuntimeConf` | 0 |
| `SMTPAuthenticator` | 0 |
| `getPasswordAuthentication` | 0 |
| `SendEmail` | 0 |
| `sendMail` | 0 |

**All three classes have zero test coverage.**

---

## Findings

---

### A31-1, Severity: CRITICAL
**Hardcoded AWS IAM credentials in `SMTPAuthenticator.getPasswordAuthentication()`**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SMTPAuthenticator.java`, lines 9–10

The method `getPasswordAuthentication()` contains a hardcoded AWS IAM Access Key ID (`AKIA**REDACTED**`) and a corresponding AWS IAM Secret Access Key (`****REDACTED****`) committed in plaintext to version control. This is a known AWS key format (access key IDs beginning with `AKIA` are long-term IAM user credentials). Any party with read access to the repository can extract these credentials and use them to access AWS services. The credentials also appear to be live (not clearly rotated or revoked in any configuration file found). There are zero tests covering this class, meaning no test has ever validated or challenged this credential-loading behaviour.

---

### A31-2, Severity: CRITICAL
**`SMTPAuthenticator` class is dead code — never instantiated or used**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SMTPAuthenticator.java`

`SMTPAuthenticator` is not referenced anywhere in the production source tree. `SendEmail.java` obtains its `javax.mail.Session` exclusively via JNDI (`envCtx.lookup("mail/Session")`), making this authenticator entirely bypassed at runtime. The class exists solely as a credential store. No tests cover it. The combination of dead code and live hardcoded secrets makes this doubly dangerous: the credentials are present in the codebase with no operational justification.

---

### A31-3, Severity: CRITICAL
**`RuntimeConf` is dead code — superseded by `RuntimeConfig` with identical constant**

**File:** `src/main/java/com/journaldev/spring\jdbc\util\RuntimeConf.java`

`RuntimeConf.database` (value `"jdbc/PreStartDB"`, line 4) is never referenced anywhere in the main source tree. The active class `com.journaldev.spring.jdbc.controller.RuntimeConfig` defines an identical field `production_database = "jdbc/PreStartDB"` at line 16, which is the field actually consumed by `SendMessage.java`. The presence of an unreferenced duplicate constant class creates confusion about the authoritative configuration source. There are no tests for `RuntimeConf`. The risk is that a future developer references `RuntimeConf.database` believing it is the live constant, while the actual runtime JNDI name could have diverged in `RuntimeConfig.production_database`.

---

### A31-4, Severity: HIGH
**`SendEmail.sendMail()` — entire method is untested; zero unit or integration tests**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`, line 14

`sendMail()` is invoked from three distinct production call sites (`DriverService`, `ImpactDAO`, `CompanyController`) but has no test coverage whatsoever. The method performs JNDI lookups, constructs MIME messages, and dispatches email via `Transport.send()`. None of these code paths are exercised in any test. Failures here are silent in some cases (see A31-5) and would only surface in production.

---

### A31-5, Severity: HIGH
**`sendMail()` — `setRecipients` exception is swallowed silently; mail continues to be sent without a recipient**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`, lines 29–34

The inner try/catch block surrounding `message.setRecipients(...)` catches all `Exception` types and prints to stdout, then allows execution to continue. If `InternetAddress.parse(mailTo, false)` throws (e.g., for a malformed address), the `MimeMessage` will have no recipients set. Execution then proceeds to `Transport.send(message)`, which will throw `SendFailedException` with "No recipient addresses" — but that exception is itself swallowed by the second inner catch (lines 45–49). The net result is: a malformed `mailTo` address causes the email to silently fail with no notification to the caller, no return value, and no re-throw. The `void` return type provides no success/failure signal to callers. There are no tests exercising this path.

---

### A31-6, Severity: HIGH
**`sendMail()` — JNDI lookup failure swallowed by outer `MessagingException`/`Throwable` catch; callers receive no signal**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`, lines 17–54

If `new InitialContext()` or `envCtx.lookup("mail/Session")` throws `NamingException` (e.g., JNDI not configured, wrong deployment context), the exception propagates to the outer `catch (Throwable t)` at line 52, which calls `t.printStackTrace()` and returns normally. All three production callers (`DriverService`, `ImpactDAO`, `CompanyController`) ignore the `void` return and have no way to detect that the email was never sent. User-facing operations (driver account setup emails, password reset emails, impact alert emails) would silently fail. No tests cover this path.

---

### A31-7, Severity: HIGH
**`sendMail()` — `Transport.send()` exception swallowed; delivery failure is invisible to callers**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`, lines 45–49

The inner try/catch surrounding `Transport.send(message)` catches all `Exception` and only calls `e.printStackTrace()`. SMTP delivery failures (authentication failure, connection timeout, relay rejection) are not re-thrown and not logged to any framework logger. The method always returns normally regardless of whether the email was delivered. No tests cover this error path.

---

### A31-8, Severity: MEDIUM
**`sendMail()` — `mailTo` parameter is never validated for null or empty before use**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`, line 14

The `mailTo` parameter is passed directly to `InternetAddress.parse(mailTo, false)` without a null check or empty-string guard. A null value will throw `NullPointerException` inside `InternetAddress.parse()`, which would be caught by the inner `Exception` catch at line 32, printed to stdout, and silently ignored. An empty string will parse to an empty address array and proceed to `Transport.send()` without a recipient. Neither case is tested.

---

### A31-9, Severity: MEDIUM
**`sendMail()` — `subject` and `msg` parameters are not validated for null; can cause `MessagingException`**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`, lines 37–38

`message.setSubject(null)` and `message.setContent(null, ...)` are not guarded. Passing null for either will result in a `MessagingException` or `NullPointerException` which is silently caught. No tests exercise null subject or null body paths.

---

### A31-10, Severity: MEDIUM
**`sendMail()` — uses `printStackTrace()` instead of a structured logger throughout**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`, lines 33, 48, 51, 53

All four exception-handling sites use `System.out.println()` or `e.printStackTrace()` rather than a logging framework (SLF4J, Log4j, etc.). In a containerised or cloud deployment, stdout may not be captured, monitored, or retained. There is no correlation with request IDs, no severity classification, and no alerting hook. This is observable without tests but is compounded by the total absence of tests that would validate logging behaviour.

---

### A31-11, Severity: MEDIUM
**`RuntimeConf.database` constant naming inconsistency creates maintenance confusion**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/RuntimeConf.java`, line 4

The field is named `database` in `RuntimeConf` but `production_database` in `RuntimeConfig`. Both hold the same value `"jdbc/PreStartDB"`. No tests reference either class directly, meaning no test enforces consistency of JNDI names across the two configuration holders. A future change to one without the other would go undetected until a JNDI lookup failure in production.

---

### A31-12, Severity: LOW
**`SMTPAuthenticator` — `getPasswordAuthentication()` has no test even as a structural baseline**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SMTPAuthenticator.java`, line 7

Even setting aside the security issues (A31-1, A31-2), the override of `getPasswordAuthentication()` has no test asserting that the method returns a non-null `PasswordAuthentication`, that the returned object carries a username, or that the method does not throw. If this class were ever made active, its correctness would be entirely untested.

---

### A31-13, Severity: LOW
**`SendEmail` has no test covering the happy path (successful send)**

**File:** `src/main/java/com/journaldev/spring/jdbc/util/SendEmail.java`

No test verifies that, given a valid JNDI session, valid addresses, subject, and body, the method reaches `Transport.send()` and completes without exception. Without even a baseline smoke test using a mocked `Session` and `Transport`, no regression protection exists for any future change to the method.

---

## Coverage Matrix

| Class | Method | Direct Tests | Indirect Tests | Coverage |
|---|---|---|---|---|
| `RuntimeConf` | (no methods) | 0 | 0 | None |
| `RuntimeConf` | `database` field access | 0 | 0 | None |
| `SMTPAuthenticator` | `getPasswordAuthentication()` | 0 | 0 | None |
| `SendEmail` | `sendMail(String, String, String)` | 0 | 0 | None |
| `SendEmail` | — happy path (JNDI + send succeeds) | 0 | 0 | None |
| `SendEmail` | — `setRecipients` exception path | 0 | 0 | None |
| `SendEmail` | — `Transport.send` exception path | 0 | 0 | None |
| `SendEmail` | — JNDI lookup failure path | 0 | 0 | None |
| `SendEmail` | — null `mailTo` path | 0 | 0 | None |
| `SendEmail` | — null `subject` / `msg` paths | 0 | 0 | None |

**Overall estimated test coverage for these three files: 0%**
