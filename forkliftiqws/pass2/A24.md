# Audit Report A24 - Pass 2: Test Coverage
**Date:** 2026-02-27
**Agent:** A24
**Scope:** Model and service utility classes — User, UserResponse, APKUpdaterException

---

## Reading Evidence

### File 1: `src/main/java/com/journaldev/spring/jdbc/model/User.java`

**Class:** `User` (implements `Serializable`)

**Annotations:**
- `@Data` (Lombok — generates: `getId`, `getName`, `getEmail`, `getPassword`, `isActive`, `getRoles`, and all corresponding setters, `equals`, `hashCode` via `@EqualsAndHashCode(onlyExplicitlyIncluded = true)` on `email` only, `toString` via `@ToString(onlyExplicitlyIncluded = true)` on `name`, `email`, `active`)
- `@NoArgsConstructor` (Lombok — generates zero-arg constructor)
- `@EqualsAndHashCode(onlyExplicitlyIncluded = true)`
- `@ToString(onlyExplicitlyIncluded = true)`

**Constants:**
- `serialVersionUID = 2514353078919159376L` (line 15)

**Fields:**
| Field | Type | Line | Annotations |
|---|---|---|---|
| `id` | `Long` | 17 | (none) |
| `name` | `String` | 19 | `@ToString.Include` |
| `email` | `String` | 23 | `@EqualsAndHashCode.Include`, `@ToString.Include` |
| `password` | `String` | 25 | (none) |
| `active` | `boolean` | 28 | `@ToString.Include` |
| `roles` | `Set<Roles>` | 30 | initialized to `new HashSet<>()` |

**Explicit Methods:**
| Method | Line | Notes |
|---|---|---|
| `User(Long id, String name, String email, String password, boolean active)` (private `@Builder` constructor) | 33–39 | Populates all five fields; `roles` not populated by builder |
| `addRoles(Roles role)` | 41–43 | Adds a `Roles` instance to the `roles` `HashSet` |

**Lombok-generated methods (implicit):**
- `User()` — no-arg constructor
- `getId()`, `setId(Long)`, `getName()`, `setName(String)`, `getEmail()`, `setEmail(String)`, `getPassword()`, `setPassword(String)`, `isActive()`, `setActive(boolean)`, `getRoles()`, `setRoles(Set<Roles>)`
- `equals(Object)` — based on `email` field only
- `hashCode()` — based on `email` field only
- `toString()` — includes `name`, `email`, `active`
- `User.builder()` — static builder entry point
- `UserBuilder.build()` — builder terminal method

**Types referenced:** `Serializable`, `Roles`, `HashSet`, `Set`, `Long`, `String`, `boolean`

---

### File 2: `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java`

**Class:** `UserResponse` (implements `Serializable`)

**Annotations:**
- `@Data` (Lombok — generates getters, setters, `equals`, `hashCode`, `toString` for all fields)
- `@NoArgsConstructor`
- `@JsonInclude(JsonInclude.Include.NON_NULL)` — null fields excluded from JSON serialization

**Constants:**
- `serialVersionUID = 894041507646078302L` (line 18)

**Fields:**
| Field | Type | Line |
|---|---|---|
| `username` | `String` | 19 |
| `email` | `String` | 20 |
| `userCreateDate` | `String` | 21 |
| `userStatus` | `String` | 22 |
| `lastModifiedDate` | `String` | 23 |
| `name` | `String` | 24 |
| `lastname` | `String` | 25 |
| `phoneNumber` | `String` | 26 |

**Explicit Methods:** None — class is a pure Lombok `@Data` / `@NoArgsConstructor` DTO.

**Lombok-generated methods (implicit):**
- `UserResponse()` — no-arg constructor
- `getUsername()`, `setUsername(String)`, `getEmail()`, `setEmail(String)`, `getUserCreateDate()`, `setUserCreateDate(String)`, `getUserStatus()`, `setUserStatus(String)`, `getLastModifiedDate()`, `setLastModifiedDate(String)`, `getName()`, `setName(String)`, `getLastname()`, `setLastname(String)`, `getPhoneNumber()`, `setPhoneNumber(String)`
- `equals(Object)`, `hashCode()` — based on all fields
- `toString()` — all fields

**Types referenced:** `Serializable`, `JsonInclude`, `String`

---

### File 3: `src/main/java/com/journaldev/spring/jdbc/service/APKUpdaterException.java`

**Class:** `APKUpdaterException` (extends `RuntimeException`)

**Explicit Methods:**
| Method | Line | Notes |
|---|---|---|
| `APKUpdaterException(String message)` | 5–7 | Delegates to `super(message)` |
| `APKUpdaterException(String message, Throwable cause)` | 9–11 | Delegates to `super(message, cause)` |

**Types referenced:** `RuntimeException`, `String`, `Throwable`

**Production call sites (in `APKUpdaterService.java`):**
- Line 50: `throw new APKUpdaterException("Unable to collect all available packages", e)` — two-arg constructor
- Line 66: `throw new APKUpdaterException("Unable to get resource for package ...")` — one-arg constructor (NOTE: `e` is in scope but not passed — apparent bug, separate from this audit)

---

## Test Coverage Search Results

**Test files found under `src/test/java/`:**
1. `com/journaldev/spring/jdbc/model/PackageEntryTest.java` — tests `PackageEntry.compareTo()`
2. `com/journaldev/spring/jdbc/service/APKUpdaterServiceTest.java` — all `@Test` methods are commented out; empty test class
3. `com/journaldev/spring/jdbc/util/DateUtilTest.java` — tests `DateUtil` parsing methods

**Coverage search results for audited classes:**
- `User` — 0 references in any test file
- `UserResponse` — 0 references in any test file
- `APKUpdaterException` — 0 references in any test file
- `addRoles` — 0 references in any test file
- `Roles` — 0 references in any test file

---

## Findings

### A24-1, Severity: HIGH
**`User` class has zero test coverage**

No test class exists for `User`. The entire class — including both the Lombok-generated lifecycle (no-arg constructor, builder, all getters/setters, `equals`, `hashCode`, `toString`) and the single explicit method `addRoles` — is untested.

- File: `src/main/java/com/journaldev/spring/jdbc/model/User.java`
- Methods with no test: `addRoles(Roles)` (line 41), all Lombok-generated accessors, `equals`, `hashCode`, `toString`, builder

---

### A24-2, Severity: MEDIUM
**`User.addRoles(Roles)` — duplicate-add and null-input behaviours are untested**

`addRoles` delegates to a `HashSet`, meaning adding a duplicate `Roles` object silently does nothing. Adding `null` is permitted by `HashSet` but may cause downstream issues. Neither of these edge cases is exercised anywhere.

- File: `src/main/java/com/journaldev/spring/jdbc/model/User.java`, line 41–43
- Missing cases: add duplicate role, add `null` role, add multiple distinct roles, verify `getRoles()` reflects additions

---

### A24-3, Severity: MEDIUM
**`User` builder does not populate `roles` — untested structural gap**

The `@Builder` constructor (lines 33–39) assigns `id`, `name`, `email`, `password`, and `active` but never sets `roles`. The field initializer at line 30 (`= new HashSet<>()`) only runs via the no-arg constructor path. When an object is created via the builder, the `roles` field default initializer behaviour with Lombok's builder is not verified. No test confirms that `User.builder().build().getRoles()` returns a non-null empty `HashSet`.

- File: `src/main/java/com/journaldev/spring/jdbc/model/User.java`, lines 30, 33–39

---

### A24-4, Severity: MEDIUM
**`User.equals` is email-only — no test verifies or guards this contract**

`@EqualsAndHashCode(onlyExplicitlyIncluded = true)` restricts `equals`/`hashCode` to the `email` field. Two `User` objects with identical emails but different `id`, `name`, `password`, or `active` values will compare as equal. This is a deliberate but security-sensitive design choice (password field is present) that is completely uncovered by tests. No test checks that users with the same email but different passwords are treated as equal, nor that this behaviour is intentional.

- File: `src/main/java/com/journaldev/spring/jdbc/model/User.java`, lines 11, 21–23

---

### A24-5, Severity: HIGH
**`UserResponse` class has zero test coverage**

No test class or reference to `UserResponse` exists in the test tree. As a serializable DTO annotated with `@JsonInclude(NON_NULL)`, the serialization contract (null fields are omitted from JSON output) is never exercised.

- File: `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java`
- All Lombok-generated methods (constructor, 8 getters, 8 setters, `equals`, `hashCode`, `toString`) are untested

---

### A24-6, Severity: MEDIUM
**`UserResponse` — `@JsonInclude(NON_NULL)` serialization behaviour is untested**

The class explicitly configures `JsonInclude.Include.NON_NULL` to suppress null fields in JSON output. No test verifies that (a) a fully-populated `UserResponse` serializes all fields, (b) a partially-populated instance correctly omits null fields, or (c) an all-null instance produces an empty JSON object `{}`. This is a functional contract that can silently break if annotations are removed or misconfigured.

- File: `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java`, line 12

---

### A24-7, Severity: HIGH
**`APKUpdaterException` has zero test coverage — both constructors untested**

`APKUpdaterServiceTest` exists but all of its `@Test` methods are commented out (lines 17–44). Neither constructor of `APKUpdaterException` is exercised. No test verifies that:
- The one-arg constructor correctly propagates `message` via `getMessage()`
- The two-arg constructor correctly propagates both `message` and `cause` via `getMessage()` / `getCause()`

- File: `src/main/java/com/journaldev/spring/jdbc/service/APKUpdaterException.java`, lines 5–11

---

### A24-8, Severity: HIGH
**`APKUpdaterServiceTest` is entirely commented out — IOException error path in `APKUpdaterService` is untested**

The `APKUpdaterException(String message, Throwable cause)` constructor exists specifically to wrap `IOException` thrown by `Files.list()` in `APKUpdaterService.getAvailablePackage()` (line 50 of `APKUpdaterService.java`). Because all tests in `APKUpdaterServiceTest` are commented out, this entire error path is never exercised. The wrapping of the cause (preserving the original `IOException`) is unverified.

- Test file: `src/test/java/com/journaldev/spring/jdbc/service/APKUpdaterServiceTest.java`, lines 17–44 (commented block)
- Production throw site: `src/main/java/com/journaldev/spring/jdbc/service/APKUpdaterService.java`, line 50

---

### A24-9, Severity: MEDIUM
**`APKUpdaterException(String message)` one-arg constructor — cause is silently dropped at call site**

At `APKUpdaterService.java` line 66, the one-arg constructor is used inside a `catch (IOException e)` block, but `e` is not passed to the exception. The root cause is swallowed. While this is a production code bug rather than a test gap, the absence of any test for this constructor means no test would ever detect this silent cause-loss. The one-arg constructor itself is also a design invitation to drop causes.

- File: `src/main/java/com/journaldev/spring/jdbc/service/APKUpdaterException.java`, line 9
- Call site: `src/main/java/com/journaldev/spring/jdbc/service/APKUpdaterService.java`, line 66

---

### A24-10, Severity: LOW
**`User` and `UserResponse` `serialVersionUID` values are not validated**

Both model classes implement `Serializable` and declare explicit `serialVersionUID` constants. No test verifies that deserialization of persisted or transmitted payloads using these UIDs succeeds, nor that the UIDs are stable across refactors. While standard Java serialization testing is uncommon, given these are network-transmitted user models (containing passwords and PII fields), the absence is noted.

- `User.java` line 15: `serialVersionUID = 2514353078919159376L`
- `UserResponse.java` line 18: `serialVersionUID = 894041507646078302L`

---

### A24-11, Severity: LOW
**`UserResponse` field naming inconsistency — `lastname` vs `name` convention is untested**

The `name` field follows camelCase but `lastname` (line 25) does not follow the expected `lastName` convention. The Lombok-generated getter will be `getLastname()` rather than `getLastName()`. No test validates the JSON key that is emitted for this field. If consumers expect `lastName` in the JSON payload, the lowercase `lastname` key will silently mismatch.

- File: `src/main/java/com/journaldev/spring/jdbc/model/UserResponse.java`, line 25

---

## Summary Table

| ID | Severity | Class | Description |
|---|---|---|---|
| A24-1 | HIGH | `User` | Zero test coverage for entire class |
| A24-2 | MEDIUM | `User` | `addRoles` edge cases: duplicate, null, multiple roles |
| A24-3 | MEDIUM | `User` | Builder does not set `roles` field — untested |
| A24-4 | MEDIUM | `User` | `equals`/`hashCode` email-only contract unverified |
| A24-5 | HIGH | `UserResponse` | Zero test coverage for entire class |
| A24-6 | MEDIUM | `UserResponse` | `@JsonInclude(NON_NULL)` serialization contract untested |
| A24-7 | HIGH | `APKUpdaterException` | Both constructors completely untested |
| A24-8 | HIGH | `APKUpdaterException` | `IOException` wrapping path untested (all APKUpdaterServiceTest commented out) |
| A24-9 | MEDIUM | `APKUpdaterException` | One-arg constructor silently drops cause at its only call site — undetected without test |
| A24-10 | LOW | `User`, `UserResponse` | `serialVersionUID` stability not validated |
| A24-11 | LOW | `UserResponse` | `lastname` field naming inconsistency — JSON key unverified by tests |
