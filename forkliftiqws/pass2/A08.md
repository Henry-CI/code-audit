# A08 – Pass 2: Test Coverage
**Audit Date:** 2026-02-27
**Agent:** A08
**Scope:** LocationController, ReportAPI, RestURIConstants

---

## 1. Reading Evidence

### 1.1 LocationController
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/LocationController.java`
**Class:** `LocationController extends ConfigurationController` (`@Controller`)

| Method | Line | Annotations |
|--------|------|-------------|
| `getGPSLocation(int uid)` | 35 | `@RequestMapping(GET_GPS_LOC, GET)`, `@ResponseBody` |
| `saveGPSLocation(GPS gps)` | 53 | `@RequestMapping(SAVE_GPS_LOC, POST)`, `@ResponseBody` |
| `saveGPSLocations(GPSList gpsList)` | 72 | `@RequestMapping(SAVE_GPS_LOCS, POST)`, `@ResponseBody` |

**Types referenced:**
- `GPS` (model), `GPSList` (model), `Results` (model)
- `JdbcTemplate`, `BeanPropertyRowMapper`
- `ResponseEntity<Results>`, `HttpStatus.OK`
- `DateUtil.parseDateTimeIso()` (called at line 84)
- `RuntimeConfig.MSGID_SUCCESS` (lines 65, 88)
- `Gson` (field, line 32 — constructed but only used in `saveGPSLocations` logger call at line 73)

**Constants used from RestURIConstants:**
- `RestURIConstants.GET_GPS_LOC` → `"/rest/gps/get/{uid}"`
- `RestURIConstants.SAVE_GPS_LOC` → `"/rest/gps/save"`
- `RestURIConstants.SAVE_GPS_LOCS` → `"/rest/gps/save/all"`

**Class-level Javadoc:** `"Not in Use"` (line 25)

**Key logic branches:**
- `saveGPSLocation`: `if(gps.getLatitude()!=0 || gps.getLongitude()!=0)` (line 57) — skips DB write when both coordinates are zero; always returns `HTTP 200 OK`.
- `saveGPSLocations`: same `if` check per GPS entry inside `forEach` (line 78); no error handling around `DateUtil.parseDateTimeIso()` call (line 84).

---

### 1.2 ReportAPI
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/ReportAPI.java`
**Class:** `ReportAPI` (plain class, no Spring stereotype)

| Method | Line | Visibility |
|--------|------|------------|
| `ReportAPI(String name, String input)` | 17 | `public` constructor |
| `downloadPDF()` | 25 | `public`, `throws Exception` |
| `getExportDir(String dirctory)` | 34 | `protected`, `throws Exception` |
| `getSubject()` | 47 | `public` |
| `setSubject(String subject)` | 51 | `public` |
| `getTitle()` | 55 | `public` |
| `setTitle(String title)` | 59 | `public` |
| `getContent()` | 64 | `public` |
| `setContent(String content)` | 68 | `public` |
| `getsEmail()` | 72 | `public` |
| `setsEmail(String sEmail)` | 76 | `public` |
| `getrEmail()` | 80 | `public` |
| `setrEmail(String rEmail)` | 84 | `public` |
| `getFileURL()` | 88 | `public` |
| `setFileURL(String fileURL)` | 92 | `public` |
| `getName()` | 96 | `public` |
| `setName(String name)` | 100 | `public` |

**Fields:** `subject`, `title`, `content`, `sEmail`, `rEmail`, `fileURL`, `name`, `input` (all `protected String`, default `""`)

**Types referenced:**
- `HttpDownloadUtility` (static calls: `sendPost`, `getFileName`, `getSaveFilePath`)
- `RuntimeConfig.PDF_FOLDER` (line 41)
- `Util` (imported but not called in this file)

**Key logic in `getExportDir` (lines 34–45):**
- Builds `dir` from class code-source location via reflection (line 35).
- Commented-out path-trimming logic at lines 36–38 (dead code block).
- If `dirctory` is empty string: uses `RuntimeConfig.PDF_FOLDER` (`"temp/"`).
- Returns `"/" + dirctory` — discards the code-source path entirely (line 43), making the directory computation at line 35 a dead assignment.

---

### 1.3 RestURIConstants
**File:** `src/main/java/com/journaldev/spring/jdbc/controller/RestURIConstants.java`
**Class:** `RestURIConstants` (plain class, no instantiation mechanism)

**All constants (all `public static final String`):**

| Constant | Line | Value |
|----------|------|-------|
| `ACCEPT_USRS` | 5 | `/rest/users/permission/acceptall/{pids}` |
| `DECLINE_USRS` | 6 | `/rest/users/permission/deleteall/{pids}` |
| `CREATE_APPUSR` | 10 | `/rest/appuser/register` |
| `RESET_PASSWORD` | 11 | `/rest/appuser/reset` |
| `VALIDATE_USR` | 12 | `/rest/appuser/validate` |
| `SAVE_EMAILS` | 13 | `/rest/appuser/emails` |
| `GET_EMAILS` | 14 | `/rest/appuser/emails/get/{uid}` |
| `UPLOAD_PROFILE` | 16 | `/rest/appuser/photo/{uid}` |
| `UPLOAD_PROFILE_APP` | 17 | `/rest/appuser/photo/app/{uid}` |
| `GET_USR` | 18 | `/rest/appuser/get/{uid}` |
| `UPDATE_USERS` | 20 | `/rest/appuser/update/{uid}` |
| `GET_EQUIPMENT` | 21 | `/rest/equipment/get/{uid}` |
| `SAVE_LICENCE` | 22 | `/rest/licence/save` |
| `GET_COMPANY` | 23 | `/rest/company/get/{uid}` |
| `GET_COMPANY_DRIVERS` | 24 | `/rest/company/owner/{uid}/drivers` |
| `SEARCH_COMPANY` | 26 | `/rest/company/search/{keyword}` |
| `ADD_COMPANY` | 27 | `/rest/company/add` |
| `COMPANY_ACCEPT` | 28 | `/rest/company/accept/{pid}` |
| `COMPANY_ACCEPT_WEB` | 29 | `/rest/company/accept/web/{token}` |
| `COMPANY_DELETE` | 30 | `/rest/company/delete/{pid}` |
| `ADD_EQUIPMENT` | 32 | `/rest/equip/add` |
| `GET_MANUFACTURER` | 33 | `/rest/manu/get` |
| `GET_TYPE` | 34 | `/rest/type/get/{mid}` |
| `GET_FUELTYPE` | 35 | `/rest/fuletype/get/manuid/{mid}/typeid/{tid}` |
| `GET_QUESTION` | 36 | `/rest/question/get/{eid}` |
| `GET_FORMS` | 37 | `/rest/forms/get/question/{qid}/type/{type}` |
| `SEARCH_FORMS` | 38 | `/rest/forms/unit/{uid}/type/{type}/search/{keyword}` |
| `SAVE_RESULT` | 39 | `/rest/result/save` |
| `DRIVRR_ACCESS` | 40 | `/rest/driveraccess/save/sid/{sid}/imageno/{imageno}` |
| `START_SESSION` | 41 | `/rest/session/start` |
| `END_SESSION` | 42 | `/rest/session/end` |
| `SAVE_OFFLINE` | 43 | `/rest/offline/save` |
| `ABORT_SESSION` | 44 | `/rest/session/abort/session/{sid}` |
| `SAVE_INCIDENT` | 45 | `/rest/impact/save` |
| `SAVE_IMPACT` | 46 | `/rest/impactdata/save` |
| `SAVE_IMPACTIMAGE` | 47 | `/rest/impactimage/{impid}` |
| `SAVE_IMPACTIMAGE_APP` | 48 | `/rest/impactimage/impid/{impid}/type/{type}` |
| `GET_SERVICE` | 49 | `/rest/service/get/{uid}` |
| `GET_SERVICEDTL` | 50 | `/rest/sericedetail/get/{userid}` |
| `SAVE_SERVICE` | 51 | `/rest/service/save` |
| `RESUME_EQUIPMENT` | 52 | `/rest/driverresume/get/{uid}/frequencey/{frequencey}` |
| `RESUME_DRIVER` | 53 | `/rest/resume/get/{uid}` |
| `GET_REPORT` | 54 | `/rest/reportlist/get/{uid}` |
| `GENERATE_REPORT` | 55 | `/rest/reportlist/generate/user/{uid}/report/{rid}` |
| `SEND_REPORT` | 56 | `/rest/reportlist/freq/{freq}` |
| `GET_GPS_LOC` | 57 | `/rest/gps/get/{uid}` |
| `SAVE_GPS_LOC` | 58 | `/rest/gps/save` |
| `SAVE_GPS_LOCS` | 59 | `/rest/gps/save/all` |

**No methods declared.** No constructor declared (implicit public no-arg constructor only).

---

## 2. Test Coverage Search Results

**Test files found under `src/test/java/`:**
1. `PackageEntryTest.java` — tests `PackageEntry.compareTo()`; no relation to audit scope.
2. `APKUpdaterServiceTest.java` — all test methods commented out; zero effective tests.
3. `DateUtilTest.java` — tests `DateUtil.parseDateIso()` and `parseDateTimeIso()`; no relation to audit scope.

**Search results for each class and method:**

| Search Target | Result |
|---------------|--------|
| `LocationController` in test tree | Not found |
| `ReportAPI` in test tree | Not found |
| `RestURIConstants` in test tree | Not found |
| `getGPSLocation` in test tree | Not found |
| `saveGPSLocation` in test tree | Not found |
| `saveGPSLocations` in test tree | Not found |
| `downloadPDF` in test tree | Not found |
| `getExportDir` in test tree | Not found |

**Coverage: 0% across all three files.**

---

## 3. Findings

---

### A08-1, Severity: CRITICAL
**Zero test coverage for LocationController — all three HTTP endpoints untested**

No test of any kind exists for `LocationController`. All three mapped endpoints (`getGPSLocation`, `saveGPSLocation`, `saveGPSLocations`) are completely untested. The class is a Spring `@Controller` exposing live HTTP endpoints mapped to GPS data in the database. The class-level Javadoc states "Not in Use" but the endpoints are actively mapped and referenced by `RestURIConstants` constants that appear throughout the production codebase, indicating the comment is misleading or stale.

**Untested methods:**
- `getGPSLocation(int uid)` — line 35
- `saveGPSLocation(GPS gps)` — line 53
- `saveGPSLocations(GPSList gpsList)` — line 72

---

### A08-2, Severity: CRITICAL
**Zero test coverage for ReportAPI — all methods untested**

No test file references `ReportAPI` or any of its methods. This class orchestrates external HTTP communication (PDF download via `HttpDownloadUtility.sendPost`) and filesystem writes. The absence of any unit or integration test means every failure mode (network error, bad HTTP response, filesystem write failure, null `name`/`input` arguments) is completely unverified in the test suite.

**Untested methods:**
- Constructor `ReportAPI(String name, String input)` — line 17
- `downloadPDF()` — line 25
- `getExportDir(String dirctory)` — line 34
- All 14 accessor/mutator methods (lines 47–104)

---

### A08-3, Severity: HIGH
**`saveGPSLocation`: skips database write silently when both lat and lon are zero; caller receives HTTP 200**

The condition `if(gps.getLatitude()!=0 || gps.getLongitude()!=0)` at line 57 silently discards the GPS record when both coordinates are zero. The method then returns `HTTP 200 OK` with `MSGID_SUCCESS`. No test validates:
- That the zero-coordinate branch correctly skips the DB write.
- That HTTP 200 is still returned in the zero-coordinate case (which may mask a client error).
- That a GPS record at coordinates (0.0, 0.0) — a valid ocean location on the prime meridian/equator — is also silently discarded.

The same logic defect and missing test applies symmetrically to `saveGPSLocations` (line 78).

---

### A08-4, Severity: HIGH
**`saveGPSLocations`: `DateUtil.parseDateTimeIso()` exception propagates uncaught through `forEach` lambda**

At line 84, `DateUtil.parseDateTimeIso(gps.getGps_time())` is called inside a `forEach` lambda with no try/catch. `DateUtil.parseDateTimeIso` throws `IllegalArgumentException` on an unparseable date string (confirmed by `DateUtilTest.parseDateTimeIsoThrowsIfInvalid`). If any GPS entry in the list has a malformed or null `gps_time`, the exception will abort the entire batch, leaving earlier entries in the list partially committed (the preceding `update` for that entry will have already executed), with no compensating rollback. This is untested and unhandled.

---

### A08-5, Severity: HIGH
**`ReportAPI.getExportDir`: dead code assignment makes directory resolution incorrect**

In `getExportDir` (line 34):
- Line 35 resolves a path from the class's code-source location via `getProtectionDomain().getCodeSource().getLocation()`.
- Lines 36–38 contain commented-out code that previously trimmed that path.
- Line 43 overwrites `dir` entirely with `"/" + dirctory`, making the line-35 computation a dead assignment.
- The method always returns `"/" + RuntimeConfig.PDF_FOLDER` (`"/temp/"`) when `dirctory` is empty, regardless of the application's actual deployment path.

This produces an absolute path rooted at the filesystem root (`/temp/`), which is likely wrong on most deployment environments. No test exists to catch this regression, and the commented-out code suggests this was once functional and was broken by an incomplete refactor.

---

### A08-6, Severity: HIGH
**`ReportAPI.downloadPDF`: `Exception` from `HttpDownloadUtility.sendPost` propagates to caller with no structured handling**

`downloadPDF()` is declared `throws Exception` (line 25) and makes no attempt to catch or categorize the exception thrown by `HttpDownloadUtility.sendPost`. All callers of `downloadPDF` must handle or rethrow `Exception`. No test verifies behaviour when the remote PDF API is unreachable, returns a non-200 response, or the filesystem write fails. The broad `throws Exception` contract prevents callers from distinguishing network errors from I/O errors.

---

### A08-7, Severity: MEDIUM
**`getGPSLocation`: no authentication or authorization check; UID accepted as path variable**

`getGPSLocation(int uid)` at line 35 accepts a raw `int uid` from the URL path variable. The SQL query does filter by `p.driver_id = ?` and `p.enabled is true`, providing some data-layer scope limiting, but no controller-level check verifies that the authenticated user is permitted to query for the given `uid`. No test exercises this endpoint with an unauthorized UID to verify the SQL filter is the sole protection mechanism.

---

### A08-8, Severity: MEDIUM
**`saveGPSLocation` and `saveGPSLocations`: no transaction management; partial update possible**

Both save methods execute two sequential JDBC operations (an `UPDATE` to clear `current_location`, then an `INSERT`). Neither method is annotated `@Transactional`. If the `INSERT` fails after the `UPDATE` succeeds, the unit's GPS records will have all `current_location = false` with no new current record. This is untested and there is no test confirming atomicity of the two-statement sequence.

---

### A08-9, Severity: MEDIUM
**`RestURIConstants`: constants `ACCEPT_USRS` and `DECLINE_USRS` marked unused but not removed**

Lines 4–6 annotate `ACCEPT_USRS` and `DECLINE_USRS` with the comment `//unused`. These dead constants are retained in the public API of the class. No test verifies that these constants are not referenced by any active endpoint mapping. The presence of unused public constants creates maintenance risk (future code may accidentally reference them) and indicates incomplete cleanup.

---

### A08-10, Severity: MEDIUM
**`RestURIConstants`: typos in constant names and values are untested**

Several constant values contain apparent typos that no test exercises:
- `GET_SERVICEDTL` (line 50): value is `/rest/sericedetail/get/{userid}` — `"serice"` should be `"service"`. If clients use the string constant, they silently call the misspelled URL.
- `RESUME_EQUIPMENT` (line 52): value contains `"frequencey"` (misspelling of `"frequency"`) in both the constant name and value.
- `DRIVRR_ACCESS` (line 40): constant name contains `"DRIVRR"` (double-R typo).

No test validates that constants match expected API paths or that all constants are referenced by exactly one controller mapping.

---

### A08-11, Severity: LOW
**`RestURIConstants` has no private constructor; can be instantiated unnecessarily**

`RestURIConstants` is a utility constants class with no instance state. It declares no private constructor, so the implicit public no-arg constructor allows instantiation (`new RestURIConstants()`). No test verifies or enforces the class's utility nature. A private constructor should prevent instantiation, but its absence is also untested.

---

### A08-12, Severity: LOW
**`LocationController`: `Gson gson` field instantiated at class level but only used in a log statement**

At line 32, `Gson gson = new Gson()` is declared as an instance field. It is used only at line 73 inside `saveGPSLocations` to serialize `gpsList` into a log message (`logger.info(... gson.toJson(gpsList))`). The serialization happens unconditionally regardless of the active log level, causing unnecessary object allocation and serialization work when `INFO` logging is disabled. No test exercises or benchmarks this path.

---

### A08-13, Severity: LOW
**`ReportAPI`: `Util` is imported but never called within the class**

At line 4, `com.journaldev.spring.jdbc.util.Util` is imported but no method of `Util` is invoked anywhere in `ReportAPI`. This is a dead import. No test validates that `ReportAPI` compiles cleanly without warnings, and the import suggests a method call (e.g., `Util.generateRadomName()`) may have been intended but omitted.

---

## 4. Summary Table

| ID | Severity | Area | Description |
|----|----------|------|-------------|
| A08-1 | CRITICAL | LocationController | Zero test coverage — all 3 HTTP endpoints untested |
| A08-2 | CRITICAL | ReportAPI | Zero test coverage — all 16 methods untested |
| A08-3 | HIGH | LocationController | Zero-coordinate silent discard returns HTTP 200; valid (0,0) coordinates rejected |
| A08-4 | HIGH | LocationController | `DateUtil.parseDateTimeIso` exception unhandled in batch `forEach`; partial commit risk |
| A08-5 | HIGH | ReportAPI | `getExportDir` dead assignment makes path resolution incorrect after commented-out refactor |
| A08-6 | HIGH | ReportAPI | `downloadPDF` propagates broad `Exception`; no failure-path coverage |
| A08-7 | MEDIUM | LocationController | No controller-level authorization check on UID path variable |
| A08-8 | MEDIUM | LocationController | No `@Transactional`; two-statement GPS update/insert not atomic |
| A08-9 | MEDIUM | RestURIConstants | Dead constants `ACCEPT_USRS`/`DECLINE_USRS` retained without test enforcement |
| A08-10 | MEDIUM | RestURIConstants | Typos in constant names and values untested (`sericedetail`, `frequencey`, `DRIVRR`) |
| A08-11 | LOW | RestURIConstants | No private constructor; utility class is instantiable |
| A08-12 | LOW | LocationController | `Gson` serialized unconditionally in log call regardless of log level |
| A08-13 | LOW | ReportAPI | `Util` imported but never used in class body |
