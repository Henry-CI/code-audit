# Audit Report A19 — Pass 2: Test Coverage
**Date:** 2026-02-27
**Agent:** A19
**Scope:** `com.journaldev.spring.jdbc.model` — Manufacturer, OfflineSessions, PackageEntry
**Pass:** 2 (Test Coverage)

---

## Reading Evidence

### 1. Manufacturer.java
**File:** `src/main/java/com/journaldev/spring/jdbc/model/Manufacturer.java`

- **Class:** `Manufacturer` (implements `Serializable`)
- **Constant:** `serialVersionUID = 9130860210979786961L` (line 10)
- **Fields:** `id` (int, line 12), `name` (String, line 26)
- **Methods:**
  - `getId()` — line 14
  - `setId(int id)` — line 17
  - `getName()` — line 20
  - `setName(String name)` — line 23
- **Types used:** `java.io.Serializable`
- **No annotations, no error paths, no constructors (default only)**

---

### 2. OfflineSessions.java
**File:** `src/main/java/com/journaldev/spring/jdbc/model/OfflineSessions.java`

- **Class:** `OfflineSessions` (implements `Serializable`)
- **Constant:** `serialVersionUID = -8930449759197168463L` (line 10)
- **Fields:** `sessions` (Sessions, line 11), `results` (Result, line 12)
- **Methods:**
  - `getSessions()` — line 14
  - `setSessions(Sessions sessions)` — line 17
  - `getResults()` — line 20
  - `setResults(Result results)` — line 23
- **Types used:** `java.io.Serializable`, `Sessions` (internal model), `Result` (internal model)
- **No annotations, no error paths, no constructors (default only)**

---

### 3. PackageEntry.java
**File:** `src/main/java/com/journaldev/spring/jdbc/model/PackageEntry.java`

- **Class:** `PackageEntry` (implements `Comparable<PackageEntry>`)
- **Annotations:** `@Data`, `@NoArgsConstructor` (Lombok, line 13–14); `@Builder` on builder constructor (line 28); `@JsonIgnore` on `pattern` field (line 25)
- **Fields:**
  - `name` (String, line 17)
  - `fileName` (String, line 18)
  - `url` (String, line 19)
  - `major` (int, line 20)
  - `minor` (int, line 21)
  - `patch` (int, line 22)
  - `env` (String, line 23)
  - `pattern` (Pattern, line 26) — compiled regex `(\d*)\.?(\d*)?\.?(\d*)?\-(\w*)`
- **Methods:**
  - `PackageEntry(String fileName, String name, String version, String baseUrl)` — Builder constructor, line 29 (private)
  - `initVersion(String version)` — line 36 (private)
  - `compareTo(PackageEntry o)` — line 57 (public, `@Override`)
- **Lombok-generated methods** (from `@Data`): `getName()`, `getFileName()`, `getUrl()`, `getMajor()`, `getMinor()`, `getPatch()`, `getEnv()`, and corresponding setters, plus `equals()`, `hashCode()`, `toString()`
- **Types used:** `com.fasterxml.jackson.annotation.JsonIgnore`, `lombok.Builder`, `lombok.Data`, `lombok.NoArgsConstructor`, `org.apache.commons.lang3.StringUtils`, `org.apache.commons.lang3.builder.CompareToBuilder`, `java.util.regex.Matcher`, `java.util.regex.Pattern`
- **Error paths in `initVersion`:** `Integer.parseInt()` called without guarding for non-numeric regex groups (line 40, 43, 47) — potential `NumberFormatException` if regex group captures non-integer content
- **Error paths in `compareTo`:** null guard for `o == null` exists (line 58), returns 1
- **Regex pattern:** `(\d*)\.?(\d*)?\.?(\d*)?\-(\w*)` — requires a hyphen and an env segment; version strings without a hyphen will produce no match

---

### 4. PackageEntryTest.java
**File:** `src/test/java/com/journaldev/spring/jdbc/model/PackageEntryTest.java`

- **Class:** `PackageEntryTest`
- **Methods:**
  - `compareTo()` — line 8 (`@org.junit.Test`)
- **Test data used:** five `PackageEntry` instances built via builder with versions `1.0.0-local`, `1.1.0-local`, `1.0.1-local`, `1.1.1-local`, `2.0.0-local`
- **Assertions exercised:** minor ordering (p1 < p2), patch ordering (p1 < p3), minor vs patch cross-comparison (p2 > p3), combined minor+patch (p4 > p2), major ordering (p5 > p4)
- **Aspects NOT exercised:** equality case (`compareTo` returning 0), null argument, versions with no env segment, malformed version strings

---

### 5. APKUpdaterServiceTest.java (Indirect Coverage Check)
**File:** `src/test/java/com/journaldev/spring/jdbc/service/APKUpdaterServiceTest.java`

- Imports `PackageEntry` and references it in two commented-out `@Test` methods (`getAvailablePackage`, `getAvailablePackageWhenAlreadyHaveLatest`, lines 25–43).
- The `@Before` setup block and both test methods are entirely commented out.
- The class body contains only an instantiated `APKUpdaterService` field and no active assertions.
- **Effective coverage contribution: zero.**

---

### 6. Indirect Coverage Search Results
- **Manufacturer:** No references found anywhere under `src/test/java/`. Zero test coverage.
- **OfflineSessions:** No references found anywhere under `src/test/java/`. Zero test coverage.
- **PackageEntry:** Referenced in `APKUpdaterServiceTest.java` but exclusively within commented-out code — no active indirect coverage.

---

## Findings

---

### A19-1 — Severity: CRITICAL
**Title:** Manufacturer.java has zero test coverage

**Description:** The class `Manufacturer` has no dedicated test file and no indirect test coverage anywhere in `src/test/java/`. All four accessor methods (`getId`, `setId`, `getName`, `setName`) are completely untested. While these are simple JavaBean accessors, `Manufacturer` is a domain model used in persistence and serialization contexts. The absence of any test coverage means that serialization contract (`serialVersionUID`), field initialization, and getter/setter correctness are entirely unverified.

**Location:** `src/main/java/com/journaldev/spring/jdbc/model/Manufacturer.java`
**Untested methods:** `getId()` (line 14), `setId(int id)` (line 17), `getName()` (line 20), `setName(String name)` (line 23)

---

### A19-2 — Severity: CRITICAL
**Title:** OfflineSessions.java has zero test coverage

**Description:** The class `OfflineSessions` has no dedicated test file and no indirect test coverage anywhere in `src/test/java/`. All four accessor methods (`getSessions`, `setSessions`, `getResults`, `setResults`) are completely untested. As an aggregation model that composes `Sessions` and `Result` objects, the correct assembly and retrieval of these sub-objects is never verified. Null-assignment edge cases (setting sessions or results to null and retrieving them) are also unexercised.

**Location:** `src/main/java/com/journaldev/spring/jdbc/model/OfflineSessions.java`
**Untested methods:** `getSessions()` (line 14), `setSessions(Sessions sessions)` (line 17), `getResults()` (line 20), `setResults(Result results)` (line 23)

---

### A19-3 — Severity: HIGH
**Title:** APKUpdaterServiceTest entirely commented out — intended PackageEntry indirect coverage is dead

**Description:** `APKUpdaterServiceTest.java` was written to cover `PackageEntry` usage through `APKUpdaterService`, including full field assertions on `fileName`, `major`, `minor`, `patch`, and `url`. Both test methods and the `@Before` setup are wrapped in a block comment and never execute. This means the builder path that exercises `initVersion` with a real filesystem scan, URL formatting, and field population is never tested by the test suite. The commented-out tests represent the only planned indirect coverage of `PackageEntry`'s builder constructor.

**Location:** `src/test/java/com/journaldev/spring/jdbc/service/APKUpdaterServiceTest.java` lines 17–44
**Impact:** `PackageEntry` builder constructor (line 29), `initVersion` (line 36), `url` formatting (line 33), and field getters `getFileName()`, `getMajor()`, `getMinor()`, `getPatch()`, `getUrl()` have no active test path.

---

### A19-4 — Severity: HIGH
**Title:** PackageEntry.initVersion has no test for the non-matching branch (version string without hyphen)

**Description:** The regex `(\d*)\.?(\d*)?\.?(\d*)?\-(\w*)` requires a hyphen followed by a word segment to match. When `matcher.matches()` returns false — which occurs for any version string without a hyphen (e.g. `"1.0.0"`) or an empty string — `initVersion` silently exits, leaving `major`, `minor`, `patch`, and `env` at their zero/null defaults. No test exercises this branch. The `@NoArgsConstructor` and Lombok setters allow construction of a `PackageEntry` with a version set externally but the no-match path of `initVersion` is entirely dark.

**Location:** `src/main/java/com/journaldev/spring/jdbc/model/PackageEntry.java`, `initVersion()` lines 36–54, branch at line 39
**Missing test cases:** version without hyphen (e.g. `"1.0.0"`), empty string version, version with hyphen but missing numeric segments (e.g. `"-local"`)

---

### A19-5 — Severity: HIGH
**Title:** PackageEntry.compareTo equality case (returns 0) is not tested

**Description:** The single test method `compareTo()` in `PackageEntryTest` exercises only strict less-than and greater-than outcomes. No test verifies that two `PackageEntry` instances with identical `major`, `minor`, and `patch` values produce a `compareTo` result of 0. This equality branch of `CompareToBuilder.toComparison()` is untested, meaning the `Comparable` contract for equality is unverified.

**Location:** `src/main/java/com/journaldev/spring/jdbc/model/PackageEntry.java`, `compareTo()` line 57
**Location:** `src/test/java/com/journaldev/spring/jdbc/model/PackageEntryTest.java`
**Missing test:** e.g. `p1.compareTo(PackageEntry.builder().version("1.0.0-local").build()) == 0`

---

### A19-6 — Severity: MEDIUM
**Title:** PackageEntry.compareTo null-argument branch is not tested

**Description:** `compareTo` contains an explicit null guard at line 58 (`if (o == null) return 1`). No test in `PackageEntryTest` calls `p1.compareTo(null)` to verify this guard fires correctly. Violations of the `Comparable` contract (such as a regression removing this guard) would not be caught by the existing test suite.

**Location:** `src/main/java/com/journaldev/spring/jdbc/model/PackageEntry.java`, `compareTo()` line 58
**Missing test:** `assertTrue(p1.compareTo(null) > 0)`

---

### A19-7 — Severity: MEDIUM
**Title:** PackageEntry builder constructor fields fileName, name, and url are never asserted in any active test

**Description:** The builder constructor (line 29) sets `this.name`, `this.fileName`, and formats `this.url`. No active test verifies these fields. The only test (`compareTo`) builds instances using only the `version` parameter and never calls `getFileName()`, `getName()`, or `getUrl()`. The URL format string `"%s/%s?version=%s"` (line 33) and its dependency on `baseUrl`, `name`, and `version` is entirely unverified. Additionally, the `APKUpdaterServiceTest` tests that would have covered these are commented out.

**Location:** `src/main/java/com/journaldev/spring/jdbc/model/PackageEntry.java`, builder constructor lines 29–34
**Missing assertions:** `getFileName()`, `getName()`, `getUrl()` with varying `baseUrl`, `name`, and `version` combinations

---

### A19-8 — Severity: MEDIUM
**Title:** PackageEntry.initVersion partial-group branches (blank minor, patch, env) are not tested

**Description:** `initVersion` has three conditional branches (lines 42–52) guarded by `StringUtils.isNotBlank()` for groups 2, 3, and 4 (minor, patch, env). The existing test always uses fully-populated version strings of the form `major.minor.patch-env`. No test uses a version where any of minor, patch, or env segments are absent or blank (e.g. a regex match where group 2 is empty). Consequently, the "skip assignment" path for minor, patch, and env is never exercised, and those fields would remain at 0/null without detection.

**Location:** `src/main/java/com/journaldev/spring/jdbc/model/PackageEntry.java`, `initVersion()` lines 42, 46, 50
**Missing test cases:** versions like `"1--local"` (zero-length minor/patch groups that still match)

---

### A19-9 — Severity: LOW
**Title:** PackageEntry Lombok-generated equals/hashCode/toString are not tested

**Description:** `@Data` generates `equals()`, `hashCode()`, and `toString()` on all non-`@JsonIgnore` fields. No test verifies any of these methods. While Lombok-generated code is generally trusted, the `@JsonIgnore` annotation on the `pattern` field means `pattern` is excluded from `equals` and `hashCode`, which is a behavioral contract. If a future refactor changes field annotations, this behavioral contract change would go undetected.

**Location:** `src/main/java/com/journaldev/spring/jdbc/model/PackageEntry.java`, line 13 (`@Data`)

---

### A19-10 — Severity: LOW
**Title:** Manufacturer and OfflineSessions serialVersionUID correctness is untested

**Description:** Both `Manufacturer` (serialVersionUID `9130860210979786961L`) and `OfflineSessions` (serialVersionUID `-8930449759197168463L`) declare explicit serial version UIDs as part of their `Serializable` contract. No test performs round-trip serialization or deserialization to verify the UIDs match the class structure. A structural change to either class without updating the `serialVersionUID` would silently break deserialization in production but would not be caught by the test suite.

**Location:**
- `src/main/java/com/journaldev/spring/jdbc/model/Manufacturer.java` line 10
- `src/main/java/com/journaldev/spring/jdbc/model/OfflineSessions.java` line 10

---

## Summary Table

| Finding | Severity | Class | Area |
|---------|----------|-------|------|
| A19-1 | CRITICAL | Manufacturer | Complete absence of test coverage |
| A19-2 | CRITICAL | OfflineSessions | Complete absence of test coverage |
| A19-3 | HIGH | PackageEntry (indirect) | APKUpdaterServiceTest entirely commented out |
| A19-4 | HIGH | PackageEntry | initVersion — non-matching version string branch |
| A19-5 | HIGH | PackageEntry | compareTo — equality (returns 0) not tested |
| A19-6 | MEDIUM | PackageEntry | compareTo — null argument branch not tested |
| A19-7 | MEDIUM | PackageEntry | Builder constructor — fileName/name/url never asserted |
| A19-8 | MEDIUM | PackageEntry | initVersion — blank group branches not tested |
| A19-9 | LOW | PackageEntry | Lombok equals/hashCode/toString not tested |
| A19-10 | LOW | Manufacturer, OfflineSessions | Serialization round-trip not tested |
