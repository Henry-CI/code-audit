# Pass 3 Findings: A44

## File: LibPercentProgress/src/main/java/com/natasa/progresspercent/OnProgressTrackListener.java

### Reading Evidence
- Class: `OnProgressTrackListener` (public interface)
- Public Methods:
  - `onProgressFinish()` (line 25)
  - `onProgressUpdate(int progress)` (line 27)
- Constants/Types: None

### Findings

#### A44-1: `onProgressFinish()` has no Javadoc [INFO]
- File: `LibPercentProgress/src/main/java/com/natasa/progresspercent/OnProgressTrackListener.java`, Line: 25
- Description: The interface method `onProgressFinish()` has no Javadoc comment. Its purpose (called when progress reaches completion) is not documented.

#### A44-2: `onProgressUpdate(int progress)` has no Javadoc [INFO]
- File: `LibPercentProgress/src/main/java/com/natasa/progresspercent/OnProgressTrackListener.java`, Line: 27
- Description: The interface method `onProgressUpdate(int progress)` has no Javadoc comment. The meaning and expected range of the `progress` parameter are not documented.

---

## File: app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java

### Reading Evidence
- Class: `BleControlService` (extends `IntentService`)
- Public Methods:
  - `BleControlService()` constructor (line 33)
  - `processBleEvents(Intent intent)` (line 38)
  - `onHandleIntent(Intent intent)` (line 176, `@Override`)
  - `authDevice()` static (line 183)
  - `sendData(Intent intent, String uuid)` static (line 187)
  - `sendAction(String action)` static (line 210)
  - `setRelayWithDelay()` static (line 215)
  - `setRelayNoDelay()` static (line 224)
  - `setTime()` static (line 228)
  - `initDevice()` static (line 232)
  - `setImpactThreshold()` static (line 237)
  - `setRelayTimeout()` static (line 241)
  - `setShockNotification()` static (line 245)
  - `afterWriteAttribute(boolean r, BluetoothGattCharacteristic characteristic, Runnable failedRunnable)` static (line 249)
- Constants/Types:
  - `public static String ACTION_AUTO_RECONNECT` (line 22)
  - `public static String ACTION_INIT_DEVICE` (line 23)
  - `private static String ACTION_AUTH_DEVICE` (line 24)
  - `private static String ACTION_SET_RELAY` (line 25)
  - `private static String ACTION_SET_TIME` (line 26)
  - `private static String ACTION_SET_IMPACT_THRESHOLD` (line 27)
  - `private static String ACTION_SET_RELAY_TIMEOUT` (line 28)
  - `private static String ACTION_ENABLE_SHOCK_NOTIFICATION` (line 29)
  - `public static String TAG` (line 30)
  - `static BleMachine mBleMachine` (line 31)

### Findings

#### A44-3: Class-level Javadoc is inaccurate and incomplete [LOW]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 14
- Description: The class Javadoc (lines 14-19) is a boilerplate stub ("An IntentService subclass for handling asynchronous task requests in a service on a separate handler thread. helper methods."). It does not describe the actual purpose of `BleControlService`, which is to process BLE (Bluetooth Low Energy) control operations such as device authentication, relay control, time synchronisation, impact threshold configuration, and reconnection logic. The phrase "helper methods." is a dangling sentence fragment left over from a template and is inaccurate as a description of the class.

#### A44-4: `processBleEvents(Intent intent)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 38
- Description: This public method has no Javadoc. It dispatches BLE lifecycle events (connected, disconnected, services discovered, data available/changed) and delegates to `handleBleOperation` for command intents. Its behaviour, parameter contract, and side effects are not documented.

#### A44-5: `authDevice()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 183
- Description: Public static method with no Javadoc. Its purpose (sending an `ACTION_AUTH_DEVICE` intent to trigger device authentication) is not documented.

#### A44-6: `sendData(Intent intent, String uuid)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 187
- Description: Public static method with no Javadoc. The routing logic (shock-count/event UUIDs go to `BleDataService` and `ShockEventService`; all other UUIDs go to `BleControlService` itself) is non-obvious and entirely undocumented. Parameter semantics for `uuid` are not explained.

#### A44-7: `sendAction(String action)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 210
- Description: Public static method with no Javadoc. The expected values of `action` (one of the `ACTION_*` constants) are not described.

#### A44-8: `setRelayWithDelay()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 215
- Description: Public static method with no Javadoc. The method blocks the calling thread for 2 seconds via `Thread.sleep` before calling `mBleMachine.setRelay(true)` directly — a significant side effect (blocking sleep on the service thread) that is completely undocumented.

#### A44-9: `setRelayNoDelay()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 224
- Description: Public static method with no Javadoc.

#### A44-10: `setTime()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 228
- Description: Public static method with no Javadoc. The 2-second delay introduced by `sendActionWithDelay` is not documented.

#### A44-11: `initDevice()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 232
- Description: Public static method with no Javadoc. It sends `ACTION_INIT_DEVICE` (which triggers a sequence of time, threshold, relay-timeout, and shock-notification writes) and also triggers `BleDataService.ACTION_READ_SHOCK_COUNT`. This compound behaviour is undocumented.

#### A44-12: `setImpactThreshold()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 237
- Description: Public static method with no Javadoc. The 2-second delay is not documented.

#### A44-13: `setRelayTimeout()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 241
- Description: Public static method with no Javadoc. The 2-second delay is not documented.

#### A44-14: `setShockNotification()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 245
- Description: Public static method with no Javadoc. The 2-second delay is not documented.

#### A44-15: `afterWriteAttribute(boolean, BluetoothGattCharacteristic, Runnable)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 249
- Description: Public static method with no Javadoc. The method blocks the calling thread for 1 second via `Thread.sleep` when `r` is `true`, then reads back the characteristic. When `r` is `false` and `failedRunnable` is non-null, the runnable is executed. The semantics of the boolean parameter `r` (write success/failure), the blocking sleep, and the nullable `failedRunnable` are all undocumented.

#### A44-16: `handleBleOperation(Intent intent)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleControlService.java`, Line: 102
- Description: This package-private method (not public) is noted for completeness — it has no Javadoc. While not a public API violation, it is the core dispatch logic of the service and its return value semantics (`true` = intent was a BLE operation command, `false` = was not handled) are not described anywhere.

---

## File: app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java

### Reading Evidence
- Class: `BleController` (public)
- Public Methods:
  - `BleController()` constructor (line 779)
  - `instance()` static synchronized (line 770)
  - `init(Context context)` (line 764)
  - `isDeviceSetupDone(String address)` (line 138)
  - `isDeviceDisconnected(String address)` (line 146)
  - `onBleServiceDisconnected()` (line 187)
  - `getSupportedGattServices()` (line 209)
  - `discoverServices()` (line 217)
  - `autoReconnect()` (line 227)
  - `stopConnection()` (line 275)
  - `startScan()` (line 377)
  - `stopScan()` (line 402)
  - `preStartCheck(boolean relaySet, boolean autoReconnect, EquipmentItem equipmentItem, EquipmentListener listener)` (line 530)
  - `startConnect(boolean relaySet, boolean autoReconnect, EquipmentItem equipmentItem, EquipmentListener listener)` (line 615)
  - `startTimer()` (line 744)
- Nested public class: `EquipmentListener` (line 659)
  - `onSucceed()` (line 661)
  - `onFailed(int errorCode)` (line 665)
- Constants/Types (public):
  - `public final static int EQUIPMENT_CONNECT_CODE_BLE_NOT_ON` (line 49)
  - `public final static int EQUIPMENT_CONNECT_CODE_BLE_FAILED` (line 50)
  - `public final static int EQUIPMENT_CONNECT_CODE_BUSY` (line 51)
  - `public final static int EQUIPMENT_CONNECT_CODE_INVALID_DATA` (line 52)
  - `public static int STATUS_NONE` (line 55)
  - `public final static int STATUS_IDLE` (line 56)
  - `public final static int STATUS_CONNECTING` (line 57)
  - `public final static int STATUS_SERVICE_FOUND` (line 58)
  - `public final static int STATUS_AUTHENTICATED` (line 59)
  - `public final static int STATUS_SETUP_RELAY_DONE` (line 60)
  - `public final static int STATUS_SETUP_DONE` (line 61, alias for `STATUS_SETUP_RELAY_DONE`)
  - `public static final int SCAN_PERIOD` (line 68, 10000 ms)
  - `public static final int CONNECT_PERIOD` (line 69, 30000 ms)
  - `public static final int SCAN_TIMEOUT` (line 70, 10000 ms)
  - `public static ArrayList<BluetoothDevice> cachedBleDevices` (line 117)
  - `public Handler myHandler` (line 732)

### Findings

#### A44-17: Class-level Javadoc is absent [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 34
- Description: The only comment on the class is the IDE-generated `// Created by steveyang on 10/6/17.` (line 32). There is no Javadoc for the class. `BleController` is the central singleton managing BLE scanning, connecting, state machine interaction, and equipment session lifecycle; its responsibilities and usage contract are entirely undocumented.

#### A44-18: `instance()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 770
- Description: The public singleton accessor has no Javadoc. Its thread-safety guarantee (synchronized) and singleton behaviour are not described.

#### A44-19: `init(Context context)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 764
- Description: Public method with no Javadoc. Callers have no documentation indicating that `init` must be called before using the controller, nor what happens if it is not.

#### A44-20: `isDeviceSetupDone(String address)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 138
- Description: Public method with no Javadoc. The method returns `true` only when the given address matches the currently connected device AND `ble_status >= STATUS_SETUP_DONE`. Neither the parameter semantics nor the return value conditions are documented.

#### A44-21: `isDeviceDisconnected(String address)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 146
- Description: Public method with no Javadoc. Returns `true` only when the address matches the current device AND `ble_status == STATUS_IDLE`. Undocumented.

#### A44-22: `onBleServiceDisconnected()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 187
- Description: Public method with no Javadoc. Triggers `onFailed()` and nulls `mBleService`. Its role as a `ServiceConnection` callback is not documented.

#### A44-23: `getSupportedGattServices()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 209
- Description: Public method with no Javadoc. Returns an empty list when `mBleService` is null rather than `null`, which is a non-obvious defensive behaviour that callers should know about.

#### A44-24: `discoverServices()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 217
- Description: Public method with no Javadoc. The guard condition (only executes when `ble_status` is `STATUS_SERVICE_FOUND` or `STATUS_CONNECTING`) is undocumented; callers do not know when this call is a no-op.

#### A44-25: `autoReconnect()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 227
- Description: Public method with no Javadoc. Its precondition (requires a non-null `mEquipmentItem`) and the fact that it calls `startConnect` with the stored equipment item are undocumented.

#### A44-26: `stopConnection()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 275
- Description: Public method with no Javadoc. It initiates relay clearing (asynchronously, with up to 3 retries over 15 seconds) and stops scanning. The asynchronous nature of `clearRelay` and its retry behaviour are not described anywhere.

#### A44-27: `startScan()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 377
- Description: Public method with no Javadoc. It clears previously discovered devices, starts an async BLE scan, and schedules a stop after `SCAN_PERIOD` (10 s). The automatic timeout behaviour and the fact that found devices are stored in `mDevicesDiscovered` are undocumented.

#### A44-28: `stopScan()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 402
- Description: Public method with no Javadoc. On a successful stop it immediately calls `startBleService()` (the side-effect of initiating a GATT connection is significant and completely undocumented).

#### A44-29: `preStartCheck(...)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 530
- Description: Public method with no Javadoc. This method performs all pre-connection validation (busy check, null equipment check, empty MAC address check) and asynchronously initialises the Bluetooth adapter. Its relationship to `startConnect`, the error codes delivered via `listener.onFailed()`, and the async execution are undocumented.

#### A44-30: `startConnect(boolean, boolean, EquipmentItem, EquipmentListener)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 615
- Description: Public method with no Javadoc. This is the primary entry point for initiating a BLE device connection session. None of its parameters, preconditions, or error callback semantics are documented.

#### A44-31: `startTimer()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 744
- Description: Public method with no Javadoc. It schedules a periodic shock-count read every 5 minutes (`timerDuration`). The timer interval and its purpose are undocumented.

#### A44-32: `EquipmentListener.onSucceed()` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 661
- Description: Public method on the public nested class `EquipmentListener` has no Javadoc. Implementors have no description of when this callback fires (after full setup including relay, time, threshold, and shock-notification writes).

#### A44-33: `EquipmentListener.onFailed(int errorCode)` has no Javadoc [INFO]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 665
- Description: Public method on the public nested class `EquipmentListener` has no Javadoc. The `errorCode` parameter corresponds to one of the `EQUIPMENT_CONNECT_CODE_*` constants but this mapping is not documented. Implementors cannot know what values to handle without reading the implementation.

#### A44-34: `STATUS_SETUP_DONE` is a silent alias for `STATUS_SETUP_RELAY_DONE` with no explanation [LOW]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 61
- Description: `STATUS_SETUP_DONE` is declared as `STATUS_SETUP_RELAY_DONE` (they share the same integer value). A status state machine with two names for the same state is confusing, and no comment explains that these are intentional aliases or why there is no distinct higher state after relay setup. This absence of documentation may mislead maintainers into thinking additional states are missing from the sequence, or lead to incorrect numeric comparisons.

#### A44-35: `STATUS_NONE` is `public` and mutable, creating a risk if used as a constant [LOW]
- File: `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/BLE/BleController.java`, Line: 55
- Description: `STATUS_NONE` is declared `public static int` (not `final`). It is used as a seed value from which subsequent status constants are derived by post-increment. Because it is public and non-final, external code could mutate it, silently corrupting the values of all derived `STATUS_*` constants. No Javadoc or comment warns against modifying this field. The same pattern applies to `EQUIPMENT_CONNECT_CODE_NONE` (line 48), which is `private static int` and therefore carries lower risk, but `STATUS_NONE` being public is the documented concern here.
