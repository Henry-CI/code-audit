# Pass 3 Findings: A78

## File: EquipmentDb.java
**Full path:** `app/src/main/java/au/com/collectiveintelligence/fleetiq360/model/EquipmentDb.java`

### Reading Evidence
- Class: `EquipmentDb extends RealmObject`
- Public Methods:
  - `getEquipmentResultArray(int userId)` (line 30) — static
  - `saveEquipmentResultArray(int userId, GetEquipmentResultArray getEquipmentResultArray)` (line 45) — static
- Package-private Methods:
  - `needToCache(int userId)` (line 20) — static
- Private Methods:
  - `isExpired()` (line 16)
- Constants/Types: None defined. No enums, no static final constants.
- Fields (all private instance): `userId` (int), `updateTime` (long), `equipmentListStr` (String)

### Findings

#### A78-1: `getEquipmentResultArray` has no Javadoc [INFO]
- File: `EquipmentDb.java`, Line: 30
- Description: The public static method `getEquipmentResultArray(int userId)` has no Javadoc comment. A caller cannot determine from the declaration alone that: (a) if no cached record exists for `userId`, the method returns a non-null `GetEquipmentResultArray` whose `arrayList` field is an empty `ArrayList` (not null and not a null return); (b) the method queries the Realm database and deserialises the cached JSON string. The non-null guarantee on the fallback return value is particularly important for callers performing null checks.

#### A78-2: `saveEquipmentResultArray` has no Javadoc [INFO]
- File: `EquipmentDb.java`, Line: 45
- Description: The public static method `saveEquipmentResultArray(int userId, GetEquipmentResultArray getEquipmentResultArray)` has no Javadoc comment. Callers cannot determine from the declaration that: (a) the method performs an upsert — it updates the existing record for `userId` if one exists, or creates a new object if not; (b) `updateTime` is set to `System.currentTimeMillis()` at save time (i.e., the cache timestamp is always refreshed on save); (c) the serialised form stored is JSON produced by `GsonHelper.stringFromObjectNoPolicy`.

---

## File: LocationDb.java
**Full path:** `app/src/main/java/au/com/collectiveintelligence/fleetiq360/model/LocationDb.java`

### Reading Evidence
- Class: `LocationDb extends RealmObject`
- Public Fields:
  - `TAG` (static String, line 24)
  - `userKey` (int, line 26) — initialised from `WebData.instance().getUserId()` at field-declaration time
  - `unit_id` (int, line 28)
  - `longitude` (Double, line 29)
  - `latitude` (Double, line 30)
  - `gps_time` (String, line 31)
- Public Methods:
  - `readAllLocationToSync()` (line 33) — static
  - `removeData(SaveSingleGPSParameter saveSingleGPSParameter)` (line 47) — static
  - `uploadLocation()` (line 81) — static
  - `saveNewLocation(SaveSingleGPSParameter saveSingleGPSParameter)` (line 112) — static
- Package-private Methods:
  - `readData(Realm realm)` (line 43) — static
  - `removeData(Realm realm, SaveMultipleGPSParameter parameter)` (line 64) — static
- Private Methods:
  - `getMatchingRecord(Realm realm, int unit_id)` (line 76) — static
- Constants/Types: None defined.

### Findings

#### A78-3: `readAllLocationToSync` has no Javadoc [INFO]
- File: `LocationDb.java`, Line: 33
- Description: The public static method `readAllLocationToSync()` has no Javadoc. Callers cannot determine that the method returns a detached (copied-from-Realm) `ArrayList` of all `LocationDb` objects, or that it uses `DataBaseHelp.getRealmQuery` for filtering rather than a plain `realm.where` call, meaning the returned set may be subject to additional filter logic encapsulated in `DataBaseHelp`.

#### A78-4: `removeData(SaveSingleGPSParameter)` has no Javadoc [INFO]
- File: `LocationDb.java`, Line: 47
- Description: The public static method `removeData(SaveSingleGPSParameter)` has no Javadoc. Callers cannot determine that: (a) deletion is matched by `unit_id` only — not by any finer-grained field of `SaveSingleGPSParameter`; (b) the method is a no-op when the parameter is null (null guard at line 48); (c) all records sharing the same `unit_id` are deleted, not just a single record.

#### A78-5: `uploadLocation` has no Javadoc [INFO]
- File: `LocationDb.java`, Line: 81
- Description: The public static method `uploadLocation()` has no Javadoc. Callers cannot determine that: (a) the method reads all pending location records, batches them into a `SaveMultipleGPSParameter`, and calls the network API synchronously via `WebApi.sync()`; (b) on API success, all uploaded records are deleted from Realm; (c) on API failure, no records are deleted and no retry or error propagation occurs — the failure is silently logged only; (d) if there are no queued records, the method returns immediately without making a network call.

#### A78-6: `saveNewLocation` has no Javadoc — upsert-replace semantics undiscoverable [INFO]
- File: `LocationDb.java`, Line: 112
- Description: The public static method `saveNewLocation(SaveSingleGPSParameter)` has no Javadoc. The name "save" implies an additive store, but the implementation first deletes all existing records for `saveSingleGPSParameter.unit_id` (line 122) before inserting the new record. This replace-not-append behaviour is a non-obvious contract that is invisible without documentation. Callers who assume records accumulate across calls will be confused by data disappearing. A null guard exists at line 113 but is also undocumented.

---

## File: ModelPrefs.java
**Full path:** `app/src/main/java/au/com/collectiveintelligence/fleetiq360/model/ModelPrefs.java`

### Reading Evidence
- Class: `ModelPrefs`
- Class-level comment: `// Created by steveyang on 20/11/2015.` (IDE-generated, not Javadoc)
- Public Methods:
  - `saveInt(String key, int d)` (line 22) — static
  - `readInt(String key)` (line 26) — static
  - `deleteDataForKey(String key)` (line 31) — static
  - `saveString(String key, String s)` (line 36) — static
  - `readString(String key)` (line 40) — static
  - `saveBoolean(String key, boolean s)` (line 45) — static
  - `readBoolean(String key)` (line 49) — static
  - `saveObject(String key, Object object)` (line 53) — static
  - `readObject(String key, Class<?> classType)` (line 61) — static
- Package-private Methods:
  - `getPref()` (line 16) — static
- Constants/Types: None defined. SharedPreferences file name `"prefs"` is a hardcoded string literal, not a named constant.

### Findings

#### A78-7: `readInt` has no Javadoc — default value undocumented [INFO]
- File: `ModelPrefs.java`, Line: 26
- Description: `readInt(String key)` has no Javadoc. The method returns `0` when the key is absent (line 27 `getInt(key, 0)`). Callers that need to distinguish "key was never written" from "key was written with value 0" cannot do so, and the choice of `0` as the missing-key sentinel is invisible without documentation.

#### A78-8: `readBoolean` has no Javadoc — default value undocumented [INFO]
- File: `ModelPrefs.java`, Line: 49
- Description: `readBoolean(String key)` has no Javadoc. The method returns `false` when the key is absent (line 50 `getBoolean(key, false)`). As with `readInt`, callers cannot distinguish absence from an explicit `false` value without documentation.

#### A78-9: `readString` has no Javadoc — default value undocumented [INFO]
- File: `ModelPrefs.java`, Line: 40
- Description: `readString(String key)` has no Javadoc. The method returns `""` (empty string) when the key is absent (line 41 `getString(key, "")`). Callers cannot distinguish a missing key from a key stored with an empty string value without documentation.

#### A78-10: `saveObject` has no Javadoc — null-object serialisation behaviour undocumented [INFO]
- File: `ModelPrefs.java`, Line: 53
- Description: `saveObject(String key, Object object)` has no Javadoc. When `object` is null, the method stores an empty string `""` under the key (lines 54-55), rather than removing the key or storing a JSON null literal. This means a subsequent `readObject` call for that key will attempt to deserialise `""`, which will return null (or throw, depending on `GsonHelper` behaviour). The null-input contract and its effect on subsequent reads is undiscoverable without documentation.

#### A78-11: `readObject` has no Javadoc — nullable return and null-class behaviour undocumented [LOW]
- File: `ModelPrefs.java`, Line: 61
- Description: `readObject(String key, Class<?> classType)` has no Javadoc. The return type is `Object` rather than a typed generic, giving callers no compile-time help. More critically: (a) when the key is absent or its stored value is `""` (including after a `saveObject(key, null)` call), `GsonHelper.objectFromString` is invoked with an empty string and will most likely return null — but the method's signature implies it always returns an `Object`; (b) if `classType` does not match the stored JSON structure, deserialisation silently returns a partially populated or null object. Neither nullable return nor deserialisation failure behaviour is documented. The risk is elevated relative to the other `read*` methods because callers are likely to cast the return value immediately, and an undocumented null will cause a `NullPointerException` or `ClassCastException` at the call site. Severity is LOW (rather than INFO) because the undocumented nullable return from a method whose signature declares `Object` (non-primitive) creates a real latent defect risk for callers that do not defensively null-check.

#### A78-12: All other public methods in `ModelPrefs` have no Javadoc [INFO]
- File: `ModelPrefs.java`, Lines: 22, 31, 36, 45
- Description: `saveInt`, `deleteDataForKey`, `saveString`, and `saveBoolean` have no Javadoc. While their behaviour is relatively self-evident from name and signature, the SharedPreferences file name (`"prefs"`) is hardcoded and not exposed as a constant, so there is no documented way for callers to know which preferences file is being accessed. The use of `commit()` (synchronous, blocking) rather than `apply()` (asynchronous) for all writes is also undocumented and may be relevant on the main thread.
