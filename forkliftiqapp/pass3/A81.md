# Pass 3 Findings: A81

## File: SessionDb.java
### Reading Evidence
- Class: `SessionDb` (extends `RealmObject`)
- Public Fields: `userKey` (line 21), `preStartFinished` (line 30)
- Public Methods:
  - `getSessionResult()` (line 41)
  - `setSessionResult(SessionResult result)` (line 50)
  - `getEquipmentItem()` (line 54)
  - `isEquipmentSetupDone(int sessionId)` (line 58) — static
  - `isPreStartFinished(int sessionId)` (line 68) — static
  - `isSessionAborted(int sessionId)` (line 145) — static
  - `setSessionPreFinish(int sessionId, String finishTime)` (line 178) — static
  - `addRunningChangeListener(RealmChangeListener<RealmResults<SessionDb>> listener)` (line 202) — static
  - `readRunningSessionDb()` (line 255) — static
  - `readRunningEquipmentItem()` (line 260) — static
  - `readRunningSession()` (line 265) — static
  - `readUnfinishedSession()` (line 270) — static
  - `hasOfflineData(int sessionId)` (line 290) — static
  - `setSessionAborted(int sessionId, boolean offline)` (line 306) — static
  - `setSessionFinished(int sessionId, String finish_time, boolean offline)` (line 338) — static
  - `setSessionResultWithPreStartRequired(SessionResult sessionResult, boolean prestartRequired)` (line 378) — static
  - `setSessionPreStartFinished(int sessionId, SavePreStartParameter parameter, boolean offline)` (line 395) — static
  - `setSessionConnected(int sessionId, boolean connected)` (line 418) — static
  - `saveData(SessionResult result, EquipmentItem equipmentItem, boolean offline)` (line 461) — static
  - `incrementConnectionRetry()` (line 467)
- Constants/Types: None (no static final constants; all fields are instance state)

### Findings

#### A81-1: No Javadoc on any public method in SessionDb [INFO]
- File: SessionDb.java, Lines: 41, 50, 54, 58, 68, 145, 178, 202, 255, 260, 265, 270, 290, 306, 338, 378, 395, 418, 461, 467
- Description: The class has 20 public methods and 2 public fields and none carry any Javadoc comment. The methods implement non-trivial offline-sync logic (e.g., `setSessionFinished`, `setSessionAborted`, `incrementConnectionRetry`, `addRunningChangeListener`) whose behaviour, parameters, and side-effects are entirely undocumented.

#### A81-2: `incrementConnectionRetry` return value is potentially unsafe — no documentation warning [LOW]
- File: SessionDb.java, Line: 486
- Description: The method ends with `Objects.requireNonNull(readRunningSessionDb()).connectionRetry`. If there is no running session at the time of the call (e.g., the session just finished), `readRunningSessionDb()` returns `null` and `requireNonNull` throws a `NullPointerException`. There is no Javadoc or inline comment documenting this precondition, making it a silent runtime risk for callers. The documentation gap is a direct contributor to the hazard.

#### A81-3: `setSessionFinished` does not guard against null `SessionResult` from Gson deserialisation [LOW]
- File: SessionDb.java, Lines: 351-354
- Description: At line 351, `GsonHelper.objectFromString(sessionDb.dataStr, SessionResult.class)` may return `null` (e.g., if `dataStr` is null or malformed). The result is used without a null check at line 352 (`sessionResult.finish_time = finish_time`), which would throw a `NullPointerException`. No Javadoc or inline comment documents this assumption or pre-condition. Because this is a database write path executed inside a Realm transaction, a crash here silently leaves the record in an inconsistent state.

---

## File: SyncService.java
### Reading Evidence
- Class: `SyncService` (extends `IntentService`)
- Public Methods:
  - `SyncService()` constructor (line 27)
  - `startService()` (line 157) — static
- Overridden (non-public in terms of API contract): `onHandleIntent(Intent intent)` (line 32)
- Private fields: `TAG` (line 23), `webApi` (line 25)
- Constants/Types: None

### Findings

#### A81-4: No Javadoc on any public method in SyncService [INFO]
- File: SyncService.java, Lines: 27, 157
- Description: Neither the constructor nor `startService()` carries Javadoc. `startService()` in particular has a non-obvious behaviour: it does not start the service immediately but schedules a delayed start of 5000 ms via `MyApplication.runLater`. Callers receiving no documentation may assume the service starts synchronously.

#### A81-5: `startService` delayed-start behaviour is undocumented [LOW]
- File: SyncService.java, Lines: 157-167
- Description: `startService()` wraps `context.startService(...)` inside a `runLater(..., 5000)` call, meaning the service is always started with a 5-second delay. This is a behavioural contract that callers depend on (it is called from multiple sites including `SessionDb` after offline events). No comment or Javadoc explains the delay, its rationale, or the `IllegalStateException` catch that silently suppresses failures when the app is in the background. This constitutes an accuracy gap between the method name (implies immediate start) and its actual behaviour.

#### A81-6: `onHandleIntent` network-unavailable retry path silently continues to `syncSession` [LOW]
- File: SyncService.java, Lines: 37-46
- Description: When no network is detected, the code schedules a retry via `runLater` but does NOT return; it falls through and calls `syncSession()` on line 46 anyway. This means a sync is attempted against a known-offline device. There is no comment explaining whether this is intentional (e.g., to allow local DB cleanup in `removeSessionsToDelete`). The absence of any documentation makes the logic ambiguous and potentially indicates a bug that could be caught during review if behaviour were specified.

---

## File: TakePhotoPathPrefs.java
### Reading Evidence
- Class: `TakePhotoPathPrefs`
- Class-level comment: `// Created by steveyang on 20/11/2015.` (not a Javadoc comment; line 9-11)
- Public Methods:
  - `saveObjectFromPosition(int position, String path)` (line 26) — static
  - `hasInvalidPhoto()` (line 38) — static
  - `getImagePathFromPosition(int position)` (line 46) — static
  - `clearImages()` (line 53) — static
- Package-private Methods:
  - `getPref()` (line 21) — static, package-private
- Constants/Types:
  - `KEY_0` = `"image0"` (line 14) — private static
  - `KEY_1` = `"image1"` (line 15) — private static
  - `KEY_2` = `"image2"` (line 16) — private static
  - `KEY_3` = `"image3"` (line 17) — private static
  - `keyArray` = `{KEY_0, KEY_1, KEY_2, KEY_3}` (line 18) — private static

### Findings

#### A81-7: No Javadoc on any public method in TakePhotoPathPrefs [INFO]
- File: TakePhotoPathPrefs.java, Lines: 26, 38, 46, 53
- Description: None of the four public methods carry Javadoc. The class-level author comment (lines 9-11) uses `/** */` block syntax but contains no meaningful description of the class purpose.

#### A81-8: `hasInvalidPhoto` method name and return type are misleading — no documentation to clarify [MEDIUM]
- File: TakePhotoPathPrefs.java, Lines: 38-45
- Description: The method is named `hasInvalidPhoto`, which implies a boolean result ("does an invalid photo exist?"). However, the method returns an `int`: the zero-based index of the first slot that has no stored path, or `-1` if all four slots are populated. The name inverts the semantic of `-1` (the "all valid" case returns a negative number, while a boolean `has*` method would conventionally return `false`). Without any Javadoc, callers who read only the signature will likely misinterpret the return value. This is a documentation accuracy gap with real misuse risk.

#### A81-9: `saveObjectFromPosition` contains dead code with no explanatory comment [INFO]
- File: TakePhotoPathPrefs.java, Line: 27
- Description: `String s = "";` is declared but never read or used. While this is primarily a code quality issue, the absence of any method-level comment means there is no indication of whether this was an intentional placeholder or an oversight. A Javadoc comment would have made the method intent clear enough that such dead code would be obviously incongruous.

#### A81-10: `saveObjectFromPosition` silently ignores out-of-range position values — undocumented [LOW]
- File: TakePhotoPathPrefs.java, Lines: 26-36
- Description: The method accepts `position` values 0-3. If `position` is any other value (e.g., 4, -1), the method performs no operation and returns without any error, log, or exception. This silent no-op is not documented in a Javadoc `@param` tag or `@throws` clause, so callers have no indication that invalid positions are silently discarded rather than raising an error.
