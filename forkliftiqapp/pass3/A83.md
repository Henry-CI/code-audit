# Pass 3 Findings: A83

## File: JobsPresenter.java
**Full path:** `app/src/main/java/au/com/collectiveintelligence/fleetiq360/presenter/JobsPresenter.java`

### Reading Evidence
- Class: `JobsPresenter`
- Public Methods:
  - `stopTimer()` (line 54)
  - `JobsPresenter(JobsFragment ui)` constructor (line 59)
  - `saveSessionEnd()` (line 74)
- Private Methods (for reference):
  - `startTimer()` (line 48)
  - `setTimeText()` (line 68)
- Constants/Types: None defined
- Notable: Duplicate import of `au.com.collectiveintelligence.fleetiq360.ui.application.MyApplication` at lines 23 and 26.

### Findings

#### A83-1: Constructor `JobsPresenter(JobsFragment)` has no Javadoc [INFO]
- File: `JobsPresenter.java`, Line: 59
- Description: The constructor is public and has no Javadoc comment. It performs non-trivial initialization: stores the UI reference, instantiates a `ServerDateFormatter`, fetches the current `SessionResult` from `WebData`, parses the session start time, calls `setTimeText()` to populate UI immediately, and then starts the repeating timer via `startTimer()`. These side effects on construction are entirely undocumented.

#### A83-2: Public method `stopTimer()` has no Javadoc [INFO]
- File: `JobsPresenter.java`, Line: 54
- Description: `stopTimer()` sets the `timerStopped` flag to `true` and removes pending callbacks from the handler, halting the repeating UI update. It has no Javadoc. Callers (expected to be `JobsFragment` lifecycle methods) have no indication of when this must be called or what state is left after the call.

#### A83-3: Public method `saveSessionEnd()` has no Javadoc [INFO]
- File: `JobsPresenter.java`, Line: 74
- Description: `saveSessionEnd()` is the most complex public method in the class and has no Javadoc. Its undocumented behavior includes: (1) a null-guard on `sessionResult` that shows a toast and returns early, (2) an async API call to end the session, (3) on success: updating progress, triggering a location update, and showing a `YesNoDialog` with a 30-second auto-timeout that logs the user out on accept or timeout and hides progress on decline, (4) on failure: an offline-data fallback path that marks the session finished locally and proceeds identically to the success path, versus a second failure path that hides progress and shows an error dialog. The dual-path failure logic and the YesNoDialog timeout-triggered logout are especially significant undocumented behaviors.

---

## File: PreStartCheckListPresenter.java
**Full path:** `app/src/main/java/au/com/collectiveintelligence/fleetiq360/presenter/PreStartCheckListPresenter.java`

### Reading Evidence
- Class: `PreStartCheckListPresenter`
- Public Fields:
  - `mapAnswers` — `HashMap<Integer, AnswerItem>` (line 25), annotated `@SuppressLint("UseSparseArrays")`
- Public Methods:
  - `PreStartCheckListPresenter(EquipmentPrestartFragment ui)` constructor (line 29)
  - `getPreStartCheckListInfo()` (line 34)
  - `savePreStartCheckListAnswerResult(HashMap<Integer, AnswerItem> mapAnswers, String comments)` (line 58)
- Constants/Types: None defined

### Findings

#### A83-4: Constructor `PreStartCheckListPresenter(EquipmentPrestartFragment)` has no Javadoc [INFO]
- File: `PreStartCheckListPresenter.java`, Line: 29
- Description: The public constructor has no Javadoc. It stores the UI reference and instantiates a `ServerDateFormatter`. While simple, its contract with the UI fragment is undocumented.

#### A83-5: Public method `getPreStartCheckListInfo()` has no Javadoc [INFO]
- File: `PreStartCheckListPresenter.java`, Line: 34
- Description: `getPreStartCheckListInfo()` has no Javadoc. It shows a loading layout, makes an async API call to fetch pre-start questions for the current session's unit, hides the loading layout on completion, and populates the recycler view. On failure, it falls back to locally cached questions from `PreStartQuestionDb`; if no local cache exists, it shows a toast with a hardcoded string `"Get prestart info failed."`. The fallback behavior and the hardcoded failure string are undocumented.

#### A83-6: Public method `savePreStartCheckListAnswerResult(HashMap, String)` has no Javadoc [INFO]
- File: `PreStartCheckListPresenter.java`, Line: 58
- Description: `savePreStartCheckListAnswerResult()` has no Javadoc. Its undocumented behaviors include: (1) it converts the `mapAnswers` map values to a list and constructs a `SavePreStartParameter` using session data from `WebData`, (2) it records the current time as `finish_time`, (3) on API success it displays a progress update, then after a 1-second delay hides progress and calls `ui.showNext()`, (4) on API failure with offline data available it saves the pre-start locally via `SessionDb.setSessionPreStartFinished()` and follows the same success path, (5) on API failure without offline data it updates progress with a failure message and hides progress after 1 second but does NOT call `showNext()`, effectively blocking progression. The parameter `comments` maps to `parameter.comment`; this mapping is undocumented. An unused local variable `webServiceResultPacket` is created at line 86 in the offline-fallback branch but never used, suggesting dead or incomplete code.

#### A83-7: Public field `mapAnswers` has no Javadoc [INFO]
- File: `PreStartCheckListPresenter.java`, Line: 25
- Description: The public field `mapAnswers` (type `HashMap<Integer, AnswerItem>`) is annotated with `@SuppressLint("UseSparseArrays")` to suppress an Android lint warning about performance, but there is no Javadoc or comment explaining why a `HashMap` is used instead of a `SparseArray`, nor what the `Integer` key represents (it is presumed to be a question ID). The suppression annotation without explanation may confuse maintainers.

---

## File: SelectDriverPresenter.java
**Full path:** `app/src/main/java/au/com/collectiveintelligence/fleetiq360/presenter/SelectDriverPresenter.java`

### Reading Evidence
- Class: `SelectDriverPresenter`
- Public Fields:
  - `ui` — `DriverListFragment` (line 15)
- Public Methods:
  - `SelectDriverPresenter(DriverListFragment ui)` constructor (line 17)
  - `getCompanyDriversList()` (line 21)
  - `showImage(String url, ImageView imageView)` (line 25)
- Constants/Types: None defined

### Findings

#### A83-8: Constructor `SelectDriverPresenter(DriverListFragment)` has no Javadoc [INFO]
- File: `SelectDriverPresenter.java`, Line: 17
- Description: The public constructor has no Javadoc. It stores the provided `DriverListFragment` reference in the public field `ui`.

#### A83-9: Public method `getCompanyDriversList()` has no Javadoc [INFO]
- File: `SelectDriverPresenter.java`, Line: 21
- Description: `getCompanyDriversList()` has no Javadoc. It delegates directly to `ui.updateDriverList(CurrentUser.get().associatedDrivers())`. There is no documentation of the data source (`CurrentUser`) or what happens if the current user has no associated drivers.

#### A83-10: Public method `showImage(String, ImageView)` has no Javadoc — undocumented SSL bypass side effect [HIGH]
- File: `SelectDriverPresenter.java`, Line: 25
- Description: `showImage()` has no Javadoc at all. Critically, at line 39 it calls `UserPhotoFragment.SSLCertificateHandler.nuke()` before loading the image. Based on the method name `nuke()` and the class name `SSLCertificateHandler`, this call very likely disables or bypasses SSL certificate validation globally for the process (a well-known Android anti-pattern). This is a security-significant side effect that is entirely undocumented on the public method. Callers have no indication that invoking `showImage()` alters the global SSL trust state of the application. This warrants HIGH severity because the absence of documentation means the behavior may be inadvertently triggered without awareness of its security implications, and it cannot be reviewed or suppressed by callers who consult only the method signature and documentation.

#### A83-11: Public field `ui` is undocumented and unnecessarily public [INFO]
- File: `SelectDriverPresenter.java`, Line: 15
- Description: The field `ui` holding the `DriverListFragment` reference is declared `public` rather than `private`. In the other two presenter files (`JobsPresenter`, `PreStartCheckListPresenter`) the equivalent field is `private`. There is no Javadoc explaining the intentional public visibility. This inconsistency is undocumented and exposes the UI reference to direct external mutation without any encapsulation.
