# Pass 3 Findings: A19

## File: DiskCache.java
Full path: `LibImageloader/src/main/java/com/nostra13/universalimageloader/cache/disc/DiskCache.java`

### Reading Evidence
- Class: `DiskCache` (interface)
- Public Methods:
  - `getDirectory()` (line 37)
  - `get(String imageUri)` (line 45)
  - `save(String imageUri, InputStream imageStream, IoUtils.CopyListener listener)` (line 59)
  - `save(String imageUri, Bitmap bitmap)` (line 69)
  - `remove(String imageUri)` (line 78)
  - `close()` (line 81)
  - `clear()` (line 84)
- Constants/Types: none (interface only)

### Findings
No findings. All seven public methods carry Javadoc that accurately describes their contracts.

---

## File: BaseDiskCache.java
Full path: `LibImageloader/src/main/java/com/nostra13/universalimageloader/cache/disc/impl/BaseDiskCache.java`

### Reading Evidence
- Class: `BaseDiskCache` (abstract, implements `DiskCache`)
- Public Methods:
  - `BaseDiskCache(File cacheDir)` constructor (line 60)
  - `BaseDiskCache(File cacheDir, File reserveCacheDir)` constructor (line 68)
  - `BaseDiskCache(File cacheDir, File reserveCacheDir, FileNameGenerator fileNameGenerator)` constructor (line 78)
  - `getDirectory()` (line 92) — `@Override`
  - `get(String imageUri)` (line 97) — `@Override`
  - `save(String imageUri, InputStream imageStream, IoUtils.CopyListener listener)` (line 102) — `@Override`
  - `save(String imageUri, Bitmap bitmap)` (line 125) — `@Override`
  - `remove(String imageUri)` (line 146) — `@Override`
  - `close()` (line 151) — `@Override`
  - `clear()` (line 156) — `@Override`
  - `setBufferSize(int bufferSize)` (line 177)
  - `setCompressFormat(Bitmap.CompressFormat compressFormat)` (line 181)
  - `setCompressQuality(int compressQuality)` (line 185)
- Constants/Types:
  - `DEFAULT_BUFFER_SIZE = 32 * 1024` (line 40) — public static final int
  - `DEFAULT_COMPRESS_FORMAT = Bitmap.CompressFormat.PNG` (line 42) — public static final Bitmap.CompressFormat
  - `DEFAULT_COMPRESS_QUALITY = 100` (line 44) — public static final int

### Findings

#### A19-1: `save(String, Bitmap)` recycles the bitmap without documenting that side effect [HIGH]
- File: `BaseDiskCache.java`, Line: 141
- Description: The implementation at line 141 calls `bitmap.recycle()` unconditionally after the save attempt, regardless of success or failure. Neither the interface-level Javadoc in `DiskCache.java` (lines 62-68) nor any comment in `BaseDiskCache` itself mentions that the supplied `Bitmap` will be recycled by this call. Callers who retain a reference to the bitmap and attempt to use it after calling `save()` will receive an `IllegalStateException` ("Canvas: trying to use a recycled bitmap"). This is a high-risk undocumented side effect because the caller has no indication the object they passed in will be destroyed.

#### A19-2: `setBufferSize(int)` has no Javadoc [INFO]
- File: `BaseDiskCache.java`, Line: 177
- Description: The public method `setBufferSize(int bufferSize)` has no Javadoc comment. There is no description of the parameter, the units (bytes), the default value (`DEFAULT_BUFFER_SIZE` = 32 KB), or any constraints (e.g., whether zero or negative values are valid).

#### A19-3: `setCompressFormat(Bitmap.CompressFormat)` has no Javadoc [INFO]
- File: `BaseDiskCache.java`, Line: 181
- Description: The public method `setCompressFormat(Bitmap.CompressFormat compressFormat)` has no Javadoc comment. There is no description of the parameter, the default value (`DEFAULT_COMPRESS_FORMAT` = PNG), or the effect on already-cached entries.

#### A19-4: `setCompressQuality(int)` has no Javadoc [INFO]
- File: `BaseDiskCache.java`, Line: 185
- Description: The public method `setCompressQuality(int compressQuality)` has no Javadoc comment. There is no description of the parameter, valid range (conventionally 0–100), the default value (`DEFAULT_COMPRESS_QUALITY` = 100), or the interaction with lossless formats such as PNG where quality is ignored.

#### A19-5: Malformed `{@value}` Javadoc tags on constants [INFO]
- File: `BaseDiskCache.java`, Lines: 39, 41, 43
- Description: The three constant fields use the comment `/** {@value */` (note the missing closing brace on the tag — it should be `/** {@value} */`). As written the tag is malformed and will not be rendered correctly by Javadoc tooling; the generated documentation will show the literal text `{@value` rather than the actual constant value.

---

## File: LimitedAgeDiskCache.java
Full path: `LibImageloader/src/main/java/com/nostra13/universalimageloader/cache/disc/impl/LimitedAgeDiskCache.java`

### Reading Evidence
- Class: `LimitedAgeDiskCache` (extends `BaseDiskCache`)
- Public Methods:
  - `LimitedAgeDiskCache(File cacheDir, long maxAge)` constructor (line 47)
  - `LimitedAgeDiskCache(File cacheDir, File reserveCacheDir, long maxAge)` constructor (line 56)
  - `LimitedAgeDiskCache(File cacheDir, File reserveCacheDir, FileNameGenerator fileNameGenerator, long maxAge)` constructor (line 67)
  - `get(String imageUri)` (line 73) — `@Override`
  - `save(String imageUri, InputStream imageStream, IoUtils.CopyListener listener)` (line 96) — `@Override`
  - `save(String imageUri, Bitmap bitmap)` (line 103) — `@Override`
  - `remove(String imageUri)` (line 110) — `@Override`
  - `clear()` (line 116) — `@Override`
- Constants/Types: none beyond what is inherited

### Findings

#### A19-6: `get()` returns a non-null deleted File reference for expired entries, violating the interface contract [MEDIUM]
- File: `LimitedAgeDiskCache.java`, Lines: 73-93
- Description: The `DiskCache` interface documents `get()` as returning "null if image wasn't cached" (DiskCache.java line 43). When `LimitedAgeDiskCache.get()` determines a file has exceeded `maxFileAge` it deletes the file on disk (line 86) and removes it from `loadingDates` (line 87), but then falls through to return the non-null `file` reference (line 92). The returned `File` object points to a path that no longer exists. Callers relying on the interface contract — checking for `null` to determine cache miss — will receive a non-null handle and may attempt to open a file that has already been deleted, causing an `IOException` or silent failure. The `LimitedAgeDiskCache` class Javadoc and the overriding method carry no comment explaining this deviation from the interface contract.

#### A19-7: Two-argument constructor `LimitedAgeDiskCache(File, File, long)` does not document the `reserveCacheDir` parameter [INFO]
- File: `LimitedAgeDiskCache.java`, Lines: 51-58
- Description: The Javadoc block for the `LimitedAgeDiskCache(File cacheDir, File reserveCacheDir, long maxAge)` constructor (lines 51-55) provides `@param` tags only for `cacheDir` and `maxAge`. The `reserveCacheDir` parameter is not described at all. By contrast, the equivalent constructor in the parent class `BaseDiskCache` (line 64) documents `reserveCacheDir` as "null-ok; Reserve directory for file caching. It's used when the primary directory isn't available." The omission leaves callers unaware that `null` is an accepted value.
