# Pass 3 Findings: A46

## File: BleModel.java
### Reading Evidence
- Class: `BleModel` (line 11)
- Public Methods:
  - `instance()` (line 42)
  - `BleModel()` constructor (line 52)
  - `getPrimaryRelayId()` (line 56)
  - `getRelayId(int index)` (line 60)
  - `getPathExternalRelayKey(int index)` (line 85)
  - `getUUIDFromPath(String path)` (line 89)
- Constants/Types:
  - `UUID_BLE_TIME` (line 13) — public final static String
  - `UUID_BLE_DEVICE_NAME` (line 14) — public final static String
  - `UUID_BLE_MANUFACTURE` (line 15) — public final static String
  - `UUID_BLE_MODEL` (line 16) — public final static String
  - `UUID_SHOCK_COUNT` (line 17) — public final static String
  - `UUID_SHOCK_EVENT_ITEM` (line 18) — public final static String
  - `UUID_POP_SHOCK_EVENT` (line 19) — public final static String
  - `UUID_SHOCK_THRESHOLD` (line 20) — public final static String
  - `UUID_RELAY_0` (line 21) — public final static String
  - `UUID_RELAY_1` (line 22) — public final static String
  - `UUID_TOKEN_AUTH` (line 23) — public final static String
  - `TOKEN_AUTH` (line 24) — public final static String
  - `UUID_RELAY_0_TIMEOUT` (line 26) — public final static String
  - `UUID_RELAY_1_TIMEOUT` (line 27) — public final static String
  - `CLIENT_CHARACTERISTIC_CONFIG` (line 29) — public static String
  - `basePath` (line 32) — package-private final static String
  - `PATH_VERSION_MAIN` (line 33) — package-private final static String
  - `PATH_VERSION_RADIO` (line 34) — package-private final static String
  - `PATH_SHOCK_EVENT_THRESHOLD` (line 35) — package-private final static String
  - `PATH_SHOCK_EVENT_POP` (line 36) — package-private final static String
  - `PATH_SHOCK_EVENT` (line 37) — package-private final static String
  - `PATH_SHOCK_EVENT_COUNT` (line 38) — package-private final static String
  - `mapUuidForPath` (line 39) — package-private HashMap<String,String>
  - `ourInstance` (line 41) — private static BleModel

### Findings

#### A46-1: `instance()` has no Javadoc [INFO]
- File: BleModel.java, Line: 42
- Description: The public singleton factory method `instance()` has no Javadoc comment. It is not obvious from the method signature alone that this method applies lazy initialisation or that it returns a shared singleton. A Javadoc comment documenting the singleton pattern and thread-safety (or lack thereof) would help callers.

#### A46-2: `BleModel()` constructor has no Javadoc [INFO]
- File: BleModel.java, Line: 52
- Description: The public no-arg constructor has no Javadoc. Callers have no documentation indicating that the constructor calls `initUuids()` to pre-populate the UUID map, or that the class is also usable via the singleton `instance()` method.

#### A46-3: `getPrimaryRelayId()` has no Javadoc [INFO]
- File: BleModel.java, Line: 56
- Description: The public method `getPrimaryRelayId()` has no Javadoc. There is no explanation of what constitutes the "primary" relay or why it is always `UUID_RELAY_0`.

#### A46-4: `getRelayId(int)` has no Javadoc [INFO]
- File: BleModel.java, Line: 60
- Description: The public method `getRelayId(int index)` has no Javadoc. Callers are not informed that valid indices are 0 and 1 only, that index 0 maps to `UUID_RELAY_0`, index 1 to `UUID_RELAY_1`, or that any other index silently returns an empty string rather than throwing an exception.

#### A46-5: `getPathExternalRelayKey(int)` has no Javadoc [INFO]
- File: BleModel.java, Line: 85
- Description: The public method `getPathExternalRelayKey(int index)` has no Javadoc. There is no documentation of the returned path string format (`"external_output.relay_N_state"`) or the valid range of the index parameter.

#### A46-6: `getUUIDFromPath(String)` has no Javadoc [INFO]
- File: BleModel.java, Line: 89
- Description: The public method `getUUIDFromPath(String path)` has no Javadoc despite implementing a non-trivial algorithm: it prepends the `basePath` namespace, computes a SHA-1 hash of the full path, then formats the first 32 hex characters of that hash into a UUID string (9-4-4-4-11 grouping). Results are cached in `mapUuidForPath`. The method returns an empty string on SHA-1 failure. None of this is documented, making the method opaque to callers.

#### A46-7: No class-level Javadoc on `BleModel` [INFO]
- File: BleModel.java, Line: 11
- Description: The class has only a creation timestamp comment (`// Created by steveyang on 2/7/17.`) but no Javadoc describing the class's purpose: acting as a central registry of BLE UUIDs for the ForkliftIQ device and providing UUID derivation from characteristic path strings.

---

## File: BleUtil.java
### Reading Evidence
- Class: `BleUtil` (line 22)
- Inner Class: `BleUtil.BleTimeItem` (line 33) — public static, fields: `year`, `month`, `day`, `hour`, `minute`, `second`, `dayOfWeek` (all package-private int)
- Public Methods:
  - `BleUtil()` constructor (line 24)
  - `parseBleTime(byte[] data)` (line 43) — public static
  - `isTimeSetSucceed(BleTimeItem bleTimeItem, BleTimeItem expectItem)` (line 63) — public static
  - `getTimeData()` (line 91) — public static
  - `isTheSameByteArray(byte[] a1, byte[] a2)` (line 127) — public static
  - `bytesToHexStr(byte[] bytes)` (line 151) — public static
  - `unsignedByteToInt(byte b)` (line 164) — static public
  - `unsignedBytesToInt(byte b0, byte b1)` (line 171) — static public
  - `unsignedBytesToInt(byte b0, byte b1, byte b2, byte b3)` (line 178) — static public
  - `bytesToFloat(byte b0, byte b1)` (line 186) — static public
  - `bytesToFloat(byte b0, byte b1, byte b2, byte b3)` (line 196) — static public
  - `unsignedToSigned(int unsigned, int size)` (line 207) — static public
  - `intToSignedBits(int i, int size)` (line 217) — static public
  - `getIntValue(byte[] data, int formatType)` (line 231) — static public
  - `getIntValue(byte[] data, int formatType, int offset)` (line 234) — static public
- Constants/Types:
  - `UPDATE_REASON_UNKNOWN` (line 26) — package-private static byte = 0
  - `UPDATE_REASON_MANUAL` (line 27) — package-private static byte = 1
  - `UPDATE_REASON_EXTERNAL_REF` (line 28) — package-private static byte = (1 << 1)
  - `UPDATE_REASON_TIME_ZONE_CHANGE` (line 29) — package-private static byte = (1 << 2)
  - `UPDATE_REASON_DAYLIGHT_SAVING` (line 30) — package-private static byte = (1 << 3)
  - `hexArray` (line 150) — private final static char[]

### Findings

#### A46-8: `parseBleTime(byte[])` has no Javadoc [INFO]
- File: BleUtil.java, Line: 43
- Description: The public static method `parseBleTime(byte[] data)` has no Javadoc. It parses a 10-byte Bluetooth GATT Current Time characteristic payload into a `BleTimeItem`, returning a default-initialised (all-zero) item if the array is shorter than 10 bytes. The only documentation present is a commented-out Python `struct.pack` line (lines 45-46) which, while useful as a format reference, does not substitute for a Javadoc comment describing the parameter, return value, or silent partial-parse behaviour on short arrays.

#### A46-9: `isTimeSetSucceed(BleTimeItem, BleTimeItem)` has no Javadoc [INFO]
- File: BleUtil.java, Line: 63
- Description: The public static method `isTimeSetSucceed` has no Javadoc. The method validates that the first argument represents a date/time that is greater than or equal to the second argument field-by-field (year, month, day, hour, minute, second) and that the first item has non-zero date components. The comparison is strictly field-by-field and not a proper point-in-time comparison (e.g., a date with a later month but earlier day can pass). This nuance is undocumented and could mislead callers.

#### A46-10: `getTimeData()` has no Javadoc [INFO]
- File: BleUtil.java, Line: 91
- Description: The public static method `getTimeData()` has no Javadoc. It builds a 10-byte Bluetooth GATT Current Time characteristic payload in little-endian format, using the current time in UTC. The day-of-week conversion from Calendar convention (Sunday=1) to CTS convention (Sunday=7) is documented only via inline comments. No Javadoc explains what the method returns, its byte format, or that it uses UTC.

#### A46-11: `isTheSameByteArray(byte[], byte[])` has no Javadoc [INFO]
- File: BleUtil.java, Line: 127
- Description: The public static method `isTheSameByteArray` has no Javadoc. Callers are not informed that passing either null argument returns `false` rather than throwing a `NullPointerException`, or that comparison is by byte-content rather than reference identity.

#### A46-12: `bytesToHexStr(byte[])` has no Javadoc [INFO]
- File: BleUtil.java, Line: 151
- Description: The public static method `bytesToHexStr` has no Javadoc. There is no documentation of the return format (uppercase hexadecimal, no separators, two characters per byte), or the behaviour when an empty array is passed.

#### A46-13: `bytesToFloat(byte, byte)` Javadoc describes format inaccurately [LOW]
- File: BleUtil.java, Line: 183-184 (Javadoc), 186 (method)
- Description: The Javadoc states "Convert signed bytes to a 16-bit short float value." The implementation decodes a Bluetooth GATT SFLOAT: a 16-bit value with a 12-bit signed mantissa and a 4-bit signed exponent (IEEE 11073-20601 format). While the total input is 16 bits, calling it a "16-bit short float" is imprecise because "short float" (SFLOAT) is a specific Bluetooth term for this 12+4 encoding, distinct from IEEE 754 half-precision (also 16-bit). A reader may incorrectly assume standard IEEE 754 half-precision is decoded. The Javadoc should specify the Bluetooth GATT SFLOAT format.

#### A46-14: `bytesToFloat(byte, byte, byte, byte)` Javadoc uses contradictory term [LOW]
- File: BleUtil.java, Line: 193-194 (Javadoc), 196 (method)
- Description: The Javadoc states "Convert signed bytes to a 32-bit short float value." This is contradictory: in Bluetooth GATT terminology, "short float" (SFLOAT) is the 16-bit format; the 32-bit equivalent is "FLOAT" (IEEE 11073 FLOAT: 24-bit signed mantissa, 8-bit signed exponent in the fourth byte). Using "short float" to describe the 32-bit variant is technically inaccurate and inconsistent with the Bluetooth specification. Callers reading this Javadoc alongside the 16-bit overload will find the naming confusing.

#### A46-15: `getIntValue(byte[], int)` has no Javadoc [INFO]
- File: BleUtil.java, Line: 231
- Description: The public static overload `getIntValue(byte[] data, int formatType)` has no Javadoc. It is a convenience wrapper that calls `getIntValue(data, formatType, 0)` with offset 0, but this is not documented. There is no description of accepted `formatType` values, return type, or the null return when the data array is too short.

#### A46-16: `getIntValue(byte[], int, int)` has no Javadoc [INFO]
- File: BleUtil.java, Line: 234
- Description: The primary overload `getIntValue(byte[] data, int formatType, int offset)` has no Javadoc. It supports six format types (`FORMAT_UINT8`, `FORMAT_UINT16`, `FORMAT_UINT32`, `FORMAT_SINT8`, `FORMAT_SINT16`, `FORMAT_SINT32`) and returns `null` for unsupported format types or when data is insufficient for the offset and format combination. None of this contract is documented.

#### A46-17: `BleTimeItem` inner class and its fields have no Javadoc [INFO]
- File: BleUtil.java, Line: 33
- Description: The public static inner class `BleTimeItem` and all seven of its package-private fields (`year`, `month`, `day`, `hour`, `minute`, `second`, `dayOfWeek`) have no Javadoc. The class is a plain data container for a parsed BLE time value but provides no documentation of field semantics (e.g., whether `month` is 0-based or 1-based, or what encoding `dayOfWeek` uses).

#### A46-18: No class-level Javadoc on `BleUtil` [INFO]
- File: BleUtil.java, Line: 22
- Description: The class has no Javadoc comment explaining its purpose as a collection of BLE data-conversion utilities. The file header is a copyright notice only.

---

## File: ShockEventService.java
### Reading Evidence
- Class: `ShockEventService extends IntentService` (line 25)
- Public Methods:
  - `ShockEventService()` constructor (line 28)
  - `startService()` (line 102) — public static
- Constants/Fields:
  - `TAG` (line 26) — public static String (log tag)
  - `IMPACT` (line 144) — public static final String (broadcast action)
  - `lastImpactEvent` (line 145) — public static ShockEventsItem (mutable shared state)
- Package-private / private methods (not subject to public-API documentation requirements but noted for completeness):
  - `onHandleIntent(Intent)` (line 33) — protected override
  - `onShockDataRead(String, Intent)` (line 55) — private
  - `uploadEvent()` (line 71) — private
  - `sendData(Intent)` (line 109) — package-private static
  - `saveShockEvent(String, byte[])` (line 117) — private static
  - `showShockAlertIfNeeded(ShockEventsItem)` (line 147) — private static

### Findings

#### A46-19: `startService()` has no Javadoc [INFO]
- File: ShockEventService.java, Line: 102
- Description: The public static method `startService()` has no Javadoc. Callers are not informed that the method starts `ShockEventService` via the application context, that exceptions are silently swallowed (the `catch (Exception ignored)` on line 105 discards all errors including `IllegalStateException` from background starts on Android 8+), or that this method has no return value indicating success or failure.

#### A46-20: `IMPACT` broadcast action constant has no Javadoc [INFO]
- File: ShockEventService.java, Line: 144
- Description: The public static final String `IMPACT` defines a LocalBroadcast action constant but has no Javadoc comment. There is no documentation of when this broadcast is sent, what `Intent` extras accompany it, or that the associated impact data is stored in the public mutable field `lastImpactEvent` at the time of broadcast.

#### A46-21: `lastImpactEvent` public mutable field has no Javadoc [INFO]
- File: ShockEventService.java, Line: 145
- Description: The public static field `lastImpactEvent` is mutable shared state with no Javadoc. Callers cannot determine from documentation alone that this field is populated immediately before the `IMPACT` broadcast is sent, that it is `null` until the first qualifying shock event, or that it is not thread-safe. The lack of documentation increases the risk of incorrect use by broadcast receivers reading this field.

#### A46-22: `ShockEventService()` constructor has no Javadoc [INFO]
- File: ShockEventService.java, Line: 28
- Description: The public constructor has no Javadoc. While the constructor only delegates to `super()` with the class simple name, documenting it would clarify the service's `IntentService` lifecycle and that the service name used for the worker thread is the class simple name.

#### A46-23: No class-level Javadoc on `ShockEventService` [INFO]
- File: ShockEventService.java, Line: 25
- Description: The class has no Javadoc comment. There is no documentation of the dual-mode intent handling: when started with no action the service uploads pending shock events to the server and schedules itself to run again in 10 minutes; when started with `ACTION_DATA_AVAILABLE` or `ACTION_DATA_CHANGED` it parses BLE shock event data and saves it to the local Realm database. This architecture is non-obvious and critical to understanding how the service interacts with `BleMachineService` and the web API.
