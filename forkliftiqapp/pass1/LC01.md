# Pass 1 Security Audit — LC01
**Agent ID:** LC01
**Date:** 2026-02-27
**Repository:** forkliftiqapp
**Checklist:** PASS1-CHECKLIST-forkliftiqapp.md

## Assigned Files

1. `/c/Projects/cig-audit/repos/forkliftiqapp/LibCommon/src/main/java/com/yy/libcommon/BaseActivity.java`
2. `/c/Projects/cig-audit/repos/forkliftiqapp/LibCommon/src/main/java/com/yy/libcommon/BaseController.java`
3. `/c/Projects/cig-audit/repos/forkliftiqapp/LibCommon/src/main/java/com/yy/libcommon/BaseDialog.java`

---

## Step 1 — Branch Verification

Command run: `git -C /c/Projects/cig-audit/repos/forkliftiqapp branch --show-current`

Result: `master`

**Discrepancy noted:** The checklist specifies `Branch: main`. The actual branch is `master`. Audit proceeds on `master` as instructed.

---

## Step 4 — Reading Evidence

### File 1: BaseActivity.java

**File path:** `/c/Projects/cig-audit/repos/forkliftiqapp/LibCommon/src/main/java/com/yy/libcommon/BaseActivity.java`

**Fully qualified class name:** `com.yy.libcommon.BaseActivity`

**Superclass:** `android.support.v7.app.AppCompatActivity`

**Interfaces implemented:** `com.yy.libcommon.BaseController`, `com.yy.libcommon.FragmentInterface.FragmentHandle`

**Public methods (with signatures and line numbers):**

| Line | Signature |
|------|-----------|
| 40   | `public int getScreenWidth()` |
| 48   | `public void backToHome()` |
| 56   | `public void onBackPressed()` (override) |
| 75   | `public void addFragment(@IdRes int containerViewId, Fragment fragment, String tag)` (override) |
| 83   | `public void addFragment(@IdRes int containerViewId, Fragment fragment, String tag, boolean addStack)` |
| 94   | `public void hideFragment(String tag)` (override) |
| 101  | `public void removeFragment(String tag)` |
| 107  | `public Fragment findFramentByTag(String tag)` |
| 112  | `public Fragment showFragment(@IdRes int containerViewId, String tag, String className)` (override) |
| 134  | `public Fragment showFragmentWithoutStack(@IdRes int containerViewId, String tag, Fragment fragment)` |
| 149  | `public Fragment showFragmentWithStack(@IdRes int containerViewId, String tag, Fragment fragment)` |
| 164  | `public void addFragmentWithAnimation(@AnimRes int enter, @AnimRes int exit, @AnimRes int popEnter, @AnimRes int popExit, @IdRes int containerViewId, Fragment fragment, String tag, boolean addStack)` |
| 180  | `public void onRequestPermissionsResult(int requestCode, String permissions[], int[] grantResults)` (override) |
| 186  | `public void showDialog(String title, String msg)` |
| 212  | `public boolean onCreateOptionsMenu(Menu menu)` (override) |
| 217  | `public boolean onOptionsItemSelected(MenuItem item)` (override) |
| 254  | `public void hideKeyboard(View view)` |
| 292  | `public void runLater(final Runnable runnable, long delayMillis)` |
| 306  | `public void setBestOrientation()` |
| 323  | `public SubFragPermission getSubFragPermission()` |
| 327  | `public FragmentManager getCurrentFragmentManager()` (override) |
| 332  | `public void showToast(String msg)` |
| 338  | `public void showDialog(String title, String msg, ErrorDialog.OnErrorCallback callback)` |
| 359  | `public void showProgress(String title, String message)` |
| 367  | `public void showSavingProgress()` |
| 375  | `public void showDeletingProgress()` |
| 384  | `public void showLoadingProgress()` |
| 393  | `public void updateProgress(String message)` |
| 399  | `public void hideProgress()` |

**Protected methods:**

| Line | Signature |
|------|-----------|
| 196  | `protected void initKeyboard()` |
| 229  | `protected void onSaveInstanceState(Bundle outState)` (override) |
| 238  | `protected void onCreate(Bundle savedInstanceState)` (override) |
| 259  | `protected void onStart()` (override) |
| 266  | `protected void onResume()` (override) |
| 274  | `protected void onPause()` (override) |
| 280  | `protected void onStop()` (override) |
| 286  | `protected void onDestroy()` (override) |
| 350  | `protected void showProgressDialog()` |

**Package-private methods:**

| Line | Signature |
|------|-----------|
| 202  | `void showKeyboard(final View view)` |
| 233  | `void onRecover(Bundle savedInstanceState)` |

**Public/protected fields and constants:**

| Line | Declaration |
|------|-------------|
| 30   | `private static final String TAG = "BaseActivity"` |
| 31   | `private Fragment mFragment` |
| 32   | `private FragmentManager manager` |
| 33   | `protected boolean isStarted = false` |
| 34   | `protected boolean isResumed = false` |
| 37   | `protected CustomProgressDialog mCustomProgressDialog` |
| 38   | `protected SubFragPermission subFragPermission` |

---

### File 2: BaseController.java

**File path:** `/c/Projects/cig-audit/repos/forkliftiqapp/LibCommon/src/main/java/com/yy/libcommon/BaseController.java`

**Fully qualified class name:** `com.yy.libcommon.BaseController`

**Type:** `interface`

**Public method declarations (interface contract):**

| Line | Signature |
|------|-----------|
| 11   | `FragmentManager getCurrentFragmentManager()` |
| 12   | `boolean isDestroyed()` |
| 14   | `SubFragPermission getSubFragPermission()` |

**Commented-out interface methods (lines 16–21, inactive):**
- `void showProgress(String title, String message)`
- `void updateProgress(String message)`
- `void hideProgress()`
- `void showToast(String msg)`
- `boolean checkCameraPermissionWithRun(Runnable runnable)`
- `boolean checkFilePermissionWithRun(Runnable runnable)`
- `void requestCameraPermission()`
- `void requestFilePermission()`

**Public fields/constants:** None.

---

### File 3: BaseDialog.java

**File path:** `/c/Projects/cig-audit/repos/forkliftiqapp/LibCommon/src/main/java/com/yy/libcommon/BaseDialog.java`

**Fully qualified class name:** `com.yy.libcommon.BaseDialog`

**Superclass:** `android.support.v4.app.DialogFragment`

**Interfaces implemented:** `com.yy.libcommon.BaseController`

**Public methods (with signatures and line numbers):**

| Line | Signature |
|------|-----------|
| 32   | `public int getScreenWidth()` |
| 39   | `public void showProgress(String title, String message)` |
| 45   | `public void showSavingProgress()` |
| 50   | `public void showDeletingProgress()` |
| 56   | `public void showLoadingProgress()` |
| 63   | `public void updateProgress(String message)` |
| 68   | `public void hideProgress()` |
| 74   | `public BaseActivity getBaseActivity()` |
| 80   | `public void onDismiss(DialogInterface dialog)` (override) |
| 88   | `public void showToast(String msg)` |
| 97   | `public void onSaveInstanceState(Bundle outState)` (override) |
| 102  | `public void onActivityCreated(Bundle savedInstanceState)` (override) |
| 112  | `public void onDestroy()` (override) |
| 121  | `public void onDetach()` (override) |
| 130  | `public void onPause()` (override) |
| 135  | `public void onResume()` (override) |
| 141  | `public void onStart()` (override) |
| 146  | `public void onStop()` (override) |
| 153  | `public SubFragPermission getSubFragPermission()` (override) |
| 158  | `public boolean isDestroyed()` (override) |
| 163  | `public FragmentManager getCurrentFragmentManager()` (override) |
| 168  | `public void hideKeyboard(View view)` |
| 174  | `public static void addFragment(FragmentManager fragmentManager, Fragment fragment, int container)` |
| 178  | `public static void addFragment(FragmentManager fragmentManager, Fragment fragment, int container, boolean backStack)` |
| 189  | `public static void removeFragment(FragmentManager fragmentManager, int container)` |
| 196  | `public void addFragment(Fragment fragment, int container)` |
| 201  | `public void addFragment(Fragment fragment, int container, boolean backStack)` |
| 211  | `public void removeSelfFromParent()` |

**Protected methods:**

| Line | Signature |
|------|-----------|
| 125  | `protected void setupViews()` |

**Public fields:**

| Line | Declaration |
|------|-------------|
| 26   | `protected ViewGroup mRootView` |
| 27   | `public IDialogGenericCallback mGenericCallback` |
| 28   | `public boolean isDestroyed = false` |
| 30   | `protected SubFragPermission subFragPermission` |

---

## Step 5 — Security Findings by Checklist Section

### Section 1: Signing and Keystores

These files contain no signing configuration, keystore references, `storePassword`, `keyPassword`, `keyAlias`, or Gradle `signingConfigs` blocks. BaseActivity, BaseController, and BaseDialog are UI/framework classes.

**No issues found — Section 1: Signing and Keystores** (not applicable to these source files).

---

### Section 2: Network Security

These files contain no HTTP client instantiation, no URL construction, no OkHttp/Retrofit usage, no `TrustManager` or `HostnameVerifier` implementations, no hardcoded API endpoints or IP addresses, and no `SSLContext` initialization.

**No issues found — Section 2: Network Security** (not applicable to these source files).

---

### Section 3: Data Storage

#### Finding DS-01 — Unencrypted SharedPreferences (Indirect / Architecture Concern)

**Severity:** Info

**File:** `BaseActivity.java` and `BaseDialog.java`

These base classes expose lifecycle infrastructure (`isStarted`, `isResumed`, `mCustomProgressDialog`, `subFragPermission`) and UI state to all subclasses. No direct SharedPreferences access or file I/O is present in these files. However, as the foundational base classes for the entire application's Activity and Dialog layer, any data storage decisions made in subclasses inherit from this context. This finding is informational — actual SharedPreferences usage must be checked in subclasses.

**No direct issues found — Section 3: Data Storage** (no file I/O, SharedPreferences, external storage, or credential caching present in these files).

---

### Section 4: Input and Intent Handling

#### Finding II-01 — Dynamic Fragment Instantiation via Reflection (Class.forName)

**Severity:** Medium

**File:** `BaseActivity.java`

**Line:** 120

**Code:**
```java
pFragment = (Fragment) (Class.forName(className)).newInstance();
```

The method `showFragment(@IdRes int containerViewId, String tag, String className)` at line 112 accepts a `String className` parameter and instantiates a Fragment class by name using `Class.forName()` followed by `newInstance()`. If the `className` argument originates from an external source (Intent extras, deep link parameters, or inter-process communication) rather than a hardcoded internal constant, an attacker could supply an arbitrary class name and cause instantiation of unintended classes. This constitutes a potential class injection / reflection abuse vector.

**Recommendation:** Audit every call site of `showFragment(containerViewId, tag, className)` in subclasses to confirm `className` is always a compile-time constant or validated against a whitelist of known Fragment class names. If this method is only called with literal strings in the codebase, risk is low; if the string is ever derived from user input or an Intent extra, this is a High finding.

---

#### Finding II-02 — Swallowed Exception in Reflection Block Suppresses Failure Visibility

**Severity:** Low

**File:** `BaseActivity.java`

**Lines:** 122–128

**Code:**
```java
} catch (InstantiationException e) {
    e.printStackTrace();
} catch (IllegalAccessException e) {
    e.printStackTrace();
} catch (ClassNotFoundException e) {
    e.printStackTrace();
}
```

Exceptions during `Class.forName()` / `newInstance()` are caught and printed to stderr only. No user notification, no logging to a crash reporting system, and no fallback handling occurs. This means a failed Fragment instantiation (including one triggered by a malformed or malicious class name input) fails silently at runtime. Combined with Finding II-01, this makes exploitation attempts invisible in production.

**Recommendation:** Replace `e.printStackTrace()` with proper logging (structured logger or crash reporter). Propagate the failure to the caller or display an error state.

---

#### Finding II-03 — Exception Silently Swallowed in runLater()

**Severity:** Low

**File:** `BaseActivity.java`

**Lines:** 297–300

**Code:**
```java
try {
    runnable.run();
} catch (Exception e) {

}
```

The `runLater()` utility method catches all `Exception` types from the supplied `Runnable` and discards them completely — no logging, no stack trace, no notification. Any runtime error in a delayed operation (including security-relevant operations like permission checks or token validation initiated via `runLater`) will be silently suppressed.

**Recommendation:** At minimum, log the caught exception. Do not use bare `catch (Exception e) {}` in production code, especially in a generic utility used by the entire application.

---

#### Finding II-04 — Back Button Overridden to Navigate Home Without Authentication Gate

**Severity:** Medium

**File:** `BaseActivity.java`

**Lines:** 56–72

**Code:**
```java
@Override
public void onBackPressed() {
    Intent setIntent = new Intent(Intent.ACTION_MAIN);
    setIntent.addCategory(Intent.CATEGORY_HOME);
    setIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
    startActivity(setIntent);
}
```

`onBackPressed()` is overridden in `BaseActivity` (the base class for all Activities in the application) to send the app to the Android home screen instead of following the normal back-stack behaviour. The original implementation using an exit confirmation dialog is commented out.

For a forklift management application handling operator sessions, this means pressing the back button from any Activity sends the app to the background without triggering a logout, session lock, or any authentication check. The app remains in its authenticated state in the background. A subsequent user could bring the app back to the foreground (e.g., via the recents screen) and access operator data without re-authenticating.

**Recommendation:** Evaluate whether backgrounding the app without a lock-screen or session timeout is acceptable for the operator data this app handles. If shift-change or unattended-device scenarios are possible, implement a session lock or re-authentication prompt when the app returns to the foreground from this back-to-home navigation path.

---

#### Finding II-05 — No Null Check on subFragPermission Before Use in onRequestPermissionsResult

**Severity:** Low

**File:** `BaseActivity.java`

**Lines:** 180–183

**Code:**
```java
@Override
public void onRequestPermissionsResult(int requestCode, String permissions[], int[] grantResults) {
    super.onRequestPermissionsResult(requestCode,permissions,grantResults);
    subFragPermission.onRequestPermissionsResult(requestCode,permissions,grantResults);
}
```

`subFragPermission` is initialised in `onCreate()` at line 245. However, `onRequestPermissionsResult()` can be invoked by the Android system before `onCreate()` completes in edge cases (e.g., Activity recreation during a permission dialog). If `subFragPermission` is null at that moment, this will throw a `NullPointerException` and crash the application.

**Recommendation:** Add a null check: `if (subFragPermission != null) { subFragPermission.onRequestPermissionsResult(...); }`.

---

#### Finding II-06 — No Null Check on subFragPermission in BaseDialog.onResume()

**Severity:** Low

**File:** `BaseDialog.java`

**Lines:** 135–138

**Code:**
```java
@Override
public void onResume() {
    super.onResume();
    subFragPermission.onActive();
}
```

`subFragPermission` is initialised in `onActivityCreated()`. If `onResume()` is called before `onActivityCreated()` (which can occur in certain Fragment lifecycle edge cases or when a dialog is shown before the activity has fully initialised), this will throw a `NullPointerException`.

**Recommendation:** Add a null guard: `if (subFragPermission != null) { subFragPermission.onActive(); }`.

---

#### Finding II-07 — Implicit Intent Used for Home Navigation (Low Interception Risk)

**Severity:** Info

**File:** `BaseActivity.java`

**Lines:** 48–53 and 67–72

**Code:**
```java
Intent intent = new Intent(Intent.ACTION_MAIN);
intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
intent.addCategory(Intent.CATEGORY_HOME);
startActivity(intent);
```

Both `backToHome()` and `onBackPressed()` use an implicit Intent with `Intent.ACTION_MAIN` and `Intent.CATEGORY_HOME` to navigate to the device home screen. This is standard Android idiom for returning home and carries negligible interception risk (the Home Intent is handled by the launcher, not an arbitrary third-party app). Noted for completeness; not a substantive finding.

**No actionable issue — Section 4: Input and Intent Handling** (beyond findings II-01 through II-06 above).

---

### Section 5: Authentication and Session

#### Finding AS-01 — App Backgrounded Without Session Invalidation on Back Press (Cross-reference II-04)

**Severity:** Medium

**File:** `BaseActivity.java`

**Lines:** 56–72

The `onBackPressed()` override sends the application to the home screen without any logout, token invalidation, or session lock. As this is implemented in `BaseActivity` — the superclass of all Activities — no subclass implements its own back-press logout behaviour unless it explicitly overrides `onBackPressed()` again. This means any Activity inheriting from `BaseActivity` is susceptible to session persistence after the device is handed off to another operator.

This is particularly significant for the forklift fleet management use case, where devices may be shared across operators during shift changes. If a current operator presses back (or the supervisor hands the device to a new operator without explicitly logging out), the new operator sees the previous operator's session.

**Recommendation:** Implement a session timeout or screen lock that triggers when the app is backgrounded. At minimum, evaluate whether `onStop()` or `onPause()` in `BaseActivity` should initiate a lock-screen or re-authentication flow.

---

#### Finding AS-02 — No Evidence of Logout Credential Clearing in Base Layer

**Severity:** Info

**File:** `BaseActivity.java`, `BaseDialog.java`, `BaseController.java`

None of the three base layer files contain any logout logic, credential clearing, token revocation, or session cleanup. The commented-out interface methods in `BaseController.java` (lines 16–21) previously included permission helpers but never included session/logout primitives. This observation does not constitute a finding in isolation — logout may be implemented in higher-level classes — but it is recorded here as evidence that the base framework provides no enforced logout contract.

**Recommendation:** Audit subclasses and the Application class for logout/session-clear implementations. Verify that logout clears all stored credentials, tokens, and operator data as required by Section 5 of the checklist.

---

### Section 6: Third-Party Libraries

#### Finding TL-01 — Use of Deprecated android.support Library (Support Library vs AndroidX)

**Severity:** Medium

**File:** `BaseActivity.java`, `BaseDialog.java`, `BaseController.java`

**Lines:** Multiple import statements in all three files.

All three files import from `android.support.*` packages:

- `BaseActivity.java` lines 11–16: `android.support.annotation.*`, `android.support.v4.app.*`, `android.support.v7.app.AppCompatActivity`
- `BaseDialog.java` lines 7–10: `android.support.v4.app.*`
- `BaseController.java` line 3: `android.support.v4.app.FragmentManager`

The Android Support Library (`android.support.*`) was deprecated and superseded by AndroidX in 2018. Google ceased publishing security and compatibility updates to the old Support Library. AndroidX is now the required library for Google Play submissions targeting API 34+. Continued use of the old Support Library means the application does not receive upstream fixes.

**Recommendation:** Migrate all `android.support.*` imports and usages to their AndroidX equivalents (`androidx.*`). Android Studio provides an automated migration tool (`Refactor > Migrate to AndroidX`).

---

### Section 7: Google Play and Android Platform

#### Finding GP-01 — Use of Deprecated API: newInstance() on Class Object

**Severity:** Low

**File:** `BaseActivity.java`

**Line:** 120

**Code:**
```java
pFragment = (Fragment) (Class.forName(className)).newInstance();
```

`Class.newInstance()` is deprecated as of Java 9 and produces a deprecation warning. It is less safe than `Constructor.newInstance()` because it propagates checked exceptions as unchecked, masking error details. While not an Android-version-specific deprecation, this is a code quality finding that interacts with the security concern in Finding II-01.

**Recommendation:** Replace with `Class.forName(className).getDeclaredConstructor().newInstance()`, and handle the resulting checked exceptions explicitly.

---

#### Finding GP-02 — Use of Deprecated Handler Constructor

**Severity:** Low

**File:** `BaseActivity.java`

**Lines:** 293–303

**Code:**
```java
public void runLater(final Runnable runnable, long delayMillis){
    Handler handler = new Handler();
    ...
}
```

`new Handler()` (no-argument constructor) is deprecated as of API 30. It implicitly associates the Handler with the current thread's Looper, which can cause memory leaks or unexpected behaviour if the calling thread's Looper is not the main looper. The recommended replacement is `new Handler(Looper.getMainLooper())` for UI operations.

**Recommendation:** Replace `new Handler()` with `new Handler(Looper.getMainLooper())` and import `android.os.Looper`.

---

#### Finding GP-03 — Use of Deprecated onActivityCreated() in DialogFragment

**Severity:** Low

**File:** `BaseDialog.java`

**Lines:** 102–109

**Code:**
```java
@Override
public void onActivityCreated(Bundle savedInstanceState) {
    super.onActivityCreated(savedInstanceState);
    subFragPermission = new SubFragPermission(getBaseActivity(),this);
    setupViews();
}
```

`Fragment.onActivityCreated()` is deprecated as of API 28. The AndroidX Fragment library documents that initialization logic should be moved to `onViewCreated()` (for view-related setup) or `onCreate()` (for non-view setup). Subclasses overriding `setupViews()` expect it to be called within `onActivityCreated()`, which may not be called in future platform versions.

**Recommendation:** Migrate `SubFragPermission` initialisation and `setupViews()` to `onViewCreated()` or `onCreate()` as appropriate.

---

#### Finding GP-04 — isDestroyed Field Name Shadows isDestroyed() Method

**Severity:** Low

**File:** `BaseDialog.java`

**Lines:** 28 and 159

**Code (field):**
```java
public boolean isDestroyed = false;
```

**Code (method):**
```java
@Override
public boolean isDestroyed() {
    return isDestroyed;
}
```

The public boolean field `isDestroyed` at line 28 has the same name as the `isDestroyed()` method it is read by at line 159. While the implementation is internally consistent (the method returns the field), the public exposure of a mutable boolean field with this name is problematic: any external code can set `isDestroyed = true` without the object actually having been destroyed, causing methods that guard on `!isDestroyed` (lines 40, 46, 51, 57, 64, 69) to incorrectly skip their operations. Additionally, `android.app.Dialog` has its own `isDestroyed()` method — the shadowing could cause confusion.

**Recommendation:** Change the field access modifier from `public` to `private`. Provide a package-private or protected setter only if subclass write access is required.

---

## Summary Table

| ID     | Severity | File               | Line(s) | Issue |
|--------|----------|--------------------|---------|-------|
| II-01  | Medium   | BaseActivity.java  | 112–132 | Dynamic Fragment instantiation via `Class.forName(className)` — potential class injection if className is externally sourced |
| II-04  | Medium   | BaseActivity.java  | 56–72   | Back button sends app home without session lock or logout |
| AS-01  | Medium   | BaseActivity.java  | 56–72   | Session not invalidated when app is backgrounded via back press |
| TL-01  | Medium   | All three files    | Multiple | Use of deprecated `android.support.*` library instead of AndroidX |
| II-02  | Low      | BaseActivity.java  | 122–128 | Exceptions in reflection block only print stack trace; failures are invisible in production |
| II-03  | Low      | BaseActivity.java  | 293–303 | `catch (Exception e) {}` in `runLater()` silently discards all errors |
| II-05  | Low      | BaseActivity.java  | 180–183 | No null check on `subFragPermission` in `onRequestPermissionsResult()` |
| II-06  | Low      | BaseDialog.java    | 135–138 | No null check on `subFragPermission` in `onResume()` |
| GP-01  | Low      | BaseActivity.java  | 120     | Deprecated `Class.newInstance()` used |
| GP-02  | Low      | BaseActivity.java  | 293     | Deprecated no-arg `Handler()` constructor |
| GP-03  | Low      | BaseDialog.java    | 102–109 | Deprecated `onActivityCreated()` lifecycle callback used for initialization |
| GP-04  | Low      | BaseDialog.java    | 28, 159 | Public mutable `isDestroyed` field shadows `isDestroyed()` method; can be externally corrupted |
| AS-02  | Info     | All three files    | —       | No logout/session-clear logic in base layer; must verify in subclasses |
| II-07  | Info     | BaseActivity.java  | 48–72   | Implicit home intents — standard idiom, negligible risk |

**Sections with no issues found in assigned files:**
- Section 1: Signing and Keystores — not applicable (no build/signing config in these files)
- Section 2: Network Security — not applicable (no HTTP client, URL, or TLS code in these files)
- Section 3: Data Storage — no direct SharedPreferences, file I/O, or external storage usage found

---

*End of LC01 report.*
