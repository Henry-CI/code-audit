# Pass 1 Security Audit — Agent LC10
**Repo:** forkliftiqapp
**Date:** 2026-02-27
**Agent:** LC10
**Stack:** Android / Java

---

## Branch Verification

Command run: `git -C /c/Projects/cig-audit/repos/forkliftiqapp branch --show-current`
Result: `master`

Checklist header states "Branch: main". Actual branch is "master". Discrepancy recorded. Branch is present and correct for this audit; proceeding.

---

## Reading Evidence

### 1. `com.yy.libcommon.Util`
**File:** `LibCommon/src/main/java/com/yy/libcommon/Util.java`

**Public fields:**
| Field | Line |
|---|---|
| `public final static int MAX_UPLOAD_IMAGE_SIZE = 480` | 44 |

**Public methods:**
| Signature | Line |
|---|---|
| `public static ArrayList<String> arrayListFromStrings(String[] ar)` | 46 |
| `public static String generateDeviceId(Context pContext)` | 56 |
| `public static String colorToHexString(int color)` | 86 |
| `public static int dpToPx(int dp, Context pContext)` | 90 |
| `public static int dpToPx(float dp, Context pContext)` | 103 |
| `public static String getLastDigitSufix(int number)` | 116 |
| `public static String getRandomInstanceId()` | 126 |
| `public static String getRandomString()` | 134 |
| `public static int getRandomNumber()` | 150 |
| `public static boolean isStringEmpty(String input)` | 168 |
| `public static void setLayoutClickable(View view, boolean enabled)` | 172 |
| `public static Bitmap decodeFile(String path, int maxSize)` | 190 |
| `public static Bitmap decodeFile(File f, int maxSize)` | 194 |
| `public static byte[] preProcessBitmapToByteArray(String pathToOurFile)` | 236 |
| `public static Bitmap preProcessBitmap(Bitmap bitmap, ByteArrayOutputStream byteArrayOutputStream)` | 257 |
| `public static Bitmap decodeFileFixOrientation(String file)` | 281 |
| `public static String bigDecimalToPriceStr(BigDecimal bigDecimal)` | 309 |
| `public static boolean bigDecimalsAreTheSame(BigDecimal bd1, BigDecimal bd2)` | 313 |
| `public static boolean integersAreTheSame(Integer i1, Integer i2)` | 340 |
| `public static String getRealPathFromURI(Context context, Uri contentUri)` | 367 |

**Android components declared:** None (utility class only).

---

### 2. `com.yy.libcommon.WebActivity`
**File:** `LibCommon/src/main/java/com/yy/libcommon/WebActivity.java`

**Public fields:**
| Field | Line |
|---|---|
| `static public final String URL_KEY = "com.webactivity.url"` | 20 |

**Public methods:**
| Signature | Line |
|---|---|
| `protected void onCreate(Bundle savedInstanceState)` | 23 (override) |

**Package-private methods:**
| Signature | Line |
|---|---|
| `void initWebView()` | 32 |

**Android components declared:** `WebActivity extends BaseActivity` — one Activity.

**WebView settings inventory (lines 41–48):**
- `setJavaScriptEnabled(true)` — line 43
- `setLayoutAlgorithm(WebSettings.LayoutAlgorithm.SINGLE_COLUMN)` — line 42
- `setDisplayZoomControls(false)` — line 44
- `setSupportZoom(false)` — line 45
- `setBuiltInZoomControls(true)` — line 46
- `setUseWideViewPort(true)` — line 47
- `setLoadWithOverviewMode(true)` — line 48
- `setAllowFileAccess` — NOT explicitly set (platform default applies; on API < 30 the default is `true`)
- URL validation — NOT present; URL is taken directly from intent extra `URL_KEY` and passed to `webView.loadUrl(url)` at line 84 without any validation or whitelist check.

---

### 3. `com.yy.libcommon.WebService.GsonHelper`
**File:** `LibCommon/src/main/java/com/yy/libcommon/WebService/GsonHelper.java`

**Public fields:** None.

**Public methods:**
| Signature | Line |
|---|---|
| `public static <T> T objectFromString(String data, Class<T> dataClass)` | 13 |
| `public static JSONObject fromObject(Object object)` | 30 |
| `public static String stringFromObjectNoPolicy(Object object)` | 43 |

**Private methods:**
| Signature | Line |
|---|---|
| `private static JSONObject fromObjectNoNamePolicy(Object object)` | 17 |

**Android components declared:** None (utility class only).

---

### 4. `com.yy.libcommon.YesNoDialog`
**File:** `LibCommon/src/main/java/com/yy/libcommon/YesNoDialog.java`

**Public fields:** None.

**Public methods:**
| Signature | Line |
|---|---|
| `public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)` | 36 (override) |
| `public static YesNoDialog newInstance(String title, String content, String buttonAcceptText, String buttonDeclineText, int timeoutInSeconds, Callback callback)` | 45 |
| `public void init()` | 95 |
| `public void onActivityCreated(Bundle savedInstanceState)` | 88 (override) |

**Inner interface `Callback` (public):**
| Method | Line |
|---|---|
| `public void onAcceptPress()` | 161 |
| `public void onDeclinePress()` | 163 |
| `public void onTimeOutDialog()` | 165 |

**Android components declared:** `YesNoDialog extends BaseDialog` (which extends `DialogFragment`) — one DialogFragment.

---

## Findings by Checklist Section

### Section 1 — Signing and Keystores

No issues found in these four files. None of the assigned files contain signing configuration, keystore references, hardcoded passwords, or pipeline credential handling.

---

### Section 2 — Network Security

No issues found in `Util.java`, `GsonHelper.java`, or `YesNoDialog.java` for this section.

**WebActivity.java — no TrustAllCertificates, no SSL override detected.** The `WebViewClient` does not override `onReceivedSslError`, which means the default behavior (rejecting invalid certificates) is preserved. No cleartext HTTP enforcement in this file.

---

### Section 3 — Data Storage

No issues found in `GsonHelper.java` or `YesNoDialog.java`.

**Util.java — no SharedPreferences or file-write calls present.** Image decode and resize operations work in memory only.

No `MODE_WORLD_READABLE`, `MODE_WORLD_WRITEABLE`, or `getExternalStorageDirectory()` calls detected in any assigned file.

---

### Section 4 — Input and Intent Handling

#### FINDING 4-A: WebView — JavaScript Enabled (Medium)
**File:** `WebActivity.java`, line 43
**Code:**
```java
webView.getSettings().setJavaScriptEnabled(true);
```
JavaScript is unconditionally enabled. If any URL loaded into this WebView is attacker-controlled or points to a malicious page, JavaScript can execute in the WebView context. Severity is mitigated by the absence of `addJavascriptInterface` calls in this file, but the risk remains if the URL source is not trusted.

#### FINDING 4-B: WebView — No URL Validation or Whitelist (High)
**File:** `WebActivity.java`, lines 34 and 84
**Code:**
```java
String url = getIntent().getStringExtra(URL_KEY);   // line 34
...
webView.loadUrl(url);                                // line 84
```
The URL is retrieved directly from an Intent extra using the key `"com.webactivity.url"` and loaded into the WebView without any validation, scheme check, or whitelist. If `WebActivity` is exported (to be confirmed by the manifest agent), any third-party app on the device can fire an Intent with an arbitrary URL — including `file://` URIs, `javascript:` URIs, or attacker-controlled `https://` addresses — and this WebView will load them. This is an intent-injection vulnerability. Even if not exported, implicit intent interception remains a risk if the caller constructs the URL from untrusted input.

#### FINDING 4-C: WebView — `setAllowFileAccess` Not Explicitly Disabled (Low)
**File:** `WebActivity.java`
On Android API levels below 30, the default value of `WebSettings.setAllowFileAccess()` is `true`. This file does not explicitly call `setAllowFileAccess(false)`. If the app's `minSdkVersion` is below 30 (to be confirmed by the build.gradle agent), a `file://` URL loaded via Finding 4-B could access the app's data directory. Explicit opt-out is recommended regardless of API level.

#### FINDING 4-D: Weak Device Identifier — Insecure Randomness Fallback (Low)
**File:** `Util.java`, lines 72–79
**Code:**
```java
} catch (NullPointerException e){//Running emulator
    e.printStackTrace();
    Random r = new Random();
    int rand = r.nextInt(100000-1000) + 1000;
    return String.valueOf(rand);
}
```
When both `ANDROID_ID` and MAC address are null (emulator case), `generateDeviceId` falls back to `java.util.Random` producing a value in the range 1000–99999 — a space of approximately 99,000 possible values. This fallback returns a simple numeric string used as a device identifier. If device IDs influence access control or session binding in the backend (forkliftiqws), this tiny space is trivially brute-forced. `SecureRandom` or a stable UUID should be used for any security-relevant identifier.

#### FINDING 4-E: `getRandomInstanceId` and `getRandomString` Use `java.util.Random` (Low)
**File:** `Util.java`, lines 126–165
**Code:**
```java
Random random = new Random();    // getRandomInstanceId, line 128
Random random = new Random();    // getRandomNumber, line 154
```
Both `getRandomInstanceId()` and `getRandomString()` use `java.util.Random`, which is not cryptographically secure. If these values are used as nonces, session identifiers, or tokens, they are predictable. `SecureRandom` should be used for any value with a security purpose.

No issues found — exported component validation, deep links, and implicit intent usage are manifest-level concerns outside the scope of these four files.

---

### Section 5 — Authentication and Session

No issues found in these four files. No credential storage, token handling, or logout logic is present in `Util.java`, `WebActivity.java`, `GsonHelper.java`, or `YesNoDialog.java`.

---

### Section 6 — Third-Party Libraries

**WebActivity.java** imports `com.natasa.progresspercent.LineProgress` (line 11). This is a third-party progress bar library (`PercentProgress` / `LineProgress` by natasa). The specific version in use is not visible in these source files; version and CVE status must be verified in the module's `build.gradle`. This library is listed in the checklist as a known dependency to check.

**GsonHelper.java** uses `com.google.gson.Gson` and `com.google.gson.GsonBuilder`. The version in use is not visible here; must be confirmed in `build.gradle`. Gson has had known deserialization issues in older versions.

**YesNoDialog.java** imports `android.support.v4.app.DialogFragment` (line 5) — this is the legacy Android Support Library, not AndroidX. The Support Library is no longer maintained (last release 2018). This represents use of an abandoned library. Migration to `androidx.fragment.app.DialogFragment` is required.

---

### Section 7 — Google Play and Android Platform

#### FINDING 7-A: Deprecated `WifiManager.getConnectionInfo()` and `WifiInfo.getMacAddress()` (Medium)
**File:** `Util.java`, lines 60–63
**Code:**
```java
WifiManager wifiMan = (WifiManager) pContext.getSystemService(Context.WIFI_SERVICE);
WifiInfo wifiInf = wifiMan.getConnectionInfo();
macAddr = wifiInf.getMacAddress();
```
`WifiManager.getConnectionInfo()` is deprecated as of API 31 (Android 12). `WifiInfo.getMacAddress()` returns a constant fake MAC address (`"02:00:00:00:00:00"`) on all devices running Android 6.0+ when the app lacks `ACCESS_FINE_LOCATION`, and is further restricted in Android 10+. This means `generateDeviceId` will silently generate the same UUID for all devices on Android 6+ without location permission, undermining any uniqueness guarantee for the device identifier.

#### FINDING 7-B: Deprecated `BitmapFactory.Options.inPurgeable` (Low)
**File:** `Util.java`, line 218
**Code:**
```java
o2.inPurgeable = true;
```
`BitmapFactory.Options.inPurgeable` was deprecated in API 21 (Android 5.0) and is ignored on all modern API levels. No security impact, but indicates unmaintained code.

#### FINDING 7-C: Deprecated `WebViewClient.shouldOverrideUrlLoading(WebView, String)` (Low)
**File:** `WebActivity.java`, lines 60–63
**Code:**
```java
public boolean shouldOverrideUrlLoading(WebView view, String url){
    return false;
}
```
The single-argument `String url` override of `shouldOverrideUrlLoading` is deprecated as of API 24 in favour of the `WebResourceRequest` variant. On API 24+ the deprecated override may not be called for all navigations. No direct security impact, but the upgrade path to `WebResourceRequest` would also provide more information for URL validation (addressing Finding 4-B).

#### FINDING 7-D: Deprecated `onActivityCreated` in Fragment (Low)
**File:** `YesNoDialog.java`, line 88
```java
public void onActivityCreated(Bundle savedInstanceState)
```
`Fragment.onActivityCreated()` is deprecated as of AndroidX Fragment 1.3.0. Not a security finding, but confirms the codebase is using outdated Android APIs.

#### FINDING 7-E: Legacy Support Library in `YesNoDialog.java` (Medium)
**File:** `YesNoDialog.java`, line 5
```java
import android.support.v4.app.DialogFragment;
```
The Android Support Library (`android.support.*`) is abandoned. It has not received updates since 2018. AndroidX (`androidx.fragment.app.DialogFragment`) is the maintained replacement. No active CVEs are currently associated with this specific import, but the use of unmaintained libraries is a systemic risk.

---

## Summary Table

| ID | File | Severity | Section | Title |
|---|---|---|---|---|
| 4-A | WebActivity.java:43 | Medium | 4 | JavaScript unconditionally enabled in WebView |
| 4-B | WebActivity.java:34,84 | High | 4 | No URL validation — WebView loads Intent-supplied URL without whitelist check |
| 4-C | WebActivity.java | Low | 4 | `setAllowFileAccess` not explicitly disabled |
| 4-D | Util.java:72-79 | Low | 4/5 | Insecure `java.util.Random` fallback for device identifier |
| 4-E | Util.java:126-165 | Low | 4/5 | `java.util.Random` used for instance ID and random string generation |
| 7-A | Util.java:60-63 | Medium | 7 | Deprecated `WifiManager.getConnectionInfo()` / MAC address always fake on Android 6+ |
| 7-B | Util.java:218 | Low | 7 | Deprecated `BitmapFactory.Options.inPurgeable` |
| 7-C | WebActivity.java:60-63 | Low | 7 | Deprecated single-String `shouldOverrideUrlLoading` override |
| 7-D | YesNoDialog.java:88 | Low | 7 | Deprecated `onActivityCreated` in Fragment |
| 7-E | YesNoDialog.java:5 | Medium | 6/7 | Legacy abandoned Support Library (`android.support.v4`) instead of AndroidX |
