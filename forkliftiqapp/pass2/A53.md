# Pass 2 Audit – Agent A53
## Files Assigned
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/activity/ActionClearActivity.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/activity/DashboardActivity.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/activity/DriverStatsActivity.java`

---

## Project-Wide Finding: Zero Automated Test Coverage

**A53-1 | HIGH | Project-wide**

The `app/` and `LibCommon/` modules contain no test directories whatsoever. The only test files present in the entire repository are inside `LibImageloader/src/test/` and cover a third-party image-loading library, not application code. Every activity, fragment, service, BLE controller, web API layer, session management component, and data model in the first-party codebase is completely untested. This finding applies to all three assigned files and to every other file in `app/` and `LibCommon/`.

There is no unit test infrastructure, no instrumented test infrastructure, and no evidence of any test runner configuration for application code. Any regression in business logic, networking, Bluetooth pairing, session lifecycle, or data persistence would go undetected by automated means.

---

## Reading Evidence

### File 1 — ActionClearActivity.java

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.ui.activity.ActionClearActivity`

**Superclass:** `FleetActivity` (which extends `BaseActivity`)

**Methods (with line numbers and signatures):**
| Line | Signature |
|------|-----------|
| 11 | `protected void onCreate(Bundle savedInstanceState)` |

**Fields / constants defined:** None declared at class level.

**Inherited fields referenced:** None explicitly accessed beyond those from `FleetActivity`.

**Intent extras consumed:**
- `"action"` (String) — read at line 17 via `getIntent().getStringExtra("action")`

**Fragments used:**
- `SetupEmailFragment` — created via `SetupEmailFragment.createInstance(true)` and committed at line 19–20

---

### File 2 — DashboardActivity.java

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.ui.activity.DashboardActivity`

**Superclass:** `FleetActivity`

**Methods (with line numbers and signatures):**
| Line | Signature |
|------|-----------|
| 14 | `protected void onCreate(Bundle savedInstanceState)` |
| 22 | `protected void onResume()` |

**Fields / constants defined:** None declared at class level.

**Services started in `onResume`:**
- `ShockEventService.startService()` (line 28)
- `CacheService.startService()` (line 29)
- `SyncService.startService()` (line 30)

All three are started via `MyApplication.runLater(…, 2000)` — a 2-second deferred dispatch on the main-thread handler.

**Fragments used:**
- `DashboardFragment` — committed in `onCreate` at line 18

---

### File 3 — DriverStatsActivity.java

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.ui.activity.DriverStatsActivity`

**Superclass:** `FleetActivity`

**Methods (with line numbers and signatures):**
| Line | Signature |
|------|-----------|
| 10 | `protected void onCreate(Bundle savedInstanceState)` |

**Fields / constants defined:** None declared at class level.

**Fragments used:**
- `DriverStatsFragment1` — committed in `onCreate` at line 16

---

## Findings

### A53-2 | HIGH | ActionClearActivity — Null-dereference crash on missing Intent extra

**File:** `ActionClearActivity.java`, line 17–18

**Code:**
```java
String action = getIntent().getStringExtra("action");
if (action.equals("setup")) {
```

`getIntent().getStringExtra("action")` returns `null` if the caller omits the `"action"` extra or passes an explicit `null` value. The very next line calls `action.equals("setup")` without any null guard, which will throw a `NullPointerException` and crash the activity.

There is no test exercising the case where the extra is absent, the case where it is `null`, or the case where it contains an unrecognised value (e.g., anything other than `"setup"`). The only branch reachable with the current code structure is the `"setup"` branch; all other values — including `null` — cause either a crash or silent no-op with a blank screen respectively.

**Untested scenarios:**
- Extra `"action"` absent entirely → NPE crash
- Extra `"action"` is `null` explicitly → NPE crash
- Extra `"action"` is any string other than `"setup"` → activity renders an empty `activity_common` layout with no fragment, which is a silent UI failure

---

### A53-3 | HIGH | ActionClearActivity — All logic paths untested (no test file)

**File:** `ActionClearActivity.java`

`onCreate` is the sole method and contains the entirety of the class's logic. No test file exists for this class. The following paths have no test coverage:

- The happy path: intent carries `action = "setup"`, `SetupEmailFragment` is instantiated and displayed.
- The crash path: intent missing `"action"` extra (see A53-2).
- The silent failure path: `action` is a non-null, non-`"setup"` string — the activity opens with an empty container.

---

### A53-4 | HIGH | DashboardActivity — Service-start side-effects in `onResume` are completely untested

**File:** `DashboardActivity.java`, lines 22–33

`onResume` posts a delayed runnable that unconditionally calls `ShockEventService.startService()`, `CacheService.startService()`, and `SyncService.startService()`. These are background service initiations with network and BLE implications. No test covers:

- Whether the three services are actually started when `onResume` fires.
- Whether the 2-second delay is appropriate or whether services are started in the wrong lifecycle order relative to fragment readiness.
- What happens if `onPause` is called before the 2-second delay elapses (the handler post is never cancelled; the runnable fires after the activity has paused, potentially starting services that should not be running).
- What happens if `MyApplication.runLater` receives a null handler (e.g., application not fully initialised).

The absence of cancellation for the pending runnable on `onPause`/`onStop` is a latent resource-management defect with no test to detect regressions.

---

### A53-5 | MEDIUM | DashboardActivity — No test for `onCreate` fragment commitment

**File:** `DashboardActivity.java`, line 18

`DashboardFragment` is unconditionally committed in `onCreate` on every call, including configuration-change restores where `savedInstanceState != null`. The Android fragment back-stack system will automatically re-create the fragment from state, so committing a new instance on top of the restored one causes fragment duplication. There is no test verifying that only one `DashboardFragment` is present after a rotation or other configuration change.

---

### A53-6 | MEDIUM | DashboardActivity — All lifecycle methods untested (no test file)

**File:** `DashboardActivity.java`

Both `onCreate` and `onResume` are untested. No test file exists for this class. The methods interact with three separate background services and the fragment manager, making coverage gaps here higher impact than for a purely UI-passthrough activity.

---

### A53-7 | LOW | DriverStatsActivity — Thin activity with no test file

**File:** `DriverStatsActivity.java`

`onCreate` is the sole method. It sets the content view, calls `initKeyboard()` (inherited), and commits `DriverStatsFragment1`. The same fragment-duplication risk on configuration change noted in A53-5 applies here: `savedInstanceState` is not checked before committing the fragment.

No test file exists. Because the activity is a thin pass-through delegating all logic to the fragment, the risk is lower than for the other two files, but the fragment-duplication behaviour on rotation is still unverified.

---

### A53-8 | LOW | ActionClearActivity — `initKeyboard()` call untested

**File:** `ActionClearActivity.java`, line 15

`initKeyboard()` is inherited from `FleetActivity`/`BaseActivity`. Its effect (soft-keyboard mode configuration) is never verified in the context of this activity. Any regression in keyboard behaviour — particularly on devices where the activity is used after a hardware keyboard attach/detach — would go undetected.

---

### A53-9 | INFO | All three activities — Fragment-duplication pattern on configuration change

**Files:** All three assigned files

None of the three `onCreate` implementations check `savedInstanceState` before committing their fragments. The conventional guard is:

```java
if (savedInstanceState == null) {
    // commit fragment
}
```

Without this guard, rotating the device or triggering any configuration change will add a second copy of the fragment on top of the one restored from the back stack. This is a well-known Android defect pattern. No test exercises a simulated rotation to detect the duplication.

---

### A53-10 | INFO | DashboardActivity — Handler runnable not cancelled on `onPause`

**File:** `DashboardActivity.java`, lines 22–33

`MyApplication.runLater` posts a `Runnable` to the main-thread `Handler` with a 2-second delay. The activity does not override `onPause` or `onStop` to cancel this pending post via `handler.removeCallbacks(runnable)`. If the user navigates away within 2 seconds of `onResume`, the three services will still be started after the activity is paused. This is a lifecycle correctness issue with no test to catch regressions.
