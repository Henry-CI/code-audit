# Audit Pass 2 — Agent A32
**Audit run:** 2026-02-26-01
**Agent:** A32
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/SaveServiceDurationParameter.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/SaveServiceHoursParameter.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/SaveSessionsParameter.java`

---

## PROJECT-WIDE FINDING

### A32-1 — Zero automated test coverage across app/ and LibCommon/ modules [HIGH]

Neither the `app/` module nor the `LibCommon/` module contains a `src/test/` or `src/androidTest/` directory. A glob for `**/test*/**/*.java` across the entire repository returns only two files, both in unrelated third-party library modules (`LibImageloader` and implicitly `LibImagePicker`/`LibPercentProgress`). The three source files assigned to this agent — and by extension all production code in the `app/` module — have zero automated test coverage of any kind (unit, integration, or instrumented).

This means no regression safety exists for any business logic, serialisation behaviour, numeric boundary conditions, or API contract in the application's primary modules. Any bug introduced by refactoring or dependency update will not be caught before it reaches production.

**Evidence:** `Glob("**/test*/**/*.java", /c/Projects/cig-audit/repos/forkliftiqapp)` returns only `LibImageloader/src/test/java/com/nostra13/universalimageloader/core/assist/ImageSizeTest.java` and `LibImageloader/src/test/java/com/nostra13/universalimageloader/core/download/BaseImageDownloaderTest.java`. No results exist under `app/src/` or `LibCommon/src/`.

---

## Reading Evidence

### File 1: SaveServiceDurationParameter.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.SaveServiceDurationParameter`

**Inheritance:** extends `WebServiceParameterPacket` (which extends `WebServicePacket`) implements `Serializable`

**Fields defined (all public, no encapsulation):**

| Field | Type | Line |
|---|---|---|
| `unit_id` | `int` | 14 |
| `acc_hours` | `double` | 15 |
| `last_serv` | `int` | 16 |
| `service_type` | `String` | 17 |
| `serv_duration` | `int` | 18 |
| `driver_id` | `int` | 19 |

**Methods defined:**

| Method | Line | Signature |
|---|---|---|
| `SaveServiceDurationParameter()` | 21 | `public SaveServiceDurationParameter()` — empty no-arg constructor |

**Constants defined:** None.

**Imports used but not reflected in own code:** `JSONException`, `JSONObject`, `JSONArray`, `ArrayList`, `BigDecimal`, wildcard imports of `webserviceclasses.*` and `results.*` — all unused in this class; the imports are copy-paste boilerplate.

---

### File 2: SaveServiceHoursParameter.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.SaveServiceHoursParameter`

**Inheritance:** extends `WebServiceParameterPacket` implements `Serializable`

**Fields defined (all public, no encapsulation):**

| Field | Type | Line |
|---|---|---|
| `unit_id` | `int` | 14 |
| `acc_hours` | `double` | 15 |
| `last_serv` | `int` | 16 |
| `service_type` | `String` | 17 |
| `next_serv` | `int` | 18 |
| `driver_id` | `int` | 19 |

**Methods defined:**

| Method | Line | Signature |
|---|---|---|
| `SaveServiceHoursParameter()` | 21 | `public SaveServiceHoursParameter()` — empty no-arg constructor |

**Constants defined:** None.

**Unused imports:** same boilerplate pattern as File 1.

---

### File 3: SaveSessionsParameter.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.SaveSessionsParameter`

**Inheritance:** extends `WebServiceParameterPacket` implements `Serializable`

**Fields defined (all public, no encapsulation):**

| Field | Type | Line |
|---|---|---|
| `sessions` | `SaveSessionItem` | 14 |
| `results` | `SavePreStartItem` | 15 |

**Methods defined:**

| Method | Line | Signature |
|---|---|---|
| `SaveSessionsParameter()` | 17 | `public SaveSessionsParameter()` — empty no-arg constructor |

**Constants defined:** None.

**Unused imports:** same boilerplate pattern as Files 1 and 2.

---

## File-Specific Findings

### A32-2 — No test for negative or zero values of `serv_duration` in SaveServiceDurationParameter [MEDIUM]

**File:** `SaveServiceDurationParameter.java`, field `serv_duration` (line 18, type `int`)

`serv_duration` represents a service interval in hours. The field is a raw public `int` with no validation, no minimum constraint, and no setter guard. In the caller (`ServiceEditFragment.java` lines 260–301) the value is parsed from a user-entered string via `Integer.valueOf(sa)` and assigned directly without checking that it is positive. If the user enters `0` or a negative integer, `serv_duration` will be sent to the server as-is and will also be used locally in the post-save calculation:

```java
getCurrentRecordItem().service_due =
    (getCurrentRecordItem().last_serv + durationParameter.serv_duration)
    - getCurrentRecordItem().acc_hours;
```

A zero `serv_duration` causes `service_due` to equal `last_serv - acc_hours`, which will typically be a negative number, displayed to the user as a negative "hours to next service" value. A negative `serv_duration` makes `service_due` even more negative and creates an invalid server record. There is no test verifying that zero or negative values are rejected before the parameter is constructed.

**Boundary cases with no test coverage:**
- `serv_duration = 0`
- `serv_duration < 0`
- `serv_duration = Integer.MAX_VALUE` (overflow in `last_serv + serv_duration`)

---

### A32-3 — No test for negative, zero, or overflow values of `next_serv` in SaveServiceHoursParameter [MEDIUM]

**File:** `SaveServiceHoursParameter.java`, field `next_serv` (line 18, type `int`)

`next_serv` represents the absolute accumulator-hour threshold at which the next service is due. The caller (`ServiceEditFragment.java` line 279) validates only that `serviceInterval >= mServiceRecordItem.acc_hours`, which prevents a due value in the past but does not prevent:

- `next_serv = 0` if `acc_hours` is also 0 (edge case at machine initialisation).
- `next_serv = Integer.MAX_VALUE` — no overflow guard; if `acc_hours` is close to `Integer.MAX_VALUE` the subsequent subtraction `hoursParameter.next_serv - getCurrentRecordItem().acc_hours` (line 324 in the fragment) silently overflows to a large negative number displayed as `service_due`.
- No test verifies the equality boundary where `next_serv == acc_hours` (service due immediately), which may be a valid or invalid business state depending on server contract.

There is no test for any of these cases.

---

### A32-4 — No test for negative or zero values of `acc_hours` in SaveServiceDurationParameter and SaveServiceHoursParameter [MEDIUM]

**Files:** `SaveServiceDurationParameter.java` line 15 / `SaveServiceHoursParameter.java` line 15 — field `acc_hours` (type `double`)

`acc_hours` is the vehicle's accumulated engine-hour counter. It is sourced from a server response and assigned without local validation (`parameter.acc_hours = mServiceRecordItem.acc_hours`). A value of `0.0` is plausible for a new machine and should produce a valid parameter. A negative value (possible if the server returns corrupt data) would silently create a parameter that passes the caller's comparisons (`serviceInterval < acc_hours` would be trivially false for any positive interval, allowing the save to proceed), producing an invalid server record.

No test exists that exercises `acc_hours = 0.0`, `acc_hours < 0`, or `acc_hours = Double.NaN` / `Double.POSITIVE_INFINITY`.

---

### A32-5 — No test for null `sessions` field in SaveSessionsParameter [MEDIUM]

**File:** `SaveSessionsParameter.java`, field `sessions` (line 14, type `SaveSessionItem`)

In `SyncService.java` (line 125–132) a `SaveSessionsParameter` is constructed and `sessions` is assigned from a freshly created `SaveSessionItem`. However, the field is public and unguarded. The downstream consumer `SessionDb.setSessionSynced()` (line 106) dereferences `saveSessionsParameter.sessions.id` without a null check. If `sessions` is null at the point that method is called, a `NullPointerException` will crash the sync service. No test exercises the case where `sessions` is null or partially populated (e.g., `sessions.id` is 0 or negative).

---

### A32-6 — No test for null `results` field in SaveSessionsParameter [MEDIUM]

**File:** `SaveSessionsParameter.java`, field `results` (line 15, type `SavePreStartItem`)

`SessionDb.getPreStartResultsParameter()` explicitly returns `null` when `prestartOffline` is false (line 80 in `SessionDb.java`). This null is assigned to `parameterItem.results` (SyncService.java line 133), meaning `results` is intentionally null in the non-prestart path. There is no test confirming that the serialisation of `SaveSessionsParameter` with `results = null` produces the correct JSON payload (i.e., that the field is omitted or sent as `null` rather than causing a serialisation error), and no test confirming the server-side contract accepts a null `results` field.

---

### A32-7 — Unused boilerplate imports in all three parameter classes [LOW]

**Files:** All three assigned files (lines 3–10 of each)

All three classes share identical import blocks:

```java
import org.json.JSONException;
import org.json.JSONObject;
import org.json.JSONArray;
import java.util.ArrayList;
import java.math.BigDecimal;
import au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.*;
import au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.*;
```

None of these are used within any of the three classes. The classes contain only field declarations and an empty constructor; they perform no JSON parsing, no ArrayList operations, and no BigDecimal arithmetic. These imports are copy-paste artefacts from a template. While they do not affect runtime behaviour, they obscure the actual dependencies and would cause build warnings under strict lint configurations. There is no test that would catch a regression if a future developer incorrectly assumes one of these types is available locally.

---

### A32-8 — No test for `service_type` being null or an unrecognised string [LOW]

**Files:** `SaveServiceDurationParameter.java` line 17 / `SaveServiceHoursParameter.java` line 17

`service_type` is a `String` assigned a constant value in the caller (`ServiceRecordFragment.TYPE_SET_HOURS` or `TYPE_SET_INTERVAL`). However, the field is public and unguarded. The post-save display logic in `ServiceEditFragment.java` (line 312, 320) assigns `service_type` back to the model without validation. `SessionDb.java` checks `service_type` string values in display logic, and `SavePreStartItem` population is gated on `prestart_required`. No test exists for:
- `service_type = null` (would be serialised as JSON null; server contract for this case is untested).
- `service_type = ""` (empty string).
- `service_type` containing an unrecognised value other than the two known constants.

---

### A32-9 — No test confirming Serializable contract for any of the three parameter classes [INFO]

**Files:** All three assigned files

All three classes implement `java.io.Serializable` but declare no `serialVersionUID`. The JVM will auto-generate one based on class structure. If a field is added or removed in a future version, deserialisation of any previously serialised instance (e.g., stored in a `Bundle`, passed across process boundaries, or persisted to disk) will throw `InvalidClassException`. No test verifies round-trip serialisation for any of these classes.

---

## Summary Table

| ID | File | Severity | Description |
|---|---|---|---|
| A32-1 | Project-wide | HIGH | Zero automated test coverage in `app/` and `LibCommon/` modules |
| A32-2 | SaveServiceDurationParameter | MEDIUM | No test for zero, negative, or overflow `serv_duration` |
| A32-3 | SaveServiceHoursParameter | MEDIUM | No test for zero, negative, or overflow `next_serv` |
| A32-4 | Both service parameter classes | MEDIUM | No test for zero, negative, NaN, or infinite `acc_hours` |
| A32-5 | SaveSessionsParameter | MEDIUM | No test for null `sessions` field (causes NPE in downstream consumer) |
| A32-6 | SaveSessionsParameter | MEDIUM | No test confirming serialisation correctness when `results` is null |
| A32-7 | All three files | LOW | Unused boilerplate imports across all three classes |
| A32-8 | Both service parameter classes | LOW | No test for null, empty, or unrecognised `service_type` string |
| A32-9 | All three files | INFO | No `serialVersionUID` declared; `Serializable` round-trip untested |
