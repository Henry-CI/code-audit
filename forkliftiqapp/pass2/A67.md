# Audit Pass 2 — Agent A67
**Audit run:** 2026-02-26-01
**Agent:** A67
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/fragment/SignupFragment.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/fragment/SignupLoadingFragment.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/fragment/UniversityGuideFragment.java`

---

## PROJECT-WIDE FINDING

### A67-1 — HIGH: Zero automated test coverage across app/ and LibCommon/ modules

The `app/` and `LibCommon/` modules contain no `test/` or `androidTest/` source directories whatsoever. A glob search for `**/test/**/*.java` and `**/androidTest/**/*.java` across the entire repository returned only two files in `LibImageloader` (a third-party image-loading library, not application code) and two skeleton `ApplicationTest.java` stubs in `LibImagePicker` and `LibPercentProgress` (also third-party library modules). No test file covers any class in the `au.com.collectiveintelligence.fleetiq360` package.

This means the following critical application paths have never been exercised by an automated test:

- User registration and all input validation branches in `SignupFragment`
- The authentication flow in `SignupLoadingFragment` (login network call, credential fallback, dashboard routing)
- Every fragment, activity, web service call, model, and utility in the app

All findings in this report describe coverage gaps that exist because test infrastructure is entirely absent. The absence of a test suite means regressions are detectable only through manual QA, which is not a scalable or reliable safety net for a safety-critical fleet-management application.

---

## File 1: SignupFragment.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.ui.fragment.SignupFragment`

**Superclass / interfaces:**
`FleetFragment` (extends), `View.OnClickListener` (implements)

**Fields:**
| Name | Type | Declaration line |
|---|---|---|
| `activity` | `SignupActivity` | 31 |
| `firstNameET` | `EditText` (private) | 32 |
| `lastNameET` | `EditText` (private) | 32 |
| `emailAddressET` | `EditText` (private) | 32 |
| `mobileNumET` | `EditText` (private) | 32 |
| `passwordET` | `EditText` (private) | 32 |
| `confirmPWET` | `EditText` (private) | 32 |
| `sign_up_group_choice_id` | `TextView` (private) | 33 |

**Constants:**
| Name | Value | Declaration line |
|---|---|---|
| `TYPE_DRIVER` | `"DRIVER"` (private static final) | 86 |
| `TYPE_COMPANY` | `"COMPANY"` (private static final) | 87 |

**Methods:**
| Line | Signature |
|---|---|
| 36 | `public View onCreateView(@NonNull LayoutInflater, @Nullable ViewGroup, @Nullable Bundle)` |
| 43 | `public void onActivityCreated(Bundle)` |
| 50 | `public void initViews()` |
| 89 | `private void showGroupType()` |
| 112 | `private void register()` |
| 203 | `public void onClick(View)` |

**Inner / anonymous classes:**
- `TextView.OnEditorActionListener` (lines 60–68): triggers `register()` on `IME_ACTION_DONE`
- `View.OnClickListener` for join button (lines 71–76): triggers `register()`
- `View.OnClickListener` for group-choice label (lines 78–83): triggers `showGroupType()`
- `ThemedSingleListDialog.Callback<String>` (lines 95–107): applies type selection, shows/hides password fields
- `WebListener<LoginItem>` (lines 157–190): handles registration network response

---

### Findings — SignupFragment

#### A67-2 — HIGH: No test file exists for SignupFragment

There is no corresponding test class for `SignupFragment`. The entire class — including all validation branches in `register()` and the type-switching UI logic in `showGroupType()` — has zero automated test coverage.

#### A67-3 — HIGH: No test for registration with all fields empty

`register()` (line 112) is the central method of this class. It validates fields in the following order:

1. User type not selected → toast "Please select your user type" (line 122)
2. Email invalid → toast (line 127)
3. First name empty → toast (line 131)
4. Last name empty → toast (line 136)
5. Mobile empty → toast (line 141)
6. Password invalid (COMPANY only) → toast (line 146)
7. Password mismatch → toast (line 151)

No test exercises the all-empty-fields case, meaning no test verifies that the first guard (type not selected) fires correctly before any field access, nor that none of the later guards throw a `NullPointerException` if the `EditText` widgets have not been initialised via `initViews()`. The absence of any test also means the ordering of validations (e.g., email is checked before first name) is undocumented and untested, so a future reordering would go undetected.

#### A67-4 — HIGH: No test for password validation logic or its boundary conditions

`CommonFunc.isPasswordValid(String)` (CommonFunc.java line 92–94) treats a password as valid if it is non-null and non-empty — i.e., a single space character `" "` passes. `register()` calls this only when `type.equals(TYPE_COMPANY)` (line 146). No test covers:

- COMPANY type with a blank password (fails guard → toast expected)
- COMPANY type with a whitespace-only password (passes guard — potential functional bug, but untestable without a test)
- COMPANY type with a password that satisfies `isPasswordValid` but does not match `confirmPWET` (line 151 guard)
- DRIVER type where password fields are hidden: `register()` still reads `passwordET.getText()` (line 118) regardless of visibility. This means the mismatch check at line 151 always compares the two raw field values even for DRIVER registrations (see A67-5 below), but no test verifies the actual value passed in `userRegisterParameter.password` for a DRIVER.

#### A67-5 — HIGH: No test for stale password sent in DRIVER registration request body

When the user type is DRIVER, `showGroupType()` (line 103) sets `passwordET.setVisibility(View.INVISIBLE)` and `confirmPWET.setVisibility(View.INVISIBLE)`, but does **not** clear the field text. `register()` (line 118) unconditionally reads `passwordET.getText().toString()` and assigns it to `userRegisterParameter.password` (line 196) for **all** registration requests, regardless of type.

Scenario:
1. User selects COMPANY, types a password in `passwordET`.
2. User switches type to DRIVER — password fields become invisible but retain their text.
3. User submits. The password validation guard at line 146 is skipped for DRIVER, and the mismatch guard at line 151 passes because both fields still contain the same previously typed value.
4. `userRegisterParameter.password` is populated with the old COMPANY password string and transmitted to the server.

No test verifies that a DRIVER registration request contains an empty or null password. This is a data-integrity finding: a DRIVER account may be created on the server with an unexpected password field value, which could have authentication side-effects depending on server-side behaviour.

#### A67-6 — HIGH: No test for the isBadGateway error path in onFailed

`register()` creates a `WebListener<LoginItem>` whose `onFailed(WebResult)` handler (line 176) branches on `webResult.isBadGateway()`. The `true` branch shows the dialog "Email already exist" (line 179); the `false` branch shows a progress update and then hides progress after a delay (lines 181–187). No test exercises either branch, meaning:

- A server 502 response that should surface a user-visible error dialog is completely untested.
- The "email already exists" error message is hard-coded and untested, so a future rename or localisation change is not validated against actual server response codes.

#### A67-7 — MEDIUM: No test for showGroupType() — password field visibility toggling

`showGroupType()` (line 89) presents a dialog and in its callback sets `passwordET` and `confirmPWET` visible when COMPANY is selected, and invisible (not GONE) when DRIVER is selected. No test verifies:

- That selecting DRIVER hides both password fields.
- That selecting COMPANY shows both password fields.
- That re-selecting the same type is idempotent.
- That `View.INVISIBLE` (rather than `View.GONE`) is used intentionally and does not create layout gaps — this is a design question that only a test can capture as a regression guard.

#### A67-8 — MEDIUM: No test for onActivityCreated null-activity path

`onActivityCreated()` (line 43) performs `if (getActivity() instanceof SignupActivity)` before assigning `activity`. If the fragment is attached to any other activity, `activity` remains null. Later, `register()` → `onSucceed` → `runLater` callback (line 166) uses `activity` behind a null guard, but that null guard simply silently skips the navigation to `SetUserPhotoFragment`. No test verifies this path: a successful registration with a null activity reference silently does nothing.

#### A67-9 — LOW: No test for onClick(View) — empty method

`onClick(View)` (line 203) is declared by `View.OnClickListener` but has an empty body. No test confirms this is intentional (the class registers click listeners via anonymous classes, not via this method). A future developer could add logic here and the empty-body contract would silently break.

#### A67-10 — LOW: No test for IME_ACTION_DONE triggering register()

The `OnEditorActionListener` on `confirmPWET` (lines 60–68) calls `register()` when `arg1 == EditorInfo.IME_ACTION_DONE`. No test verifies this keyboard shortcut path executes the same validation sequence as the join button path, nor that it returns `false` (allowing the IME to dismiss) in all cases.

---

## File 2: SignupLoadingFragment.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.ui.fragment.SignupLoadingFragment`

**Superclass / interfaces:**
`FleetFragment` (extends), `View.OnClickListener` (implements)

**Fields:**
| Name | Type | Declaration line |
|---|---|---|
| `activity` | `LoginActivity` (package-private) | 24 |
| `loadingIV` | `ImageView` (private) | 25 |
| `loadingResIds` | `int[]` (private) | 47–49 |
| `loginFinished` | `boolean` (private static) | 51 |
| `runTime` | `int` (private static) | 52 |

**Methods:**
| Line | Signature |
|---|---|
| 28 | `public View onCreateView(@NonNull LayoutInflater, @Nullable ViewGroup, @Nullable Bundle)` |
| 35 | `public void onActivityCreated(Bundle)` |
| 41 | `public void initViews()` |
| 54 | `private void timerHandle()` |
| 79 | `private void onLoginSucceed()` |
| 85 | `private void loadingLoginHandle()` |
| 111 | `private void showDashboard()` |
| 122 | `public void onResume()` |
| 129 | `public void onStop()` |
| 134 | `public void onDestroy()` |
| 139 | `public void onClick(View)` |

**Inner / anonymous classes:**
- `Runnable` (line 56): animation loop inside new `Thread`
- `Runnable` (line 67): UI-thread runnable updating `loadingIV` frame
- `CurrentUser.LoginHandler` (lines 86–103): handles `HandleSuccess` and `HandleIncorrectCredentials`

---

### Findings — SignupLoadingFragment

#### A67-11 — HIGH: No test file exists for SignupLoadingFragment

There is no corresponding test class for `SignupLoadingFragment`. None of the authentication flow, animation loop, error handling, or dashboard-routing logic has any automated coverage.

#### A67-12 — HIGH: No test for loginFinished / runTime as static fields — shared state across instances

`loginFinished` and `runTime` are declared `private static` (lines 51–52). This means they are shared across all instances of `SignupLoadingFragment` in the same process. `loadingLoginHandle()` resets both to initial values (lines 106–107), but `timerHandle()` (line 54) reads `loginFinished` in a spin loop on a raw `Thread` that is started in `onResume()` (line 125). No test verifies:

- That a second instantiation of the fragment does not inherit stale `runTime` or `loginFinished` values from a prior instance.
- That if `onResume()` fires twice (e.g., navigate away and back), a second background thread is started while the first is still spinning, leading to two concurrent threads both calling `activity.runOnUiThread()` and both incrementing `runTime`.

This is a concurrency correctness gap with no test coverage.

#### A67-13 — HIGH: No test for timerHandle() — background thread not stopped on fragment stop/destroy

`timerHandle()` (line 54) starts a raw `Thread` that loops until `loginFinished == true`. The thread calls `activity.runOnUiThread(...)` in every iteration. `onStop()` (line 129) and `onDestroy()` (line 134) have empty bodies and make no attempt to set `loginFinished = true` or interrupt the thread. No test verifies:

- That the background thread terminates when the fragment is stopped or destroyed.
- That `activity.runOnUiThread(...)` is not called after the activity is finished, which would cause a crash or ANR on a destroyed activity reference.

#### A67-14 — HIGH: No test for HandleIncorrectCredentials path in loadingLoginHandle()

`loadingLoginHandle()` (line 85) creates a `LoginHandler` whose `HandleIncorrectCredentials()` implementation (line 94) calls `getBaseActivity().getCurrentFragmentManager().popBackStack()`. No test verifies:

- That this method is invoked when `CurrentUser.login()` delivers a failed result.
- That `popBackStack()` successfully navigates the user back to the login screen.
- That the error dialog is shown with the correct message before `popBackStack()` is called.
- That `loginFinished` is set to `true` before the dialog is shown (line 95), which is required to stop the animation thread — and failure to do so would leave the background thread running after the fragment is popped.

#### A67-15 — HIGH: No test for showDashboard() routing logic

`showDashboard()` (line 111) chooses between `DashboardActivity` and `DriversActivity` based on `CurrentUser.get().hasAssociatedDrivers()`. No test covers:

- The DRIVER user path → `DashboardActivity` is launched.
- The COMPANY/has-drivers path → `DriversActivity` is launched with `FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_CLEAR_TASK`.
- The case where `CurrentUser.get()` returns null (which is possible if the user is not stored — `get()` returns the result of `UserDb.get(ModelPrefs.readInt(...))`, which could return null). A null return here causes a `NullPointerException` on `get().hasAssociatedDrivers()`.

#### A67-16 — MEDIUM: No test for initViews() version name display

`initViews()` (line 41) reads `BuildConfig.VERSION_NAME` and sets it on an `AMTextView`. No test verifies this binding, meaning a misconfigured build variant that produces an empty or null `VERSION_NAME` would silently show nothing in the UI.

#### A67-17 — MEDIUM: No test for onLoginSucceed() — check_login view visibility and final frame

`onLoginSucceed()` (line 79) sets `loadingIV` to `frame14` and makes `R.id.check_login` visible. No test verifies that these UI state changes occur after a successful login, nor that `showDashboard()` is then called.

#### A67-18 — LOW: No test for onClick(View) — empty method

`onClick(View)` (line 139) is an empty body declared by `View.OnClickListener`. Same concern as A67-9: no test locks the empty-body contract.

---

## File 3: UniversityGuideFragment.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.ui.fragment.UniversityGuideFragment`

**Superclass / interfaces:**
`FleetFragment` (extends)

**Fields:**
None declared (no instance or class-level fields).

**Constants:**
None declared.

**Methods:**
| Line | Signature |
|---|---|
| 21 | `public View onCreateView(@NonNull LayoutInflater, ViewGroup, Bundle)` |
| 26 | `public void initViews()` |
| 49 | `public void onResume()` |
| 54 | `public void onPause()` |

**Inner / anonymous classes:**
- `View.OnClickListener` for go button (lines 29–35): builds URL from `URLBuilder.urlGetUniversity(MyCommonValue.currentEquipmentItem.id)`, starts `WebActivity`
- `View.OnClickListener` for close button (lines 38–44): pops back stack if count > 0

---

### Findings — UniversityGuideFragment

#### A67-19 — HIGH: No test file exists for UniversityGuideFragment

There is no corresponding test class for `UniversityGuideFragment`. None of the URL-construction, null-safety, or navigation logic is covered by automated tests.

#### A67-20 — HIGH: No test for null dereference on MyCommonValue.currentEquipmentItem in go-button handler

`initViews()` (line 26) attaches a click listener to the go button that constructs the university URL as:

```java
URLBuilder.urlGetUniversity(MyCommonValue.currentEquipmentItem.id)
```

`MyCommonValue.currentEquipmentItem` is a `public static EquipmentItem` field initialised to `null` (MyCommonValue.java line 10). There is no null guard before this field access. If the fragment is displayed while no equipment item is selected — which is possible during a navigation race condition or after session expiry — this dereference throws a `NullPointerException` and crashes the app.

No test verifies the null-currentEquipmentItem case, nor verifies that the fragment correctly handles or prevents this condition.

#### A67-21 — MEDIUM: No test for go-button URL construction with valid equipment item

The go-button listener calls `URLBuilder.urlGetUniversity(int eid)` which builds `https://pandora.fleetiq360.com/pandora/uni?id=<eid>`. No test verifies:

- That the correct URL is passed as `WebActivity.URL_KEY` in the intent.
- That the intent targets `WebActivity` (not some other activity).
- That the equipment item `id` value is correctly injected into the URL query parameter.

#### A67-22 — MEDIUM: No test for close-button back-stack guard

The close-button listener (line 38) checks `manager.getBackStackEntryCount() > 0` before calling `manager.popBackStack()`. No test covers:

- The case where back-stack count is zero (guard fires, nothing happens — no crash, but also no navigation feedback to the user).
- The case where back-stack count is greater than zero (pop executes, fragment closes correctly).

#### A67-23 — LOW: No test for onResume() and onPause() — empty lifecycle overrides

`onResume()` (line 49) and `onPause()` (line 54) both call only `super.onResume()` / `super.onPause()` and do nothing else. No test locks these as intentionally empty, so a future developer adding logic here would have no regression guard.

---

## Summary Table

| ID | Severity | File | Description |
|---|---|---|---|
| A67-1 | HIGH | Project-wide | Zero automated test coverage in app/ and LibCommon/ modules |
| A67-2 | HIGH | SignupFragment | No test file exists for SignupFragment |
| A67-3 | HIGH | SignupFragment | No test for registration with all fields empty |
| A67-4 | HIGH | SignupFragment | No test for password validation logic or boundary conditions |
| A67-5 | HIGH | SignupFragment | No test for stale password sent in DRIVER registration request body |
| A67-6 | HIGH | SignupFragment | No test for isBadGateway / non-gateway error paths in onFailed |
| A67-7 | MEDIUM | SignupFragment | No test for showGroupType() password-field visibility toggling |
| A67-8 | MEDIUM | SignupFragment | No test for onActivityCreated null-activity silent-skip path |
| A67-9 | LOW | SignupFragment | No test for onClick(View) empty-body contract |
| A67-10 | LOW | SignupFragment | No test for IME_ACTION_DONE triggering register() |
| A67-11 | HIGH | SignupLoadingFragment | No test file exists for SignupLoadingFragment |
| A67-12 | HIGH | SignupLoadingFragment | No test for static loginFinished/runTime shared across instances |
| A67-13 | HIGH | SignupLoadingFragment | No test for background thread not stopped on fragment stop/destroy |
| A67-14 | HIGH | SignupLoadingFragment | No test for HandleIncorrectCredentials path |
| A67-15 | HIGH | SignupLoadingFragment | No test for showDashboard() routing and null CurrentUser.get() |
| A67-16 | MEDIUM | SignupLoadingFragment | No test for initViews() version name binding |
| A67-17 | MEDIUM | SignupLoadingFragment | No test for onLoginSucceed() UI state and flow |
| A67-18 | LOW | SignupLoadingFragment | No test for onClick(View) empty-body contract |
| A67-19 | HIGH | UniversityGuideFragment | No test file exists for UniversityGuideFragment |
| A67-20 | HIGH | UniversityGuideFragment | No test for null dereference on MyCommonValue.currentEquipmentItem |
| A67-21 | MEDIUM | UniversityGuideFragment | No test for go-button URL construction with valid equipment item |
| A67-22 | MEDIUM | UniversityGuideFragment | No test for close-button back-stack guard (zero-count and positive-count paths) |
| A67-23 | LOW | UniversityGuideFragment | No test for onResume()/onPause() empty lifecycle override contracts |
