# Audit Pass 2 — Agent A41
**Audit run:** 2026-02-26-01
**Agent:** A41
**Assigned files:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/SaveSingleGPSResult.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/ServiceRecordResultArray.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/ServiceSummaryResultArray.java`

---

## PROJECT-WIDE FINDING

### A41-1 — HIGH — Zero automated test coverage across app/ and LibCommon/ modules

Neither the `app/` module nor the `LibCommon/` module contains a `src/test/` or `src/androidTest/` directory. Glob searches for `**/app/src/test/**`, `**/app/src/androidTest/**`, and `**/LibCommon/src/test/**` all returned no results. The only test files found in the entire repository belong to third-party library modules (`LibImageloader`, `LibImagePicker`, `LibPercentProgress`) and are not authored by the project team.

Every class reviewed in this agent's scope — and by extension every web-service result DTO, every model class, every fragment, and every utility in the `app/` module — has zero test coverage. No unit tests exist for JSON parsing, null-field handling, serialisation round-trips, or any business logic.

**Impact:** Regressions in JSON parsing, silent data corruption from missing or mistyped fields, and logic errors in business rules (e.g., service-status thresholds) cannot be caught automatically. The absence of tests means every API contract change is a manual-testing risk.

---

## File 1: SaveSingleGPSResult.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.SaveSingleGPSResult`

**Superclass:** `WebServiceResultPacket` (which extends `WebServicePacket`) — both implement `Serializable`.

**Fields defined (all public, no constants):**

| Field | Type | Line |
|---|---|---|
| `unit_id` | `int` | 12 |
| `longitude` | `Double` (boxed) | 13 |
| `latitude` | `Double` (boxed) | 14 |
| `gps_time` | `String` | 15 |

**Methods defined:**

| Line | Signature |
|---|---|
| 17 | `public SaveSingleGPSResult()` — default no-arg constructor |
| 20 | `public SaveSingleGPSResult(JSONObject jsonObject) throws JSONException` — JSON-parsing constructor |

**Parsing behaviour (line-by-line):**
- Line 22: delegates to `super(jsonObject)` (WebServiceResultPacket → WebServicePacket) before own parsing.
- Lines 24–46: null-guards each field with `jsonObject.isNull(key)` before extracting; fields absent from JSON remain at Java defaults (`unit_id = 0`, `longitude = null`, `latitude = null`, `gps_time = null`).

---

### Findings for SaveSingleGPSResult.java

#### A41-2 — LOW — No test file exists for SaveSingleGPSResult; all constructors and parse paths are untested

There is no test file corresponding to this class anywhere in the repository. Both the no-arg constructor (line 17) and the JSON-parsing constructor (line 20) are completely untested.

Untested paths include:
- No-arg constructor produces an object with `unit_id == 0` and all reference fields `null`.
- JSON-parsing constructor with a well-formed object containing all four keys.
- JSON-parsing constructor where individual keys are absent (each field silently stays at its Java default — undetected if defaults are confused with real server values).
- JSON-parsing constructor where `jsonObject` argument is `null` (the null guard on line 24 causes the body to be skipped entirely; this is exercised by `GsonRequest.getResult()` line 108 when the response is neither a valid array nor a valid object).

#### A41-3 — MEDIUM — `unit_id` default (0) is indistinguishable from a missing-key response; no test verifies this silent omission

`unit_id` is a primitive `int` (line 12). When the server omits the `"unit_id"` key, `jsonObject.isNull("unit_id")` returns `true`, the assignment is skipped, and `unit_id` remains `0`. The value `0` is a valid-looking integer that downstream code (`LocationDb.removeData`, `LocationDb.getMatchingRecord`) will use as a real unit ID, silently matching all records whose stored `unit_id` is also `0`. No test exercises the absent-key scenario to confirm the downstream behaviour is acceptable.

#### A41-4 — LOW — `longitude` and `latitude` use boxed `Double`; null propagation to callers is untested

Both geographic coordinate fields are declared as `Double` (boxed, lines 13–14). When keys are absent or null in the response JSON, these fields remain `null`. `MyApplication.SaveUnitLocation()` (line 177) and `LocationDb.saveNewLocation()` (line 128) read these fields and store them without null checks. If a future code path auto-unboxes these fields (e.g., in a comparison or arithmetic expression), a `NullPointerException` will occur at runtime. No test confirms that null coordinates are handled gracefully end-to-end.

#### A41-5 — LOW — `gps_time` null propagation is untested

When the `"gps_time"` key is absent, `gps_time` remains `null`. This value is stored directly in `LocationDb` and later used as a parameter in GPS upload calls. No test verifies what happens when a null `gps_time` reaches the server serialisation layer.

#### A41-6 — INFO — `SaveSingleGPSResult` constructor accepts a `JSONObject` but is deserialized via Gson/Volley infrastructure that prefers `JSONArray`

`GsonRequest.getResult()` (lines 99–108) first attempts `JSONArray` construction, then `JSONObject`, then finally passes `null`. The `SaveSingleGPSResult(JSONObject)` constructor is only reachable if the server returns a JSON object (not an array). No test verifies the actual server response shape matches the constructor path taken, meaning a response-shape change would silently produce a default-constructed (all-zero/null) result with no error reported.

---

## File 2: ServiceRecordResultArray.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.ServiceRecordResultArray`

**Superclass:** `WebServiceResultPacket` implements `Serializable`.

**Fields defined:**

| Field | Type | Line |
|---|---|---|
| `arrayList` | `ArrayList<ServiceRecordItem>` | 14 |

**Methods defined:**

| Line | Signature |
|---|---|
| 16 | `public ServiceRecordResultArray()` — no-arg constructor (leaves `arrayList` null) |
| 19 | `public ServiceRecordResultArray(JSONArray jsonArray) throws JSONException` — JSON-parsing constructor |

**Parsing behaviour:**
- Line 22: `arrayList` is initialised to an empty `ArrayList` before the null check.
- Lines 23–29: if `jsonArray` is non-null, iterates all elements; each element is used to construct a `ServiceRecordItem(JSONObject)`.
- The `ServiceRecordItem` constructor (in `ServiceRecordItem.java`) performs its own isNull-guarded parsing of eight fields.

---

### Findings for ServiceRecordResultArray.java

#### A41-7 — LOW — No test file exists; all constructors and parse paths are untested

There is no test file for this class. Untested paths:
- No-arg constructor leaves `arrayList` as `null`; any caller that iterates `arrayList` without a null check (e.g., `ServiceRecordFragment.onData()` line 209 calls `result.arrayList` directly) will throw a `NullPointerException` if the no-arg constructor is used inadvertently.
- JSON-parsing constructor with a `null` argument (array is initialised but loop is skipped; result is an empty list — correct but untested).
- JSON-parsing constructor with an empty array `[]` (zero iterations; `arrayList` is empty).
- JSON-parsing constructor with a single-element array.
- JSON-parsing constructor with a large array.

#### A41-8 — MEDIUM — No-arg constructor leaves `arrayList` null; caller in ServiceRecordFragment performs no null check

The no-arg constructor (line 16) does not initialise `arrayList`. `GsonRequest.createResultWithJsonArray()` (line 38) catches all exceptions from reflection and falls back to `webClazz.newInstance()`, which invokes the no-arg constructor. If this fallback is triggered (e.g., a malformed array element raises an exception inside the loop), the returned object has `arrayList == null`.

`ServiceRecordFragment.onData()` (line 209) calls `result.arrayList` and passes it directly to `listData.addAll(result.arrayList)` with no null guard. A null `arrayList` at this point causes a `NullPointerException` that crashes the fragment. No test exercises this error path.

#### A41-9 — MEDIUM — A malformed element mid-array aborts the entire parse; partial results are lost silently

The loop at line 25 constructs each `ServiceRecordItem` by calling `jsonArray.getJSONObject(i)`. If any element is not a JSON object (e.g., a null element in the array, or a corrupt API response), `JSONException` propagates out of the constructor (declared `throws JSONException`). The exception is caught by `GsonRequest.createResultWithJsonArray()` (line 36–38), which catches all exceptions and falls back to `webClazz.newInstance()`, returning a null-arrayList object rather than a partial list. All successfully parsed earlier items are discarded. No test exercises a mixed-valid/invalid array.

#### A41-10 — INFO — Import of `java.math.BigDecimal` (line 8) is unused

`BigDecimal` is imported but never referenced in the file. This is dead code. No test would catch an accidental removal of a real dependency if a developer incorrectly cleaned up imports.

---

## File 3: ServiceSummaryResultArray.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.ServiceSummaryResultArray`

**Superclass:** `WebServiceResultPacket` implements `Serializable`.

**Fields defined:**

| Field | Type | Line |
|---|---|---|
| `arrayList` | `ArrayList<ServiceSummaryItem>` | 14 |

**Methods defined:**

| Line | Signature |
|---|---|
| 16 | `public ServiceSummaryResultArray()` — no-arg constructor (leaves `arrayList` null) |
| 19 | `public ServiceSummaryResultArray(JSONArray jsonArray) throws JSONException` — JSON-parsing constructor |

**Parsing behaviour:**
- Line 22: `arrayList` initialised before null check.
- Lines 23–29: same pattern as `ServiceRecordResultArray`; each element passed to `ServiceSummaryItem(JSONObject)`.
- `ServiceSummaryItem` parses eight fields: `unit_id`, `acc_hours`, `service_due`, `last_serv`, `next_serv`, `serv_duration` (all `int`), and `unit_name`, `service_type` (both `String`).

**Structural note:** `ServiceSummaryResultArray` is not referenced anywhere in `WebApi.java`; no API call currently uses it. It appears to be dead production code.

---

### Findings for ServiceSummaryResultArray.java

#### A41-11 — LOW — No test file exists; all constructors and parse paths are untested

Identical situation to `ServiceRecordResultArray`. Untested paths:
- No-arg constructor (leaves `arrayList` null).
- JSON-parsing constructor with null argument.
- JSON-parsing constructor with empty array.
- JSON-parsing constructor with well-formed array.
- JSON-parsing constructor with a malformed element mid-array.

#### A41-12 — MEDIUM — No-arg constructor leaves `arrayList` null; any future caller risks NullPointerException

Same structural defect as A41-8. The no-arg constructor (line 16) does not initialise `arrayList`. If the Volley/GsonRequest fallback path invokes it and a caller iterates `arrayList`, a `NullPointerException` results. No test verifies the fallback behaviour.

#### A41-13 — MEDIUM — Class is unused in production call graph but retained in codebase; untested dead code

`ServiceSummaryResultArray` is defined and compiled but no method in `WebApi.java` constructs a `GsonRequest` with this class as the type parameter. No fragment or model class references it. It exists as dead code. Dead code that is never exercised in tests can be silently broken (e.g., by a rename of `ServiceSummaryItem` fields) and the breakage would not be detected. If the class is intended for future use, it requires tests before activation.

#### A41-14 — LOW — `ServiceSummaryItem.acc_hours` is typed as `int`, while `ServiceRecordItem.acc_hours` is typed as `double` for the same semantic field

`ServiceSummaryItem.acc_hours` (line 15 of that file) is declared `int`, and parsed with `jsonObject.getInt("acc_hours")`. `ServiceRecordItem.acc_hours` (line 14 of that file) is declared `double`, parsed with `jsonObject.getDouble("acc_hours")`. These two classes represent parallel server entities and share the same JSON key name. The type discrepancy means a fractional `acc_hours` value from the server will be silently truncated to an integer when parsed into `ServiceSummaryItem`, losing precision. No test compares the two parsers against the same fixture JSON to detect this inconsistency.

#### A41-15 — MEDIUM — A malformed element mid-array aborts the entire parse with the same silent-discard behaviour as A41-9

Same structural issue as finding A41-9. A corrupt or unexpected element type mid-array causes `JSONException` to propagate out of the constructor, the Volley fallback returns a null-arrayList object, and all successfully parsed prior items are lost. No test covers this path.

#### A41-16 — INFO — Unused imports (`java.math.BigDecimal`, self-import of own package) present in both array result files

Both `ServiceRecordResultArray.java` (lines 8, 10) and `ServiceSummaryResultArray.java` (lines 8, 10) import `java.math.BigDecimal` and `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.*` (a wildcard import of the same package the class belongs to). Neither import is used. These are noise that obscures the real dependency surface and would not be caught without a test or static analysis gate.

---

## Summary Table

| ID | Severity | File | Description |
|---|---|---|---|
| A41-1 | HIGH | project-wide | Zero automated tests in app/ and LibCommon/ modules |
| A41-2 | LOW | SaveSingleGPSResult | No test file; all constructors and parse paths untested |
| A41-3 | MEDIUM | SaveSingleGPSResult | `unit_id` default 0 indistinguishable from missing-key; silent data corruption risk |
| A41-4 | LOW | SaveSingleGPSResult | Boxed `Double` fields can be null; null propagation to callers untested |
| A41-5 | LOW | SaveSingleGPSResult | `gps_time` null propagation untested |
| A41-6 | INFO | SaveSingleGPSResult | Constructor path selection depends on response shape; no test verifies correct path taken |
| A41-7 | LOW | ServiceRecordResultArray | No test file; all constructors and parse paths untested |
| A41-8 | MEDIUM | ServiceRecordResultArray | No-arg constructor leaves `arrayList` null; caller in ServiceRecordFragment has no null check |
| A41-9 | MEDIUM | ServiceRecordResultArray | Mid-array parse failure silently discards all partial results via Volley fallback |
| A41-10 | INFO | ServiceRecordResultArray | Unused `BigDecimal` import |
| A41-11 | LOW | ServiceSummaryResultArray | No test file; all constructors and parse paths untested |
| A41-12 | MEDIUM | ServiceSummaryResultArray | No-arg constructor leaves `arrayList` null; future callers risk NullPointerException |
| A41-13 | MEDIUM | ServiceSummaryResultArray | Class is dead code with no callers in WebApi; untested before future activation |
| A41-14 | LOW | ServiceSummaryResultArray | `acc_hours` typed as `int` vs `double` in parallel `ServiceRecordItem`; silent precision loss |
| A41-15 | MEDIUM | ServiceSummaryResultArray | Mid-array parse failure silently discards all partial results via Volley fallback |
| A41-16 | INFO | ServiceSummaryResultArray | Unused imports (`BigDecimal`, self-package wildcard) in both array result files |
