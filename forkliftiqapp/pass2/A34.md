# Audit Pass 2 – Test Coverage
## Agent: A34
## Audit Run: 2026-02-26-01
## Files Assigned:
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/SessionStartParameter.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/SetEmailsParameter.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/UpdateUserParameter.java`

---

## PROJECT-WIDE FINDING — NO TEST INFRASTRUCTURE EXISTS

### A34-0 | HIGH | Zero Automated Test Coverage Across app/ and LibCommon/ Modules

The `app/src/` directory contains only a `main/` subdirectory. There is no `test/` directory and no `androidTest/` directory. The `LibCommon/` module has been confirmed by the audit context to be in the same state. The only test files present in the entire repository are in `LibImageloader/src/test/`, a third-party image-loading library, not application code.

**Impact:** Every class in the `app/` and `LibCommon/` modules — including all web service parameter DTOs, business logic, presenters, fragments, and utilities — is completely untested by automated means. Any regression, serialization breakage, or validation logic error can reach production undetected.

**Evidence:**
```
app/src/
  main/     <- only subdirectory; no test/ or androidTest/ present
```

All file-specific findings below are reported against this backdrop of zero test coverage.

---

## Reading Evidence

### File 1: SessionStartParameter.java

**Fully Qualified Class Name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.SessionStartParameter`

**Superclass:** `WebServiceParameterPacket` (which extends `WebServicePacket`), also implements `java.io.Serializable`

**Fields defined (all public):**

| Line | Type   | Name         |
|------|--------|--------------|
| 9    | int    | driver_id    |
| 10   | int    | unit_id      |
| 11   | String | start_time   |

**Methods defined:**

| Line | Signature                   | Notes                    |
|------|-----------------------------|--------------------------|
| 13   | `SessionStartParameter()`   | No-arg constructor, empty body |

**Constants defined:** None

---

### File 2: SetEmailsParameter.java

**Fully Qualified Class Name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.SetEmailsParameter`

**Superclass:** `WebServiceParameterPacket`, also implements `java.io.Serializable`

**Fields defined (all public):**

| Line | Type   | Name          |
|------|--------|---------------|
| 14   | int    | driver_id     |
| 15   | String | email_addr1   |
| 16   | String | email_addr2   |
| 17   | String | email_addr3   |
| 18   | String | email_addr4   |

**Methods defined:**

| Line | Signature              | Notes                    |
|------|------------------------|--------------------------|
| 20   | `SetEmailsParameter()` | No-arg constructor, empty body |

**Constants defined:** None

**Caller context (SetupEmailFragment.java, lines 161–166):** Fields are set directly by the caller after construction. The fragment reads email strings from `TextView` widgets and assigns them to the parameter fields unconditionally — no format validation is applied before the API call is dispatched.

---

### File 3: UpdateUserParameter.java

**Fully Qualified Class Name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.UpdateUserParameter`

**Superclass:** `WebServiceParameterPacket`, also implements `java.io.Serializable`

**Fields defined (all public):**

| Line | Type   | Name             |
|------|--------|------------------|
| 8    | int    | id               |
| 9    | String | first_name       |
| 10   | String | last_name        |
| 11   | String | compliance_date  |

**Methods defined:**

| Line | Signature                                                                                       | Notes                          |
|------|-------------------------------------------------------------------------------------------------|--------------------------------|
| 13   | `UpdateUserParameter(int id, String firstName, String lastName, String complianceDate)` | Only constructor; assigns all four fields directly, no null/empty guards |

**Constants defined:** None

**Caller context 1 (ProfileFragment.java, lines 115–118):** `first_name` and `last_name` are taken directly from `EditText.getText().toString()`. If the user clears a field, an empty string is passed. No pre-submission validation is present.

**Caller context 2 (ComplianceAccepter.java, lines 38–40):** `UpdateUserParameter` is constructed with `user.getFirstName()` and `user.getLastName()`, which may themselves be null if the `User` object was partially deserialized from storage.

---

## Findings

---

### A34-1 | HIGH | No test files exist for any of the three assigned classes (or any app/ class)

**Severity:** HIGH (restatement at file level of the project-wide finding A34-0)

**Files affected:**
- `SessionStartParameter.java`
- `SetEmailsParameter.java`
- `UpdateUserParameter.java`

**Detail:** No test file exists anywhere in the `app/` module. A glob for `**/test/**/*.java` under the project root returns only two files, both in the unrelated `LibImageloader` third-party module. None of the three assigned classes has any corresponding test file, direct or indirect.

**Risk:** All three classes are serialized and sent over the network as JSON request bodies via Gson. Any field rename, type change, or serialization regression will produce silent API failures with no automated detection.

---

### A34-2 | MEDIUM | UpdateUserParameter constructor performs no null or empty-string validation on required String fields

**Severity:** MEDIUM

**File:** `UpdateUserParameter.java`, line 13

**Detail:** The single constructor accepts `firstName`, `lastName`, and `complianceDate` as `String` parameters and assigns them to public fields without any null check, empty-string check, or trimming. Two distinct callers both have paths that can produce problematic values:

- **ProfileFragment** (line 115): `EditText.getText().toString()` returns an empty string `""` when the user has cleared the name fields. The UI does not enforce non-empty input before calling `saveModifiedResult()`.
- **ComplianceAccepter** (line 38): `user.getFirstName()` and `user.getLastName()` are passed directly. If the `User` object was stored and retrieved from shared preferences in a partial state, these values may be `null`.

A `null` `first_name` or `last_name` will serialize to JSON `null`, which the server may reject or silently accept and corrupt the stored record. An empty string will overwrite a valid name on the server with an empty value, again with no client-side detection.

**Untested scenarios:**
- `UpdateUserParameter` constructed with `null` firstName
- `UpdateUserParameter` constructed with `null` lastName
- `UpdateUserParameter` constructed with `""` (empty) firstName
- `UpdateUserParameter` constructed with `""` (empty) lastName
- `UpdateUserParameter` constructed with `null` complianceDate
- `UpdateUserParameter` constructed with a whitespace-only string (`"   "`) for any name field

---

### A34-3 | MEDIUM | SetEmailsParameter fields accept and transmit invalid email addresses without validation

**Severity:** MEDIUM

**File:** `SetEmailsParameter.java`, lines 14–18

**Caller:** `SetupEmailFragment.java`, lines 161–166

**Detail:** `SetEmailsParameter` declares four email address fields as plain `String` with no validation. The caller `SetupEmailFragment.saveEmail()` reads the values directly from `TextView` widgets and assigns them to the parameter fields before dispatching the API call. No format validation (regex, `android.util.Patterns.EMAIL_ADDRESS`, or otherwise) is applied at any point in the call chain.

The class itself has no validation method, no setter, and no constructor parameter — all four fields are public and set by direct assignment. There is no mechanism to prevent:

- Malformed email strings (e.g., `"notanemail"`, `"@nodomain"`, `"user@"`)
- Empty strings assigned to email fields that the server treats as required
- Strings containing control characters or Unicode sequences that could affect downstream email dispatch

**Untested scenarios:**
- `email_addr1` set to a string with no `@` character
- `email_addr1` set to `""` (empty)
- `email_addr1` set to `null`
- `email_addr2` through `email_addr4` set to the same duplicate address
- All four fields set to `null` simultaneously (the driver has no registered emails)
- An email string exceeding typical server-side length limits

---

### A34-4 | LOW | SessionStartParameter fields are all public with no validation; start_time format is unchecked

**Severity:** LOW

**File:** `SessionStartParameter.java`, lines 9–11

**Detail:** `SessionStartParameter` carries `driver_id`, `unit_id`, and `start_time`. The integer fields have the implicit zero-value risk (`driver_id = 0` or `unit_id = 0` would submit a session against an invalid entity), but the more concrete concern is `start_time`, which is a `String` representing a date-time. The field is set by the caller (`WebData.getTempSessionResult`, line 49, copies it from the parameter) without any format check.

`WebData.getTempSessionResult()` constructs a `SessionResult` from a `SessionStartParameter` directly. If `start_time` is `null` or a malformed date string, the resulting `SessionResult` and any persisted `SessionDb` record will carry the bad value silently.

**Untested scenarios:**
- `SessionStartParameter` constructed with `start_time = null`
- `SessionStartParameter` constructed with `start_time = ""` (empty string)
- `SessionStartParameter` constructed with `driver_id = 0`
- `SessionStartParameter` constructed with `unit_id = 0`
- `SessionStartParameter` constructed with negative `driver_id` or `unit_id`

---

### A34-5 | LOW | SetEmailsParameter has no constraint on driver_id being zero or negative

**Severity:** LOW

**File:** `SetEmailsParameter.java`, line 14

**Detail:** `driver_id` is set by `SetupEmailFragment` as `WebData.instance().getUserId()`, which returns `-1` when no current user is present (see `WebData.java`, line 114). There is no guard in the fragment or the parameter class to detect the `-1` sentinel before dispatching the API call. A request submitted with `driver_id = -1` would either fail server-side with an opaque error or, depending on server behavior, update records for an unintended entity.

**Untested scenarios:**
- `SetEmailsParameter` constructed with `driver_id = -1` (no logged-in user)
- `SetEmailsParameter` constructed with `driver_id = 0`

---

### A34-6 | INFO | All three parameter classes use public fields rather than private fields with accessors

**Severity:** INFO

**Files:**
- `SessionStartParameter.java`
- `SetEmailsParameter.java`
- `UpdateUserParameter.java`

**Detail:** All fields across all three classes are declared `public`. While Gson serialization operates correctly on public fields, this design eliminates any opportunity to enforce invariants at the point of assignment. Adding validation logic later would require a breaking change to the field access pattern across all callers. Encapsulating fields as `private` with validated setters or a validated constructor would be the standard remediation path, but since these classes contain no logic today, this is informational only.

---

## Summary Table

| ID     | Severity | File(s)                                         | Description                                                              |
|--------|----------|-------------------------------------------------|--------------------------------------------------------------------------|
| A34-0  | HIGH     | Project-wide (app/, LibCommon/)                 | Zero automated test infrastructure exists in any application module      |
| A34-1  | HIGH     | All three assigned files                        | No test file exists for any of the three classes, direct or indirect     |
| A34-2  | MEDIUM   | UpdateUserParameter.java                        | Constructor accepts null/empty String fields without validation          |
| A34-3  | MEDIUM   | SetEmailsParameter.java                         | Email address fields accept and transmit invalid formats without checks  |
| A34-4  | LOW      | SessionStartParameter.java                      | start_time format and zero-value integer fields are unchecked            |
| A34-5  | LOW      | SetEmailsParameter.java                         | driver_id = -1 sentinel not guarded before API dispatch                 |
| A34-6  | INFO     | All three assigned files                        | All fields are public; no accessor layer to enforce future invariants    |
