# Audit Pass 2 – Agent A25
**Audit run:** 2026-02-26-01
**Agent:** A25
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/ReportItem.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/RoleItem.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/SaveGPSLocationItem.java`

---

## Project-Wide Finding: Zero Automated Test Coverage

### A25-1 [HIGH] No test directories exist in app/ or LibCommon/ modules

The `app/` module and `LibCommon/` module contain no test directories (`src/test/` or `src/androidTest/`). The only test files found in the entire repository reside in the third-party `LibImageloader` module:

- `LibImageloader/src/test/java/com/nostra13/universalimageloader/core/assist/ImageSizeTest.java`
- `LibImageloader/src/test/java/com/nostra13/universalimageloader/core/download/BaseImageDownloaderTest.java`

These tests cover library code, not application code. Every class in `app/` and `LibCommon/` — including all business logic, data parsing, GPS location handling, session management, authentication, and database operations — has zero automated test coverage. All findings below are consequences of this blanket absence; no test file was found for any of the three assigned source files.

---

## File 1: ReportItem.java

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.ReportItem`

**Implements:** `java.io.Serializable`

**Fields/constants defined:**
| Name | Type | Access | Line |
|------|------|--------|------|
| `id` | `int` | `public` | 14 |
| `name` | `String` | `public` | 15 |

**Methods:**
| Line | Signature |
|------|-----------|
| 17 | `public ReportItem()` |
| 20 | `public ReportItem(JSONObject jsonObject) throws JSONException` |

**Imports used:** `org.json.JSONException`, `org.json.JSONObject`, `java.io.Serializable`, `org.json.JSONArray` (unused), `java.util.ArrayList` (unused), `java.math.BigDecimal` (unused), wildcard imports of `webserviceclasses.*` and `webserviceclasses.results.*` (unused).

**Observed logic:**
- Line 22: null guard on `jsonObject` before field access.
- Lines 25-28: `id` assigned only when the JSON key is not null; if key is absent `id` retains default value `0`.
- Lines 30-33: `name` assigned only when the JSON key is not null; if key is absent `name` remains `null`.
- The JSON parsing constructor propagates `JSONException` to callers.
- `ReportItem` is consumed by `ReportResultArray` (which constructs instances in a loop) and by `SavedReportListAdapter` and `SavedReportFragment` in the UI layer.

---

### Findings — ReportItem.java

#### A25-2 [LOW] No test file exists for ReportItem

There is no test class for `ReportItem`. No test exercises either constructor, and no test validates field values after construction.

**Untested methods:**
- `ReportItem()` (no-arg constructor)
- `ReportItem(JSONObject jsonObject)` (JSON-parsing constructor)

---

#### A25-3 [MEDIUM] No test for null-JSONObject input to JSON constructor

`ReportItem(JSONObject)` accepts `null` without throwing (the outer null guard on line 22 handles this), but no test confirms this contract. If the guard were accidentally removed in a refactor the silent null promotion would go undetected.

**Missing test scenario:** `new ReportItem((JSONObject) null)` must produce an object with `id == 0` and `name == null`.

---

#### A25-4 [MEDIUM] No test for absent or JSON-null field keys

Two distinct JSON states reach the same Java outcome (`id` stays `0`, `name` stays `null`) but through different code paths:

1. Key is completely absent from the JSON object — `jsonObject.isNull(key)` returns `true`.
2. Key is present with a JSON null value — `jsonObject.isNull(key)` also returns `true`.

No test covers either variant for `id` or `name`. A regression that changes the conditional to `has()` instead of `!isNull()` would silently alter behavior for absent keys.

---

#### A25-5 [LOW] No test for boundary integer values for `id`

`id` is parsed as `int` via `getInt()`. No test covers:
- `id = 0` (minimum unsigned boundary, same as unset default — ambiguous)
- `id = Integer.MAX_VALUE`
- `id = Integer.MIN_VALUE` (negative id from a malformed server response)

A server returning a negative or zero `id` is indistinguishable from a parsing miss.

---

#### A25-6 [LOW] No test for empty string `name`

`name` is a `String` with no length validation. No test covers `name = ""` (empty) vs `name = null` (absent key). Downstream UI code in `SavedReportListAdapter` could render an empty name without a visible error, silently showing a blank list item.

---

#### A25-7 [LOW] Unused imports not caught by any static-analysis gate

Lines 6–10 import `JSONArray`, `ArrayList`, `BigDecimal`, and two wildcard packages that are not used by this class. Because there are no automated tests or lint enforcement gating CI for this module, these dead imports persist undetected. (Informational only; not a test gap per se, but symptomatic of the absent quality-gate pipeline.)

---

## File 2: RoleItem.java

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.RoleItem`

**Implements:** `java.io.Serializable`

**Fields/constants defined:**
| Name | Type | Access | Line |
|------|------|--------|------|
| `id` | `int` | `public` | 14 |
| `name` | `String` | `public` | 15 |
| `description` | `String` | `public` | 16 |

**Methods:**
| Line | Signature |
|------|-----------|
| 18 | `public RoleItem()` |
| 21 | `public RoleItem(JSONObject jsonObject) throws JSONException` |

**Imports used:** `org.json.JSONException`, `org.json.JSONObject`, `java.io.Serializable`, `org.json.JSONArray` (unused), `java.util.ArrayList` (unused), `java.math.BigDecimal` (unused), wildcard imports of `webserviceclasses.*` and `webserviceclasses.results.*` (unused).

**Observed logic:**
- Lines 23-40: null guard on `jsonObject` wraps all field assignment.
- Lines 26-29: `id` set only when key is not JSON null; defaults to `0`.
- Lines 31-34: `name` set only when key is not JSON null; defaults to `null`.
- Lines 36-39: `description` set only when key is not JSON null; defaults to `null`.
- `RoleItem` is constructed inside `CompanyItem`'s JSON constructor (line 55 of `CompanyItem.java`), meaning a malformed role object within a company array can throw `JSONException` that propagates through `CompanyItem` deserialization, which is part of the login/session flow.

---

### Findings — RoleItem.java

#### A25-8 [LOW] No test file exists for RoleItem

There is no test class for `RoleItem`. Neither constructor is exercised by any automated test.

**Untested methods:**
- `RoleItem()` (no-arg constructor)
- `RoleItem(JSONObject jsonObject)` (JSON-parsing constructor)

---

#### A25-9 [MEDIUM] No test for null-JSONObject input to JSON constructor

Same pattern as A25-3. `RoleItem(null)` is guarded on line 23, producing a zero-`id`, all-null-field object. No test confirms this contract is stable.

---

#### A25-10 [MEDIUM] No test for absent or JSON-null field keys across all three fields

`RoleItem` has three nullable fields (`id`, `name`, `description`). No test covers the case where any individual key is absent or JSON-null. Partial-data role objects from the server (e.g., a role with no `description`) would silently produce a `null` field with no observable test failure.

---

#### A25-11 [MEDIUM] No test for RoleItem construction failure propagating through CompanyItem login flow

`RoleItem(JSONObject)` is invoked inside `CompanyItem`'s constructor at line 55 of `CompanyItem.java`. A `JSONException` thrown during role deserialization propagates and aborts parsing of the entire company/login response. No test covers:
- A `JSONException` thrown by a malformed role item in the array.
- An array element that is not a `JSONObject` (e.g., a primitive).

Because `RoleItem` sits on the critical login deserialization path, a bad role record from the server would break the entire session establishment for that user.

**Severity rationale:** The login path is security-adjacent (authentication). An unhandled exception here causes a denial-of-service for the affected user account. Elevated from LOW to MEDIUM.

---

#### A25-12 [LOW] No test for boundary integer values for `id`

Same gap as A25-5. `id = 0` is ambiguous (unset default vs. valid zero-id role). Negative or max-integer ids from the server are not validated.

---

#### A25-13 [LOW] Unused imports not caught by any static-analysis gate

Same pattern as A25-7. Lines 6–10 carry dead imports with no enforcement gate.

---

## File 3: SaveGPSLocationItem.java

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.SaveGPSLocationItem`

**Implements:** `java.io.Serializable`

**Fields/constants defined:**
| Name | Type | Access | Line |
|------|------|--------|------|
| `unit_id` | `int` | `public` | 13 |
| `longitude` | `Double` | `public` | 14 |
| `latitude` | `Double` | `public` | 15 |
| `gps_time` | `String` | `public` | 16 |

**Methods:**
| Line | Signature |
|------|-----------|
| 19 | `public SaveGPSLocationItem()` |
| 22 | `public SaveGPSLocationItem(LocationDb gps)` |

**Imports used:** `org.json.JSONException` (unused), `org.json.JSONObject` (unused), `java.io.Serializable`, `au.com.collectiveintelligence.fleetiq360.WebService.JSONObjectParser` (unused), `au.com.collectiveintelligence.fleetiq360.model.LocationDb`.

**Observed logic:**
- Lines 23-27: The `LocationDb` constructor directly accesses four public fields of the `LocationDb` argument without any null check on `gps`.
- `SaveGPSLocationItem` is constructed in `LocationDb.uploadLocation()` at line 93 of `LocationDb.java`, where `locationDb` comes from a live Realm query result. It is also held in `SaveMultipleGPSParameter.gpsList`.
- `longitude` and `latitude` are boxed `Double` (nullable), not primitive `double`. A `null` from `LocationDb` would be silently stored and transmitted to the server.

---

### Findings — SaveGPSLocationItem.java

#### A25-14 [LOW] No test file exists for SaveGPSLocationItem

There is no test class for `SaveGPSLocationItem`. Neither constructor is exercised by any automated test.

**Untested methods:**
- `SaveGPSLocationItem()` (no-arg constructor)
- `SaveGPSLocationItem(LocationDb gps)` (field-copy constructor)

---

#### A25-15 [HIGH] No null check on LocationDb argument; null input causes NullPointerException

`SaveGPSLocationItem(LocationDb gps)` at line 22 accesses `gps.gps_time`, `gps.longitude`, `gps.latitude`, and `gps.unit_id` unconditionally. If `gps` is `null`, all four field accesses throw a `NullPointerException`.

The caller site in `LocationDb.uploadLocation()` (line 93) iterates a Realm `RealmResults` collection. While the collection itself is non-null, individual items yielded by Realm under certain managed-object lifecycle conditions (e.g., Realm closed mid-iteration) could be null. Additionally, the no-arg default constructor leaves `unit_id = 0` and all other fields null, which can be used to construct a `SaveGPSLocationItem` and later serialized to the network with a zero/null GPS payload — a silent data corruption.

No test covers:
- `new SaveGPSLocationItem(null)` — expected behavior (exception vs. guard) is unspecified and untested.
- A `LocationDb` with `null` `longitude` or `latitude` (boxed `Double` fields on `LocationDb`).

**Severity rationale:** GPS location upload is a core operational feature. A null-pointer crash in this path silently drops location data with no retry or error surfacing beyond a logcat message.

---

#### A25-16 [MEDIUM] No test for null latitude/longitude propagation from LocationDb

`LocationDb.longitude` and `LocationDb.latitude` are declared as `Double` (boxed, nullable) at lines 29-30 of `LocationDb.java`. If a `LocationDb` record was stored with null coordinates (possible if the GPS fix was unavailable), those nulls are copied directly into `SaveGPSLocationItem` without any guard. No exception is thrown at construction time. The null values are then serialized (via Gson or similar) and transmitted to the server API as `null` GPS coordinates.

No test verifies:
- That null coordinates produce a rejected or guarded item rather than a null-payload API call.
- That the server roundtrip handles null coordinates gracefully.

---

#### A25-17 [MEDIUM] No test for gps_time format or null value

`gps_time` is a `String` copied verbatim from `LocationDb`. No test exercises:
- `gps_time = null` (no GPS fix time recorded).
- `gps_time` containing a malformed timestamp string.
- `gps_time` being an empty string.

The server presumably parses `gps_time` as a timestamp. A null or malformed value could cause server-side rejection of the entire GPS batch, silently discarding all location records in the upload.

---

#### A25-18 [LOW] Unused imports indicate copy-paste origin with dead code risk

`SaveGPSLocationItem.java` imports `JSONException`, `JSONObject`, and `JSONObjectParser` (lines 3, 4, 8) — none of which are used. This strongly suggests the file was scaffolded by copying another webserviceclasses file that had a JSON-parsing constructor. The presence of a no-arg constructor and the `Serializable` interface, combined with unused JSON imports, suggests a JSON-parsing constructor was originally intended but never implemented. There is no test to confirm the class's actual parsing contract (there is none).

---

#### A25-19 [LOW] No test for unit_id boundary or zero value

`unit_id` is a primitive `int` defaulting to `0`. No test covers:
- `unit_id = 0` (ambiguous: default unset vs. valid unit 0).
- Negative `unit_id` from a corrupt `LocationDb` record.

In `LocationDb.removeData()` (line 65-73 of `LocationDb.java`), `unit_id` from `SaveGPSLocationItem` is used to query and delete Realm records. A zero `unit_id` passed to `getMatchingRecord()` would delete all records with `unit_id == 0`, which could include records for multiple units if zero is a valid id.

---

## Summary Table

| ID | Severity | File | Summary |
|----|----------|------|---------|
| A25-1 | HIGH | Project-wide | Zero automated test coverage in app/ and LibCommon/ modules |
| A25-2 | LOW | ReportItem.java | No test file; no constructor coverage |
| A25-3 | MEDIUM | ReportItem.java | No test for null JSONObject input |
| A25-4 | MEDIUM | ReportItem.java | No test for absent vs. JSON-null key distinction |
| A25-5 | LOW | ReportItem.java | No test for boundary integer values for id |
| A25-6 | LOW | ReportItem.java | No test for empty string name |
| A25-7 | LOW | ReportItem.java | Unused imports undetected without static analysis gate |
| A25-8 | LOW | RoleItem.java | No test file; no constructor coverage |
| A25-9 | MEDIUM | RoleItem.java | No test for null JSONObject input |
| A25-10 | MEDIUM | RoleItem.java | No test for absent or JSON-null field keys (three fields) |
| A25-11 | MEDIUM | RoleItem.java | No test for JSONException propagation through login flow |
| A25-12 | LOW | RoleItem.java | No test for boundary integer values for id |
| A25-13 | LOW | RoleItem.java | Unused imports undetected without static analysis gate |
| A25-14 | LOW | SaveGPSLocationItem.java | No test file; no constructor coverage |
| A25-15 | HIGH | SaveGPSLocationItem.java | No null check on LocationDb argument; NPE on null input |
| A25-16 | MEDIUM | SaveGPSLocationItem.java | No test for null latitude/longitude propagation |
| A25-17 | MEDIUM | SaveGPSLocationItem.java | No test for null or malformed gps_time |
| A25-18 | LOW | SaveGPSLocationItem.java | Unused JSON imports suggest incomplete implementation |
| A25-19 | LOW | SaveGPSLocationItem.java | No test for unit_id zero/negative boundary |
