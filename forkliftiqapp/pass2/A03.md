# Pass 2 Audit – Agent A03
**Audit run:** 2026-02-26-01
**Agent:** A03
**Files assigned:**
1. `LibCommon/src/main/java/com/yy/libcommon/CommonLib/NetworkDetect.java`
2. `LibCommon/src/main/java/com/yy/libcommon/CustomProgressDialog.java`
3. `LibCommon/src/main/java/com/yy/libcommon/DrawingView.java`

---

## Project-Wide Finding: Zero Automated Test Coverage

**Finding ID:** A03-1
**Severity:** HIGH
**Scope:** Project-wide (`app/` and `LibCommon/` modules)

Neither the `app/` module nor the `LibCommon/` module contains a test source directory of any kind. Confirmed:

- `app/src/` — contains only `main/` (no `test/` or `androidTest/` subdirectory)
- `LibCommon/src/` — contains only `main/` (no `test/` or `androidTest/` subdirectory)

The only test files in the repository are in third-party library modules (`LibImageloader`, `LibImagePicker`, `LibPercentProgress`) and are not authored by this project.

Zero automated test coverage means:
- No regression safety net for any change
- No verification of error paths, null inputs, or boundary conditions
- All three files assigned to this agent have no corresponding test file; every method in every file is untested

This finding applies globally and is the root cause of every file-level finding below.

---

## File 1: NetworkDetect.java

### Reading Evidence

**Fully qualified class name:** `com.yy.libcommon.CommonLib.NetworkDetect`

**Methods (with line numbers and signatures):**

| Line | Signature |
|------|-----------|
| 13 | `static public boolean isNetworkConnected(Context context)` |

**Constants/types/errors defined:** None

**Corresponding test file:** None. No test file exists for `NetworkDetect` anywhere in the repository. No reference to `NetworkDetect` was found in any test directory.

---

### Findings

**Finding ID:** A03-2
**Severity:** HIGH
**File:** `NetworkDetect.java`
**Method:** `isNetworkConnected(Context)` — line 13
**Issue:** Method is entirely untested.

`isNetworkConnected` is the sole method of this class. It performs a real system service call (`ConnectivityManager`) and returns a boolean that is used throughout the application to gate network operations. No test exercises this method under any condition.

Missing coverage includes:
- Normal case: device is connected (returns `true`)
- Device is disconnected (returns `false`)
- `getActiveNetworkInfo()` returns `null` (the null-guard on line 17 is present but untested)

---

**Finding ID:** A03-3
**Severity:** MEDIUM
**File:** `NetworkDetect.java`
**Method:** `isNetworkConnected(Context)` — line 16
**Issue:** Null-dereference on `connMgr` is untested.

`context.getSystemService(Context.CONNECTIVITY_SERVICE)` can return `null` on certain devices or OS configurations. The result is cast and immediately dereferenced at line 16 (`connMgr.getActiveNetworkInfo()`) with no null check on `connMgr`. No test exercises this path. A `NullPointerException` would crash the calling code silently from the caller's perspective if `ConnectivityManager` is unavailable.

---

**Finding ID:** A03-4
**Severity:** MEDIUM
**File:** `NetworkDetect.java`
**Method:** `isNetworkConnected(Context)` — line 13
**Issue:** Null `Context` input path is untested.

If a caller passes `null` as the `context` argument, line 15 will throw a `NullPointerException`. There is no null guard on the parameter. No test exercises this boundary condition.

---

## File 2: CustomProgressDialog.java

### Reading Evidence

**Fully qualified class name:** `com.yy.libcommon.CustomProgressDialog`

**Superclass:** `com.yy.libcommon.BaseThemedDialog` (extends `BaseDialog`, which extends `DialogFragment`)

**Constants defined:**

| Name | Value | Line |
|------|-------|------|
| `TITLE` | `"TITLE"` | 17 |
| `DETAILS` | `"DETAILS"` | 18 |

**Fields:**

| Name | Type | Line |
|------|------|------|
| `mTitle` | `String` | 20 |
| `mDetails` | `String` | 21 |
| `mDetailsTextView` | `TextView` | 23 |

**Methods (with line numbers and signatures):**

| Line | Signature |
|------|-----------|
| 25 | `public CustomProgressDialog()` (constructor) |
| 30 | `@Override public void onCreate(Bundle savedInstanceState)` |
| 39 | `public static CustomProgressDialog newInstance(String title, String details)` |
| 52 | `@Override protected void setupViews()` |
| 77 | `public void updateText(String message)` |

**Corresponding test file:** None. No test file exists for `CustomProgressDialog` anywhere in the repository.

---

### Findings

**Finding ID:** A03-5
**Severity:** HIGH
**File:** `CustomProgressDialog.java`
**Method:** `newInstance(String, String)` — line 39
**Issue:** Static factory method is entirely untested.

`newInstance` is the primary construction path for this dialog, used throughout the application. No test verifies that:
- A valid `CustomProgressDialog` instance is returned
- Arguments are correctly stored in the `Bundle` under the expected keys (`"TITLE"`, `"DETAILS"`)
- The returned fragment can be re-hydrated correctly after a configuration change

---

**Finding ID:** A03-6
**Severity:** HIGH
**File:** `CustomProgressDialog.java`
**Method:** `setupViews()` — lines 52–75
**Issue:** Multi-branch view setup logic is entirely untested.

`setupViews` contains three distinct conditional branches affecting what is displayed:

1. Lines 60–64: If `mTitle != null`, use the provided title text; otherwise fall back to the string resource `R.string.loading`.
2. Lines 66–70: If `mDetails != null`, use the provided details text; otherwise fall back to `R.string.loading`.
3. Lines 72–74: If `mTitle == null` OR `mTitle.length() == 0`, the title view is hidden (`View.GONE`).

None of these branches is exercised by any test. Regressions in this logic would be invisible.

---

**Finding ID:** A03-7
**Severity:** MEDIUM
**File:** `CustomProgressDialog.java`
**Method:** `setupViews()` — line 72
**Issue:** Inconsistent null/empty check logic for title visibility is untested.

The title text is set at line 61 using `mTitle != null` as the guard, but the title view visibility is controlled at line 72 using `mTitle == null || mTitle.length() == 0`. These two conditions are not equivalent: an empty string (`""`) passes the null check at line 61 and causes `setTitleText("")` to be called, but the visibility check at line 72 then hides the title bar anyway. No test exercises the empty-string boundary condition that exposes this inconsistency.

---

**Finding ID:** A03-8
**Severity:** MEDIUM
**File:** `CustomProgressDialog.java`
**Method:** `updateText(String)` — line 77
**Issue:** `updateText` is entirely untested, including its guard conditions.

`updateText` contains two guards: `mDetailsTextView != null` and `isResumed()`. No test verifies:
- The message is applied when the view is inflated and the fragment is resumed
- The method is silently a no-op when the view is null (before `setupViews` runs)
- The method is silently a no-op when the fragment is not resumed (paused/stopped)
- A null `message` argument is passed (would propagate to `TextView.setText(null)`, which is legal but unchecked by callers)

---

**Finding ID:** A03-9
**Severity:** LOW
**File:** `CustomProgressDialog.java`
**Method:** `onCreate(Bundle)` — line 30
**Issue:** Argument extraction from Bundle is untested.

`onCreate` reads `mTitle` and `mDetails` from arguments only when `getArguments() != null`. No test verifies the case where `getArguments()` returns `null` (e.g., the no-argument constructor is used directly without `newInstance`), ensuring the dialog degrades gracefully rather than displaying uninitialized state.

---

## File 3: DrawingView.java

### Reading Evidence

**Fully qualified class name:** `com.yy.libcommon.DrawingView`

**Superclass:** `android.view.View`

**Fields:**

| Name | Type | Visibility | Line |
|------|------|------------|------|
| `drawPath` | `Path` | private | 20 |
| `drawPaint` | `Paint` | private | 21 |
| `canvasPaint` | `Paint` | private | 21 |
| `paintColor` | `int` | private | 22 |
| `drawCanvas` | `Canvas` | private | 23 |
| `canvasBitmap` | `Bitmap` | public | 24 |
| `mWidth` | `int` | private | 25 |
| `mHeight` | `int` | private | 26 |
| `hasBeenDrawnOn` | `boolean` | private | 27 |
| `hasImage` | `boolean` | private | 28 |

**Methods (with line numbers and signatures):**

| Line | Signature |
|------|-----------|
| 30 | `public DrawingView(Context context, AttributeSet attrs)` (constructor) |
| 35 | `private void setupDrawing()` |
| 51 | `@Override protected void onSizeChanged(int w, int h, int oldw, int oldh)` |
| 64 | `public boolean hasBeenDrawnOn()` |
| 68 | `public boolean hasImage()` |
| 72 | `@Override protected void onDraw(Canvas canvas)` |
| 78 | `public void clear()` |
| 85 | `public void setImageBitmap(Bitmap bitmap)` |
| 109 | `public void save()` |
| 113 | `@Override public boolean onTouchEvent(MotionEvent event)` |

**Constants/errors defined:** None (paintColor default value `0xFF000000` is an inline literal, not a named constant)

**Corresponding test file:** None. No test file exists for `DrawingView` anywhere in the repository.

---

### Findings

**Finding ID:** A03-10
**Severity:** HIGH
**File:** `DrawingView.java`
**Method:** `setImageBitmap(Bitmap)` — lines 85–107
**Issue:** Null-dereference crash on null `bitmap` argument is untested.

At line 87, `bitmap != null` is checked before setting `hasImage = true`. However, at line 91, `bitmap.copy(...)` is called unconditionally — outside and after the null guard. If `bitmap` is `null`, the null check at line 87 is silently bypassed and line 91 throws a `NullPointerException`. The method will crash rather than behave defensively. No test exercises a null bitmap input, so this defect is undetected.

---

**Finding ID:** A03-11
**Severity:** HIGH
**File:** `DrawingView.java`
**Method:** `onDraw(Canvas)` — line 72
**Issue:** `onDraw` called before `onSizeChanged` results in a `NullPointerException` on `canvasBitmap`.

`canvasBitmap` is initialized in `onSizeChanged` (line 58). `onDraw` at line 74 dereferences `canvasBitmap` without a null check. In the View lifecycle, `onDraw` can be triggered before `onSizeChanged` completes (e.g., if `invalidate()` is called during construction or before layout). No test exercises this lifecycle ordering, leaving the crash path undetected.

---

**Finding ID:** A03-12
**Severity:** HIGH
**File:** `DrawingView.java`
**Method:** `onTouchEvent(MotionEvent)` — lines 113–140
**Issue:** Touch event handling is entirely untested.

`onTouchEvent` handles `ACTION_DOWN`, `ACTION_MOVE`, and `ACTION_UP`. No test verifies:
- `ACTION_DOWN` moves the path origin and sets `hasBeenDrawnOn = true`
- `ACTION_MOVE` extends the path and sets `hasBeenDrawnOn = true`
- `ACTION_UP` commits the path to the canvas, resets the path, and sets `hasBeenDrawnOn = true`
- Any unrecognized action returns `false` (line 134) without modifying state
- Multiple sequential touch events produce the correct cumulative path

---

**Finding ID:** A03-13
**Severity:** HIGH
**File:** `DrawingView.java`
**Method:** `clear()` — lines 78–83
**Issue:** `clear()` called before `onSizeChanged` will crash.

`clear()` at line 80 calls `Bitmap.createBitmap(mWidth, mHeight, ...)`. If `onSizeChanged` has not yet run, `mWidth` and `mHeight` are both `0`. `Bitmap.createBitmap(0, 0, ...)` throws an `IllegalArgumentException` ("width and height must be > 0"). Additionally, `drawCanvas` at line 79 may be null if `onSizeChanged` has not executed. No test exercises this call ordering.

---

**Finding ID:** A03-14
**Severity:** MEDIUM
**File:** `DrawingView.java`
**Method:** `onSizeChanged(int, int, int, int)` — lines 51–62
**Issue:** Zero-dimension resize (w=0 or h=0) is untested.

`onSizeChanged` is called by the Android framework when the view's dimensions change, including during view recycling and certain layout transitions where width or height can be zero. `Bitmap.createBitmap(0, h, ...)` and `Bitmap.createBitmap(w, 0, ...)` both throw `IllegalArgumentException`. No test exercises zero-dimension inputs.

---

**Finding ID:** A03-15
**Severity:** MEDIUM
**File:** `DrawingView.java`
**Method:** `save()` — lines 109–111
**Issue:** `save()` is a no-op stub with no implementation and no test.

The `save()` method has an empty body. If callers rely on this method to persist drawing state, data loss will occur silently. No test verifies either: (a) that the method correctly saves state, or (b) that callers handle the no-op gracefully. The presence of this stub without implementation or a `TODO` comment indicating intentional deferral is a reliability gap.

---

**Finding ID:** A03-16
**Severity:** MEDIUM
**File:** `DrawingView.java`
**Method:** `setImageBitmap(Bitmap)` — line 91
**Issue:** `bitmap.getConfig()` may return null, causing a crash in `bitmap.copy()`.

`Bitmap.getConfig()` returns `null` for bitmaps loaded from hardware-accelerated sources (e.g., `HARDWARE` config on API 26+). Passing `null` as the config argument to `Bitmap.copy(null, true)` throws a `NullPointerException`. No test exercises this path with a bitmap whose config is null.

---

**Finding ID:** A03-17
**Severity:** LOW
**File:** `DrawingView.java`
**Field:** `canvasBitmap` — line 24
**Issue:** `canvasBitmap` is `public` — mutation by external code is untested.

`canvasBitmap` is declared `public`, allowing any external class to replace or recycle it. If an external caller sets `canvasBitmap = null` or recycles it while `onDraw` or `clear()` is in progress, a crash or visual corruption results. No test verifies that external mutation is handled safely or that the field's public exposure is intentional.

---

**Finding ID:** A03-18
**Severity:** LOW
**File:** `DrawingView.java`
**Methods:** `hasBeenDrawnOn()` (line 64), `hasImage()` (line 68)
**Issue:** State accessor methods are entirely untested.

These two accessors return the values of `hasBeenDrawnOn` and `hasImage`. No test verifies:
- `hasBeenDrawnOn()` returns `false` before any touch event
- `hasBeenDrawnOn()` returns `true` after `ACTION_DOWN`, `ACTION_MOVE`, or `ACTION_UP`
- `hasImage()` returns `false` before `setImageBitmap` is called with a non-null bitmap
- `hasImage()` returns `true` after a valid `setImageBitmap` call
- `hasBeenDrawnOn` is NOT reset by `clear()` (it is not reset in the current implementation — this may be a defect, but cannot be confirmed without a test specifying the intended contract)

---

## Summary Table

| ID | Severity | File | Method / Scope | Issue |
|----|----------|------|----------------|-------|
| A03-1 | HIGH | Project-wide | `app/`, `LibCommon/` | Zero automated test coverage in both modules |
| A03-2 | HIGH | NetworkDetect.java | `isNetworkConnected` | Method entirely untested |
| A03-3 | MEDIUM | NetworkDetect.java | `isNetworkConnected` | `connMgr` null-dereference path untested |
| A03-4 | MEDIUM | NetworkDetect.java | `isNetworkConnected` | Null `Context` argument path untested |
| A03-5 | HIGH | CustomProgressDialog.java | `newInstance` | Static factory entirely untested |
| A03-6 | HIGH | CustomProgressDialog.java | `setupViews` | All three conditional display branches untested |
| A03-7 | MEDIUM | CustomProgressDialog.java | `setupViews` | Empty-string title inconsistency untested |
| A03-8 | MEDIUM | CustomProgressDialog.java | `updateText` | Method and all guard conditions untested |
| A03-9 | LOW | CustomProgressDialog.java | `onCreate` | Null-arguments degradation path untested |
| A03-10 | HIGH | DrawingView.java | `setImageBitmap` | Null bitmap crashes past null guard |
| A03-11 | HIGH | DrawingView.java | `onDraw` | Null `canvasBitmap` before `onSizeChanged` untested |
| A03-12 | HIGH | DrawingView.java | `onTouchEvent` | Touch event handling entirely untested |
| A03-13 | HIGH | DrawingView.java | `clear` | Called before `onSizeChanged` causes crash, untested |
| A03-14 | MEDIUM | DrawingView.java | `onSizeChanged` | Zero-dimension inputs crash path untested |
| A03-15 | MEDIUM | DrawingView.java | `save` | No-op stub with no implementation or test |
| A03-16 | MEDIUM | DrawingView.java | `setImageBitmap` | Null `getConfig()` crash path untested |
| A03-17 | LOW | DrawingView.java | `canvasBitmap` (field) | Public field allows unsafe external mutation, untested |
| A03-18 | LOW | DrawingView.java | `hasBeenDrawnOn`, `hasImage` | State accessors untested; reset contract for `clear()` unverified |
