# Audit Pass 2 — Agent A22
**Audit run:** 2026-02-26-01
**Agent:** A22
**Date:** 2026-02-27

## Assigned Files

1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/EquipmentTypeItem.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/EqupmentUsageItem.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/FuelTypeItem.java`

---

## Project-Wide Finding

### A22-1 — HIGH: Zero automated test coverage in `app/` and `LibCommon/` modules

**Severity:** HIGH

The `app/` module and `LibCommon/` module contain no test directories whatsoever. A glob for `**/test/**/*.java` across the entire repository returned only two test files, both inside `LibImageloader/` (a third-party image loading library). No unit tests, no integration tests, and no instrumented tests exist for any production code in `app/` or `LibCommon/`.

This is a project-wide condition. Every class in these modules — including all web service DTOs, fragments, activities, and business logic — is untested. Regressions introduced by any future change cannot be caught automatically.

**Evidence:**
- `LibImageloader/src/test/java/.../ImageSizeTest.java` — third-party library only
- `LibImageloader/src/test/java/.../BaseImageDownloaderTest.java` — third-party library only
- No other test files found anywhere in the repository

---

## Reading Evidence

### File 1: `EquipmentTypeItem.java`

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.EquipmentTypeItem`

**Implements:** `java.io.Serializable`

**Fields defined:**

| Field | Type | Visibility | Line |
|-------|------|------------|------|
| `id` | `int` | `public` | 14 |
| `name` | `String` | `public` | 15 |
| `url` | `String` | `public` | 16 |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 18 | `public EquipmentTypeItem()` — no-arg constructor |
| 21 | `public EquipmentTypeItem(JSONObject jsonObject) throws JSONException` — JSON-deserialising constructor |

**JSON parsing logic (lines 22–41):**
- Guards on `jsonObject != null`
- Guards each field with `!jsonObject.isNull(key)` before reading
- Reads `id` via `getInt("id")`
- Reads `name` via `getString("name")`
- Reads `url` via `getString("url")` — value assigned without any scheme, host, or safety validation

**Test files found:** None. A grep across the entire repository for `EquipmentTypeItem` returned only production source files.

---

### File 2: `EqupmentUsageItem.java`

**Note:** The class name contains a typo — `EqupmentUsageItem` (missing the 'i' in "Equipment"). This matches the filename exactly.

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.EqupmentUsageItem`

**Implements:** `java.io.Serializable`

**Fields defined:**

| Field | Type | Visibility | Line |
|-------|------|------------|------|
| `time` | `String` | `public` | 14 |
| `usage` | `double` | `public` | 15 |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 17 | `public EqupmentUsageItem()` — no-arg constructor |
| 20 | `public EqupmentUsageItem(JSONObject jsonObject) throws JSONException` — JSON-deserialising constructor |

**JSON parsing logic (lines 21–35):**
- Guards on `jsonObject != null`
- Guards each field with `!jsonObject.isNull(key)` before reading
- Reads `time` via `getString("time")`
- Reads `usage` via `getDouble("usage")`

**Test files found:** None. A grep across the entire repository for `EqupmentUsageItem` returned only production source files.

---

### File 3: `FuelTypeItem.java`

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.FuelTypeItem`

**Implements:** `java.io.Serializable`

**Fields defined:**

| Field | Type | Visibility | Line |
|-------|------|------------|------|
| `id` | `int` | `public` | 14 |
| `name` | `String` | `public` | 15 |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 17 | `public FuelTypeItem()` — no-arg constructor |
| 20 | `public FuelTypeItem(JSONObject jsonObject) throws JSONException` — JSON-deserialising constructor |

**JSON parsing logic (lines 21–35):**
- Guards on `jsonObject != null`
- Guards each field with `!jsonObject.isNull(key)` before reading
- Reads `id` via `getInt("id")`
- Reads `name` via `getString("name")`

**Test files found:** None. A grep across the entire repository for `FuelTypeItem` returned only production source files.

---

## File-Specific Findings

### A22-2 — MEDIUM: `EquipmentTypeItem.url` is populated from server JSON with no safety validation

**File:** `EquipmentTypeItem.java`
**Lines:** 36–39

```java
if (!jsonObject.isNull("url"))
{
    url = jsonObject.getString("url");
}
```

The `url` field is assigned the raw string value returned by the server with no validation of any kind. No test exists that verifies what happens when the server returns a malformed URL, a non-HTTPS URL, a `javascript:` scheme, a `file://` scheme, or an excessively long string. Because the field is `public` with no accessor control, any consumer of `EquipmentTypeItem` can read and act on this value without knowing it was never validated. If this URL is ever loaded into a `WebView` or passed to an `Intent`, an unsafe value from the server (or from a compromised server response) could be acted upon directly.

**Untested conditions:**
- `url` field contains `null` after a JSON payload where the key is present but the value is JSON null (currently `isNull` check prevents assignment, so `url` stays `null` — callers must null-check, but this is untested)
- `url` field contains an empty string `""`
- `url` field contains a non-HTTP scheme such as `javascript:alert(1)` or `file:///data/data/...`
- `url` field contains an extremely long string
- `url` field contains a relative path rather than an absolute URL

---

### A22-3 — LOW: `EquipmentTypeItem(JSONObject)` — no test exercises the null-`jsonObject` guard

**File:** `EquipmentTypeItem.java`
**Line:** 23

```java
if (jsonObject != null)
```

The constructor silently succeeds when passed `null`, leaving all fields at their Java defaults (`id = 0`, `name = null`, `url = null`). No test verifies this behaviour. A caller relying on `name` or `id` being populated after constructing with a null `JSONObject` would silently receive zero/null without any indication of failure. The same gap exists in `EqupmentUsageItem` (A22-5) and `FuelTypeItem` (A22-7).

**Untested conditions:**
- `new EquipmentTypeItem(null)` — all fields remain default
- `new EquipmentTypeItem(new JSONObject("{}"))` — all fields remain default because no keys are present

---

### A22-4 — LOW: `EquipmentTypeItem` — no test exercises the JSON-deserialising constructor for the happy path

**File:** `EquipmentTypeItem.java`
**Lines:** 21–41

The JSON-deserialising constructor `EquipmentTypeItem(JSONObject)` is the primary mechanism by which server data is materialised into application state. It is completely untested. No test exercises the path where a well-formed JSON object with all three keys (`id`, `name`, `url`) is supplied and the resulting fields are verified.

**Untested methods:**
- `EquipmentTypeItem(JSONObject)` — all paths untested

---

### A22-5 — LOW: `EqupmentUsageItem(JSONObject)` — no test exercises the null-`jsonObject` guard or happy path

**File:** `EqupmentUsageItem.java`
**Lines:** 21–35

Identical structural gap to A22-3. Passing `null` silently produces a zero-initialised object (`time = null`, `usage = 0.0`). The `usage` field is a `double`; a default of `0.0` is an arithmetically valid and plausible usage value, making silent data loss particularly difficult to detect in production without tests.

**Untested conditions:**
- `new EqupmentUsageItem(null)` — all fields remain default
- `new EqupmentUsageItem(new JSONObject("{}"))` — all fields remain default
- `usage` field populated with a negative double (e.g., `-1.0`) — no test confirms whether callers accept or reject negative usage
- `usage` field populated with `Double.MAX_VALUE` or `Double.NaN` — JSON `getDouble` does not guard against these

---

### A22-6 — LOW: `FuelTypeItem(JSONObject)` — no test exercises the null-`jsonObject` guard or happy path

**File:** `FuelTypeItem.java`
**Lines:** 20–35

Identical structural gap to A22-3. Passing `null` silently produces `id = 0`, `name = null`. An `id` of `0` is indistinguishable from a legitimately zero-valued `id`, creating potential silent failures downstream.

**Untested conditions:**
- `new FuelTypeItem(null)` — all fields remain default
- `new FuelTypeItem(new JSONObject("{}"))` — all fields remain default
- `id` field populated with a negative integer

---

### A22-7 — INFO: Typo in class name `EqupmentUsageItem` (missing 'i' in "Equipment")

**File:** `EqupmentUsageItem.java`
**Line:** 12

```java
public class EqupmentUsageItem implements Serializable
```

The class name `EqupmentUsageItem` is a misspelling of `EquipmentUsageItem`. This is perpetuated throughout the codebase because the filename matches the class name. Renaming would require updating all call sites. No test exists that would catch a future accidental rename to the correct spelling breaking serialisation compatibility (the class implements `Serializable` without a `serialVersionUID`, which compounds this).

---

### A22-8 — INFO: No `serialVersionUID` declared in any of the three DTO classes

**Files:** `EquipmentTypeItem.java` (line 12), `EqupmentUsageItem.java` (line 12), `FuelTypeItem.java` (line 12)

All three classes implement `java.io.Serializable` but none declare a `private static final long serialVersionUID`. The JVM will compute one at runtime based on class structure. If any field is added, removed, or renamed, the auto-generated UID changes, making previously serialised instances unreadable (e.g., from `Bundle`, `Intent` extras, or on-disk caches). No test validates serialisation round-trip behaviour for any of these classes.

---

## Summary Table

| ID | Severity | File | Description |
|----|----------|------|-------------|
| A22-1 | HIGH | Project-wide | Zero automated test coverage in `app/` and `LibCommon/` |
| A22-2 | MEDIUM | `EquipmentTypeItem.java` | `url` field populated from server with no scheme/safety validation |
| A22-3 | LOW | `EquipmentTypeItem.java` | Null-JSONObject guard untested; silent default field values |
| A22-4 | LOW | `EquipmentTypeItem.java` | JSON-deserialising constructor entirely untested |
| A22-5 | LOW | `EqupmentUsageItem.java` | Null guard and happy path untested; `0.0` default indistinguishable from real data |
| A22-6 | LOW | `FuelTypeItem.java` | Null guard and happy path untested; `0` default for `id` indistinguishable from real data |
| A22-7 | INFO | `EqupmentUsageItem.java` | Class name typo: `EqupmentUsageItem` should be `EquipmentUsageItem` |
| A22-8 | INFO | All three files | `Serializable` without `serialVersionUID` — no round-trip serialisation test |
