# Audit Pass 2 – Test Coverage
**Agent:** A20
**Audit run:** 2026-02-26-01
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/WebRequest.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/WebResult.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/AnswerItem.java`

---

## Project-Wide Finding

### A20-1 [HIGH] – Zero automated test coverage across app/ and LibCommon/ modules

The `app/` module has no `test/` or `androidTest/` directory under `app/src/`. The `LibCommon/` module likewise has no `test/` or `androidTest/` directory under `LibCommon/src/`. A broad filesystem search of the repository confirms that only third-party library modules (`LibImageloader`, `LibImagePicker`, `LibPercentProgress`) carry any test directories, and those contain only stub `ApplicationTest` scaffolding.

All production code in the two primary modules — including all networking, authentication, session management, data persistence, and UI presentation logic — has zero automated test coverage. Every finding below in this report is a direct consequence of this project-wide gap.

**Evidence of no test directories:**
- `app/src/` contains only `main/`; no `test/` or `androidTest/` subdirectory exists.
- `LibCommon/src/` contains only `main/`; no `test/` or `androidTest/` subdirectory exists.
- Grep across the entire repository for `WebRequest`, `WebResult`, and `AnswerItem` in any `*Test*.java` file returns zero results.

---

## File 1: WebRequest.java

**Full path:** `/c/Projects/cig-audit/repos/forkliftiqapp/app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/WebRequest.java`

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.WebRequest<T>`

**Superclass:** `com.android.volley.Request<T>`

**Constants defined:**
| Name | Line | Value |
|------|------|-------|
| `WEBREQUEST_TIMEOUT_MS` | 46 | `30 * 1000` (int, public static final) |
| `PROTOCOL_CHARSET` | 60 | `"utf-8"` (String, static final) |
| `PROTOCOL_CONTENT_TYPE` | 63 | `"application/json; charset=utf-8"` (String, static final) |

**Fields:**
| Name | Line | Type/Visibility |
|------|------|-----------------|
| `mHttpClient` | 47 | `HttpClient` (package-private) |
| `mPriority` | 48 | `Priority` (private) |
| `webClazz` | 49 | `Class<T>` (final, package-private) |
| `webHeaders` | 50 | `Map<String,String>` (final, package-private) |
| `msgId` | 51 | `String` (package-private) |
| `mUrlItem` | 52 | `UrlItem` (package-private) |
| `canceledByUser` | 53 | `boolean` (package-private) |
| `mRequestBody` | 54 | `String` (package-private) |
| `webListener` | 55 | `WebListener<T>` (package-private) |
| `cTimer` | 56 | `CountDownTimer` (package-private) |
| `isTimerRunning` | 57 | `boolean` (package-private) |
| `isAuthMessage` | 65 | `boolean` (package-private) |

**Methods defined:**
| Line | Signature |
|------|-----------|
| 68 | `public void cancel()` |
| 75 | `public void setPriority(Priority priority)` |
| 79 | `public Request.Priority getPriority()` |
| 84 | `public void setHttpClient(HttpClient httpClient)` |
| 89 | `protected Response<T> parseNetworkResponse(NetworkResponse networkResponse)` |
| 111 | `public String getPostBodyContentType()` (deprecated) |
| 119 | `public byte[] getPostBody()` (deprecated) |
| 124 | `public String getBodyContentType()` |
| 129 | `public byte[] getBody()` |
| 143 | `public WebRequest(UrlItem urlItem, WebServiceParameterPacket parameter, Class<T> clazz, WebListener<T> listener)` (constructor 1) |
| 172 | `String getMsgId(String url)` |
| 176 | `public WebRequest(UrlItem urlItem, String requestBody, boolean authMessage, Class<T> clazz, WebListener<T> listener)` (constructor 2) |
| 188 | `public Map<String,String> getHeaders()` |
| 192 | `public String getMsgId()` |
| 197 | `public void onSucceed(T response)` |
| 211 | `public void onConnectFailed(VolleyError volleyError)` |
| 227 | `void removeRequest()` |
| 233 | `private void onRequestFailed(VolleyError volleyError)` |
| 239 | `public void onRequestFailed(WebResult webResult)` |
| 246 | `boolean ignoreResponse(T response)` |
| 255 | `protected void deliverResponse(T response)` |
| 263 | `public void deliverError(VolleyError error)` |
| 274 | `public WebRequest<T> update()` |

---

### Findings for WebRequest.java

---

#### A20-2 [HIGH] – No test file exists for WebRequest

There is no corresponding test class (e.g., `WebRequestTest.java`) anywhere in the repository. `WebRequest` is the core HTTP request abstraction used by every API call the application makes — it manages request bodies, authentication headers, timeout handling, retry-on-auth-failure, and success/failure dispatch. None of this logic is exercised by any automated test.

---

#### A20-3 [HIGH] – Timer-cancel NPE path in `onSucceed` is untested (line 197–209)

`onSucceed` calls `cTimer.cancel()` when `isTimerRunning` is true (line 200). When the second constructor (line 176) is used, `cTimer` is never assigned — it remains `null` (field initialised to `null` at line 56). If `isTimerRunning` were somehow `true` in that path, calling `cTimer.cancel()` would produce a `NullPointerException`. No test verifies that the second constructor path is safe when `onSucceed` fires.

---

#### A20-4 [HIGH] – `onConnectFailed` dereferences `volleyError.networkResponse` without null-guard, untested (line 218)

At line 218 the condition short-circuits on `volleyError` being non-null, but then immediately accesses `volleyError.networkResponse` in the same compound expression. If `volleyError` is non-null but `volleyError.networkResponse` is null (a common Volley scenario for timeout or no-network errors), the condition evaluates to `false` and falls through to `onRequestFailed` — which is the correct fallback. However, the private overload `onRequestFailed(VolleyError)` (line 233) is called from `CountDownTimer.onFinish()` with a literal `null` (line 165). That path is never tested: `onRequestFailed(null)` constructs a `WebResult`, assigns `null` to `webResult.volleyError`, and calls the public `onRequestFailed(WebResult)`. Callers of `onRequestFailed(WebResult)` that then call `webResult.getStatusCode()` or `webResult.isBadGateway()` will handle `null` volleyError correctly per `WebResult`'s own guards, but the end-to-end timeout-triggered failure path has no test coverage.

---

#### A20-5 [HIGH] – `parseNetworkResponse` ignores response body and always constructs empty T (line 89–105)

`parseNetworkResponse` calls `webClazz.newInstance()` and returns an empty default-constructed object. The actual `NetworkResponse` body is never deserialized. This means every successful HTTP response is silently discarded and callers receive an empty object. No test verifies that response data is (or is not) propagated. The severity is HIGH because silent data loss in the network layer can mask bugs across all API calls.

---

#### A20-6 [HIGH] – `getMsgId(String url)` at line 172 is unreachable dead code, untested

The method `getMsgId(String url)` at line 172 (package-private, takes a `String` parameter) is never called anywhere in the file. Both constructors call the no-arg `getMsgId()` at line 192, which returns the already-assigned `msgId` field — returning `null` for constructor 1 because `msgId` is set from the return of `getMsgId()` in a circular self-assignment (line 152 calls `getMsgId()` before `msgId` is set, so it returns `null`). The parameterised overload is dead code. No test covers either the dead overload or the null-returning circular call.

---

#### A20-7 [MEDIUM] – Constructor 1 `msgId` is always null due to self-referential call (line 152)

In constructor 1 (line 143), the sequence is:

```java
msgId = getMsgId();  // line 152 — calls getMsgId() which returns this.msgId (null at this point)
```

`getMsgId()` at line 192 returns the field `msgId`, which has not yet been assigned. So `msgId` is set to `null`. The intended ID generation logic is in `getMsgId(String url)` (line 172), which is never called. No test catches this null-assignment bug.

---

#### A20-8 [MEDIUM] – `getBody()` returns null silently on `UnsupportedEncodingException` (line 129–141)

When `UnsupportedEncodingException` is thrown, `getBody()` logs a warning via `VolleyLog.wtf` and returns `null`. The Volley framework treats a null body as an empty POST body, which may corrupt API calls that require a JSON payload. No test exercises this exception path or verifies the fallback behaviour.

---

#### A20-9 [MEDIUM] – `update()` method discards POST/GET distinction without acting (line 274–283)

The `update()` method contains a switch on `mUrlItem.method` with empty `POST` and `GET` cases and a comment claiming it updates token/session, but it does neither. It simply constructs a new `WebRequest` from stored fields. No test verifies that `update()` produces a correctly re-authenticated request, nor does any test catch the fact that the switch body is a no-op.

---

#### A20-10 [MEDIUM] – `cancel()` sets `canceledByUser` but does not stop the `CountDownTimer` (line 68–72)

`cancel()` calls `super.cancel()` and sets `canceledByUser = true` but does not cancel `cTimer`. The timer will continue to fire `onFinish()` after the user cancels, calling `onRequestFailed(null)` and potentially dispatching a failure callback to a listener that the caller believes has been cancelled. No test verifies timer lifecycle on user-initiated cancel.

---

#### A20-11 [MEDIUM] – `ignoreResponse` only checks `canceledByUser`, no test for other suppression scenarios (line 246–252)

`ignoreResponse` always returns `false` unless `canceledByUser` is true. No test exercises: (a) the `canceledByUser == true` branch, (b) whether `deliverResponse` correctly short-circuits in that case, or (c) whether `onSucceed` would be re-entered after cancel if the timer fires.

---

#### A20-12 [LOW] – Deprecated methods `getPostBodyContentType` and `getPostBody` are untested (lines 111, 119)

Both deprecated methods delegate to their non-deprecated counterparts. While the delegation is trivially correct, no test documents the expected delegation behaviour or guards against future refactoring breaking the delegation.

---

#### A20-13 [LOW] – `setPriority`/`getPriority` are untested (lines 75, 79)

These accessors have no test coverage. `mPriority` defaults to `NORMAL` and there is no test that verifies setting a different priority is reflected by `getPriority` or that Volley respects it.

---

#### A20-14 [LOW] – `setHttpClient`/`removeRequest` are untested (lines 84, 227)

`setHttpClient` has no test. `removeRequest` is package-private with no test. Their interaction — specifically whether `removeRequest` is safe when `mHttpClient` is null — is only guarded by a null check with no test confirming that guard is exercised.

---

## File 2: WebResult.java

**Full path:** `/c/Projects/cig-audit/repos/forkliftiqapp/app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/WebResult.java`

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.WebResult`

**Fields:**
| Name | Line | Type/Visibility |
|------|------|-----------------|
| `volleyError` | 12 | `VolleyError` (public) |

**Methods defined:**
| Line | Signature |
|------|-----------|
| 14 | `public boolean isBadGateway()` |
| 21 | `public int getStatusCode()` |

**Constants/types defined:** None beyond the class itself.

---

### Findings for WebResult.java

---

#### A20-15 [MEDIUM] – No test file exists for WebResult; all logic paths untested

There is no `WebResultTest.java` or equivalent anywhere in the repository. Although `WebResult` is a small class, it encodes the contract for error-result interpretation used throughout the app's failure-handling paths.

---

#### A20-16 [MEDIUM] – `isBadGateway()` has three distinct logical paths, none tested (line 14–19)

Three paths exist:
1. `volleyError == null` → returns `false`
2. `volleyError != null` but `volleyError.networkResponse == null` → returns `false`
3. `volleyError != null`, `networkResponse != null`, `statusCode == 502` → returns `true`
4. `volleyError != null`, `networkResponse != null`, `statusCode != 502` → returns `false`

No test exercises any of these paths.

---

#### A20-17 [MEDIUM] – `getStatusCode()` returns 0 as sentinel for both null-error and null-networkResponse, untested (line 21–27)

`getStatusCode()` returns `0` when `volleyError` is null, and also returns `0` when `volleyError` is non-null but `networkResponse` is null. These two distinct error conditions are conflated into a single sentinel value. No test documents or verifies this behaviour, and no test checks whether callers can distinguish a connectivity failure from a missing volleyError.

---

#### A20-18 [LOW] – Public mutable field `volleyError` is not validated, untested

`volleyError` is a public non-final field with no setter validation. Any caller can set it to any value after construction. No test verifies that `isBadGateway()` and `getStatusCode()` remain consistent after mutation.

---

## File 3: AnswerItem.java

**Full path:** `/c/Projects/cig-audit/repos/forkliftiqapp/app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/AnswerItem.java`

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.AnswerItem`

**Interfaces implemented:** `java.io.Serializable`

**Fields:**
| Name | Line | Type/Visibility |
|------|------|-----------------|
| `question_id` | 14 | `int` (public) |
| `answer` | 15 | `String` (public) |

**Methods defined:**
| Line | Signature |
|------|-----------|
| 17 | `public AnswerItem()` (no-arg constructor) |
| 20 | `public AnswerItem(JSONObject jsonObject) throws JSONException` (JSON constructor) |

**Constants/types defined:** None.

**Unused imports identified:**
- `java.util.ArrayList` (line 7) — unused
- `java.math.BigDecimal` (line 8) — unused
- `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.*` (line 9) — self-referential wildcard, unused
- `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.*` (line 10) — unused

---

### Findings for AnswerItem.java

---

#### A20-19 [LOW] – No test file exists for AnswerItem; JSON constructor paths untested

There is no `AnswerItemTest.java` or equivalent. While this is a simple DTO, the JSON-parsing constructor contains branching logic that deserves test coverage.

---

#### A20-20 [LOW] – JSON constructor null-JSONObject path is untested (line 22)

The outer `if (jsonObject != null)` guard at line 22 silently leaves `question_id` at `0` and `answer` at `null` when a `null` JSONObject is passed. No test verifies this no-op behaviour or documents it as intentional. Callers relying on `question_id > 0` to distinguish a valid answer from an uninitialised one would be affected.

---

#### A20-21 [LOW] – JSON constructor field-null checks are untested (lines 25, 31)

The `isNull("question_id")` and `isNull("answer")` guards leave fields at their defaults (`0` and `null`) when keys are null or absent. No test covers:
- JSON object where `"question_id"` is present but JSON-null
- JSON object where `"answer"` is present but JSON-null
- JSON object where neither key is present
- JSON object where both keys are present with valid values

---

#### A20-22 [LOW] – `AnswerItem` is `Serializable` but has no `serialVersionUID`, untested

`AnswerItem` implements `Serializable` without declaring a `serialVersionUID`. This causes the JVM to compute one from the class structure, which will change whenever the class is modified, potentially breaking any persisted serialized form. No test verifies serialization round-trip behaviour.

---

#### A20-23 [INFO] – Unused imports should be removed from AnswerItem.java (lines 7–10)

Four imports are unused: `ArrayList`, `BigDecimal`, the self-package wildcard, and the `results` subpackage wildcard. These are likely remnants from code generation. While not a test-coverage gap, they suggest the file was auto-generated and never reviewed.

---

## Summary Table

| ID | Severity | File | Description |
|----|----------|------|-------------|
| A20-1 | HIGH | Project-wide | Zero automated tests in app/ and LibCommon/ modules |
| A20-2 | HIGH | WebRequest | No test file exists for WebRequest |
| A20-3 | HIGH | WebRequest | Null `cTimer` NPE path in `onSucceed` when using constructor 2, untested |
| A20-4 | HIGH | WebRequest | Timer-triggered `onRequestFailed(null)` path is untested end-to-end |
| A20-5 | HIGH | WebRequest | `parseNetworkResponse` silently ignores response body; data loss undetected |
| A20-6 | HIGH | WebRequest | Dead code overload `getMsgId(String)` never called; unreachable, untested |
| A20-7 | MEDIUM | WebRequest | `msgId` always null due to circular self-referential call in constructor 1 |
| A20-8 | MEDIUM | WebRequest | `getBody()` silently returns null on encoding exception, untested |
| A20-9 | MEDIUM | WebRequest | `update()` switch is a no-op; claimed token-refresh behaviour absent, untested |
| A20-10 | MEDIUM | WebRequest | `cancel()` does not stop CountDownTimer; timer fires after cancel, untested |
| A20-11 | MEDIUM | WebRequest | `ignoreResponse` cancel-path and re-entry after cancel untested |
| A20-12 | LOW | WebRequest | Deprecated delegation methods untested |
| A20-13 | LOW | WebRequest | `setPriority`/`getPriority` accessors untested |
| A20-14 | LOW | WebRequest | `setHttpClient`/`removeRequest` interaction untested |
| A20-15 | MEDIUM | WebResult | No test file exists for WebResult |
| A20-16 | MEDIUM | WebResult | `isBadGateway()` four logical paths all untested |
| A20-17 | MEDIUM | WebResult | `getStatusCode()` sentinel 0 conflates null-error and null-response, untested |
| A20-18 | LOW | WebResult | Public mutable `volleyError` field consistency untested |
| A20-19 | LOW | AnswerItem | No test file exists for AnswerItem |
| A20-20 | LOW | AnswerItem | Null JSONObject path leaves fields at defaults, untested |
| A20-21 | LOW | AnswerItem | JSON-null and absent-key field paths untested |
| A20-22 | LOW | AnswerItem | `Serializable` without `serialVersionUID`, serialization untested |
| A20-23 | INFO | AnswerItem | Four unused imports suggest unreviewed code generation |
