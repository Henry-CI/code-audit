# Audit Pass 2 — Agent A35
**Audit run:** 2026-02-26-01
**Agent:** A35
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/UserRegisterParameter.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/CommonResult.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/EquipmentStatsResultArray.java`

---

## Project-Wide Finding: Zero Automated Test Coverage

**Finding ID:** A35-1
**Severity:** HIGH
**Scope:** Project-wide (app/ and LibCommon/ modules)

The `app/` module contains no `src/test/` or `src/androidTest/` directory. The `LibCommon/` module likewise contains no test directory. The only test files found in the entire repository are confined to the unrelated `LibImageloader/` library module:

- `LibImageloader/src/test/java/com/nostra13/universalimageloader/core/assist/ImageSizeTest.java`
- `LibImageloader/src/test/java/com/nostra13/universalimageloader/core/download/BaseImageDownloaderTest.java`

Zero automated test coverage exists for all application code, including all web service parameter and result classes, all business logic, all UI fragments, and all utility code. Every finding below is a direct consequence of this absence: no test currently exercises any of the behavior described.

---

## File 1: UserRegisterParameter.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.UserRegisterParameter`

**Inheritance:**
`UserRegisterParameter` extends `WebServiceParameterPacket` extends `WebServiceParameterPacket` extends `WebServicePacket` implements `Serializable`

**Fields defined (all public, no access modifiers, no annotations):**

| Line | Field | Type |
|------|-------|------|
| 14 | `first_name` | `String` |
| 15 | `last_name` | `String` |
| 16 | `email` | `String` |
| 17 | `password` | `String` |
| 18 | `phone` | `String` |
| 19 | `contactperson` | `boolean` |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 21–23 | `public UserRegisterParameter()` — no-arg constructor, empty body |

**Constants:** None

**Caller context (from cross-reference):**
`SignupFragment.register()` (line 192–200) instantiates this class, assigns all fields including `password` directly from the EditText string value without hashing, and passes the object to `WebApi.async().register(userRegisterParameter, responseListener)`.

`WebRequest` constructor (line 147) calls `GsonHelper.stringFromObjectNoPolicy(parameter)`, which uses a plain `new Gson().toJson(object)` — no field exclusion policy, no `@Expose` filtering — serializing all fields including `password` verbatim into the JSON request body.

---

### Findings for UserRegisterParameter.java

---

**Finding ID:** A35-2
**Severity:** HIGH
**File:** `UserRegisterParameter.java`, line 17
**Title:** Password field transmitted and serialized in plaintext with no test verifying hashing or exclusion

**Description:**
The `password` field is a plain `public String`. No `@SerializedName`, `@Expose(serialize=false)`, or `transient` modifier is applied. `GsonHelper.stringFromObjectNoPolicy` (LibCommon) uses a bare `new Gson().toJson(object)` with no exclusion strategy, so the password is serialized into the outgoing JSON body verbatim. There is no test that:
- Verifies the password value in the serialized JSON is hashed before transmission
- Verifies the field is excluded or masked from serialization
- Verifies the field is zeroed or nulled after the network call completes

By contrast, the login flow (`CurrentUser.setTemporaryLoginInformation`) applies `CommonFunc.MD5_Hash(password)` before storing the login password. The registration path applies no equivalent transformation. No test exists to detect or catch a regression in this difference.

Note: MD5 is itself a weak hashing algorithm for passwords; this observation is separate from the finding that registration skips hashing entirely where the login flow at least applies it.

**Evidence:**
- `UserRegisterParameter.java` line 17: `public String password;`
- `SignupFragment.java` line 118: `String passwordStr = passwordET.getText().toString();`
- `SignupFragment.java` line 196: `userRegisterParameter.password = passwordStr;`
- `GsonHelper.java` lines 17–28: serialization uses `new GsonBuilder().create()` with no field exclusion
- `WebRequest.java` line 147: `mRequestBody = GsonHelper.stringFromObjectNoPolicy(parameter);`
- `CurrentUser.java` line 122: `loginPassword = CommonFunc.MD5_Hash(password);` (hashing applied in login flow but absent in registration flow)

---

**Finding ID:** A35-3
**Severity:** HIGH
**File:** `UserRegisterParameter.java`, line 17
**Title:** Password field in a Serializable class — no test verifies it is not persisted via Java serialization

**Description:**
`UserRegisterParameter` implements `java.io.Serializable` (line 5, line 12). The `password` field at line 17 carries no `transient` modifier. Under standard Java serialization, the plaintext password string would be included in any serialized byte stream. No test verifies that the object is not inadvertently serialized to disk, to a Bundle, or over Binder IPC in a way that persists the password. The `WebServiceResultPacket` parent class marks `requestID` as `transient`, demonstrating that the pattern is known and available but was not applied to `password` here.

**Evidence:**
- `UserRegisterParameter.java` line 5: `import java.io.Serializable;`
- `UserRegisterParameter.java` line 12: `implements Serializable`
- `UserRegisterParameter.java` line 17: `public String password;` (no `transient`)
- `WebServiceResultPacket.java` line 14: `public transient String requestID;` (shows `transient` is used in sibling classes)

---

**Finding ID:** A35-4
**Severity:** MEDIUM
**File:** `UserRegisterParameter.java` (caller: `SignupFragment.java`)
**Title:** No test for registration with null or empty required fields

**Description:**
`UserRegisterParameter` has six fields. The calling code in `SignupFragment.register()` performs input validation before constructing the parameter object (checking type selection, email format, first name length, last name length, phone length, and — for COMPANY users — password validity). However:

1. No test exercises the validation guard paths to confirm they prevent submission.
2. No test constructs a `UserRegisterParameter` with null or empty `first_name`, `last_name`, `email`, `phone`, or `password` and verifies the validation layer rejects it.
3. The DRIVER registration path sets `userRegisterParameter.password = passwordStr` where `passwordStr` is the text of a field with `View.INVISIBLE` visibility. On Android, invisible fields still hold their `getText()` value. No test verifies whether an empty or stale string is transmitted as the password for DRIVER-type registrations.

**Evidence:**
- `SignupFragment.java` lines 100–104: password field set to `INVISIBLE` (not `GONE`) for DRIVER type
- `SignupFragment.java` line 118: `String passwordStr = passwordET.getText().toString();` — read unconditionally
- `SignupFragment.java` line 196: `userRegisterParameter.password = passwordStr;` — assigned unconditionally for both DRIVER and COMPANY types
- No test directory exists in the `app/` module

---

**Finding ID:** A35-5
**Severity:** MEDIUM
**File:** `UserRegisterParameter.java`
**Title:** No test for email field boundary and format validation interaction with the parameter class

**Description:**
`CommonFunc.isEmailInvalid(emailStr)` guards the email field before populating `UserRegisterParameter.email`. No test covers:
- An email string at the maximum realistic length (e.g., 254 characters per RFC 5321)
- An email string that passes the `android.util.Patterns.EMAIL_ADDRESS` regex but is unusual (e.g., contains plus-addressing, internationalized characters, or subdomains)
- A null email value — `isEmailInvalid(null)` returns `true` (safe), but no test verifies this guard fires and blocks object construction

---

**Finding ID:** A35-6
**Severity:** LOW
**File:** `UserRegisterParameter.java`
**Title:** All fields are public with no validation — no test documents intended field constraints

**Description:**
All six fields (`first_name`, `last_name`, `email`, `password`, `phone`, `contactperson`) are `public` with no encapsulation. Any code can assign any value, including null, to any field before passing the object to the web API. The class provides no internal invariant enforcement. While this is a structural design issue rather than an exploitable bug in isolation, the absence of tests means there is no specification of what values are considered valid, and no regression protection if callers are changed.

---

**Finding ID:** A35-7
**Severity:** INFO
**File:** `UserRegisterParameter.java`
**Title:** `isPasswordValid` in CommonFunc applies only a non-null, non-empty check — no test for strength requirements

**Description:**
`CommonFunc.isPasswordValid(String password)` (line 92–94) returns `true` if `password != null && password.length() != 0`. A single-character password passes this check. No test verifies that a minimum-length or complexity requirement is enforced for registration passwords. This is an informational observation about the weakness of the validation gate used by `SignupFragment` at line 146.

---

## File 2: CommonResult.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.CommonResult`

**Inheritance:**
`CommonResult` extends `WebServiceResultPacket` extends `WebServicePacket` implements `Serializable`

**Fields defined:**

| Line | Field | Type |
|------|-------|------|
| 14 | `id` | `String` |
| 15 | `error` | `String` |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 17–19 | `public CommonResult()` — no-arg constructor, empty body |
| 20–37 | `public CommonResult(JSONObject jsonObject) throws JSONException` — parses `id` and `error` from JSON |

**JSON parsing behavior (line-by-line):**
- Line 24: null-guard on `jsonObject`
- Line 27: `jsonObject.isNull("id")` guard before `getString("id")` at line 29
- Line 32: `jsonObject.isNull("error")` guard before `getString("error")` at line 34
- Line 21: delegates to `super(jsonObject)` — `WebServiceResultPacket(JSONObject)` then `WebServicePacket(JSONObject)`, both have empty bodies

**Constants:** None

**Cross-reference callers:** `ProfileFragment`, `SavedReportFragment`, `ComplianceAccepter`, `AddEquipmentFragment`, `WebApi`, `ShockEventService` — all consume `CommonResult` as a response type.

---

### Findings for CommonResult.java

---

**Finding ID:** A35-8
**Severity:** MEDIUM
**File:** `CommonResult.java`, lines 20–37
**Title:** No test for `CommonResult(JSONObject)` with null input, missing keys, or type-mismatched values

**Description:**
The constructor `CommonResult(JSONObject jsonObject)` handles the null case at line 24 (leaving `id` and `error` as null), which is correct. However, no test verifies:

1. **Null JSONObject input:** `new CommonResult(null)` — both fields remain null, which callers may not anticipate.
2. **Missing keys:** A JSONObject that lacks the `"id"` key entirely (as opposed to an explicitly null value) — `isNull("id")` returns `true` for absent keys in the Android `org.json` implementation, so the field stays null. No test documents this behavior.
3. **Key present with explicit `null` value vs. key absent:** Both result in the field being skipped, but the distinction is semantically significant (server explicitly returned null vs. server did not include the field). No test covers either path.
4. **Type mismatch:** If the server returns `"id": 42` (integer) and `getString("id")` is called, `org.json.JSONObject.getString` will coerce the integer to `"42"` silently. No test verifies this coercion behavior is acceptable.
5. **`error` field containing an empty string `""`:** This is distinct from null and from a missing key, but callers may treat all three identically. No test documents which case represents "no error."

---

**Finding ID:** A35-9
**Severity:** LOW
**File:** `CommonResult.java`, line 15
**Title:** No test verifies that `error` field null-check is performed before use by callers

**Description:**
`CommonResult.error` is null by default (when the key is absent or the JSONObject is null). The class does not provide a helper such as `hasError()`. Callers must null-check `error` themselves before use. No test documents this contract or verifies that callers handle a null `error` gracefully.

---

**Finding ID:** A35-10
**Severity:** LOW
**File:** `CommonResult.java`, line 14
**Title:** `id` field is a String but carries an identity semantics — no test verifies parsing of non-string server values

**Description:**
The `id` field is typed as `String`. Server APIs commonly return numeric IDs. `JSONObject.getString("id")` will coerce integer or long JSON values to their string representation without throwing. No test documents this coercion or verifies that downstream callers treat the string value consistently (e.g., parsing it back to an integer when needed).

---

## File 3: EquipmentStatsResultArray.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.EquipmentStatsResultArray`

**Inheritance:**
`EquipmentStatsResultArray` extends `WebServiceResultPacket` extends `WebServicePacket` implements `Serializable`

**Fields defined:**

| Line | Field | Type |
|------|-------|------|
| 14 | `arrayList` | `ArrayList<EquipmentStatsItem>` |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 16–18 | `public EquipmentStatsResultArray()` — no-arg constructor, empty body (`arrayList` remains null) |
| 19–31 | `public EquipmentStatsResultArray(JSONArray jsonArray) throws JSONException` — initializes `arrayList`, iterates array |

**JSON parsing behavior (line-by-line):**
- Line 22: `arrayList = new ArrayList<>()` — always initialized before null guard
- Line 23: null guard on `jsonArray` — if null, method returns with empty `arrayList`
- Lines 25–28: iterates `jsonArray`, constructs `EquipmentStatsItem` via `EquipmentStatsItem(JSONObject)` for each element
- Each `EquipmentStatsItem` is responsible for its own field parsing

**Constants:** None

**Referenced types:**
- `EquipmentStatsItem` — parses `unit_id` (int), `unit` (String), `total` (double), `usageList` (ArrayList<EqupmentUsageItem>)
- `EqupmentUsageItem` — parses `time` (String), `usage` (double)
- Note: class name `EqupmentUsageItem` contains a typo ("Equpment" missing 'i')

**Cross-reference callers:** `DriverStatsFragment3`, `WebApi`

---

### Findings for EquipmentStatsResultArray.java

---

**Finding ID:** A35-11
**Severity:** MEDIUM
**File:** `EquipmentStatsResultArray.java`, lines 19–31
**Title:** No test for `EquipmentStatsResultArray(JSONArray)` with null input, empty array, or malformed elements

**Description:**
The constructor handles null `jsonArray` by leaving `arrayList` non-null but empty (correct), but no test verifies:

1. **Null input:** `new EquipmentStatsResultArray(null)` — `arrayList` is initialized to empty. Callers using the no-arg constructor receive a null `arrayList`. No test documents this inconsistency between the two constructors.
2. **Empty array (`[]`):** Should yield an empty `arrayList`. No test verifies.
3. **Array with one well-formed element:** Basic happy path. No test verifies.
4. **Array element that is not a JSONObject (e.g., a string or integer):** `jsonArray.getJSONObject(i)` will throw `JSONException` at runtime. The exception propagates to the caller and is not caught. No test verifies this failure path or the caller's handling.
5. **Large array:** No test checks performance or memory behavior for large result sets, which could be a concern in a fleet-tracking context.

---

**Finding ID:** A35-12
**Severity:** MEDIUM
**File:** `EquipmentStatsResultArray.java`, lines 16–18 vs 19–31
**Title:** No-arg constructor leaves `arrayList` null — callers that use it may encounter NullPointerException

**Description:**
`EquipmentStatsResultArray()` (lines 16–18) leaves `arrayList` uninitialized (null). The JSON constructor (lines 22) always initializes `arrayList = new ArrayList<>()`. Code that constructs this class via the no-arg constructor (as `GsonRequest.createResultWithJson` may do when JSON parsing falls back via `webClazz.newInstance()` at line 38 of `GsonRequest.java`) will return an object with a null `arrayList`. Any caller that iterates `arrayList` without a null check will throw `NullPointerException`. No test exercises this code path or verifies null-safety of callers.

**Evidence:**
- `EquipmentStatsResultArray.java` line 16–18: `public EquipmentStatsResultArray() {}` — `arrayList` remains null
- `GsonRequest.java` line 38: `return webClazz.newInstance();` — fallback that invokes the no-arg constructor
- `DriverStatsFragment3.java` — consumes this result type; no test covers its null handling

---

**Finding ID:** A35-13
**Severity:** LOW
**File:** `EquipmentStatsResultArray.java`, line 14
**Title:** No test for serialization round-trip of `EquipmentStatsResultArray` via `Serializable`

**Description:**
`EquipmentStatsResultArray` implements `Serializable`. The `ArrayList<EquipmentStatsItem>` field is included in serialization. `EquipmentStatsItem` also implements `Serializable`, and `EqupmentUsageItem` implements `Serializable`. No test verifies that a round-trip serialize/deserialize of a populated `EquipmentStatsResultArray` produces an equivalent object. This matters if instances are passed via Android Bundles or IPC.

---

**Finding ID:** A35-14
**Severity:** INFO
**File:** `EquipmentStatsResultArray.java` / `EqupmentUsageItem.java`
**Title:** Typo in dependency class name `EqupmentUsageItem` — no test would catch a future rename breaking the reference

**Description:**
`EquipmentStatsResultArray` at line 14 references `EquipmentStatsItem`, which in turn references `EqupmentUsageItem` (missing 'i' in "Equipment"). This typo is present in the class name, file name, and field type. With zero test coverage, a rename refactor intended to fix the typo could silently break the class hierarchy with no automated detection.

---

## Summary Table

| Finding ID | Severity | File | Title |
|------------|----------|------|-------|
| A35-1 | HIGH | Project-wide | Zero automated test coverage in app/ and LibCommon/ modules |
| A35-2 | HIGH | UserRegisterParameter.java | Password transmitted in plaintext — no test verifies hashing or exclusion |
| A35-3 | HIGH | UserRegisterParameter.java | Password field in Serializable class — not marked transient, no test verifies it is not persisted |
| A35-4 | MEDIUM | UserRegisterParameter.java | No test for registration with null or empty required fields |
| A35-5 | MEDIUM | UserRegisterParameter.java | No test for email field boundary and format edge cases |
| A35-6 | LOW | UserRegisterParameter.java | All fields public with no validation — no test documents constraints |
| A35-7 | INFO | UserRegisterParameter.java | `isPasswordValid` applies only non-null/non-empty — no test for strength requirements |
| A35-8 | MEDIUM | CommonResult.java | No test for constructor with null input, missing keys, or type-mismatched values |
| A35-9 | LOW | CommonResult.java | No test verifies callers null-check `error` field before use |
| A35-10 | LOW | CommonResult.java | `id` typed as String — no test verifies coercion of numeric server values |
| A35-11 | MEDIUM | EquipmentStatsResultArray.java | No test for constructor with null, empty array, or malformed elements |
| A35-12 | MEDIUM | EquipmentStatsResultArray.java | No-arg constructor leaves `arrayList` null — NPE risk with no test coverage |
| A35-13 | LOW | EquipmentStatsResultArray.java | No test for Serializable round-trip of result array |
| A35-14 | INFO | EquipmentStatsResultArray.java | Typo `EqupmentUsageItem` — no test would detect rename regressions |
