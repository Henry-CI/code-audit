# Audit Pass 2 — Agent A40
**Audit run:** 2026-02-26-01
**Agent:** A40
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/SaveImpactResult.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/SaveLicenseResult.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/SaveMultipleGPSResult.java`

---

## PROJECT-WIDE FINDING (HIGH)

### A40-1 — Zero automated test coverage across app/ and LibCommon/ modules

**Severity:** HIGH

**Scope:** Project-wide — affects every source file in the `app/` and `LibCommon/` modules.

The `app/src/` tree contains only a `main/` source set. There is no `test/` directory (unit tests) and no `androidTest/` directory (instrumented tests). `LibCommon/src/` is identically structured — source only, no test directory of any kind.

```
/c/Projects/cig-audit/repos/forkliftiqapp/app/src/
  main/   <-- only source set present

/c/Projects/cig-audit/repos/forkliftiqapp/LibCommon/src/
  main/   <-- only source set present
```

The only test files found in the entire repository are:
- `LibImageloader/src/test/` — two tests for a third-party image loading library
- `LibImagePicker/src/androidTest/` — a stub ApplicationTest from boilerplate
- `LibPercentProgress/src/androidTest/` — a stub ApplicationTest from boilerplate

None of these tests cover any application business logic. The three files assigned to this agent have zero test coverage, as does every other class in `app/` and `LibCommon/`.

**Risk:** Regressions in any part of the application's parsing, data model, or service layer go undetected. For safety-critical features (incident recording, license verification, GPS tracking) this means broken data flows can ship to production undetected.

---

## Reading Evidence

### File 1: SaveImpactResult.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.SaveImpactResult`

**Inheritance:** `SaveImpactResult` extends `WebServiceResultPacket` (which extends `WebServicePacket`). Both parent constructors accept a `JSONObject` and do no meaningful work (the bodies are empty beyond the null guard).

**Fields defined (all public, no access controls):**

| Field | Type | Line |
|---|---|---|
| `id` | `int` | 14 |
| `signature` | `String` | 15 |
| `image` | `String` | 16 |
| `injury_type` | `String` | 17 |
| `witness` | `String` | 18 |
| `location` | `String` | 19 |
| `injury` | `boolean` | 20 |
| `near_miss` | `boolean` | 21 |
| `description` | `String` | 22 |
| `report_time` | `String` | 23 |
| `event_time` | `String` | 24 |
| `job_number` | `String` | 25 |

**Methods defined:**

| Line | Signature |
|---|---|
| 27 | `public SaveImpactResult()` |
| 30 | `public SaveImpactResult(JSONObject jsonObject) throws JSONException` |

**Constants:** None.

**Imports declared but unused:** `JSONArray`, `ArrayList`, `BigDecimal` — all imported but not referenced anywhere in the file.

---

### File 2: SaveLicenseResult.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.SaveLicenseResult`

**Inheritance:** `SaveLicenseResult` extends `WebServiceResultPacket`.

**Fields defined (all public):**

| Field | Type | Line |
|---|---|---|
| `id` | `int` | 14 |
| `licno` | `String` | 15 |
| `addr` | `String` | 16 |
| `expirydt` | `String` | 17 |
| `securityno` | `String` | 18 |

**Methods defined:**

| Line | Signature |
|---|---|
| 20 | `public SaveLicenseResult()` |
| 23 | `public SaveLicenseResult(JSONObject jsonObject) throws JSONException` |

**Constants:** None.

**Imports declared but unused:** `JSONArray`, `ArrayList`, `BigDecimal` — all imported but not referenced anywhere in the file.

---

### File 3: SaveMultipleGPSResult.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.SaveMultipleGPSResult`

**Inheritance:** `SaveMultipleGPSResult` extends `WebServiceResultPacket`.

**Fields defined (all public):**

| Field | Type | Line |
|---|---|---|
| `unit_id` | `int` | 11 |
| `longitude` | `Double` | 12 |
| `latitude` | `Double` | 13 |
| `gps_time` | `String` | 14 |

**Methods defined:**

| Line | Signature |
|---|---|
| 16 | `public SaveMultipleGPSResult()` |
| 19 | `public SaveMultipleGPSResult(JSONObject jsonObject) throws JSONException` |

**Constants:** None.

---

## File-Specific Findings

---

### A40-2 — SaveImpactResult: no test verifies successful parse of a complete incident response

**Severity:** HIGH
**File:** `SaveImpactResult.java`

`SaveImpactResult` carries workplace safety incident data: injury flags, near-miss flags, injury type, witness, location, event time, report time, job number, and a signature image reference. The server response is parsed by the `SaveImpactResult(JSONObject)` constructor at lines 30–97.

No test exists that constructs a `SaveImpactResult` from a valid JSON payload and asserts that each of the twelve fields is correctly populated. If the server changes a field name, changes a type, or the JSON key mapping silently diverges, the incident record produced on the device will be silently incorrect — fields will retain their zero/null default values with no exception thrown, because every field extraction is guarded by `isNull()`.

Downstream code in `IncidentPart2Fragment.java` (line 177) immediately uses `result.id` from this object to drive the image upload call `uploadImages(result.id)`. If `id` is 0 due to a silent parse failure, images are uploaded against a non-existent or wrong incident ID, corrupting the incident record without any user-visible error.

**Untested methods:** `SaveImpactResult(JSONObject jsonObject)` (line 30)

---

### A40-3 — SaveImpactResult: no test verifies behaviour when server returns failure response

**Severity:** HIGH
**File:** `SaveImpactResult.java`

The `onFailed` handler in `IncidentPart2Fragment` (line 181) shows an error dialog but does not persist or queue the incident for retry. No test verifies that a server-side failure response (e.g., HTTP 4xx/5xx wrapped in a `WebResult`) causes the incident data to be retained rather than lost. A worker involved in a forklift impact could submit an incident report that silently disappears if the network fails at submission time. This is a data-loss risk for a safety-critical workflow.

**Untested paths:** Network failure path; server error response path; transient timeout resulting in lost incident record.

---

### A40-4 — SaveImpactResult: no test verifies partial JSON response (missing fields default safely)

**Severity:** MEDIUM
**File:** `SaveImpactResult.java`

The constructor uses `isNull()` guards on every field (lines 37–95), so a server response that omits any field leaves the corresponding Java field at its primitive default (`0` for `int`, `false` for `boolean`, `null` for `String`). No test verifies that:
- A JSON response missing `injury` or `near_miss` leaves those booleans `false` (rather than incorrectly defaulting to `true`).
- A JSON response missing `id` leaves `id` as `0` — which would cause `uploadImages(0)` to be called, attaching images to ID 0.
- A JSON response missing `event_time` or `report_time` does not cause downstream null pointer exceptions when those strings are used.

---

### A40-5 — SaveImpactResult: no test for JSONException propagation from malformed type values

**Severity:** MEDIUM
**File:** `SaveImpactResult.java`

The constructor declares `throws JSONException`. If the server returns `"id": "not-a-number"`, `jsonObject.getInt("id")` (line 39) throws `JSONException`. No test verifies how the caller handles this exception. The `GsonRequest` deserialisation path in `WebApi` is not tested — if it silently swallows the exception, the user sees no error; if it propagates uncaught, the app may crash without recording the incident.

---

### A40-6 — SaveImpactResult: unused imports increase maintenance risk

**Severity:** LOW
**File:** `SaveImpactResult.java` (lines 6–8)

`JSONArray`, `ArrayList`, and `BigDecimal` are imported but unused. No test enforces that these imports remain absent, so future developers may add code that depends on them without intentional design. This is a code hygiene finding; the immediate risk is low.

---

### A40-7 — SaveLicenseResult: no test verifies successful parse of a license verification response

**Severity:** HIGH
**File:** `SaveLicenseResult.java`

`SaveLicenseResult` is returned by `WebApi.saveLicense()` (WebApi.java line 333). It carries `licno` (license number), `expirydt` (expiry date), `addr` (address), and `securityno` (security number). No test constructs a `SaveLicenseResult` from JSON and asserts correct field population.

If the server changes its response schema (e.g., renames `expirydt` to `expiry_date`), the expiry date field will silently remain `null` in the result object. Downstream logic that relies on `expirydt` to validate a driver's licence status would then operate on a null value, potentially treating an expired or invalid licence as unverified without raising an error — a safety and compliance risk.

**Untested methods:** `SaveLicenseResult(JSONObject jsonObject)` (line 23)

---

### A40-8 — SaveLicenseResult: no test verifies failure response handling for license save

**Severity:** HIGH
**File:** `SaveLicenseResult.java`

`SaveLicenseResult` is used with `WebApi.saveLicense()`. No consumer of this call visible in the codebase (`WebApi.java` line 333–334) has tests for the failure path. A failed license save could leave a driver's license record in an inconsistent state on the server without the client being aware. No test confirms that a failed `saveLicense` call triggers appropriate user feedback or retry logic.

---

### A40-9 — SaveLicenseResult: no test for partial JSON (missing expirydt or securityno)

**Severity:** MEDIUM
**File:** `SaveLicenseResult.java`

Fields `expirydt` and `securityno` can be silently null if omitted from the server response (the `isNull()` guard at lines 45 and 50 means no exception is thrown). No test verifies:
- That a missing `expirydt` is handled gracefully by callers and does not produce a NullPointerException.
- That a missing `securityno` does not cause a security validation bypass downstream.

---

### A40-10 — SaveLicenseResult: unused imports

**Severity:** LOW
**File:** `SaveLicenseResult.java` (lines 6–8)

`JSONArray`, `ArrayList`, and `BigDecimal` are imported but unused. Same concern as A40-6.

---

### A40-11 — SaveMultipleGPSResult: no test verifies successful parse of GPS location response

**Severity:** MEDIUM
**File:** `SaveMultipleGPSResult.java`

`SaveMultipleGPSResult` is returned by `WebApi.saveMultipleGPSLocation()` (WebApi.java line 345) and is used by `LocationDb.java`. No test constructs a `SaveMultipleGPSResult` from a JSON payload and asserts that `unit_id`, `longitude`, `latitude`, and `gps_time` are correctly populated.

GPS location data underpins forklift tracking. Silent parse failures (e.g., `longitude` and `latitude` silently null because field names differ between server versions) would result in location records containing null coordinates being stored in the local database without error.

**Untested methods:** `SaveMultipleGPSResult(JSONObject jsonObject)` (line 19)

---

### A40-12 — SaveMultipleGPSResult: longitude and latitude typed as boxed Double — no test for null coordinate handling

**Severity:** MEDIUM
**File:** `SaveMultipleGPSResult.java` (lines 12–13)

`longitude` and `latitude` are declared as `Double` (boxed, nullable) rather than `double` (primitive). If either field is absent from the server response, it remains `null`. No test verifies:
- That a `null` longitude or latitude does not cause a NullPointerException when unboxed in `LocationDb.java` or elsewhere.
- That the application correctly rejects or flags a GPS record with null coordinates rather than storing a corrupt location entry.
- Contrast with `unit_id` (line 11), which is primitive `int` — an absent `unit_id` silently defaults to `0`, potentially misassigning GPS records to unit 0.

---

### A40-13 — SaveMultipleGPSResult: no test for JSONException propagation from malformed coordinate values

**Severity:** MEDIUM
**File:** `SaveMultipleGPSResult.java`

If the server returns `"longitude": "invalid"`, `jsonObject.getDouble("longitude")` (line 33) throws `JSONException`. No test verifies that this exception is caught and handled, or that it propagates in a controlled manner rather than crashing the GPS recording loop.

---

### A40-14 — All three result classes: default no-arg constructors leave all fields at zero/null with no test

**Severity:** LOW
**Files:** All three assigned files

Each class defines a no-arg constructor (lines 27, 20, 16 respectively) that leaves all fields at Java defaults (`0`, `false`, `null`). No test verifies that callers which receive a default-constructed instance (which could result from a deserialisation framework creating the object before populating it) behave correctly when operating on zeroed/null fields. This is a low risk in isolation but becomes a concern if the deserialisation framework (Gson, as seen in `GsonRequest`) uses the no-arg constructor then sets fields via reflection — field-level constraints are unenforced.

---

### A40-15 — All three result classes: all fields public with no encapsulation — no test enforces immutability

**Severity:** LOW
**Files:** All three assigned files

Every field in all three classes is `public` with no getter/setter pattern and no `final` modifier. Any code in the application can silently modify a result object after it has been populated from the server response. No test verifies that result objects are treated as immutable after construction. For `SaveImpactResult`, post-construction mutation of `injury` or `near_miss` flags would corrupt the incident record without any guard.

---

## Summary Table

| ID | Severity | File | Description |
|---|---|---|---|
| A40-1 | HIGH | Project-wide | Zero automated test coverage in app/ and LibCommon/ modules |
| A40-2 | HIGH | SaveImpactResult | No test for successful parse of complete incident JSON response |
| A40-3 | HIGH | SaveImpactResult | No test verifies failure response leaves incident data intact |
| A40-4 | MEDIUM | SaveImpactResult | No test for partial JSON response / silent field defaults |
| A40-5 | MEDIUM | SaveImpactResult | No test for JSONException propagation on type mismatch |
| A40-6 | LOW | SaveImpactResult | Unused imports (JSONArray, ArrayList, BigDecimal) |
| A40-7 | HIGH | SaveLicenseResult | No test for successful parse of license verification response |
| A40-8 | HIGH | SaveLicenseResult | No test verifies failure response handling for license save |
| A40-9 | MEDIUM | SaveLicenseResult | No test for partial JSON (missing expirydt or securityno) |
| A40-10 | LOW | SaveLicenseResult | Unused imports (JSONArray, ArrayList, BigDecimal) |
| A40-11 | MEDIUM | SaveMultipleGPSResult | No test for successful parse of GPS location response |
| A40-12 | MEDIUM | SaveMultipleGPSResult | Boxed Double coordinates not tested for null/NPE on unbox |
| A40-13 | MEDIUM | SaveMultipleGPSResult | No test for JSONException on malformed coordinate values |
| A40-14 | LOW | All three | No-arg constructors leave fields at zero/null; no test for callers |
| A40-15 | LOW | All three | All fields public/mutable; no test enforces post-construction immutability |
