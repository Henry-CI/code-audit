# Audit Pass 2 – Agent A23
**Audit run:** 2026-02-26-01
**Agent:** A23
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/LoginItem.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/ManufactureItem.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/PermissionItem.java`

---

## PROJECT-WIDE FINDING

### A23-1 [HIGH] Zero automated test coverage in app/ and LibCommon/ modules

The `app/` module has no `src/test/` directory and no `src/androidTest/` directory. The `LibCommon/` module likewise has no test directory of any kind. Glob patterns `**/app/src/test/**` and `**/LibCommon/src/test/**` returned zero results. The only test code present in the repository belongs to third-party library modules (`LibImageloader`, `LibImagePicker`, `LibPercentProgress`) and tests only those libraries' own classes.

Every finding below is therefore amplified: not only is there no test for the specific defect, there is no testing infrastructure at all to add such tests to. Any correctness, security, or lifecycle guarantee about any class in `app/` or `LibCommon/` rests entirely on manual review.

---

## File 1: LoginItem.java

### Reading evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.LoginItem`

**Fields defined:**

| Line | Field | Type |
|------|-------|------|
| 15 | `id` | `public int` |
| 16 | `comp_id` | `public int` |
| 17 | `first_name` | `public String` |
| 18 | `last_name` | `public String` |
| 19 | `email` | `public String` |
| 20 | `password` | `public String` |
| 21 | `phone` | `public String` |
| 22 | `licno` | `public String` |
| 23 | `expirydt` | `public String` |
| 24 | `addr` | `public String` |
| 25 | `securityno` | `public String` |
| 26 | `photo_url` | `public String` |
| 27 | `contactperson` | `public boolean` |
| 28 | `date_format` | `public String` |
| 29 | `max_session_length` | `public int` |
| 30 | `compliance_date` | `public String` |
| 31 | `gps_frequency` | `public int` |
| 33 | `drivers` | `public List<LoginItem>` |
| 34 | `arrDriverTrainings` | `public List<TrainingItem>` |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 36 | `public LoginItem(JSONObject jsonObject) throws JSONException` |

**Types, constants, interfaces:** implements `Serializable`; no constants defined.

**Imports noted:** `android.util.Log` is imported at line 3 — but is never called in the file body. The import is dead code; it is also noteworthy because the presence of the import suggests logging was previously used or was intended for credential-related debug output.

---

### Findings

#### A23-2 [CRITICAL] `LoginItem` parses a `password` field from server JSON with no test verifying it is never persisted in plaintext, logged, or leaked

**File:** `LoginItem.java` line 47
**Evidence:**
```java
password = parser.getString("password");
```

The server returns a credential in the login response body and this field is parsed into the public `String password` field. Cross-referencing callers:

- `CurrentUser.createUser()` (CurrentUser.java:66) passes `loginItem.password` directly into the `User` constructor.
- `User.setPassword()` (User.java:110-112) stores the value in a `User` instance and immediately calls `UserDb.save(this)`.
- `UserDb.save()` (UserDb.java:13-30) persists the entire `User` object to Realm, meaning the password value is written to the on-device Realm database as the field `password` on `UserRealmObject` (UserRealmObject.java:15, 37, 57, 80).
- `UserDb.get(String email, String password)` (UserDb.java:55-63) uses the stored password for local offline authentication by performing a cleartext equality match: `equalTo("password", password)`.

This creates a confirmed, multi-step plaintext password persistence pipeline. Because the `password` field on `LoginItem` is `public` and not zeroed after use, and because `LoginItem` implements `Serializable`, any serialization of a `LoginItem` instance (e.g. passing through an Android `Intent` extra or `Bundle`) would also expose the password.

The `android.util.Log` import (line 3) that goes unused is a residual indicator that logging in this class was considered. There is no test verifying that the password is not written to Logcat, is not included in crash reports, is not present in the Realm database in plaintext, is not serialized through an Intent, and is zeroed from memory after use.

**Risk:** An attacker with local read access to the device (e.g. via ADB on a non-rooted device with USB debugging enabled, or via filesystem access on a rooted device) can extract the user's server-side password from the Realm database file. The same value is used for offline login, meaning extraction enables full account compromise.

**No test exists:** There is no test directory in `app/`.

---

#### A23-3 [HIGH] `LoginItem` constructor does not validate or reject a null-key `password` field, and no test covers the behaviour when `password` is absent from the JSON response

**File:** `LoginItem.java` lines 36-77

The `LoginItem` constructor uses a `JSONObjectParser` wrapper for all fields. Unlike the `ManufactureItem` and `PermissionItem` constructors (which guard each `jsonObject.isNull(key)` before calling `getString`), `LoginItem` calls `parser.getString("password")` without any null check on the key. The behaviour of `JSONObjectParser.getString` when the key is absent from the JSON object is not tested.

If the server omits the `password` key (as it may legitimately do for non-password-based auth flows, or in future API versions), the current code either silently assigns `null` or throws — both outcomes have downstream consequences:
- `null` propagates to `UserDb` and is stored in Realm, breaking the offline auth query.
- An unhandled `JSONException` would propagate up and crash the login flow.

No test verifies which path is taken, and no test verifies correct handling of an absent `password` key.

---

#### A23-4 [HIGH] `LoginItem` implements `Serializable`, making the `password` field serializable with no suppression or exclusion

**File:** `LoginItem.java` line 14
```java
public class LoginItem implements Serializable {
```

All `public` fields of a `Serializable` class are included in the default serialized form, including `password` at line 20. There is no `transient` modifier on the `password` field and no custom `writeObject`/`readObject` pair. Any code path that serializes a `LoginItem` (Android `Intent`/`Bundle` extras, object streams, clipboard, IPC) exposes the password in the serialized bytes.

No test verifies that `LoginItem` refuses to serialize the `password` field, or that consumers never serialize a `LoginItem` containing a non-null password.

---

#### A23-5 [MEDIUM] `LoginItem` constructor does not guard against a null `jsonObject` before calling `jsonObject.isNull("arrDriverTrainings")`, creating a divergent null-safety policy within the same constructor

**File:** `LoginItem.java` lines 37-38 and 60-67

The constructor begins with:
```java
if (jsonObject == null)
    return;
```

This means the object is left in a zero/null field state when the argument is null. Fields `id`, `comp_id`, `drivers`, `arrDriverTrainings` remain at their default values. The `drivers` and `arrDriverTrainings` fields are initialised inline to `new ArrayList<>()` (lines 33-34), so they are non-null. However the `arrDriverTrainings` block at line 60 calls `jsonObject.isNull("arrDriverTrainings")` after the null-guard has passed, which is correct. But there is no test verifying:
- that passing `null` produces a consistent zero-value object rather than a partially initialised one.
- that the `return` on line 38 leaves `drivers` and `arrDriverTrainings` as empty lists (not null), so callers iterating over them do not NPE.
- that the recursive `LoginItem(jsonArrayDrivers.getJSONObject(i))` call on line 73 is safe when inner driver objects are null.

---

#### A23-6 [MEDIUM] No test exercises the `contactperson == true` branch that recursively constructs nested `LoginItem` objects from a `drivers` JSON array

**File:** `LoginItem.java` lines 69-76
```java
if (contactperson) {
    JSONArray jsonArrayDrivers = parser.getJSONArray("drivers");
    if (jsonArrayDrivers != null) {
        for (int i = 0; i < jsonArrayDrivers.length(); i++) {
            this.drivers.add(new LoginItem(jsonArrayDrivers.getJSONObject(i)));
        }
    }
}
```

This branch is only entered when `contactperson` is true, meaning:
- The case where `contactperson` is true and `drivers` is present is untested.
- The case where `contactperson` is true and `drivers` is null/missing is untested.
- The case where `drivers` is a non-empty array whose elements are malformed JSON objects is untested.
- The recursive construction path (a `LoginItem` that contains `LoginItem` objects) is never exercised.

---

#### A23-7 [LOW] `android.util.Log` is imported but never used in `LoginItem.java`

**File:** `LoginItem.java` line 3
```java
import android.util.Log;
```

The import is dead code. It may indicate that logging of credential fields was previously present and removed, or was intended and never completed. While not a functional defect in isolation, the presence of an unused Log import in a class that parses credentials warrants explicit confirmation that no Log calls involving `password` were removed without audit, and that no Log calls will be added in the future without a test verifying they exclude sensitive fields.

---

## File 2: ManufactureItem.java

### Reading evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.ManufactureItem`

**Fields defined:**

| Line | Field | Type |
|------|-------|------|
| 14 | `id` | `public int` |
| 15 | `name` | `public String` |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 17 | `public ManufactureItem()` (no-arg constructor) |
| 20 | `public ManufactureItem(JSONObject jsonObject) throws JSONException` |

**Types, constants, interfaces:** implements `Serializable`; no constants defined.

**Unused imports:** Lines 6-10 import `JSONArray`, `ArrayList`, `BigDecimal`, and wildcard imports from the same package and results sub-package. None of these are used in the file body.

---

### Findings

#### A23-8 [LOW] `ManufactureItem` has no corresponding test file; both constructors are untested

**File:** `ManufactureItem.java`

There is no test directory in `app/`. `ManufactureItem` is a simple two-field DTO with two constructors. The untested scenarios include:

- No-arg constructor: the resulting object has `id == 0` and `name == null`. Callers that use the no-arg constructor and then conditionally check `name != null` are affected by this default state, which is never asserted.
- JSON constructor with `null` argument: the `if (jsonObject != null)` guard on line 22 silently leaves both fields at defaults. No test verifies this is the intended behaviour or that callers handle a zero-id `ManufactureItem`.
- JSON constructor where `id` key is present but not an integer (e.g. a string `"abc"`): `jsonObject.getInt("id")` throws a `JSONException` that propagates to the caller. No test verifies the caller handles this.
- JSON constructor where `name` is an empty string: `name` would be set to `""`. Callers that display `name` directly would show a blank label. No test covers this boundary.

---

#### A23-9 [LOW] `ManufactureItem.java` contains five unused imports

**File:** `ManufactureItem.java` lines 6-10
```java
import org.json.JSONArray;
import java.util.ArrayList;
import java.math.BigDecimal;
import au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.*;
import au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.*;
```

None of these are referenced in the class body. Dead imports indicate the file was generated from a template and never cleaned up. No test verifies that the class compiles cleanly under strict unused-import lint rules.

---

## File 3: PermissionItem.java

### Reading evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.PermissionItem`

**Fields defined:**

| Line | Field | Type |
|------|-------|------|
| 14 | `id` | `public int` |
| 15 | `driver_id` | `public int` |
| 16 | `driver_name` | `public String` |
| 17 | `comp_id` | `public int` |
| 18 | `enabled` | `public String` |
| 19 | `gsm_token` | `public String` |

**Methods defined:**

| Line | Signature |
|------|-----------|
| 21 | `public PermissionItem()` (no-arg constructor) |
| 24 | `public PermissionItem(JSONObject jsonObject) throws JSONException` |

**Types, constants, interfaces:** implements `Serializable`; no constants defined.

**Unused imports:** Lines 6-10 import `JSONArray`, `ArrayList`, `BigDecimal`, and wildcard imports. None are used in the class body.

**Note on `enabled` field:** Declared as `public String` rather than `public boolean`, despite the field name strongly implying a boolean semantic. No constants or enum values bound the accepted string values.

---

### Findings

#### A23-10 [HIGH] `PermissionItem.gsm_token` is parsed from server JSON and stored in a `public` field with no test verifying its lifecycle, storage, or exclusion from logs and serialization

**File:** `PermissionItem.java` lines 19, 54-57
```java
public String gsm_token;
...
if (!jsonObject.isNull("gsm_token"))
{
    gsm_token = jsonObject.getString("gsm_token");
}
```

`gsm_token` is characteristic of a GSM/cellular push-notification or telephony authentication token (equivalent to a Firebase Cloud Messaging registration token or a SIM-based auth token). Such tokens are security credentials: knowledge of a valid token allows impersonation of the device or user for push-notification delivery, and in telephony-auth schemes, for SMS-based two-factor authentication bypass.

The field is:
- `public`: readable by any code in the same process without access control.
- On a `Serializable` class: serialized by default if the object is passed through an `Intent`, `Bundle`, or `ObjectOutputStream`.
- Not declared `transient`: no mechanism prevents serialization of the token value.

Cross-referencing the codebase, `PermissionItem` is only referenced in `CompanyItem.java` (one additional occurrence). However, the grep confirms `gsm_token` appears only in `PermissionItem.java` itself — no consuming code was found outside the class, meaning there is no confirmed current usage of the token, but also no safeguards around it.

No test verifies:
- That `gsm_token` is cleared from memory after use.
- That `gsm_token` is not written to Logcat.
- That `gsm_token` is not included in serialized `Intent`/`Bundle` payloads.
- That the token is rotated or invalidated on logout.
- That the token is not accessible to third-party SDKs in the same process.

---

#### A23-11 [MEDIUM] `PermissionItem.enabled` is typed as `String` rather than `boolean`, with no test verifying what string values the server sends or how callers interpret them

**File:** `PermissionItem.java` line 18
```java
public String enabled;
```

The field name `enabled` implies a boolean permission flag. Using `String` instead of `boolean` means:
- The server could return `"true"`, `"false"`, `"1"`, `"0"`, `"yes"`, `"no"`, `"enabled"`, `""`, or `null` (key absent, field stays `null`).
- Callers performing equality checks (e.g. `if (item.enabled.equals("true"))`) will behave differently from callers using `Boolean.parseBoolean(item.enabled)`, which treats only the string `"true"` (case-insensitive) as true.
- A `null` value (key absent from JSON) leaves the field as `null`, causing a NullPointerException in any caller that calls methods on `enabled` without a null check.

No test defines or asserts the canonical set of accepted values for this field.

---

#### A23-12 [MEDIUM] No test covers `PermissionItem` constructed from a `null` JSON argument

**File:** `PermissionItem.java` lines 26-27
```java
if (jsonObject != null)
{
```

When `jsonObject` is `null`, the constructor silently returns with all fields at defaults: `id == 0`, `driver_id == 0`, `driver_name == null`, `comp_id == 0`, `enabled == null`, `gsm_token == null`. No test verifies that callers of `PermissionItem(null)` handle this zero-state object correctly, particularly for the `enabled` and `gsm_token` fields where null has security implications distinct from a false/absent value.

---

#### A23-13 [LOW] `PermissionItem` has no corresponding test file; all constructor paths are untested

**File:** `PermissionItem.java`

No test directory exists in `app/`. The untested scenarios include:

- No-arg constructor: produces a zero-field object. No test asserts this is safe for callers.
- JSON constructor with all keys present and valid: the happy path is untested.
- JSON constructor with `gsm_token` key absent: `gsm_token` remains `null`. No test verifies caller null-handling.
- JSON constructor with `id` present as a non-integer: throws `JSONException` uncaught at the call site.

---

#### A23-14 [LOW] `PermissionItem.java` contains five unused imports

**File:** `PermissionItem.java` lines 6-10
```java
import org.json.JSONArray;
import java.util.ArrayList;
import java.math.BigDecimal;
import au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.*;
import au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.*;
```

None are used in the class body. Same template-generation pattern as `ManufactureItem.java`.

---

## Summary table

| ID | Severity | File | Description |
|----|----------|------|-------------|
| A23-1 | HIGH | project-wide | Zero automated test coverage in `app/` and `LibCommon/` modules |
| A23-2 | CRITICAL | LoginItem.java | `password` field parsed from server JSON, persisted in plaintext to Realm database, with no test for any stage of the pipeline |
| A23-3 | HIGH | LoginItem.java | No null-guard on `password` JSON key; no test for absent-key behaviour |
| A23-4 | HIGH | LoginItem.java | `password` field serializable by default via `Serializable`; no `transient` modifier; no test |
| A23-5 | MEDIUM | LoginItem.java | Null-argument constructor leaves partially-initialised object; no test for null input |
| A23-6 | MEDIUM | LoginItem.java | `contactperson == true` recursive-driver-parse branch entirely untested |
| A23-7 | LOW | LoginItem.java | Dead `android.util.Log` import in a credential-parsing class |
| A23-8 | LOW | ManufactureItem.java | Both constructors untested; zero-state and missing-key paths unverified |
| A23-9 | LOW | ManufactureItem.java | Five unused imports from template generation |
| A23-10 | HIGH | PermissionItem.java | `gsm_token` security credential in a `public` field on a `Serializable` class; no lifecycle test |
| A23-11 | MEDIUM | PermissionItem.java | `enabled` typed as `String` with undefined accepted values; null risk for callers |
| A23-12 | MEDIUM | PermissionItem.java | Null-argument constructor leaves all fields at defaults; callers unchecked |
| A23-13 | LOW | PermissionItem.java | All constructor paths untested |
| A23-14 | LOW | PermissionItem.java | Five unused imports from template generation |
