# Audit Pass 2 – Agent A39
**Audit run:** 2026-02-26-01
**Assigned files:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/PreStartHelpResultArray.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/PreStartQuestionResultArray.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/results/ReportResultArray.java`

---

## PROJECT-WIDE FINDING (applies to all files)

### A39-0 — HIGH: Zero automated test coverage across app/ and LibCommon/ modules

Neither the `app/` module nor the `LibCommon/` module contains a `src/test/` or `src/androidTest/` directory. The only test code found in the repository lives inside the third-party `LibImageloader` module (`LibImageloader/src/test/java/`), which is unrelated to application logic. Every class, method, and code path in the application under review is entirely untested. All file-specific findings below are therefore unmitigated — there is no existing test suite that could partially cover these gaps.

**Impact:** Any regression, edge-case defect, or safety-critical parsing failure can reach production without automated detection.

---

## File 1: PreStartHelpResultArray.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.PreStartHelpResultArray`

**Superclass:** `WebServiceResultPacket` (itself extends `WebServicePacket`), implements `java.io.Serializable`

**Fields defined:**
| Field | Type | Visibility | Line |
|---|---|---|---|
| `arrayList` | `ArrayList<PreStartHelpItem>` | `public` | 14 |

**Methods defined:**
| Line | Signature |
|---|---|
| 16 | `public PreStartHelpResultArray()` — no-arg constructor |
| 19 | `public PreStartHelpResultArray(JSONArray jsonArray) throws JSONException` — parsing constructor |

**Item class used:** `PreStartHelpItem` (fields: `id`, `input_order`, `input_type`, `input_label`, `input_value`, `input_image`, `expected_answer`)

**Parse logic summary (lines 21–29):**
- Initialises `arrayList` unconditionally.
- Guards against `null` `jsonArray` (skips the loop).
- Iterates the array, constructing a `PreStartHelpItem` per element by calling `jsonArray.getJSONObject(i)`.
- Does not catch `JSONException`; the exception propagates to the caller.

---

### Findings for PreStartHelpResultArray.java

#### A39-1 — LOW: No-arg constructor leaves `arrayList` as `null`; callers receive an uninitialised collection field

**File:** `PreStartHelpResultArray.java`, line 16

The no-arg constructor performs no work. The public field `arrayList` is left `null`. Any caller that constructs a `PreStartHelpResultArray` via the no-arg constructor and then directly accesses `arrayList` (e.g., `result.arrayList.size()`) will throw a `NullPointerException` at runtime. No test verifies that the no-arg constructor produces a safe, usable object.

**Untested scenarios:**
- Constructing via `new PreStartHelpResultArray()` and iterating `arrayList`.
- Serialising and deserialising an instance built with the no-arg constructor.

---

#### A39-2 — MEDIUM: No test for `JSONException` propagation from the parsing constructor

**File:** `PreStartHelpResultArray.java`, line 19

The constructor declares `throws JSONException`. If `jsonArray.getJSONObject(i)` returns malformed data that causes `PreStartHelpItem(JSONObject)` to throw `JSONException`, the exception propagates uncaught to the HTTP layer. No test exercises:
- A `JSONArray` containing a non-object element (e.g., a JSON string or number at position `i`).
- A `JSONArray` whose elements are missing expected keys that `PreStartHelpItem` reads.

The absence of any test means the failure mode of the entire help-content screen under a bad server response is unknown.

---

#### A39-3 — LOW: No test for empty `JSONArray` input

**File:** `PreStartHelpResultArray.java`, line 19

When `jsonArray` is a valid but zero-length `JSONArray`, the loop body never executes and `arrayList` is initialised as empty. No test confirms that this results in a non-null, zero-length list and that downstream consumers handle the empty collection gracefully. This is a boundary condition (length = 0) with no coverage.

---

#### A39-4 — LOW: No test for `null` `JSONArray` input

**File:** `PreStartHelpResultArray.java`, line 23

The `if (jsonArray != null)` guard means that passing `null` results in a non-null but empty `arrayList`. No test explicitly exercises this path to confirm the guard works and that `arrayList` is properly initialised (not `null`) after the constructor returns with a `null` argument.

---

## File 2: PreStartQuestionResultArray.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.PreStartQuestionResultArray`

**Superclass:** `WebServiceResultPacket`, implements `java.io.Serializable`

**Fields defined:**
| Field | Type | Visibility | Line |
|---|---|---|---|
| `arrayList` | `ArrayList<PreStartQuestionItem>` | `public` | 14 |

**Methods defined:**
| Line | Signature |
|---|---|
| 16 | `public PreStartQuestionResultArray()` — no-arg constructor |
| 19 | `public PreStartQuestionResultArray(JSONArray jsonArray) throws JSONException` — parsing constructor |

**Item class used:** `PreStartQuestionItem` (fields: `id`, `content`, `expectedanswer`)

**Parse logic summary (lines 21–29):**
- Initialises `arrayList` unconditionally.
- Guards against `null` `jsonArray`.
- Iterates, constructing `PreStartQuestionItem` per element.
- Does not catch `JSONException`.

**Safety-critical context established by cross-file analysis:**

This class is the central data carrier for the equipment pre-start safety checklist. The call chain is:

1. `WebApi.getPreStartQuestionList()` parses the server response into a `PreStartQuestionResultArray`.
2. `PreStartCheckListPresenter.getPreStartCheckListInfo()` delivers it to `EquipmentPrestartFragment.setRecyclerViewdata()`.
3. `EquipmentPrestartFragment.onMiddleButton()` enforces the rule: **"answers answered == questions in list"** before allowing the operator to proceed (`presenter.mapAnswers.size() != qustionItemArrayList.size()`).
4. If the server call fails, `PreStartCheckListPresenter` falls back to `PreStartQuestionDb.getQuestionResultArray()`, which returns a `PreStartQuestionResultArray` with an empty `arrayList` when no cached data exists (lines 46–48 of `PreStartQuestionDb`).

The consequence: if `arrayList` is empty (zero questions), the `mapAnswers.size() == 0` equals `qustionItemArrayList.size() == 0`, the check passes, and the operator is allowed to advance through the pre-start screen without answering any safety questions. No test defends against this bypass.

---

### Findings for PreStartQuestionResultArray.java

#### A39-5 — HIGH: No test for empty question list allowing pre-start safety bypass

**File:** `PreStartQuestionResultArray.java`, line 14; related: `PreStartCheckListPresenter.java` lines 46–50, `EquipmentPrestartFragment.java` line 136

When the server is unavailable and no valid cached questions exist, `PreStartQuestionDb.getQuestionResultArray()` returns a `PreStartQuestionResultArray` with an empty `arrayList` (zero questions). This object is passed to `EquipmentPrestartFragment.setRecyclerViewdata()`, which populates `qustionItemArrayList` with zero elements. The save-guard check on line 136 of `EquipmentPrestartFragment` (`presenter.mapAnswers.size() != qustionItemArrayList.size()`) evaluates as `0 != 0 = false`, so the guard is skipped and the operator proceeds without completing any safety checks.

No test verifies that an empty question list is treated as an error condition. No test verifies that the UI rejects an empty checklist. No test verifies that the offline fallback path cannot produce a zero-question result that passes the gate.

**Risk:** An operator can bypass the pre-start safety checklist entirely if the network is unavailable and the cache is cold (first use, cache cleared, or cache expired). A forklift with a mechanical fault could be put into operation without the operator completing the mandatory safety check.

---

#### A39-6 — HIGH: No test for malformed question data (`content` or `expectedanswer` null)

**File:** `PreStartQuestionResultArray.java`, line 19; related: `PreStartQuestionItem.java` lines 27–39; `EquipmentPrestartFragment.java` line 55

`PreStartQuestionItem` guards each field assignment with `isNull()` checks, so `content` and `expectedanswer` remain `null` (Java default) if the server omits those keys. `EquipmentPrestartFragment.setRecyclerViewdata()` at line 55 calls `item.content` directly in `dataList.add(item.content)`. If `content` is `null`, a null entry is added to `dataList`. Downstream rendering and answer-matching logic that expects a non-null string may silently display nothing, crash, or produce unpredictable behaviour.

No test verifies that a `PreStartQuestionItem` with missing `content` is handled safely at the UI layer. No test verifies that a question with a null `expectedanswer` does not subvert the answer-validation logic.

---

#### A39-7 — MEDIUM: No test for `JSONException` propagation from the parsing constructor

**File:** `PreStartQuestionResultArray.java`, line 19

Identical structural issue to A39-2, but elevated significance due to the safety-critical nature of this class. If the server returns a `JSONArray` whose elements are not `JSONObject` instances, the call to `jsonArray.getJSONObject(i)` throws `JSONException`, which propagates to the HTTP layer. The presenter's `onFailed` callback is then invoked, triggering the offline fallback — which, as documented in A39-5, may return an empty list and silently allow the pre-start bypass.

No test exercises this failure path end-to-end to confirm that a malformed server response does not result in the pre-start bypass being triggered via the error callback.

---

#### A39-8 — LOW: No-arg constructor leaves `arrayList` as `null`; used directly by `PreStartQuestionDb`

**File:** `PreStartQuestionResultArray.java`, line 16; related: `PreStartQuestionDb.java` lines 46–48

`PreStartQuestionDb.getQuestionResultArray()` constructs a `PreStartQuestionResultArray` via the no-arg constructor and then explicitly sets `arrayList` to `new ArrayList<>()` before returning. This works, but it depends on a caller correctly initialising the field after construction. No test verifies that any other caller using the no-arg constructor safely initialises `arrayList`. A future caller constructing via `new PreStartQuestionResultArray()` without setting `arrayList` would receive a `null` collection.

---

#### A39-9 — LOW: No test for empty `JSONArray` producing zero-question list

**File:** `PreStartQuestionResultArray.java`, line 19

Same structural gap as A39-3 but with higher consequence. A valid, zero-length `JSONArray` from the server (i.e., the equipment has no pre-start questions configured) produces a zero-question list that passes the UI gate, as described in A39-5. No test confirms that this is intentional or that a zero-length response from the server is distinguished from an error condition.

---

#### A39-10 — LOW: No test for `null` `JSONArray` input

**File:** `PreStartQuestionResultArray.java`, line 23

Same structural gap as A39-4. No test exercises the `null`-guarded constructor path and confirms the post-condition (`arrayList` non-null and empty).

---

## File 3: ReportResultArray.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.results.ReportResultArray`

**Superclass:** `WebServiceResultPacket`, implements `java.io.Serializable`

**Fields defined:**
| Field | Type | Visibility | Line |
|---|---|---|---|
| `arrayList` | `ArrayList<ReportItem>` | `public` | 14 |

**Methods defined:**
| Line | Signature |
|---|---|
| 16 | `public ReportResultArray()` — no-arg constructor |
| 19 | `public ReportResultArray(JSONArray jsonArray) throws JSONException` — parsing constructor |

**Item class used:** `ReportItem` (fields: `id`, `name`)

**Parse logic summary (lines 21–29):**
- Initialises `arrayList` unconditionally.
- Guards against `null` `jsonArray`.
- Iterates, constructing `ReportItem` per element.
- Does not catch `JSONException`.

**Consumer context (from `SavedReportFragment.java`):**
- `onData()` at line 67 calls `resultArray.arrayList` directly without a null check.
- If `arrayList` were null (possible via the no-arg constructor), this would throw a `NullPointerException`.
- The empty-list case is handled in the UI at lines 52–54 (shows an error dialog).

---

### Findings for ReportResultArray.java

#### A39-11 — LOW: No-arg constructor leaves `arrayList` as `null`; `SavedReportFragment.onData()` has no null guard

**File:** `ReportResultArray.java`, line 16; related: `SavedReportFragment.java` line 67

`SavedReportFragment.onData()` calls `listData.addAll(resultArray.arrayList)` without checking whether `arrayList` is null. If a `ReportResultArray` is ever delivered to this method with a null `arrayList` (e.g., constructed via the no-arg constructor by a future caller), an uncaught `NullPointerException` will crash the fragment. No test exercises this path.

---

#### A39-12 — MEDIUM: No test for `JSONException` propagation from the parsing constructor

**File:** `ReportResultArray.java`, line 19

The constructor propagates `JSONException` uncaught. No test exercises malformed input (non-object elements in the `JSONArray`, or `ReportItem` field parsing errors). The failure mode under a bad server response for the saved-reports screen is unverified.

---

#### A39-13 — LOW: No test for empty `JSONArray` input

**File:** `ReportResultArray.java`, line 19

The boundary case of a valid zero-length `JSONArray` produces an empty `arrayList`. While the UI in `SavedReportFragment` has an empty-list guard (lines 52–54), no test confirms this guard triggers correctly when a zero-length server response is parsed through this constructor.

---

#### A39-14 — LOW: No test for `null` `JSONArray` input

**File:** `ReportResultArray.java`, line 23

No test exercises the `null`-guarded constructor path and confirms the post-condition (`arrayList` is non-null and empty after construction).

---

## Summary Table

| ID | Severity | File | Description |
|---|---|---|---|
| A39-0 | HIGH | Project-wide | Zero automated test coverage in `app/` and `LibCommon/` modules |
| A39-1 | LOW | PreStartHelpResultArray | No-arg constructor leaves `arrayList` null; no test verifies safe construction |
| A39-2 | MEDIUM | PreStartHelpResultArray | No test for `JSONException` propagation from parsing constructor |
| A39-3 | LOW | PreStartHelpResultArray | No test for empty `JSONArray` boundary (zero-length input) |
| A39-4 | LOW | PreStartHelpResultArray | No test for `null` `JSONArray` input path |
| A39-5 | HIGH | PreStartQuestionResultArray | No test for empty question list allowing operator to bypass pre-start safety checklist |
| A39-6 | HIGH | PreStartQuestionResultArray | No test for malformed question data (`content`/`expectedanswer` null) reaching the UI |
| A39-7 | MEDIUM | PreStartQuestionResultArray | No test for `JSONException` propagation triggering silent pre-start bypass via error fallback |
| A39-8 | LOW | PreStartQuestionResultArray | No-arg constructor leaves `arrayList` null; correctness depends on caller initialisation |
| A39-9 | LOW | PreStartQuestionResultArray | No test for zero-length `JSONArray` producing zero-question list (safety gate implication) |
| A39-10 | LOW | PreStartQuestionResultArray | No test for `null` `JSONArray` input path |
| A39-11 | LOW | ReportResultArray | No-arg constructor leaves `arrayList` null; `SavedReportFragment.onData()` has no null guard |
| A39-12 | MEDIUM | ReportResultArray | No test for `JSONException` propagation from parsing constructor |
| A39-13 | LOW | ReportResultArray | No test for empty `JSONArray` boundary (zero-length input) |
| A39-14 | LOW | ReportResultArray | No test for `null` `JSONArray` input path |
