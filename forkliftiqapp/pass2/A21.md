# Audit Pass 2 – Test Coverage
**Agent:** A21
**Audit run:** 2026-02-26-01
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/CompanyItem.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/EquipmentItem.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/EquipmentStatsItem.java`

---

## Project-wide Finding

### A21-1 — HIGH: Zero automated test coverage in `app/` and `LibCommon/` modules

**Severity:** HIGH

The `app/` module and `LibCommon/` module contain no test directories whatsoever. A glob for `**/test/**/*.java` across the entire repository returned only two test files, both located in the unrelated `LibImageloader/` third-party library module. There are no JUnit, Espresso, Robolectric, or any other test files for any production code in `app/src/` or `LibCommon/src/`.

This means every class, method, parsing path, and security-sensitive field in the application's primary modules is completely untested. All file-specific findings below exist within this broader context of zero automated test coverage.

---

## File 1: CompanyItem.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.CompanyItem`

**Implements:** `java.io.Serializable`

**Fields defined (all `public`):**
| Field | Type | Line |
|---|---|---|
| `id` | `int` | 14 |
| `name` | `String` | 15 |
| `email` | `String` | 16 |
| `password` | `String` | 17 |
| `arrRoles` | `ArrayList<RoleItem>` | 18 |
| `permission` | `PermissionItem` | 19 |

**Methods defined:**
| Method | Line | Signature |
|---|---|---|
| `CompanyItem()` | 21 | `public CompanyItem()` — default no-arg constructor |
| `CompanyItem(JSONObject)` | 24 | `public CompanyItem(JSONObject jsonObject) throws JSONException` — deserialises from a JSON object; populates `id`, `name`, `email`, `password`, `arrRoles`, `permission` |

**Imports:** `org.json.JSONException`, `org.json.JSONObject`, `java.io.Serializable`, `org.json.JSONArray`, `java.util.ArrayList`, `java.math.BigDecimal` (unused), wildcard imports of `webserviceclasses.*` and `webserviceclasses.results.*`

---

### Findings for CompanyItem.java

#### A21-2 — HIGH: `password` field is accepted from server JSON response and stored in a `Serializable` object with no test verifying it is not persisted or logged

**Severity:** HIGH

`CompanyItem` declares a `public String password` field (line 17). The JSON constructor at line 44–47 unconditionally reads a `"password"` key from the server response and stores it in plaintext:

```java
if (!jsonObject.isNull("password"))
{
    password = jsonObject.getString("password");
}
```

`CompanyItem` implements `java.io.Serializable`. A serializable object carrying a plaintext password can be inadvertently persisted to disk (via `Bundle`, `Intent` extras, object serialisation streams, or crash-reporting SDKs that serialise `Throwable` causes). There is no `transient` modifier on the `password` field and no `writeObject`/`readObject` override that would exclude it.

There is no test that:
- Verifies `password` is not written to `SharedPreferences`, a file, or a database.
- Verifies `password` is not emitted to Logcat (e.g., via an unguarded `toString()`, exception message, or debug log that references the object).
- Verifies that after deserialisation the field is cleared (`password = null`) once consumed.
- Verifies that the field is marked `transient` or otherwise excluded from serialisation.

A grep of `Log.` calls referencing `CompanyItem` or its `password` field returned no matches, which means no logging guard is present — but also means the absence of intentional logging cannot be confirmed by testing. Any future refactor (e.g., adding a `toString()` override, passing the object to a logging framework, or transmitting it in a `Bundle`) would silently expose the password with no test to catch the regression.

Additionally, the server API returning a password at all is architecturally suspicious and warrants review of what credential is actually being transmitted (plaintext password, token, or hash).

---

#### A21-3 — LOW: No test for `CompanyItem(JSONObject)` null-input path

**Severity:** LOW

The JSON constructor guards against a null `jsonObject` parameter (line 26: `if (jsonObject != null)`), silently producing a zero-valued/null-field object. There is no test confirming that passing `null` produces a safely initialised object rather than throwing an exception or leaving the object in an undefined state. While the null guard is present, the behaviour is untested.

---

#### A21-4 — LOW: No test for `CompanyItem(JSONObject)` with missing or null JSON keys

**Severity:** LOW

Each field is guarded with `jsonObject.isNull(key)` checks before assignment. There is no test verifying that partial JSON (e.g., a payload that includes `id` and `name` but omits `password`, `arrRoles`, or `permission`) leaves the remaining fields as Java defaults (`0`, `null`) rather than throwing. The `arrRoles` array list is also only initialised when the key is present; callers iterating `arrRoles` without a null check would throw a `NullPointerException`. No test covers this path.

---

#### A21-5 — LOW: No test for `arrRoles` JSON array deserialization

**Severity:** LOW

Lines 51–58 iterate a `JSONArray` named `"arrRoles"` and construct `RoleItem` objects. There is no test for:
- An empty array (`[]`), which should produce an empty `ArrayList`.
- An array whose elements are malformed or missing expected fields, which would propagate a `JSONException` from `RoleItem`'s constructor.

---

#### A21-6 — INFO: Unused import `java.math.BigDecimal`

**Severity:** INFO

`CompanyItem.java` imports `java.math.BigDecimal` (line 8) but no field or method references `BigDecimal`. No test exercises or validates the absence of `BigDecimal` logic. This is a dead import suggesting copy-paste origin and warrants cleanup.

---

## File 2: EquipmentItem.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.EquipmentItem`

**Implements:** `java.io.Serializable`

**Fields defined (all `public`):**
| Field | Type | Line |
|---|---|---|
| `type_id` | `int` | 10 |
| `comp_id` | `int` | 11 |
| `fuel_type_id` | `int` | 12 |
| `impact_threshold` | `int` | 13 |
| `manu_id` | `int` | 14 |
| `id` | `int` | 15 |
| `name` | `String` | 16 |
| `type` | `String` | 17 |
| `manu` | `String` | 18 |
| `fuel_type` | `String` | 19 |
| `comp` | `String` | 20 |
| `serial_no` | `String` | 21 |
| `mac_address` | `String` | 22 |
| `url` | `String` | 23 |
| `active` | `boolean` | 24 |
| `alert_enabled` | `boolean` | 25 |
| `driver_based` | `boolean` | 26 |
| `hours` | `int` | 27 |
| `trained` | `boolean` | 28 |

**Methods defined:**
| Method | Line | Signature |
|---|---|---|
| `EquipmentItem()` | 30 | `public EquipmentItem()` — default no-arg constructor |
| `EquipmentItem(JSONObject)` | 33 | `public EquipmentItem(JSONObject jsonObject) throws JSONException` — delegates all field parsing to `JSONObjectParser`; returns early if `jsonObject == null` |

**Key dependency:** `JSONObjectParser` (line 36) — wraps the raw `JSONObject` to provide null-safe getters (`getInt`, `getString`, `getBoolean`).

---

### Findings for EquipmentItem.java

#### A21-7 — LOW: No test for `EquipmentItem(JSONObject)` with null input

**Severity:** LOW

Line 34 (`if (jsonObject == null) return;`) silently produces a zero-valued object when passed `null`. There is no test confirming this early-return behaviour. Callers that pass `null` would receive an `EquipmentItem` with all numeric fields at `0`, all booleans at `false`, and all strings at `null` — this could silently propagate invalid state (e.g., an equipment item with `id == 0` being mistaken for a valid record).

---

#### A21-8 — LOW: No test for `EquipmentItem(JSONObject)` with partial or malformed JSON

**Severity:** LOW

`JSONObjectParser.getInt()` returns `0` for null keys; `getString()` returns `null`; `getBoolean()` returns `false`. There is no test verifying:
- That a JSON object missing most fields produces predictable defaults.
- That a field containing a value of the wrong type (e.g., a string where an int is expected) propagates a `JSONException` rather than silently defaulting.

---

#### A21-9 — LOW: `mac_address` field has no validation test

**Severity:** LOW

`mac_address` is parsed as a plain `String` with no format validation. There is no test verifying that an invalid MAC address string (malformed, empty, or containing injection characters) is rejected or sanitised before the value is used elsewhere in the application (e.g., for BLE pairing logic observed in `BleController.java`). Incorrect MAC address values propagated silently could cause BLE connection failures or incorrect device targeting.

---

#### A21-10 — INFO: No test covering `EquipmentItem` equality or identity semantics

**Severity:** INFO

`EquipmentItem` does not override `equals()` or `hashCode()`. Multiple callers maintain `ArrayList<EquipmentItem>` collections. There is no test verifying that two items representing the same equipment (same `id`) compare as expected, or that collections behave correctly when the same item is deserialised twice. This is an INFO-level gap given the current usage patterns.

---

## File 3: EquipmentStatsItem.java

### Reading Evidence

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.EquipmentStatsItem`

**Implements:** `java.io.Serializable`

**Fields defined (all `public`):**
| Field | Type | Line |
|---|---|---|
| `unit_id` | `int` | 14 |
| `unit` | `String` | 15 |
| `total` | `double` | 16 |
| `usageList` | `ArrayList<EqupmentUsageItem>` | 17 |

Note: The referenced type `EqupmentUsageItem` contains a typo (missing 'i' in "Equipment") consistent with its declaration in `EqupmentUsageItem.java`.

**Methods defined:**
| Method | Line | Signature |
|---|---|---|
| `EquipmentStatsItem()` | 19 | `public EquipmentStatsItem()` — default no-arg constructor |
| `EquipmentStatsItem(JSONObject)` | 22 | `public EquipmentStatsItem(JSONObject jsonObject) throws JSONException` — populates `unit_id`, `unit`, `total`, and `usageList` from JSON; guards on `jsonObject != null` |

**Imports:** `org.json.JSONException`, `org.json.JSONObject`, `java.io.Serializable`, `org.json.JSONArray`, `java.util.ArrayList`, `java.math.BigDecimal` (unused), wildcard imports of `webserviceclasses.*` and `webserviceclasses.results.*`

---

### Findings for EquipmentStatsItem.java

#### A21-11 — LOW: No test for `EquipmentStatsItem(JSONObject)` with null input

**Severity:** LOW

The null guard at line 24 (`if (jsonObject != null)`) silently produces a zero-valued object. There is no test confirming this behaviour. A caller receiving an `EquipmentStatsItem` with `total == 0.0` and `usageList == null` (rather than an exception) may silently display incorrect statistics to the user.

---

#### A21-12 — LOW: No test for `usageList` null-vs-empty distinction

**Severity:** LOW

When the `"usageList"` key is absent from the JSON, `usageList` remains `null` (Java default for an object field). When the key is present but the array is empty (`[]`), `usageList` is initialised to an empty `ArrayList`. Callers in `DriverStatsFragment3.java` (line 295–297) iterate `usageList` without an explicit null check before the loop. There is no test verifying that the null case is handled gracefully by either the DTO or its callers, which represents a real `NullPointerException` risk at runtime.

---

#### A21-13 — LOW: No test for `total` field with extreme or non-finite double values

**Severity:** LOW

The `total` field is parsed via `jsonObject.getDouble("total")` (line 39). There is no test verifying behaviour when the server returns `NaN`, `Infinity`, `-Infinity`, or a very large/small floating-point value. These edge cases can produce rendering anomalies or incorrect aggregation in the statistics display.

---

#### A21-14 — LOW: No test for `usageList` JSON array deserialization error propagation

**Severity:** LOW

Lines 44–50 iterate the `"usageList"` array and construct `EqupmentUsageItem` objects. A `JSONException` thrown by `EqupmentUsageItem`'s constructor for a malformed element would propagate up through `EquipmentStatsItem`'s constructor, leaving the partially-constructed `EquipmentStatsItem` with a partially-populated `usageList`. No test verifies that the error is detected or that the caller handles this partial state safely.

---

#### A21-15 — INFO: Unused import `java.math.BigDecimal`

**Severity:** INFO

`EquipmentStatsItem.java` imports `java.math.BigDecimal` (line 8) but no field or method references it. This is the same copy-paste artefact observed in `CompanyItem.java` (A21-6), suggesting both files share a common template origin.

---

#### A21-16 — INFO: Typo in type name `EqupmentUsageItem` (missing 'i')

**Severity:** INFO

The field `usageList` is declared as `ArrayList<EqupmentUsageItem>` (line 17) — the class name misspells "Equipment" as "Equpment". While this is consistent with the actual class name in `EqupmentUsageItem.java` and therefore compiles, there is no test that would catch a future rename or prevent the typo from propagating to new references. This is recorded as an INFO-level naming quality finding.

---

## Summary Table

| Finding ID | Severity | File | Description |
|---|---|---|---|
| A21-1 | HIGH | Project-wide | Zero automated test coverage in `app/` and `LibCommon/` modules |
| A21-2 | HIGH | CompanyItem.java | `password` field stored in `Serializable` object with no test verifying it is not persisted or logged |
| A21-3 | LOW | CompanyItem.java | No test for null `JSONObject` input to constructor |
| A21-4 | LOW | CompanyItem.java | No test for partial/null JSON keys; `arrRoles` left `null` when key absent |
| A21-5 | LOW | CompanyItem.java | No test for `arrRoles` JSON array deserialization (empty array, malformed elements) |
| A21-6 | INFO | CompanyItem.java | Unused import `java.math.BigDecimal` |
| A21-7 | LOW | EquipmentItem.java | No test for null `JSONObject` input (silent zero-valued object) |
| A21-8 | LOW | EquipmentItem.java | No test for partial or malformed JSON field values |
| A21-9 | LOW | EquipmentItem.java | `mac_address` field has no format validation test |
| A21-10 | INFO | EquipmentItem.java | No `equals()`/`hashCode()` override and no test for collection identity semantics |
| A21-11 | LOW | EquipmentStatsItem.java | No test for null `JSONObject` input (silent zero-valued object with null `usageList`) |
| A21-12 | LOW | EquipmentStatsItem.java | No test for null-vs-empty `usageList` distinction; caller iterates without null guard |
| A21-13 | LOW | EquipmentStatsItem.java | No test for non-finite `double` values in `total` field |
| A21-14 | LOW | EquipmentStatsItem.java | No test for `JSONException` during partial `usageList` array deserialization |
| A21-15 | INFO | EquipmentStatsItem.java | Unused import `java.math.BigDecimal` |
| A21-16 | INFO | EquipmentStatsItem.java | Typo in type name `EqupmentUsageItem` — missing 'i' in "Equipment" |
