# Audit Pass 2 — Agent A31
**Audit run:** 2026-02-26-01
**Agent:** A31
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/SaveLicenseParameter.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/SaveMultipleGPSParameter.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/WebService/webserviceclasses/parameters/SavePreStartParameter.java`

---

## Project-Wide Finding (applies to all assigned files)

### A31-1 — HIGH: Zero automated test coverage in `app/` and `LibCommon/` modules

No `src/test/` or `src/androidTest/` directory exists under `app/` or `LibCommon/`. The only test files found in the repository are in third-party library modules (`LibImageloader`, `LibImagePicker`, `LibPercentProgress`) and are not authored by this project. The three classes examined here have no corresponding test files anywhere in the codebase, confirmed by exhaustive glob and grep searches across all test directories.

**Impact:** Every finding below is escalated by this context. There is no safety net for regressions. Any defect in parameter construction, field population, or boundary behaviour will reach production undetected.

**Evidence of absence:**
- `app/src/test/` — does not exist
- `app/src/androidTest/` — does not exist
- `LibCommon/src/test/` — does not exist
- `LibCommon/src/androidTest/` — does not exist

---

## File 1: SaveLicenseParameter.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.SaveLicenseParameter`

**Extends / Implements:**
- `WebServiceParameterPacket` (extends `WebServicePacket`, implements `Serializable`)
- `Serializable`

**Fields defined (all public):**

| Line | Type   | Name         |
|------|--------|--------------|
| 14   | `int`  | `id`         |
| 15   | `String` | `licno`    |
| 16   | `String` | `addr`     |
| 17   | `String` | `expirydt` |
| 18   | `String` | `securityno` |

**Methods defined:**

| Line | Signature                      |
|------|-------------------------------|
| 20   | `public SaveLicenseParameter()` |

**Test files:** None. No test file exists for this class or its callers in `app/`.

---

### A31-2 — LOW: No test for default-value state of `SaveLicenseParameter`

The single constructor (line 20) is a no-arg default. All five fields remain at their Java defaults after construction: `id = 0`, `licno = null`, `addr = null`, `expirydt = null`, `securityno = null`. No test verifies that a newly constructed instance is in the expected default state, and no test verifies that the serialized form of a fully-populated instance round-trips correctly under Java serialization or Gson.

**Call site:** `WebApi.saveLicense(SaveLicenseParameter, ...)` (WebApi.java line 333). The parameter is built by caller code not under test. If any field is omitted by the caller, a null string or zero id is silently transmitted to the server.

**Finding:** MEDIUM risk is mitigated to LOW because license data is not safety-critical in a forklift context (no fail-open behaviour results), but the absence of any round-trip or non-null assertion test remains a gap.

---

### A31-3 — LOW: No test for `Serializable` contract of `SaveLicenseParameter`

`SaveLicenseParameter` implements `Serializable` (via its parent chain) but declares no `serialVersionUID`. No test exercises Java object serialization and deserialization of this class. A change to the class (adding or removing a field) will silently alter the serialized form and may cause `InvalidClassException` at runtime when deserializing previously stored data. `SessionDb` stores a `SavePreStartParameter` (the sister class) as a JSON string via Gson, but the `Serializable` interface is used elsewhere in the codebase for intent/bundle passing.

---

## File 2: SaveMultipleGPSParameter.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.SaveMultipleGPSParameter`

**Extends / Implements:**
- `WebServiceParameterPacket` (extends `WebServicePacket`, implements `Serializable`)
- `Serializable`

**Fields defined (all public):**

| Line | Type                              | Name      |
|------|-----------------------------------|-----------|
| 10   | `ArrayList<SaveGPSLocationItem>`  | `gpsList` |

**Methods defined:**

| Line | Signature                             |
|------|--------------------------------------|
| 12   | `public SaveMultipleGPSParameter()`   |

The constructor (line 12–14) initialises `gpsList` to a new empty `ArrayList`. This is the only behaviour in the class.

**Test files:** None. No test file exists for this class or its callers in `app/`.

---

### A31-4 — MEDIUM: No test for empty `gpsList` boundary condition

`LocationDb.uploadLocation()` (LocationDb.java line 88–89) guards against an empty list before constructing a `SaveMultipleGPSParameter`, but `LocationDb.removeData(Realm, SaveMultipleGPSParameter)` (LocationDb.java line 64–73) iterates directly over `parameter.gpsList` with no guard. If a `SaveMultipleGPSParameter` with an empty list is passed to `removeData`, the loop body is simply skipped — correct in isolation — but no test confirms this is the intended contract and no test confirms that `saveMultipleGPSLocation` on the server side also handles an empty list gracefully. The API endpoint behaviour with zero items is unverified.

**Specific gap:** No test constructs a `SaveMultipleGPSParameter` with `gpsList` left empty (default post-construction state) and submits it or passes it to `removeData`.

---

### A31-5 — MEDIUM: No test for oversized `gpsList`

`gpsList` is an unbounded `ArrayList`. There is no maximum-size guard anywhere in the construction path (`LocationDb.uploadLocation()` adds all Realm-persisted location records in a single batch, line 92–93). If many GPS records accumulate offline (device offline for an extended period), the single API call will attempt to transmit a large payload. No test verifies behaviour under a large list: server-side payload limits, request timeout, or Volley/OkHttp request-body size constraints are not exercised. A silent upload failure leaves records un-deleted from Realm, potentially causing repeated re-upload on the next sync cycle.

---

### A31-6 — LOW: No `serialVersionUID` on `SaveMultipleGPSParameter`

Same category as A31-3. The class implements `Serializable` (via parent chain) but declares no `serialVersionUID`. No test exercises serialization round-trip. See A31-3 for impact description.

---

## File 3: SavePreStartParameter.java

**Fully qualified class name:**
`au.com.collectiveintelligence.fleetiq360.WebService.webserviceclasses.parameters.SavePreStartParameter`

**Extends / Implements:**
- `WebServiceParameterPacket` (extends `WebServicePacket`, implements `Serializable`)
- `Serializable`

**Fields defined (all public):**

| Line | Type                      | Name          |
|------|---------------------------|---------------|
| 14   | `String`                  | `start_time`  |
| 15   | `String`                  | `finish_time` |
| 16   | `String`                  | `comment`     |
| 17   | `int`                     | `session_id`  |
| 18   | `ArrayList<AnswerItem>`   | `arrAnswers`  |

**Methods defined:**

| Line | Signature                        |
|------|----------------------------------|
| 20   | `public SavePreStartParameter()` |

The constructor (line 20) is a no-arg default. **No field is initialised in the constructor.** All fields remain at Java defaults after construction: all `String` fields are `null`, `session_id = 0`, `arrAnswers = null`.

**Test files:** None. No test file exists for this class, `PreStartCheckListPresenter`, or the `WebApi.savePreStartResult` call path in `app/`.

---

### A31-7 — HIGH: No test verifies that all required pre-start fields are populated before submission

`SavePreStartParameter` carries the safety-critical pre-start inspection answers for a forklift session. The pre-start check is the primary mechanism preventing an operator from using unsafe equipment. The class has five fields, none initialised in the constructor, and no validation method exists anywhere in the class.

`PreStartCheckListPresenter.savePreStartCheckListAnswerResult()` (PreStartCheckListPresenter.java lines 58–109) populates the parameter inline before calling `WebApi.async().savePreStartResult()`:

```
parameter.start_time  = WebData.instance().getSessionResult().start_time;  // line 62
parameter.finish_time = serverDateFormatter.formatDateTime(...);             // line 63
parameter.session_id  = WebData.instance().getSessionResult().id;           // line 64
parameter.arrAnswers  = list;                                               // line 65
parameter.comment     = comments;                                           // line 66
```

No test exercises any of the following gaps:

1. **`arrAnswers` is null or empty.** If `mapAnswers` is empty (no questions were answered, or the UI was bypassed), `list` will be empty and `arrAnswers` will be an empty `ArrayList`. The server will receive a pre-start submission with zero answers. No field-level guard exists in `SavePreStartParameter`, and no test confirms the server rejects or the client blocks such a submission.

2. **`arrAnswers` contains `AnswerItem` entries where `answer` is `null`.** `AnswerItem` (AnswerItem.java line 31) assigns `answer` only when the JSON key is non-null; the field defaults to `null`. A partially answered pre-start check — with some answers omitted — will produce `AnswerItem` objects with `answer = null`. No test confirms the server rejects these or that the client enforces completeness.

3. **`start_time` or `finish_time` is null.** If `WebData.instance().getSessionResult()` returns a session with a null `start_time`, or if `serverDateFormatter.formatDateTime()` returns null, the parameter is submitted with null time fields. No null-guard exists and no test covers this path.

4. **`session_id` is zero.** If `getSessionResult().id` is 0 (uninitialised or error state), the pre-start result is submitted against session ID 0. No test exercises this scenario.

5. **Offline fallback path.** `onFailed` (lines 82–106) calls `SessionDb.setSessionPreStartFinished(parameter.session_id, parameter, true)` and then proceeds to the next UI step (`ui.showNext()`). This means a failed submission — including one with null/empty required fields — silently advances the workflow and marks the session as pre-start finished. No test verifies that the offline path correctly rejects or preserves an incomplete parameter.

**This is a safety-critical gap.** The pre-start checklist exists to block operation of potentially unsafe equipment. A submission path that silently accepts null answers, a zero session ID, or empty answer lists — and then advances the operator to the next screen — undermines the entire safety gate without any alerting, logging, or test coverage.

---

### A31-8 — HIGH: No test for `arrAnswers` null-pointer dereference risk

`arrAnswers` is declared at line 18 but never initialised in the constructor (line 20). The constructor is a no-arg default that performs no initialisation. Any code that calls `parameter.arrAnswers.size()` or iterates over `parameter.arrAnswers` without a null check will throw a `NullPointerException` at runtime.

`SessionDb` (SessionDb.java line 97) assigns `savePreStartItem.arrAnswers = parameter.arrAnswers` directly. If a `SavePreStartParameter` is round-tripped through Gson (`GsonHelper.objectFromString`, line 87) and the stored JSON lacks the `arrAnswers` key, Gson will leave the field null. No test exercises this deserialization path with missing or null `arrAnswers`.

---

### A31-9 — LOW: No `serialVersionUID` on `SavePreStartParameter`

Same category as A31-3 and A31-6. `SavePreStartParameter` implements `Serializable` (via parent chain) but declares no `serialVersionUID`. No test exercises Java object serialization and deserialization. See A31-3 for impact description. In the context of this class, the risk is slightly elevated because the class is persisted via Gson string in `SessionDb` for offline replay, meaning serialization-form changes could silently corrupt stored offline session data.

---

### A31-10 — INFO: No test verifies Gson round-trip fidelity for `SavePreStartParameter`

`SessionDb` persists `SavePreStartParameter` as a Gson JSON string for offline support (line 87: `GsonHelper.objectFromString(preStartResults, SavePreStartParameter.class)`). No test verifies that a fully populated `SavePreStartParameter` (with all five fields set and a non-empty `arrAnswers` list) correctly round-trips through Gson serialization and deserialization. This is particularly relevant for `ArrayList<AnswerItem>` which requires Gson to correctly handle generic type tokens. A Gson misconfiguration would silently lose all answer data on offline replay.

---

## Summary Table

| ID     | Severity | File                        | Finding                                                                 |
|--------|----------|-----------------------------|-------------------------------------------------------------------------|
| A31-1  | HIGH     | Project-wide                | Zero automated test coverage in `app/` and `LibCommon/` modules         |
| A31-2  | LOW      | SaveLicenseParameter        | No test for default-value state or field population                     |
| A31-3  | LOW      | SaveLicenseParameter        | No `serialVersionUID`; no serialization round-trip test                 |
| A31-4  | MEDIUM   | SaveMultipleGPSParameter    | No test for empty `gpsList` boundary condition                          |
| A31-5  | MEDIUM   | SaveMultipleGPSParameter    | No test for oversized `gpsList` (unbounded batch upload)                |
| A31-6  | LOW      | SaveMultipleGPSParameter    | No `serialVersionUID`; no serialization round-trip test                 |
| A31-7  | HIGH     | SavePreStartParameter       | No test verifies all required pre-start fields are populated; safety-critical |
| A31-8  | HIGH     | SavePreStartParameter       | `arrAnswers` is never initialised in constructor; NPE risk on null field |
| A31-9  | LOW      | SavePreStartParameter       | No `serialVersionUID`; offline Gson persistence at risk from class changes |
| A31-10 | INFO     | SavePreStartParameter       | No Gson round-trip test for offline persistence of pre-start data       |
