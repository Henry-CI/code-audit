# Pass 2 Audit — Agent A58
**Audit run:** 2026-02-26-01
**Agent:** A58
**Files assigned:**
1. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/adapter/SelectForkAdapter.java`
2. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/application/MyApplication.java`
3. `app/src/main/java/au/com/collectiveintelligence/fleetiq360/ui/common/FleetActivity.java`

---

## PROJECT-WIDE FINDING: Zero Automated Test Coverage (HIGH)

**Finding ID:** A58-1
**Severity:** HIGH
**Scope:** Project-wide (`app/` module and `LibCommon/` module)

Neither the `app/` module nor the `LibCommon/` module contains any test directory. A comprehensive glob search for `**/test/**` under both module roots returned zero results. The only test files in the entire repository reside in the third-party `LibImageloader/` module (`ImageSizeTest.java` and `BaseImageDownloaderTest.java`), which are tests of the upstream Universal Image Loader library, not of application code.

**Evidence of zero test coverage:**
- `app/src/test/` — does not exist
- `app/src/androidTest/` — does not exist
- `LibCommon/src/test/` — does not exist
- `LibCommon/src/androidTest/` — does not exist

This means every class, method, and code path in the entire application is untested. There is no regression safety net. Any refactoring, dependency upgrade, or bug fix cannot be validated programmatically. The individual file findings below document specific high-risk gaps, but the absence of any test infrastructure is itself the root cause.

---

## File 1: SelectForkAdapter.java

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.ui.adapter.SelectForkAdapter`

**Superclass:** `AbsRecyclerAdapter<String>` (generic RecyclerView adapter base class in the same package)

**Fields defined:**

| Field | Type | Line |
|---|---|---|
| `presenter` | `EquipmentSelectForkPresenter` (private) | 11 |

**Methods defined:**

| Method | Line | Signature |
|---|---|---|
| `setPresenter` | 13 | `public void setPresenter(EquipmentSelectForkPresenter presenter)` |
| constructor | 17 | `public SelectForkAdapter(Context context, int resId)` |
| `bindDatas` | 22 | `@Override public void bindDatas(MyViewHolder holder, String data, final int position)` |

**Inherited methods from `AbsRecyclerAdapter<String>` (referenced for coverage completeness):**
- `setDatas(List<String>)` — line 31 of AbsRecyclerAdapter
- `getDatas()` — line 36
- `getItemCount()` — line 41
- `onCreateViewHolder(ViewGroup, int)` — line 47
- `onBindViewHolder(ViewHolder, int)` — line 54 (calls `bindDatas`)
- `setOnItemClickListener(OnItemClickListener)` — line 100

**Constants defined:** None

**Call chain inside `bindDatas` (lines 22–29):**
1. Retrieves a `TextView` via `holder.getView(R.id.equipment_selectfork_item_text_id)` and sets `data` as text.
2. Retrieves an `ImageView` via `holder.getView(R.id.equipment_selectfork_item_image_id)`.
3. If `presenter != null` AND `position < presenter.ui.urlList.size()`, calls `presenter.showImage(presenter.ui.urlList.get(position), iv)`.
4. `presenter.showImage()` (confirmed by reading `EquipmentSelectForkPresenter.java` line 71) unconditionally calls `UserPhotoFragment.SSLCertificateHandler.nuke()` before every image load.

**Test file:** None. No test references to `SelectForkAdapter` exist anywhere in the repository.

---

### Findings — SelectForkAdapter.java

#### A58-2 — CRITICAL: `bindDatas()` triggers process-wide SSL/TLS disablement on every list item render

**Severity:** CRITICAL
**File:** `SelectForkAdapter.java`
**Line:** 27 (`presenter.showImage(...)`) → `EquipmentSelectForkPresenter.java:71` (`SSLCertificateHandler.nuke()`) → `UserPhotoFragment.java:41–69`

**Description:**

Every time `SelectForkAdapter.bindDatas()` renders a list item with a valid presenter and a URL at the given position, it calls `presenter.showImage()`. That method unconditionally calls `UserPhotoFragment.SSLCertificateHandler.nuke()` (confirmed at `EquipmentSelectForkPresenter.java` line 71). The `nuke()` method:

1. Constructs an `X509TrustManager` whose `checkClientTrusted()` and `checkServerTrusted()` bodies are both empty — no certificate chain validation is ever performed.
2. Installs this trust-all manager as the JVM-wide default via `HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory())`.
3. Installs a `HostnameVerifier` that unconditionally returns `true` via `HttpsURLConnection.setDefaultHostnameVerifier(...)`.
4. Both suppressions (`@SuppressLint("TrustAllX509TrustManager")` and `@SuppressLint("BadHostnameVerifier")`) are present, confirming the developer was warned by Android Lint and chose to silence rather than fix the warnings.

The effect is process-wide and permanent for the lifetime of the application process. Once `bindDatas()` is called for any item (which occurs automatically as the RecyclerView renders the equipment selection screen), all subsequent HTTPS connections made by the application — including API calls to `forkliftiqws` carrying authentication tokens, session data, GPS coordinates, shock event data, and operator credentials — are made without any certificate or hostname validation. This enables a trivially mounted man-in-the-middle attack on any network the device connects to.

**No test exists** for this code path. There is no test that:
- Verifies `SSLCertificateHandler.nuke()` is NOT called when `presenter` is null
- Verifies `SSLCertificateHandler.nuke()` is NOT called when `position >= presenter.ui.urlList.size()`
- Verifies the SSL socket factory state before and after `bindDatas()` is called
- Exercises the scenario where the adapter renders items without a presenter set

**Impact:** Any attacker on the same network can intercept all HTTPS traffic from the app after the equipment selection screen is displayed. Authentication tokens, session IDs, operator safety data, and GPS tracking data are all exposed.

---

#### A58-3 — MEDIUM: No test for null-presenter guard in `bindDatas()`

**Severity:** MEDIUM
**File:** `SelectForkAdapter.java`
**Line:** 26

**Description:**

`bindDatas()` guards the image-loading branch with `if ((presenter != null) && (position < presenter.ui.urlList.size()))`. There is no test that:
- Calls `bindDatas()` with `presenter` equal to `null` and verifies the method completes without exception and without calling `showImage()`.
- Calls `bindDatas()` with an empty `urlList` (position 0, list size 0) and verifies the boundary is respected.
- Calls `bindDatas()` with `position` equal to `urlList.size() - 1` (last valid index) and `position` equal to `urlList.size()` (first invalid index) to verify off-by-one correctness.

The guard `position < presenter.ui.urlList.size()` accesses `presenter.ui` directly (public field access). If `presenter.ui` is null, a `NullPointerException` is thrown despite the outer null check on `presenter`. No test covers this scenario.

---

#### A58-4 — LOW: No test for `setPresenter()` idempotency and overwrite behaviour

**Severity:** LOW
**File:** `SelectForkAdapter.java`
**Line:** 13

**Description:**

`setPresenter()` replaces the stored presenter reference unconditionally. No test verifies that setting a new presenter mid-render does not produce inconsistent state between the `urlList` used in `bindDatas()` and the new presenter's `urlList`. While this is a low-probability race on the main thread, the absence of any test means this assumption is completely unverified.

---

## File 2: MyApplication.java

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.ui.application.MyApplication`

**Superclass:** `android.support.multidex.MultiDexApplication`

**Fields defined:**

| Field | Type | Line | Notes |
|---|---|---|---|
| `context` | `static Context` (private, `@SuppressLint("StaticFieldLeak")`) | 41 | Application singleton context |
| `mHandler` | `static Handler` (private) | 42 | Main-thread handler |
| `GPSParam` | `static SaveSingleGPSParameter` (private) | 43 | GPS parameter, shared mutable state |
| `runnable` | `Runnable` (package-private) | 45 | Unused field (no assignment in any method) |
| `locationService` | `static ScheduledExecutorService` (private) | 46 | Commented-out scheduler, never assigned at runtime |
| `networkConnected` | `boolean` (private) | 75 | Network state flag |

**Methods defined:**

| Method | Line | Signature |
|---|---|---|
| `onCreate` | 49 | `@Override public void onCreate()` |
| `initDataBase` | 65 | `private void initDataBase()` |
| `registerNetworkStatus` | 77 | `private void registerNetworkStatus()` |
| `onNetworkChanged` | 89 | `private void onNetworkChanged()` |
| `onNetworkDisconnected` | 106 | `private void onNetworkDisconnected()` |
| `onNetworkConnected` | 109 | `private void onNetworkConnected()` |
| `getHandler` | 112 | `public static Handler getHandler()` |
| `runOnMainThread` | 116 | `public static void runOnMainThread(final Runnable runnable)` |
| `runLater` | 122 | `public static void runLater(final Runnable runnable, int time)` |
| `initImageLoader` | 128 | `private static void initImageLoader(Context context)` |
| `startLocationUpdate` | 140 | `public static void startLocationUpdate()` |
| `SaveUnitLocation` | 165 | `private static void SaveUnitLocation()` |
| `getGPSProviderStatus` | 190 | `public static boolean getGPSProviderStatus()` |
| `sendLocationUpdate` | 195 | `public static void sendLocationUpdate()` |
| `getContext` | 213 | `public static Context getContext()` |

**Inner types defined:**
- Anonymous `BroadcastReceiver` at line 78 (inside `registerNetworkStatus()`)
- Anonymous `WebListener<SaveSingleGPSResult>` at line 177 (inside `SaveUnitLocation()`)

**Constants defined:** None.

**Significant structural observations:**
- `onNetworkDisconnected()` (line 106) has an empty body — no logic is implemented.
- `onNetworkConnected()` (line 109) has an empty body — no logic is implemented.
- The `runnable` field (line 45) is declared but never assigned within this class. The `locationService` field (line 46) is declared but the entire scheduling block using it is commented out (lines 144–162 and 199–209).
- `deleteRealmIfMigrationNeeded()` (line 70): silently destroys all user data on schema mismatch rather than migrating.
- No encryption key is passed to the `RealmConfiguration.Builder` at lines 68–72.

**Test file:** None. No test references to `MyApplication` exist anywhere in the repository.

---

### Findings — MyApplication.java

#### A58-5 — HIGH: Realm database configured without encryption key

**Severity:** HIGH
**File:** `MyApplication.java`
**Lines:** 65–73

**Description:**

`initDataBase()` initialises the Realm database with no encryption key:

```java
private void initDataBase() {
    Realm.init(context);
    RealmConfiguration config = new RealmConfiguration.Builder()
            .schemaVersion(4)
            .deleteRealmIfMigrationNeeded()
            .build();
    Realm.setDefaultConfiguration(config);
}
```

The `.encryptionKey(byte[])` builder method is absent. Realm stores its database as a plain-text file on the device's internal storage at the default path (typically `default.realm`). Without encryption:

- Any process with root access (rooted device, ADB backup, forensic extraction tool) can read the entire Realm database in clear text.
- The database contains operator session data, GPS coordinates, equipment assignments, pre-start checklist results, and shock event records — all safety-critical operational data.
- On Android versions below 7.0, `adb backup` can extract the file without root.

Additionally, `.deleteRealmIfMigrationNeeded()` (line 70) means that on any schema version mismatch the entire database is silently deleted without user notification or data migration. This is a data integrity risk in addition to the confidentiality risk.

**No test exists** that:
- Verifies an encryption key is supplied to the `RealmConfiguration`.
- Verifies data survives a schema upgrade without deletion (migration test).
- Verifies the database cannot be opened without a key from a separate process context.

---

#### A58-6 — MEDIUM: No test for `onCreate()` initialization sequence or failure paths

**Severity:** MEDIUM
**File:** `MyApplication.java`
**Lines:** 49–63

**Description:**

`onCreate()` performs six sequential initialization operations:
1. `initDataBase()` — sets up Realm
2. `new Handler(getMainLooper())` — creates main-thread handler
3. `WebApi.init(context)` — initializes the web API client (likely sets server endpoint and auth configuration)
4. `BleController.instance().init(context)` — initializes the BLE subsystem
5. `initImageLoader(context)` — configures the Universal Image Loader
6. `LocationProvider.instance().init(context, true, false, 5, false)` — initializes GPS

No test verifies:
- The correct initialization order (e.g., that `WebApi.init` occurs before any API call).
- That a failure in any early step (e.g., `BleController.init` throwing) does not leave the application in a partially initialized but operational-appearing state.
- That `mHandler` is non-null after `onCreate()` completes (relied upon by `runOnMainThread` and `runLater`).

---

#### A58-7 — MEDIUM: No test for `onNetworkChanged()` state-machine transitions

**Severity:** MEDIUM
**File:** `MyApplication.java`
**Lines:** 89–104

**Description:**

`onNetworkChanged()` maintains a boolean state machine (`networkConnected`) with four distinct transitions:
1. Was connected, now disconnected → calls `onNetworkDisconnected()`, sets flag false
2. Was already disconnected, still disconnected → only sets flag false (no-op path)
3. Was disconnected, now connected → calls `SyncService.startService()`, `CacheService.startService()`, calls `onNetworkConnected()`, sets flag true
4. Was already connected, still connected → only calls `SyncService.startService()`, `CacheService.startService()`, sets flag true

No test covers any of these transitions. Specifically:
- No test verifies that `SyncService.startService()` is called on reconnect but not on continued disconnection.
- No test verifies that `onNetworkDisconnected()` is called exactly once per disconnection event (and not repeatedly if the broadcast fires multiple times while disconnected).
- No test verifies the initial state of `networkConnected` (set at line 60 during `onCreate()`).

Both `onNetworkDisconnected()` (line 106) and `onNetworkConnected()` (line 109) have empty bodies, meaning they are stubs. No test documents the intended behavior when these stubs are populated.

---

#### A58-8 — MEDIUM: No test for `SaveUnitLocation()` — GPS data transmitted to API without validation

**Severity:** MEDIUM
**File:** `MyApplication.java`
**Lines:** 165–188

**Description:**

`SaveUnitLocation()` reads latitude and longitude from `LocationProvider`, constructs a `SaveSingleGPSParameter`, and transmits it via `WebApi.async().saveSingleGPSLocation()`. The method:
- Accesses `MyCommonValue.currentEquipmentItem.id` (line 171) without null-checking `currentEquipmentItem`. If no equipment is selected, this throws a `NullPointerException`.
- On API failure, stores the location to the local database via `LocationDb.saveNewLocation(GPSParam)` (line 185). No test verifies that failed transmissions are correctly persisted and that `LocationDb.removeData()` (line 181) is only called on success.
- No test verifies behavior when `LocationProvider` returns `0.0, 0.0` (default uninitialized coordinates) — these would be transmitted as real GPS coordinates.

---

#### A58-9 — MEDIUM: No test for `runOnMainThread()` and `runLater()` null-handler guard

**Severity:** MEDIUM
**File:** `MyApplication.java`
**Lines:** 116–126

**Description:**

Both `runOnMainThread()` and `runLater()` guard against a null `mHandler` before posting runnables. `mHandler` is initialized in `onCreate()` (line 54). If either method is called before `onCreate()` completes (possible during early initialization or in unit test contexts where `Application.onCreate()` is not called), the runnable is silently dropped with no error indication. No test covers this failure mode or verifies that runnables are executed on the correct thread.

---

#### A58-10 — LOW: Unused fields `runnable` and `locationService` are dead code with no test coverage

**Severity:** LOW
**File:** `MyApplication.java`
**Lines:** 45–46

**Description:**

The instance field `runnable` (line 45) is declared but never assigned within the class. The static field `locationService` (line 46) is declared but the entire block that would assign and use it is commented out (lines 144–162, lines 199–209). This commented-out code references `CurrentUser.get().getGps_frequency()` and a `ScheduledExecutorService` for periodic GPS reporting. The presence of these dead fields with no tests means there is no verification that the intended GPS scheduling behavior was ever correct, and no indication of whether the commented code represents intentional removal or a temporary disable.

---

#### A58-11 — LOW: `onNetworkDisconnected()` and `onNetworkConnected()` are empty stubs with no test

**Severity:** LOW
**File:** `MyApplication.java`
**Lines:** 106–110

**Description:**

Both `onNetworkDisconnected()` (line 106) and `onNetworkConnected()` (line 109) have empty method bodies. No test documents the expected behavior for these lifecycle events, and no test would catch a future implementation that introduces a regression. The existence of named stub methods suggests intended future behavior that is currently absent and unspecified.

---

## File 3: FleetActivity.java

### Reading Evidence

**Fully qualified class name:** `au.com.collectiveintelligence.fleetiq360.ui.common.FleetActivity`

**Superclass:** `com.yy.libcommon.BaseActivity` (abstract)

**Modifier:** `public abstract class`

**Fields defined:**

| Field | Type | Line | Notes |
|---|---|---|---|
| `mLoadingView` | `View` (private) | 59 | Loading overlay view |
| `connectingDevice` | `boolean` (public) | 60 | BLE connection in progress flag |
| `isDismissed` | `boolean` (private) | 61 | Progress dialog dismissed flag |
| `mLocation` | `LocationProvider` (package-private) | 62 | Declared but never assigned in this class |
| `GPSParam` | `SaveSingleGPSParameter` (package-private) | 63 | Declared but never assigned in this class |
| `runnable` | `Runnable` (package-private) | 65 | Declared but never assigned in this class |
| `service` | `ScheduledExecutorService` (package-private) | 66 | Declared but never assigned in this class |
| `broadcastReceiver` | `BroadcastReceiver` (private) | 116 | Handles IMPACT and GATT_DISCONNECTED broadcasts |
| `RECONNECT_REQUEST_ENABLE_BT` | `int` (private) | 328 | Request code 100 |
| `LOCATION_SETTINGS_REQUEST_GPS` | `int` (public static) | 329 | Request code 200 |

**Methods defined:**

| Method | Line | Signature |
|---|---|---|
| `onCreate` | 69 | `@Override protected void onCreate(Bundle savedInstanceState)` |
| `setLoadingView(View)` | 76 | `private void setLoadingView(View view)` |
| `setLoadingView()` | 80 | `private void setLoadingView()` |
| `showLoadingLayout` | 84 | `public void showLoadingLayout()` |
| `hideLoadingLayout` | 90 | `public void hideLoadingLayout()` |
| `setContentView` | 97 | `@Override public void setContentView(int layoutId)` |
| `setRootView` | 101 | `private void setRootView(int layoutId)` |
| `showImpactAlert` | 134 | `private void showImpactAlert()` |
| `getImpactLevelColourMessage` | 156 | `private static String getImpactLevelColourMessage(ShockEventsItem.ImpactLevel impactLevel)` |
| `onBleDeviceDisconnected` | 169 | `private void onBleDeviceDisconnected(Intent intent)` |
| `showDeviceDisconnectedDialog` | 187 | `private void showDeviceDisconnectedDialog()` |
| `onReconnectDevice` | 217 | `private void onReconnectDevice(final int delayMillis)` |
| `checkDeviceConnectedLater` | 224 | `private void checkDeviceConnectedLater(final int delayMillis)` |
| `checkEquipmentConnected` | 235 | `private void checkEquipmentConnected()` |
| `runEquipmentConnectCheck` | 239 | `private boolean runEquipmentConnectCheck()` |
| `reconnectEquipment` | 247 | `private void reconnectEquipment(EquipmentItem equipmentItem)` |
| `onActivityResult` | 331 | `@Override public void onActivityResult(int requestCode, int resultCode, Intent imageReturnedIntent)` |
| `isAbortingSession` | 349 | `private boolean isAbortingSession()` |
| `onStopSessionByUser` | 354 | `private void onStopSessionByUser()` |
| `abortSessionWithCallback` | 418 | `protected static void abortSessionWithCallback(final SessionResult sessionResult, final AbortSessionCallback abortSessionCallback)` |
| `onResume` | 441 | `@Override protected void onResume()` |
| `onPause` | 454 | `@Override protected void onPause()` |

**Inner types defined:**

| Type | Kind | Line |
|---|---|---|
| `AbortSessionCallback` | `public static class` | 410 |
| Anonymous `BroadcastReceiver` | anonymous class | 116 |
| Anonymous `YesNoDialog.Callback` | anonymous class | 197 |
| Anonymous `BleController.EquipmentListener` | anonymous class | 271 |
| Anonymous `WebListener<SessionEndResult>` | anonymous class | 377 |
| Anonymous `WebListener<WebServiceResultPacket>` | anonymous class | 426 |

**`AbortSessionCallback` methods:**

| Method | Line |
|---|---|
| `onSessionStopped()` | 411 |
| `onSessionStopFailed()` | 413 |

**Constants defined:**
- `RECONNECT_REQUEST_ENABLE_BT = 100` (line 328, private int — note: declared as `private int`, not `static final`)
- `LOCATION_SETTINGS_REQUEST_GPS = 200` (line 329, public static int — note: not `final`)

**Test file:** None. No test references to `FleetActivity` exist anywhere in the repository.

---

### Findings — FleetActivity.java

#### A58-12 — MEDIUM: No test for session validation on `onResume()` — resumed activity may re-engage without valid session

**Severity:** MEDIUM
**File:** `FleetActivity.java`
**Lines:** 441–451

**Description:**

`onResume()` performs the following operations:
1. Checks `ShockEventService.lastImpactEvent` and shows an impact alert dialog if present.
2. Registers a `BroadcastReceiver` for IMPACT and GATT_DISCONNECTED events.
3. Calls `SessionTimeouter.register(this)`.

There is no direct check in `onResume()` that a valid, authenticated operator session still exists before re-engaging all operational listeners. Session validity is entirely delegated to `SessionTimeouter`. If `SessionTimeouter` fails silently (its `register()` method does not throw or return a status), the activity will resume in fully operational state — displaying safety-critical equipment data and accepting BLE events — without verifying the operator is still authorized.

Confirmed from reading `SessionTimeouter.java`: the `register()` method (line 109 of that file) dynamically registers a `SessionTimeouterReceiver` but performs no synchronous session validity check at the point of registration. The timeout check is deferred to a `JobService` callback. During the window between activity resume and the next timeout check, no active session validation occurs.

No test covers:
- `onResume()` behavior when no active session exists in `SessionDb`.
- `onResume()` behavior when the session has expired between the activity being paused and resumed.
- Whether `SessionTimeouter.register()` being called on an activity with no running session produces correct behavior.

---

#### A58-13 — MEDIUM: No test for `onBleDeviceDisconnected()` — equipment identity mismatch not fully guarded

**Severity:** MEDIUM
**File:** `FleetActivity.java`
**Lines:** 169–185

**Description:**

`onBleDeviceDisconnected()` guards against acting on a disconnection for a different device by comparing `equipmentItem.mac_address` against the broadcast address. However:
- If `equipmentItem.mac_address` is null, `equipmentItem.mac_address.equals(address)` throws `NullPointerException` (no null check on `mac_address` before calling `.equals()`).
- The commented-out retry-limit code (lines 179–184) means reconnection is always attempted (`onReconnectDevice(5000)` is always called when addresses match), with no bound on retry attempts. `checkDeviceConnectedLater()` schedules itself recursively until `runEquipmentConnectCheck()` returns true — there is no maximum retry count or timeout. No test verifies this loop terminates.
- No test covers the path where `intent.getStringExtra(BleMachineService.DEVICE_ADDRESS)` returns an empty string (line 173 checks `address.length() == 0` but no test exercises this guard).

---

#### A58-14 — MEDIUM: No test for `onStopSessionByUser()` — network failure during session end can leave orphaned session

**Severity:** MEDIUM
**File:** `FleetActivity.java`
**Lines:** 354–408

**Description:**

`onStopSessionByUser()` has two code paths depending on `isAbortingSession()`:
1. **Aborting path** (pre-start not finished): calls `abortSessionWithCallback()`.
2. **Normal end path**: calls `WebApi.async().saveSessionEnd()`.

The normal end path `onFailed()` callback (lines 390–406) only saves offline data if `SessionDb.hasOfflineData(parameter.id)` is true. If `hasOfflineData()` returns false (e.g., a session with no offline data fails to sync), `onSessionStopFailed()` is called — which calls `showDialog("Error", ...)`. However, the session is not marked in any state in this case. The session remains in a running state in the local database with no offline abort flag, no finish time, and no user-facing mechanism to retry. No test covers this orphaned-session scenario.

Additionally, `parameter.id = Objects.requireNonNull(sessionResult).id` (line 375) — if `sessionResult` is null (i.e., `SessionDb.readRunningSession()` returns null), `requireNonNull` throws `NullPointerException` rather than handling the missing session gracefully. No test covers this null path.

---

#### A58-15 — MEDIUM: No test for `abortSessionWithCallback()` — API failure path marks session aborted but does not retry

**Severity:** MEDIUM
**File:** `FleetActivity.java`
**Lines:** 418–438

**Description:**

`abortSessionWithCallback()` calls `WebApi.async().deleteSession()`. On failure, it calls `SessionDb.setSessionAborted(sessionResult.id, true)` and then calls `abortSessionCallback.onSessionStopped()`. This means an abort failure is treated identically to abort success from the callback's perspective — the UI proceeds as if the abort succeeded. No test verifies:
- That `setSessionAborted()` is called with the correct ID on failure.
- That the callback distinction between `onSessionStopped()` and `onSessionStopFailed()` is correctly exercised.
- That a null `abortSessionCallback` does not cause issues (guarded at lines 429 and 434, but not tested).

---

#### A58-16 — MEDIUM: No test for `getImpactLevelColourMessage()` — missing `default` return is a dead-code branch

**Severity:** MEDIUM
**File:** `FleetActivity.java`
**Lines:** 156–167

**Description:**

`getImpactLevelColourMessage()` switches on `ShockEventsItem.ImpactLevel`. The `BLUE` case (line 162) returns `"Blue"`, but `showImpactAlert()` (line 136) already filters out `BLUE` impacts (`if (impact == null || impact.level == ShockEventsItem.ImpactLevel.BLUE) return;`). This means the `BLUE` branch in `getImpactLevelColourMessage()` is unreachable dead code. No test documents this invariant. If `showImpactAlert()` is later modified to permit BLUE impacts, `getImpactLevelColourMessage()` will return `"Blue"` rather than triggering the `default` empty-string path — a potential silent behavioral change. No test guards against this inconsistency.

---

#### A58-17 — MEDIUM: No test for `showLoadingLayout()` / `hideLoadingLayout()` before `setContentView()` is called

**Severity:** MEDIUM
**File:** `FleetActivity.java`
**Lines:** 84–94

**Description:**

Both `showLoadingLayout()` and `hideLoadingLayout()` guard against a null `mLoadingView` with an early return. `mLoadingView` is initialized in `setLoadingView()`, which is called from `setRootView()`, which is called from `setContentView()`. If a subclass calls `showLoadingLayout()` or `hideLoadingLayout()` before calling `setContentView()` (or if `setContentView()` is overridden in a subclass without calling `super`), the call is silently ignored. No test documents the required initialization order or verifies the null-guard behavior.

---

#### A58-18 — LOW: `RECONNECT_REQUEST_ENABLE_BT` is a non-final instance field used as a request code

**Severity:** LOW
**File:** `FleetActivity.java`
**Line:** 328

**Description:**

`RECONNECT_REQUEST_ENABLE_BT` is declared as `private int RECONNECT_REQUEST_ENABLE_BT = 100` (non-static, non-final). `LOCATION_SETTINGS_REQUEST_GPS` is declared as `public static int LOCATION_SETTINGS_REQUEST_GPS = 200` (non-final). Both are used as `onActivityResult` request codes. Because neither is `final`, they can be modified at runtime, potentially causing `onActivityResult` to fail to match the expected request code. No test verifies the values of these fields or the routing behavior of `onActivityResult()` for each code.

---

#### A58-19 — LOW: Dead fields `mLocation`, `GPSParam`, `runnable`, `service` are never assigned

**Severity:** LOW
**File:** `FleetActivity.java`
**Lines:** 62–66

**Description:**

Four instance fields are declared in `FleetActivity` but never assigned within the class:
- `mLocation` (line 62, `LocationProvider`)
- `GPSParam` (line 63, `SaveSingleGPSParameter`)
- `runnable` (line 65, `Runnable`)
- `service` (line 66, `ScheduledExecutorService`)

These are dead fields. They occupy memory on every `FleetActivity` subclass instance and create false impressions that location and scheduling are managed at the `FleetActivity` level. Subclasses that inherit from `FleetActivity` and access these fields expecting them to be initialized will encounter null values. No test documents the intended lifecycle or verifies that subclasses do not mistakenly rely on these fields.

---

#### A58-20 — INFO: `showDeviceDisconnectedDialog()` is unreachable dead code

**Severity:** INFO
**File:** `FleetActivity.java`
**Lines:** 187–215 and 179–184

**Description:**

`showDeviceDisconnectedDialog()` is defined at line 187 but is only called from a commented-out block within `onBleDeviceDisconnected()` (lines 179–184). The method is completely unreachable in the current codebase. The active code always calls `onReconnectDevice(5000)` unconditionally. No test documents the intended behavior of `showDeviceDisconnectedDialog()` or records why it was commented out.

---

## Summary Table

| Finding ID | Severity | File | Description |
|---|---|---|---|
| A58-1 | HIGH | Project-wide | Zero automated test coverage in `app/` and `LibCommon/` modules |
| A58-2 | CRITICAL | SelectForkAdapter.java:27 | `bindDatas()` triggers `SSLCertificateHandler.nuke()` via `presenter.showImage()` — process-wide SSL/TLS disabled on every equipment list render |
| A58-3 | MEDIUM | SelectForkAdapter.java:26 | No test for null-presenter guard; `presenter.ui` not null-checked before `urlList` access |
| A58-4 | LOW | SelectForkAdapter.java:13 | No test for `setPresenter()` mid-render overwrite behavior |
| A58-5 | HIGH | MyApplication.java:65–73 | Realm database configured without encryption key; all operational data stored in plaintext |
| A58-6 | MEDIUM | MyApplication.java:49–63 | No test for `onCreate()` initialization sequence or partial-initialization failure paths |
| A58-7 | MEDIUM | MyApplication.java:89–104 | No test for `onNetworkChanged()` four-state transition logic |
| A58-8 | MEDIUM | MyApplication.java:165–188 | No test for `SaveUnitLocation()`; null dereference risk on `currentEquipmentItem`; unvalidated 0,0 coordinates transmitted |
| A58-9 | MEDIUM | MyApplication.java:116–126 | No test for `runOnMainThread()`/`runLater()` silent runnable drop when `mHandler` is null |
| A58-10 | LOW | MyApplication.java:45–46 | Dead fields `runnable` and `locationService` with commented-out scheduling code; no test documents intended behavior |
| A58-11 | LOW | MyApplication.java:106–110 | `onNetworkDisconnected()` and `onNetworkConnected()` are empty stubs; no test specifies expected behavior |
| A58-12 | MEDIUM | FleetActivity.java:441–451 | No test for `onResume()` session validation; activity may re-engage operational state without valid session |
| A58-13 | MEDIUM | FleetActivity.java:169–185 | No test for `onBleDeviceDisconnected()`; null `mac_address` causes NPE; unbounded reconnect retry loop |
| A58-14 | MEDIUM | FleetActivity.java:354–408 | No test for `onStopSessionByUser()`; orphaned session on network failure with no offline data; NPE on null `sessionResult` |
| A58-15 | MEDIUM | FleetActivity.java:418–438 | No test for `abortSessionWithCallback()`; failure treated identically to success from callback perspective |
| A58-16 | MEDIUM | FleetActivity.java:156–167 | No test for `getImpactLevelColourMessage()`; unreachable `BLUE` branch and unmaintained invariant with `showImpactAlert()` |
| A58-17 | MEDIUM | FleetActivity.java:84–94 | No test for `showLoadingLayout()`/`hideLoadingLayout()` silent null-guard before `setContentView()` |
| A58-18 | LOW | FleetActivity.java:328–329 | `RECONNECT_REQUEST_ENABLE_BT` and `LOCATION_SETTINGS_REQUEST_GPS` are non-final; request code routing untested |
| A58-19 | LOW | FleetActivity.java:62–66 | Dead fields `mLocation`, `GPSParam`, `runnable`, `service` never assigned; no test documents lifecycle |
| A58-20 | INFO | FleetActivity.java:187–215 | `showDeviceDisconnectedDialog()` is unreachable dead code; no test documents intended behavior or removal rationale |
