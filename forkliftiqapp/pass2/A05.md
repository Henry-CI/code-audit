# Audit Pass 2 – Agent A05
**Audit run:** 2026-02-26-01
**Agent:** A05
**Files assigned:**
1. `LibCommon/src/main/java/com/yy/libcommon/Font/AMEditText.java`
2. `LibCommon/src/main/java/com/yy/libcommon/Font/AMRadioButton.java`
3. `LibCommon/src/main/java/com/yy/libcommon/Font/AMTextView.java`

---

## Project-Wide Finding: Zero Automated Test Coverage

**Finding ID:** A05-1
**Severity:** HIGH
**Scope:** Project-wide (`app/` and `LibCommon/` modules)

Neither the `app/` module nor the `LibCommon/` module contains a `test/` or `androidTest/` source directory. The only test files found in the entire repository are in `LibImageloader/src/test/`, covering third-party image loading infrastructure unrelated to application logic.

Evidence:
- `LibCommon/src/main/` contains only `java/` and `res/` — no `test/` sibling.
- `app/src/` contains only `main/` — no `test/` or `androidTest/` sibling.
- Glob of `**/test/**/*.java` across the repo returns only `LibImageloader` test files.

Every class in `app/` and `LibCommon/` — including the three assigned custom view classes — has zero automated test coverage. Regressions in any of these classes will not be caught by CI.

---

## Reading Evidence

### File 1: `AMEditText.java`

**Fully qualified class name:** `com.yy.libcommon.Font.AMEditText`
**Superclass:** `android.widget.EditText`

| Line | Method signature |
|------|-----------------|
| 17 | `public AMEditText(Context context)` |
| 23 | `public AMEditText(Context context, AttributeSet attrs)` |
| 29 | `public AMEditText(Context context, AttributeSet attrs, int defStyle)` |
| 36 | `private void applyCustomFont(Context context, AttributeSet attrs)` |

**Constants/types/errors defined:** None.

**Behavioural notes:**
- `applyCustomFont` at line 36 calls `getContext().obtainStyledAttributes(attrs, R.styleable.AMTextView)` when `attrs != null` but never calls `a.recycle()` on the resulting `TypedArray`.
- When `attrs` is `null` (single-argument constructor path), `applyCustomFont` skips styled attribute lookup entirely and takes no fallback font action; the typeface is left as whatever the parent `EditText` default is.
- When `attrs` is non-null but the `ttf_type` attribute is absent or empty, `FontCache.getTypeFace` returns the default Helvetica Neue Light; if the font asset is missing from the APK, `getTypeFace` returns `null` and `setTypeface` is silently skipped, leaving the widget with whatever system default is in effect.

---

### File 2: `AMRadioButton.java`

**Fully qualified class name:** `com.yy.libcommon.Font.AMRadioButton`
**Superclass:** `android.widget.RadioButton`

| Line | Method signature |
|------|-----------------|
| 18 | `public AMRadioButton(Context context)` |
| 24 | `public AMRadioButton(Context context, AttributeSet attrs)` |
| 30 | `public AMRadioButton(Context context, AttributeSet attrs, int defStyle)` |
| 37 | `private void applyCustomFont(Context context, AttributeSet attrs)` |

**Constants/types/errors defined:** None.

**Behavioural notes:**
- Structurally identical to `AMEditText` — same `obtainStyledAttributes` / no `recycle()` pattern.
- The import at line 7 (`import android.widget.EditText`) is unused dead code; `AMRadioButton` extends `RadioButton`, not `EditText`.
- Same silent no-op on missing font asset as `AMEditText`.

---

### File 3: `AMTextView.java`

**Fully qualified class name:** `com.yy.libcommon.Font.AMTextView`
**Superclass:** `android.widget.TextView`

| Line | Method signature |
|------|-----------------|
| 17 | `public AMTextView(Context context)` |
| 23 | `public AMTextView(Context context, AttributeSet attrs)` |
| 29 | `public AMTextView(Context context, AttributeSet attrs, int defStyle)` |
| 36 | `private void applyCustomFont(Context context, AttributeSet attrs)` |

**Constants/types/errors defined:** None.

**Behavioural notes:**
- Same `obtainStyledAttributes` / no `recycle()` pattern as above.
- `AMTextView` differs from the other two: after the `attrs`-guarded block, lines 47-49 apply an unconditional fallback to `"medium"` font if `typeface` is still `null`. This means even with a null `attrs` argument the class attempts to apply the medium font — the most defensive of the three implementations.
- Same silent no-op if the font asset is missing.

---

## Findings

### A05-2 – `AMEditText`: `TypedArray` never recycled (resource leak)
**Severity:** MEDIUM
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMEditText.java`
**Lines:** 42–44

`getContext().obtainStyledAttributes(...)` returns a `TypedArray` that is stored in local variable `a`. After reading from it on line 43, `a.recycle()` is never called. Android's `TypedArray` objects are pooled; failing to recycle them exhausts the pool over repeated inflation and causes native memory pressure. Every programmatic or XML inflation of an `AMEditText` with attributes present leaks one `TypedArray` instance.

No test exercises this path (no test inflates the view from XML with attributes set), so this leak is entirely undetected.

---

### A05-3 – `AMEditText`: no default font applied when `attrs` is null
**Severity:** LOW
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMEditText.java`
**Lines:** 17–21, 36–49

When constructed with only a `Context` (programmatic creation, line 17), `applyCustomFont` receives `null` attrs. The entire font-application block is skipped and no fallback is applied. By contrast, `AMTextView` (line 47–49) always falls back to the `"medium"` typeface. The asymmetry means `AMEditText` instances created programmatically silently use the system default font rather than the intended custom typeface.

No test covers the no-attrs constructor path to verify the expected font behaviour.

---

### A05-4 – `AMEditText`: silent no-op when font asset is missing
**Severity:** LOW
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMEditText.java`
**Lines:** 44, 46–48

`FontCache.getTypeFace` can return `null` if the underlying `Typeface.createFromAsset` throws (e.g., asset file absent from the APK). When that occurs, `setTypeface` is not called and the widget silently renders in the system default font. There is no log, no exception propagation, and no way for the caller to detect the failure. No test exercises the missing-asset path.

---

### A05-5 – `AMRadioButton`: `TypedArray` never recycled (resource leak)
**Severity:** MEDIUM
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMRadioButton.java`
**Lines:** 42–44

Same issue as A05-2. `obtainStyledAttributes` result is never recycled. Every inflation of `AMRadioButton` from XML with attributes present leaks one `TypedArray` instance. No test covers this path.

---

### A05-6 – `AMRadioButton`: unused import `android.widget.EditText`
**Severity:** LOW
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMRadioButton.java`
**Line:** 7

`import android.widget.EditText` is present but `AMRadioButton` extends `RadioButton`, not `EditText`. This import is dead code, suggesting the class was copied from `AMEditText` without being fully cleaned up. No test would catch this because there are no tests, but the issue also suggests the copy-paste origin of this class increases the likelihood that other, more significant differences between the two were overlooked.

---

### A05-7 – `AMRadioButton`: no default font applied when `attrs` is null
**Severity:** LOW
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMRadioButton.java`
**Lines:** 18–21, 37–49

Same as A05-3. Programmatic construction with no `AttributeSet` results in no custom font being applied and no fallback. Inconsistent with `AMTextView`'s behaviour. No test covers this path.

---

### A05-8 – `AMRadioButton`: silent no-op when font asset is missing
**Severity:** LOW
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMRadioButton.java`
**Lines:** 44, 46–48

Same as A05-4. No test covers the missing-asset path.

---

### A05-9 – `AMTextView`: `TypedArray` never recycled (resource leak)
**Severity:** MEDIUM
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMTextView.java`
**Lines:** 42–44

Same issue as A05-2 and A05-5. `obtainStyledAttributes` result is stored in `a` and never recycled. `AMTextView` is the most widely used of the three custom views (referenced in `LoginFragment` and `SignupLoadingFragment`, and likely in XML layouts throughout the app). Because it is inflated frequently, this leak is the highest-impact instance of the three. No test covers this path.

---

### A05-10 – `AMTextView`: silent no-op when fallback font asset is missing
**Severity:** LOW
**File:** `LibCommon/src/main/java/com/yy/libcommon/Font/AMTextView.java`
**Lines:** 47–51

The unconditional fallback to `"medium"` at line 48 (`FontCache.getTypeFace(getContext(), "medium")`) is itself guarded only by a null check on its return value. If the `HelveticaNeue_Medium.ttf` asset is missing, `getTypeFace` returns `null` silently. The view will then render in the system default without any error indication. No test exercises this fallback path, and no test verifies the fallback actually applies the intended typeface.

---

### A05-11 – All three classes: every constructor and `applyCustomFont` entirely untested
**Severity:** HIGH
**Files:**
- `LibCommon/src/main/java/com/yy/libcommon/Font/AMEditText.java`
- `LibCommon/src/main/java/com/yy/libcommon/Font/AMRadioButton.java`
- `LibCommon/src/main/java/com/yy/libcommon/Font/AMTextView.java`

No test file exists for any of these three classes. The following specific untested scenarios are identified across all three:

| Scenario | Classes affected |
|---|---|
| Single-arg constructor (null attrs path) | All three |
| Two-arg constructor (XML inflation, attrs non-null) | All three |
| Three-arg constructor (XML inflation with style) | All three |
| `applyCustomFont` with attrs present and `ttf_type` attribute set to each valid value (`bold`, `light`, `medium`, `thin`, `untrathin`) | All three |
| `applyCustomFont` with attrs present but `ttf_type` attribute absent (null return from `getString`) | All three |
| `applyCustomFont` with attrs present but `ttf_type` attribute set to an unrecognised string | All three |
| `applyCustomFont` when font asset file is missing from APK | All three |
| Unconditional `"medium"` fallback when primary lookup returns null | `AMTextView` only |
| Typeface is correctly applied to the widget after construction | All three |

---

## Summary Table

| ID | Severity | File | Description |
|----|----------|------|-------------|
| A05-1 | HIGH | Project-wide | Zero automated test coverage in `app/` and `LibCommon/` |
| A05-2 | MEDIUM | AMEditText.java | `TypedArray` never recycled — resource leak on each inflation |
| A05-3 | LOW | AMEditText.java | No fallback font when constructed without attrs |
| A05-4 | LOW | AMEditText.java | Silent no-op when font asset is missing |
| A05-5 | MEDIUM | AMRadioButton.java | `TypedArray` never recycled — resource leak on each inflation |
| A05-6 | LOW | AMRadioButton.java | Unused `import android.widget.EditText` — copy-paste artifact |
| A05-7 | LOW | AMRadioButton.java | No fallback font when constructed without attrs |
| A05-8 | LOW | AMRadioButton.java | Silent no-op when font asset is missing |
| A05-9 | MEDIUM | AMTextView.java | `TypedArray` never recycled — highest-impact instance |
| A05-10 | LOW | AMTextView.java | Silent no-op when fallback `"medium"` asset is missing |
| A05-11 | HIGH | All three files | All constructors and `applyCustomFont` paths entirely untested |
