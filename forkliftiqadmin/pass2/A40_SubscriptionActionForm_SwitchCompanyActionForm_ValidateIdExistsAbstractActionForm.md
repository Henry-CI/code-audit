# Pass 2 Test-Coverage Audit
**Audit run:** 2026-02-26-01
**Agent ID:** A40
**Files audited:**
- `src/main/java/com/actionform/SubscriptionActionForm.java`
- `src/main/java/com/actionform/SwitchCompanyActionForm.java`
- `src/main/java/com/actionform/ValidateIdExistsAbstractActionForm.java`

---

## 1. Reading Evidence

### 1.1 SubscriptionActionForm

**File:** `src/main/java/com/actionform/SubscriptionActionForm.java`
**Package:** `com.actionform`
**Class:** `SubscriptionActionForm extends org.apache.struts.action.ActionForm`
**Modifiers:** public, concrete

**Fields:**

| Field | Type | Default | Line |
|-------|------|---------|------|
| `comp_sub_id` | `String[]` | `{}` (empty array) | 13 |

**Methods:**

| Method | Signature | Line |
|--------|-----------|------|
| `getComp_sub_id` | `public String[] getComp_sub_id()` | 16 |
| `setComp_sub_id` | `public void setComp_sub_id(String[] comp_sub_id)` | 20 |

**Imports:** `HttpServletRequest`, `ActionMessage`, `ActionErrors`, `ActionForm`, `ActionMapping` — all imported but **none used**. The class declares no `validate()` override; no `reset()` override. No Lombok annotations.

**Struts configuration:**
- Registered as form-bean `subscriptionActionForm` at `struts-config.xml` line 17.
- No action mapping in `struts-config.xml` references `subscriptionActionForm` as its `name` attribute. The form-bean registration is an orphan with no bound action.
- Not referenced in `validation.xml`.

---

### 1.2 SwitchCompanyActionForm

**File:** `src/main/java/com/actionform/SwitchCompanyActionForm.java`
**Package:** `com.actionform`
**Class:** `SwitchCompanyActionForm extends org.apache.struts.validator.ValidatorForm`
**Modifiers:** `public final`
**Lombok:** `@Data` (generates `getCurrentCompany()`, `setCurrentCompany(String)`, `equals()`, `hashCode()`, `toString()`)

**Fields:**

| Field | Type | Default | Line |
|-------|------|---------|------|
| `currentCompany` | `String` | `null` | 8 |

**Methods (explicit):** none — all accessors generated by `@Data`.

**Struts configuration:**
- Registered as form-bean `switchCompanyActionForm` at `struts-config.xml` line 8.
- Bound to action `/switchCompany` (`struts-config.xml` lines 88–97), `validate="true"`, scope `request`, input `adminDefinition`.
- **`validate="true"` is set, but `SwitchCompanyActionForm` inherits `ValidatorForm.validate()`** which performs Struts validator-XML-driven validation. No validation rules for `switchCompanyActionForm` are defined in `validation.xml` (zero matches found). The `validate()` call therefore always returns an empty `ActionErrors` — validation is silently a no-op.
- Not referenced in `validation.xml`.

---

### 1.3 ValidateIdExistsAbstractActionForm

**File:** `src/main/java/com/actionform/ValidateIdExistsAbstractActionForm.java`
**Package:** `com.actionform`
**Class:** `ValidateIdExistsAbstractActionForm extends org.apache.struts.action.ActionForm`
**Modifiers:** `public abstract`
**Lombok:** `@Getter`, `@Setter` (generates `getId()`, `setId(String)`)

**Fields:**

| Field | Type | Default | Line |
|-------|------|---------|------|
| `id` | `protected String` | `null` | 16 |

**Methods:**

| Method | Signature | Line |
|--------|-----------|------|
| `validate` | `public ActionErrors validate(ActionMapping mapping, HttpServletRequest request)` | 19–27 |

**validate() logic (lines 19–27):**
1. Instantiates a new `ActionErrors` object.
2. Calls `StringUtils.isEmpty(this.id)` — returns `true` if `id` is `null` or the empty string `""`.
3. If empty: creates `ActionMessage("error.id")` and adds it under the key `"id"`.
4. Returns the `ActionErrors` object (either empty or containing the one error).

**Branching summary:**
- Branch A (covered path): `id` is non-null and non-empty → returns empty `ActionErrors`.
- Branch B (error path): `id` is `null` or `""` → returns `ActionErrors` containing one entry keyed `"id"`.

**Known concrete subclasses (found by grep in main source tree):**

| Subclass | File | Additional validate() logic |
|----------|------|-----------------------------|
| `AdminFleetcheckDeleteActionForm` | `com/actionform/AdminFleetcheckDeleteActionForm.java` | None — inherits parent validate() unchanged |
| `AdminFleetcheckShowActionForm` | `com/actionform/AdminFleetcheckShowActionForm.java` | None — inherits parent validate() unchanged |
| `AdminFleetcheckHideActionForm` | `com/actionform/AdminFleetcheckHideActionForm.java` | Overrides: calls `super.validate()`, then adds errors for empty `manu_id`, `type_id`, `fuel_type_id`; does NOT validate `attachment_id` |

**Struts action bindings for concrete subclasses (struts-config.xml):**

| Form bean name | Action path | validate | input |
|----------------|-------------|----------|-------|
| `adminFleetcheckShowActionForm` | `/adminFleetcheckShow` | (not shown in excerpt; check config) | — |
| `adminFleetcheckDeleteActionForm` | `/adminFleetcheckDelete` | (not shown in excerpt; check config) | — |
| `adminFleetcheckHideActionForm` | `/adminFleetcheckHide` | (not shown in excerpt; check config) | — |

---

## 2. Test Coverage Search Results

**Test files in project (complete list):**
```
src/test/java/com/calibration/UnitCalibrationImpactFilterTest.java
src/test/java/com/calibration/UnitCalibrationTest.java
src/test/java/com/calibration/UnitCalibratorTest.java
src/test/java/com/util/ImpactUtilTest.java
```

**Grep results — all three class names searched against the entire test directory:**

| Search term | Matches in test directory |
|-------------|--------------------------|
| `SubscriptionActionForm` | **0** |
| `SwitchCompanyActionForm` | **0** |
| `ValidateIdExistsAbstractActionForm` | **0** |
| `comp_sub_id` | **0** |
| `currentCompany` (SwitchCompanyActionForm context) | **0** |
| `validate` (actionform context) | **0** |
| `error.id` | **0** |

**Conclusion: Zero test coverage for all three classes. None of the form classes, their fields, their accessor methods, or their validation logic are referenced anywhere in the test suite.**

---

## 3. Findings

---

### A40-1 | Severity: CRITICAL | ValidateIdExistsAbstractActionForm.validate() — zero test coverage for a shared validation component used by three action paths

`ValidateIdExistsAbstractActionForm.validate()` is the sole mechanism that prevents Struts from dispatching a form submission with an empty `id` to the bound action. It is inherited unchanged by `AdminFleetcheckDeleteActionForm` and `AdminFleetcheckShowActionForm`, and is called via `super.validate()` by `AdminFleetcheckHideActionForm`. This single method therefore gatekeeps three separate admin action paths (delete, show, hide fleetcheck questions). Neither the parent class nor any of its subclasses has a single test. The following specific branches are entirely untested:

- **Branch A:** `id` is non-null and non-empty → `validate()` returns empty `ActionErrors` → Struts proceeds to action.
- **Branch B:** `id` is `null` → `StringUtils.isEmpty(null)` returns `true` → error is added → Struts short-circuits to `input` forward. Untested.
- **Branch C:** `id` is `""` (empty string) → `StringUtils.isEmpty("")` returns `true` → error is added. Untested.
- **Branch D:** `id` is whitespace-only (e.g., `"   "`) → `StringUtils.isEmpty("   ")` returns `false` (Apache Commons Lang `isEmpty` does not trim) → validation passes and a whitespace-only `id` reaches the action and DAO. Untested and potentially hazardous.

---

### A40-2 | Severity: CRITICAL | SubscriptionActionForm — zero test coverage; class is a registered dead artifact

`SubscriptionActionForm` has no test coverage whatsoever. Additionally, investigation reveals that it is an orphaned form-bean: it is registered in `struts-config.xml` (line 17) but no action mapping in `struts-config.xml` references it as its `name`. Pass 1 audit (agent not identified, `adminSubscription.md`) also identified `SubscriptionActionForm` as an unreferenced dead artifact. Because it is never bound to any action, Struts never populates or invokes it at runtime, meaning the registered form-bean is pure dead configuration. The unused imports in the class (`ActionMessage`, `ActionErrors`, `ActionMapping`, `HttpServletRequest`) confirm that a `validate()` method was likely planned or previously existed and was removed, leaving behind a structurally incomplete class with no validation and no action binding.

---

### A40-3 | Severity: CRITICAL | SwitchCompanyActionForm — zero test coverage; validate="true" is a silent no-op

`SwitchCompanyActionForm` has no test coverage. The class extends `ValidatorForm` (not `ActionForm`), which means validation is driven by `validation.xml` entries. The action mapping sets `validate="true"`. However, `validation.xml` contains **no rules** for `switchCompanyActionForm`. The consequence is that `ValidatorForm.validate()` executes, finds no rules, and returns an empty `ActionErrors`, effectively meaning any value of `currentCompany` — including null, empty string, or a malformed company identifier — passes validation silently. There is no test that:
- Confirms that `currentCompany = null` is rejected (it is not).
- Confirms that `currentCompany = ""` is rejected (it is not).
- Confirms that an arbitrary unrecognised company ID is rejected at the form level (it is not; authorization logic is deferred to the action).

---

### A40-4 | Severity: HIGH | ValidateIdExistsAbstractActionForm does not validate id format or type — whitespace-only id passes validation

`StringUtils.isEmpty()` from Apache Commons Lang returns `false` for strings that consist entirely of whitespace (e.g., `"   "`). A form submission with `id="   "` passes validation, and the whitespace string is forwarded to the action and then to DAO methods such as `QuestionDAO.hideQuestionById()`, `QuestionDAO.showQuestionById()`, and `QuestionDAO.deleteQuestionById()`. These DAO methods use the `id` value in database queries. Depending on the database, a whitespace-only string as a primary key lookup either returns no rows (leading to the `IndexOutOfBoundsException` documented in A05 audit) or matches rows with whitespace-padded values due to database-level string comparison behaviour. No test verifies the whitespace-`id` path.

The correct guard would be `StringUtils.isBlank(this.id)`, which returns `true` for null, empty, and whitespace-only strings.

---

### A40-5 | Severity: HIGH | SwitchCompanyActionForm.currentCompany — no validation means null/empty currentCompany reaches SwitchCompanyAction unchecked

As established in A40-3, no validation rules exist for `switchCompanyActionForm`. In `SwitchCompanyAction.execute()` (line 37), the code calls `loginActionForm.getCurrentCompany()` (generated by Lombok `@Data`) and compares it with `company.getId()` using `equals()`. If `getCurrentCompany()` returns `null`, the call is `company.getId().equals(null)` — this will never be true, so the loop silently falls through with no session update and returns `"successAdmin"`. If it returns `""`, the same silent no-op occurs. No test covers these degenerate-input paths, and the silent success return on invalid input was already flagged as a security concern in the Pass 1 audit; the form-level validation gap compounds it.

---

### A40-6 | Severity: HIGH | AdminFleetcheckHideActionForm.validate() does not validate attachment_id — untested gap

`AdminFleetcheckHideActionForm.validate()` (lines 22–38 of `AdminFleetcheckHideActionForm.java`) adds errors for empty `manu_id`, `type_id`, and `fuel_type_id`, but contains **no validation check for `attachment_id`**. The field is declared, has a getter and setter generated by Lombok, and is read by `AdminFleetcheckHideAction` (passed to the DAO call). A null or empty `attachment_id` passes validation and reaches the DAO without any server-side validation. Because this is a subclass of `ValidateIdExistsAbstractActionForm`, the absence of an `attachment_id` check is an intentional or accidental omission; there is no test to document the intended behaviour or catch a regression.

---

### A40-7 | Severity: HIGH | No test infrastructure exists for form validation testing; all validate() coverage is impossible without it

The four existing test files are plain JUnit tests with no servlet mock framework. Testing any `ActionForm.validate()` implementation requires mock `ActionMapping` and `HttpServletRequest` instances (and for `ValidatorForm` subclasses, a configured Struts validator engine with access to `validation.xml`). None of this infrastructure exists in the project. Testing `ValidateIdExistsAbstractActionForm.validate()` requires at minimum Mockito or StrutsTestCase. Until this infrastructure is established, the three most safety-critical form validation paths in the admin interface (delete, show, hide fleetcheck questions) cannot be covered by tests at all.

---

### A40-8 | Severity: MEDIUM | SubscriptionActionForm field initialised to empty array, not null — inconsistent with ActionForm reset() contract

`SubscriptionActionForm.comp_sub_id` is initialised to `{}` (an empty `String[]`) at declaration time (line 13). Struts `ActionForm` documentation recommends that array fields be reset to their default (empty) state in `reset()` to prevent carry-over between requests when the form is session-scoped. `SubscriptionActionForm` does not override `reset()`. Because no action currently uses this form (A40-2), this is not exploitable, but if the form is ever revived and bound to an action with `scope="session"`, the absence of a `reset()` override means checkbox-like `comp_sub_id` values from a previous request persist into the next request — a classic Struts multi-checkbox accumulation bug. No test documents or verifies the reset behaviour.

---

### A40-9 | Severity: MEDIUM | SwitchCompanyActionForm extends ValidatorForm instead of ActionForm — validator infrastructure dependency untested

`SwitchCompanyActionForm` extends `ValidatorForm`, which requires the Struts Validator plugin to be configured and active for `validate()` to function correctly. If the `ValidatorPlugIn` is absent or misconfigured, `ValidatorForm.validate()` may throw a `NullPointerException` or return an empty `ActionErrors` silently. There is no test that verifies `SwitchCompanyActionForm` behaves correctly under the actual Struts Validator plugin configuration. By contrast, all other form classes audited in this batch extend `ActionForm` directly. The choice of `ValidatorForm` for a form that has no `validation.xml` rules is architecturally inconsistent.

---

### A40-10 | Severity: MEDIUM | ValidateIdExistsAbstractActionForm: ActionMessage key "error.id" not tested for existence in message resources

`validate()` creates an `ActionMessage` with the key `"error.id"` (line 23). If this key is absent from the Struts `ApplicationResources.properties` file (or whatever message resource bundle is configured), Struts renders a raw key string in the error display rather than a user-friendly message. No test verifies that the key resolves to a non-empty localised string. Similarly, `AdminFleetcheckHideActionForm` uses keys `"error.manufacturer"`, `"error.type"`, and `"error.power"` — none tested for resource bundle presence.

---

### A40-11 | Severity: MEDIUM | SubscriptionActionForm: five unused imports indicate incomplete implementation

The class imports `HttpServletRequest`, `ActionMessage`, `ActionErrors`, `ActionMapping` — none of which are used. This pattern strongly indicates a `validate()` method was planned, stubbed, and then deleted or never completed. The resulting class is both dead (no action binding) and structurally incomplete (no validation despite inheriting a framework hook for it). No test exercises or documents the expected validation contract for subscription form submissions.

---

### A40-12 | Severity: LOW | SwitchCompanyActionForm declared final — cannot be subclassed for testing without reflection or bytecode manipulation

`SwitchCompanyActionForm` is declared `final`. This prevents subclassing, which is the simplest Mockito strategy for mocking a concrete class without interfaces. Testing `SwitchCompanyAction` in isolation using a mock `SwitchCompanyActionForm` requires either Mockito's `mockConstruction` / byte-buddy support or PowerMock. The `final` modifier is an unnecessary restriction on a simple data-holder class and increases the difficulty of adding tests. There is no interface extracted from `SwitchCompanyActionForm`.

---

### A40-13 | Severity: LOW | ValidateIdExistsAbstractActionForm: id field is protected, not private — subclass coupling untested

The `id` field is declared `protected` (line 16), meaning subclasses can directly access and mutate it without going through `setId()`. `@Getter` and `@Setter` generate the public accessor pair, but a subclass could also write `this.id = someValue` directly, bypassing any future setter-level validation logic. No test verifies that subclasses access `id` only through the generated accessor.

---

### A40-14 | Severity: LOW | SubscriptionActionForm: comp_sub_id getter/setter naming uses non-standard Java Bean convention

The getter is named `getComp_sub_id()` and the setter `setComp_sub_id(String[])` (lines 16, 20). The standard Java Beans convention for a field named `comp_sub_id` would be `getComp_sub_id()` only if the capitalisation rule is applied literally, but the Struts property binding engine expects `comp_sub_id` to map to a property named exactly `comp_sub_id`. In practice, Struts uses introspection and the underscore in the method name is unusual. No test verifies that Struts correctly binds the HTTP request parameter `comp_sub_id[]` (the checkbox array form of multi-select) to this field.

---

### A40-15 | Severity: INFO | All four existing tests are unrelated to any form class; no integration or functional tests exist for any action form

The four test files (`UnitCalibrationImpactFilterTest`, `UnitCalibrationTest`, `UnitCalibratorTest`, `ImpactUtilTest`) exclusively test calibration utilities and impact utilities. They represent the only test coverage in the entire project. No test targets any Struts action, any `ActionForm` subclass, any DAO, or any security control. The project has a systemic absence of action-layer and form-layer test coverage, not merely a gap for the three classes in this batch.

---

### A40-16 | Severity: INFO | ValidateIdExistsAbstractActionForm is abstract — direct instantiation is impossible; concrete subclass instances must be used in tests

Because `ValidateIdExistsAbstractActionForm` is abstract, tests must instantiate a concrete subclass (`AdminFleetcheckDeleteActionForm`, `AdminFleetcheckShowActionForm`, or `AdminFleetcheckHideActionForm`) or create an anonymous subclass inline. This is a minor but noteworthy constraint for test authoring: tests of the parent `validate()` logic written against `AdminFleetcheckDeleteActionForm` (the simplest subclass with no overrides) would serve as proxy tests for the abstract parent's logic. No such proxy tests exist.

---

## 4. Summary Table

| Finding | Severity | Description |
|---------|----------|-------------|
| A40-1 | CRITICAL | `ValidateIdExistsAbstractActionForm.validate()` — zero test coverage for shared validation used by three admin action paths |
| A40-2 | CRITICAL | `SubscriptionActionForm` — zero test coverage; class is an orphaned dead artifact with no action binding |
| A40-3 | CRITICAL | `SwitchCompanyActionForm` — zero test coverage; `validate="true"` is a silent no-op because no `validation.xml` rules exist |
| A40-4 | HIGH | Whitespace-only `id` passes `isEmpty()` check; should use `isBlank()`; untested |
| A40-5 | HIGH | Null or empty `currentCompany` silently passes form validation and reaches `SwitchCompanyAction`; untested |
| A40-6 | HIGH | `AdminFleetcheckHideActionForm.validate()` omits `attachment_id` validation; untested gap |
| A40-7 | HIGH | No servlet/Struts mock infrastructure; validate() testing is impossible without it |
| A40-8 | MEDIUM | `SubscriptionActionForm` missing `reset()` override for array field; multi-request carry-over risk if ever bound to session-scoped action |
| A40-9 | MEDIUM | `SwitchCompanyActionForm` extends `ValidatorForm` with no `validation.xml` rules; architecturally inconsistent and untested |
| A40-10 | MEDIUM | `ActionMessage` key `"error.id"` not tested for presence in message resource bundle |
| A40-11 | MEDIUM | Five unused imports in `SubscriptionActionForm` indicate incomplete `validate()` implementation |
| A40-12 | LOW | `SwitchCompanyActionForm` declared `final`; increases test complexity (cannot be subclassed for mocking) |
| A40-13 | LOW | `ValidateIdExistsAbstractActionForm.id` is `protected`; subclass direct-write access is untested |
| A40-14 | LOW | `getComp_sub_id()`/`setComp_sub_id()` non-standard naming; Struts binding untested |
| A40-15 | INFO | All existing tests target calibration/impact utilities; no action-layer or form-layer tests exist anywhere in the project |
| A40-16 | INFO | `ValidateIdExistsAbstractActionForm` is abstract; tests must use a concrete subclass or anonymous subclass |

---

**CRITICAL: 3 / HIGH: 4 / MEDIUM: 4 / LOW: 3 / INFO: 2**
