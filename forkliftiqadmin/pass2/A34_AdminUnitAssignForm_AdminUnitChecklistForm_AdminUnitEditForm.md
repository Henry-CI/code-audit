# Pass 2 Test-Coverage Audit
**Audit Run:** 2026-02-26-01
**Agent ID:** A34
**Date:** 2026-02-26
**Scope:** AdminUnitAssignForm, AdminUnitChecklistForm, AdminUnitEditForm

---

## 1. Source Files — Reading Evidence

### 1.1 AdminUnitAssignForm

**File:** `src/main/java/com/actionform/AdminUnitAssignForm.java`
**Class:** `com.actionform.AdminUnitAssignForm extends org.apache.struts.action.ActionForm`
**Annotations:** `@Data` (Lombok — generates getters, setters, equals, hashCode, toString), `@NoArgsConstructor` (Lombok — generates no-arg constructor)

**Fields:**

| Line | Field | Type |
|------|-------|------|
| 12 | `id` | `String` |
| 13 | `unit_id` | `String` |
| 14 | `company_id` | `String` |
| 15 | `start` | `String` |
| 16 | `end` | `String` |

**Methods (Lombok-generated — not explicit in source):**

| Method | Generated by |
|--------|-------------|
| `AdminUnitAssignForm()` | `@NoArgsConstructor` |
| `getId()` / `setId(String)` | `@Data` |
| `getUnit_id()` / `setUnit_id(String)` | `@Data` |
| `getCompany_id()` / `setCompany_id(String)` | `@Data` |
| `getStart()` / `setStart(String)` | `@Data` |
| `getEnd()` / `setEnd(String)` | `@Data` |
| `equals(Object)` / `hashCode()` / `toString()` | `@Data` |

**Unused import noted:** `java.util.Date` is imported at line 7 but no `Date` field or method uses it.

---

### 1.2 AdminUnitChecklistForm

**File:** `src/main/java/com/actionform/AdminUnitChecklistForm.java`
**Class:** `com.actionform.AdminUnitChecklistForm extends org.apache.struts.action.ActionForm`
**No Lombok annotations — all accessors hand-written.**

**Fields:**

| Line | Field | Type |
|------|-------|------|
| 11 | `serialVersionUID` | `static final long` (-2208616500078494492L) |
| 13 | `id` | `int` |
| 14 | `unitId` | `int` |
| 15 | `action` | `String` |
| 17 | `driverBased` | `boolean` |

**Methods (explicit):**

| Lines | Method | Signature |
|-------|--------|-----------|
| 20-22 | `getId` | `public int getId()` |
| 23-25 | `getUnitId` | `public int getUnitId()` |
| 27-29 | `setId` | `public void setId(int id)` |
| 30-32 | `setUnitId` | `public void setUnitId(int unitId)` |
| 33-35 | `isDriverBased` | `public boolean isDriverBased()` |
| 36-38 | `setDriverBased` | `public void setDriverBased(boolean driverBased)` |
| 40-42 | `getAction` | `public String getAction()` |
| 43-45 | `setAction` | `public void setAction(String action)` |

**Note:** No `equals()`, `hashCode()`, or `toString()` are declared or inherited beyond `Object` defaults.
**Note:** No `validate()` override present — form performs no server-side validation.

---

### 1.3 AdminUnitEditForm

**File:** `src/main/java/com/actionform/AdminUnitEditForm.java`
**Class:** `com.actionform.AdminUnitEditForm extends org.apache.struts.action.ActionForm`
**Annotations:** `@Data` (Lombok)

**Fields:**

| Line | Field | Type |
|------|-------|------|
| 24 | `id` | `String` |
| 25 | `name` | `String` |
| 26 | `location` | `String` |
| 27 | `department` | `String` |
| 28 | `type_id` | `String` |
| 29 | `active` | `String` |
| 30 | `manu_id` | `String` |
| 31 | `size` | `String` |
| 32 | `hourmeter` | `String` |
| 33 | `serial_no` | `String` |
| 34 | `fuel_type_id` | `String` |
| 35 | `arrAdminUnitType` | `List` (raw) |
| 36 | `arrAdminUnitFuelType` | `List` (raw) |
| 37 | `arrMenufacture` | `List` (raw) — note misspelling: "Menufacture" |
| 38 | `mac_address` | `String` |
| 39 | `exp_mod` | `String` |
| 41 | `accessible` | `boolean` |
| 42 | `access_type` | `String` |
| 43 | `keypad_reader` | `String` |
| 44 | `facility_code` | `String` |
| 45 | `access_id` | `String` |
| 46 | `op_code` | `String` |
| 47 | `weight_unit` | `String` |

**Methods (explicit):**

| Lines | Method | Signature |
|-------|--------|-----------|
| 50-54 | `AdminUnitEditForm` (constructor) | `public AdminUnitEditForm() throws Exception` |
| 56-58 | `setArrAdminUnitType` | `private void setArrAdminUnitType() throws Exception` |
| 60-62 | `setArrAdminUnitFuelType` | `private void setArrAdminUnitFuelType() throws Exception` |
| 64-108 | `validate` | `public ActionErrors validate(ActionMapping mapping, HttpServletRequest request)` |
| 110-133 | `getUnit` | `public UnitBean getUnit(String compId)` |
| 136-142 | `setUnit` | `public void setUnit(UnitBean unitBean)` |

**Lombok-generated for `@Data`:** getters/setters for all non-static fields, `equals()`, `hashCode()`, `toString()`.

**Validate logic branches (lines 64-108):**

| Lines | Condition | Error Key |
|-------|-----------|-----------|
| 68-71 | `name` is empty | `"error.unitName"` / `"unitNm"` |
| 73-76 | `serial_no` is empty | `"error.unitSerial"` / `"unitSerial"` |
| 78-81 | `manu_id` is empty | `"error.manufacturer"` / `"unitManu"` |
| 83-86 | `type_id` is empty | `"error.type"` / `"unitType"` |
| 88-91 | `fuel_type_id` is empty | `"error.power"` / `"unitFuelType"` |
| 93-99 | `size` non-empty AND fails `^\d*\.{0,1}\d{0,2}$` regex | `"error.size"` / `"unitSize"`; side-effect: `size` reset to `"0"` |
| 101-105 | Always: `getUnit(null)` called, `arrUnit` placed in request attribute `"arrAdminUnit"` | — |

---

## 2. Test Directory Search Results

**Test directory:** `src/test/java/`

**Files present:**
- `com/calibration/UnitCalibrationImpactFilterTest.java`
- `com/calibration/UnitCalibrationTest.java`
- `com/calibration/UnitCalibratorTest.java`
- `com/util/ImpactUtilTest.java`

**Grep results for each class name:**

| Search Term | Matches in test directory |
|-------------|--------------------------|
| `AdminUnitAssignForm` | **0 matches** |
| `AdminUnitChecklistForm` | **0 matches** |
| `AdminUnitEditForm` | **0 matches** |

No test file references any of the three audited classes in any capacity (import, instantiation, comment, or annotation).

---

## 3. Coverage Gaps and Findings

---

### AdminUnitAssignForm

**A34-1 | Severity: CRITICAL | AdminUnitAssignForm has zero test coverage — no test class exists**

No test file for `AdminUnitAssignForm` exists anywhere in `src/test/java/`. The class and all its Lombok-generated methods (constructor, five getters, five setters, `equals`, `hashCode`, `toString`) are completely untested.

---

**A34-2 | Severity: LOW | AdminUnitAssignForm imports `java.util.Date` but never uses it**

Line 7 imports `java.util.Date`. No field, method parameter, or return type in the class uses `Date`. This is dead code / stale import and indicates the class may have been refactored without cleanup, and no test would catch the discrepancy.

---

**A34-3 | Severity: MEDIUM | AdminUnitAssignForm has no `validate()` override — silent acceptance of all input**

`AdminUnitAssignForm` extends `ActionForm` but provides no `validate()` method. All five string fields (`id`, `unit_id`, `company_id`, `start`, `end`) are accepted without server-side validation. There are no tests to document or enforce the intended acceptable value ranges (e.g., date formats for `start`/`end`, non-null `unit_id`). This is a behavioural gap that should be covered by explicit tests specifying what the form accepts.

---

### AdminUnitChecklistForm

**A34-4 | Severity: CRITICAL | AdminUnitChecklistForm has zero test coverage — no test class exists**

No test file for `AdminUnitChecklistForm` exists anywhere in `src/test/java/`. All eight explicitly coded accessor methods (`getId`, `getUnitId`, `setId`, `setUnitId`, `isDriverBased`, `setDriverBased`, `getAction`, `setAction`) are completely untested.

---

**A34-5 | Severity: MEDIUM | AdminUnitChecklistForm has no `validate()` override — silent acceptance of all input**

`AdminUnitChecklistForm` extends `ActionForm` but provides no `validate()` method. Fields `id` (int), `unitId` (int), `action` (String), and `driverBased` (boolean) undergo no server-side validation. No tests exist to document what the form is expected to enforce or reject.

---

**A34-6 | Severity: LOW | AdminUnitChecklistForm default `id` and `unitId` are 0 — no null-safety tests**

Both `id` and `unitId` are primitive `int` fields defaulting to `0`. There are no tests verifying whether callers correctly distinguish a default/unset value (0) from a legitimately assigned ID of 0, nor whether downstream consumers of these getters handle the default safely.

---

### AdminUnitEditForm

**A34-7 | Severity: CRITICAL | AdminUnitEditForm has zero test coverage — no test class exists**

No test file for `AdminUnitEditForm` exists anywhere in `src/test/java/`. This is the most complex of the three forms, containing business logic in `validate()` and `getUnit()`, and a side-effecting constructor that calls live DAO singletons.

---

**A34-8 | Severity: CRITICAL | `validate()` method (lines 64-108) has zero test coverage — six validation branches untested**

The `validate()` method contains six distinct conditional branches, none of which has a corresponding test:

1. `name` empty — `"error.unitName"` added to errors.
2. `serial_no` empty — `"error.unitSerial"` added to errors.
3. `manu_id` empty — `"error.manufacturer"` added to errors.
4. `type_id` empty — `"error.type"` added to errors.
5. `fuel_type_id` empty — `"error.power"` added to errors.
6. `size` non-empty and fails regex `^\d*\.{0,1}\d{0,2}$` — `"error.size"` added and `size` field mutated to `"0"`.

No tests verify: (a) that each error key is produced when the corresponding field is invalid; (b) that no error is produced when all fields are valid; (c) the regex boundary behaviour for `size`; (d) the side-effect where `size` is reset to `"0"` on regex failure.

---

**A34-9 | Severity: CRITICAL | `validate()` has a hidden side-effect on `size` field (line 98) — untested mutation**

When `size` is non-empty and fails the regex, `size` is silently reset to `"0"` (line 98) in addition to adding an error. This mutation of form state within a validation method is a significant behavioural contract with no test coverage. If the downstream `getUnit()` call (line 101) or the calling action re-reads `size`, it will receive `"0"` rather than the original invalid input.

---

**A34-10 | Severity: HIGH | `validate()` unconditionally calls `getUnit(null)` and sets a request attribute (lines 101-105) — side-effect untested**

Lines 101-105 always execute during validation, constructing a `UnitBean` and placing it into `request.setAttribute("arrAdminUnit", ...)`. This has two untested concerns:

1. The request attribute is always set even when there are validation errors (i.e., partially filled data is placed in the request and may be rendered by JSP).
2. `getUnit(null)` is always called with `compId = null`, which propagates `null` into the `UnitBean.comp_id` field regardless of actual context.

---

**A34-11 | Severity: HIGH | `getUnit(String compId)` method (lines 110-133) has zero test coverage**

`getUnit()` contains complex mapping logic including:
- Conditional blank-check for `id` (null if blank, otherwise raw string value).
- Conditional `Double.valueOf(size)` conversion — will throw `NumberFormatException` if `size` is non-numeric and non-blank (reachable if `validate()` is bypassed or form is used programmatically).
- Conditional `Double.valueOf(hourmeter)` conversion — same risk.
- Conditional `UnitBean.KeypadReaderModel.valueOf(keypad_reader)` — will throw `IllegalArgumentException` if `keypad_reader` is non-blank but not a valid enum constant.

None of these code paths have test coverage.

---

**A34-12 | Severity: HIGH | `getUnit()` can throw `NumberFormatException` for `size` and `hourmeter` — no defensive test**

Lines 120-121:
```java
.size(StringUtils.isBlank(size) ? 0.0d : Double.valueOf(size))
.hourmeter(StringUtils.isBlank(hourmeter) ? 0.0d : Double.valueOf(hourmeter))
```
If `size` or `hourmeter` is a non-blank, non-parseable string (e.g., the form is submitted via an API without going through `validate()`), `Double.valueOf()` throws `NumberFormatException`. There is no try/catch here. No test covers this failure path.

---

**A34-13 | Severity: HIGH | `getUnit()` can throw `IllegalArgumentException` for invalid `keypad_reader` enum value — no defensive test**

Line 129:
```java
.keypad_reader(StringUtils.isNotBlank(keypad_reader) ? UnitBean.KeypadReaderModel.valueOf(keypad_reader) : null)
```
If `keypad_reader` is a non-blank string that does not match any `UnitBean.KeypadReaderModel` enum constant, `valueOf()` throws `IllegalArgumentException` with no catch. No test covers this failure path or enumerates valid values.

---

**A34-14 | Severity: HIGH | `setUnit(UnitBean)` (lines 136-142) has zero test coverage — exception swallowing behaviour untested**

`setUnit()` uses `PropertyUtils.copyProperties()`. On any of `IllegalAccessException`, `InvocationTargetException`, or `NoSuchMethodException` it wraps and re-throws as `RuntimeException`. No test verifies: (a) successful property copy; (b) the RuntimeException wrapping behaviour on failure; (c) that the correct fields are populated after a copy.

---

**A34-15 | Severity: HIGH | Constructor `AdminUnitEditForm()` calls live DAO singletons — untestable without mocking, no tests exist**

Lines 50-54:
```java
public AdminUnitEditForm() throws Exception {
    super();
    this.setArrAdminUnitType();   // calls UnitDAO.getInstance().getAllUnitType()
    this.setArrAdminUnitFuelType(); // calls UnitDAO.getInstance().getAllUnitFuelType()
}
```
The constructor calls `UnitDAO.getInstance()` directly, making the class impossible to instantiate in a unit test without a live database or a mocking framework configured for static singletons. No tests exist that demonstrate or document how this dependency should be handled in test contexts.

---

**A34-16 | Severity: MEDIUM | `arrMenufacture` field name is misspelled (line 37) — typo perpetuated without test catching it**

The field is named `arrMenufacture` (line 37) rather than `arrManufacture`. Lombok's `@Data` will generate `getArrMenufacture()` and `setArrMenufacture()` matching the misspelling. No test exists that would catch this naming inconsistency or document the intended API name.

---

**A34-17 | Severity: MEDIUM | Raw `List` types used for `arrAdminUnitType`, `arrAdminUnitFuelType`, `arrMenufacture` — no type-safety tests**

Lines 35-37 declare three `List` fields without generic type parameters. No tests verify the element types expected in these lists or enforce that callers provide correctly typed collections.

---

**A34-18 | Severity: LOW | `validate()` regex for `size` (line 93) allows empty string to pass — behaviour undocumented by tests**

The regex `^\d*\.{0,1}\d{0,2}$` matches an empty string (all quantifiers permit zero occurrences). However, the outer guard `StringUtils.isNotEmpty(size)` (line 95) prevents the regex from executing on empty input. This means `size` can be submitted as empty without triggering the regex branch, yet the distinction between "blank" and "zero" is not tested.

---

## 4. Summary Table

| Finding | Severity | Class | Description |
|---------|----------|-------|-------------|
| A34-1 | CRITICAL | AdminUnitAssignForm | Zero test coverage — no test class exists |
| A34-2 | LOW | AdminUnitAssignForm | Unused import `java.util.Date` |
| A34-3 | MEDIUM | AdminUnitAssignForm | No `validate()` override; all input silently accepted |
| A34-4 | CRITICAL | AdminUnitChecklistForm | Zero test coverage — no test class exists |
| A34-5 | MEDIUM | AdminUnitChecklistForm | No `validate()` override; all input silently accepted |
| A34-6 | LOW | AdminUnitChecklistForm | Primitive `int` default-zero ambiguity untested |
| A34-7 | CRITICAL | AdminUnitEditForm | Zero test coverage — no test class exists |
| A34-8 | CRITICAL | AdminUnitEditForm | `validate()` six conditional branches entirely untested |
| A34-9 | CRITICAL | AdminUnitEditForm | `validate()` silently mutates `size` field on regex failure — untested |
| A34-10 | HIGH | AdminUnitEditForm | `validate()` unconditional request attribute side-effect untested |
| A34-11 | HIGH | AdminUnitEditForm | `getUnit()` complex mapping logic entirely untested |
| A34-12 | HIGH | AdminUnitEditForm | `getUnit()` `NumberFormatException` risk on `size`/`hourmeter` untested |
| A34-13 | HIGH | AdminUnitEditForm | `getUnit()` `IllegalArgumentException` risk on `keypad_reader` enum untested |
| A34-14 | HIGH | AdminUnitEditForm | `setUnit()` PropertyUtils copy and exception wrapping untested |
| A34-15 | HIGH | AdminUnitEditForm | Constructor calls live DAO singletons — not unit-testable without mocking |
| A34-16 | MEDIUM | AdminUnitEditForm | `arrMenufacture` field name misspelled; no test to catch it |
| A34-17 | MEDIUM | AdminUnitEditForm | Raw `List` types on three fields; no type-safety tests |
| A34-18 | LOW | AdminUnitEditForm | `size` regex/empty-string interaction boundary untested |

---

## 5. Coverage Statistics

| Class | Explicit Methods | Tested Methods | Line Coverage |
|-------|-----------------|----------------|---------------|
| AdminUnitAssignForm | 0 explicit (all Lombok) | 0 | 0% |
| AdminUnitChecklistForm | 8 | 0 | 0% |
| AdminUnitEditForm | 6 explicit + Lombok | 0 | 0% |
| **Total** | **14+ explicit** | **0** | **0%** |

All three classes have **0% test coverage**.

---

*End of A34 Pass 2 Audit Report*
