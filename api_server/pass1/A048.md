# Audit Report A048
**Agent:** A048
**Pass:** 1
**Repo:** api_server
**Stack:** Elixir/Phoenix
**Branch:** master
**Run:** 2026-02-27-01
**Auditor model:** claude-sonnet-4-6

**Assigned files:**
- `geonames-elixir/lib/geonames/endpoints/weather.ex`
- `geonames-elixir/lib/geonames/endpoints/weather_icao.ex`
- `geonames-elixir/lib/geonames/endpoints/wikipedia_bounding_box.ex`
- `geonames-elixir/lib/geonames/endpoints/wikipedia_search.ex`

---

## Reading Evidence

---

### File 1: `geonames-elixir/lib/geonames/endpoints/weather.ex`

**Module name:** `Geonames.Endpoints.Weather`

**Public functions (`def`):**

| Name | Arity | Line |
|---|---|---|
| `endpoint` | 0 | 12 |
| `available_url_parameters` | 0 | 13 |
| `required_url_parameters` | 0 | 14 |
| `function_name` | 0 | 15 |
| `url_arguments` | 1 | 17 |

**defstruct / defexception / schema:** None defined.

**use / import / alias at module level:** None.

**Other module-level attributes:**
- `@behaviour Geonames.Endpoint` (line 3)
- `@default_arguments %{north: nil, south: nil, east: nil, west: nil}` (lines 5-10)

---

### File 2: `geonames-elixir/lib/geonames/endpoints/weather_icao.ex`

**Module name:** `Geonames.Endpoints.WeatherICAO`

**Public functions (`def`):**

| Name | Arity | Line |
|---|---|---|
| `endpoint` | 0 | 9 |
| `available_url_parameters` | 0 | 10 |
| `required_url_parameters` | 0 | 11 |
| `function_name` | 0 | 12 |
| `url_arguments` | 1 | 14 |

**defstruct / defexception / schema:** None defined.

**use / import / alias at module level:** None.

**Other module-level attributes:**
- `@behaviour Geonames.Endpoint` (line 3)
- `@default_arguments %{ICAO: nil}` (lines 5-7)

---

### File 3: `geonames-elixir/lib/geonames/endpoints/wikipedia_bounding_box.ex`

**Module name:** `Geonames.Endpoints.WikipediaBoundingBox`

**Public functions (`def`):**

| Name | Arity | Line |
|---|---|---|
| `endpoint` | 0 | 13 |
| `available_url_parameters` | 0 | 14 |
| `required_url_parameters` | 0 | 15 |
| `function_name` | 0 | 16 |
| `url_arguments` | 1 | 18 |

**defstruct / defexception / schema:** None defined.

**use / import / alias at module level:** None.

**Other module-level attributes:**
- `@behaviour Geonames.Endpoint` (line 3)
- `@default_arguments %{north: nil, south: nil, east: nil, west: nil, maxRows: 10}` (lines 5-11)

---

### File 4: `geonames-elixir/lib/geonames/endpoints/wikipedia_search.ex`

**Module name:** `Geonames.Endpoints.WikipediaSearch`

**Public functions (`def`):**

| Name | Arity | Line |
|---|---|---|
| `endpoint` | 0 | 11 |
| `available_url_parameters` | 0 | 12 |
| `required_url_parameters` | 0 | 13 |
| `function_name` | 0 | 14 |
| `url_arguments` | 1 | 16 |

**defstruct / defexception / schema:** None defined.

**use / import / alias at module level:** None.

**Other module-level attributes:**
- `@behaviour Geonames.Endpoint` (line 3)
- `@default_arguments %{q: nil, title: nil, maxRows: 10}` (lines 5-9)

---

## Checklist Review

### §1: Secrets and Configuration

No config files, credentials, API keys, secrets, or environment variable references appear in any of the four files. All four modules contain only compile-time module attributes defining parameter names and default values (all `nil` or small integer constants). No hardcoded hostnames, AWS resource names, or Bitbucket pipeline references are present.

**§1: No issues found.**

---

### §2: Authentication and Authorization

These are pure endpoint-descriptor modules implementing the `Geonames.Endpoint` behaviour. They contain no authentication logic, no plug pipelines, no Guardian configuration, no password handling, and no resource-ownership checks. Authentication and authorization are expected to be enforced by the calling layer (the HTTP client wrapper and application controllers), not within these descriptor modules. No issues attributable to these files.

**§2: No issues found.**

---

### §3: Input Validation and Injection

The `url_arguments/1` function in each module performs a `Map.merge(@default_arguments, provided_arguments)`, merging caller-supplied arguments over the module's default map. There is no validation of the types or values of `provided_arguments` within these modules.

The following observations apply:

**A048-1 — MEDIUM — Missing input validation in `url_arguments/1` (all four modules)**

Each module's `url_arguments/1` accepts an arbitrary map `provided_arguments` and merges it directly into `@default_arguments` without any type, range, or key whitelist validation. The merged result is presumably passed downstream to construct a URL query string for the GeoNames HTTP API. If the calling code does not enforce validation before calling `url_arguments/1`, a caller could inject unexpected keys into the URL (parameter pollution) or supply values of unexpected types (e.g., maps or lists instead of scalars), potentially causing malformed requests or unexpected behaviour in the GeoNames API client layer.

Affected files and lines:
- `weather.ex` line 17-19: `url_arguments/1`
- `weather_icao.ex` line 14-16: `url_arguments/1`
- `wikipedia_bounding_box.ex` line 18-20: `url_arguments/1`
- `wikipedia_search.ex` line 16-18: `url_arguments/1`

Note: Each module does declare `required_url_parameters/0` and `available_url_parameters/0`, which would allow a caller to enforce a whitelist and presence check. However, these descriptor functions are advisory only — there is no enforcement within `url_arguments/1` itself. If the caller does not use them, the validation gap is open.

No raw SQL, atom creation from user input, `binary_to_term`, `Code.eval_string`, or `Kernel.apply` with user-controlled arguments was found in any file.

---

### §4: Session and CSRF

These modules contain no session handling, cookie configuration, WebSocket/channel logic, or CSRF protection. These concerns are not within scope for this layer.

**§4: No issues found.**

---

### §5: File and Data Handling

No file upload handling, `File.write/2`, `Logger` calls, or error response rendering is present in any of the four files. No PII, GPS coordinates, driver data, or fleet data is handled within these modules.

**§5: No issues found.**

---

### §6: Dependencies

These files contain no `mix.exs` entries, dependency declarations, or `git:` source references. Dependency review for the `geonames-elixir` vendored library is outside the scope of these four endpoint modules specifically; it would need to be assessed at the library's `mix.exs` and `mix.lock` level.

**§6: No issues found** (within the scope of these four files; library-level dependency review is deferred to the relevant assigned agent).

---

### §7: Infrastructure Exposure

No hardcoded hostnames, IP addresses, port numbers, or internal service URLs are present in any of the four files. The string literals present are GeoNames API endpoint path fragments (`"weatherJSON"`, `"weatherIcaoJSON"`, `"wikipediaBoundingBoxJSON"`, `"wikipediaSearchJSON"`), which are standard public GeoNames API endpoint names and do not reveal internal CIG infrastructure topology.

No CORS configuration, TLS configuration, or inter-service communication logic is present.

**§7: No issues found.**

---

## Summary of Findings

| ID | Severity | File(s) | Description |
|---|---|---|---|
| A048-1 | MEDIUM | `weather.ex:17`, `weather_icao.ex:14`, `wikipedia_bounding_box.ex:18`, `wikipedia_search.ex:16` | `url_arguments/1` merges caller-provided arguments without whitelist or type validation; advisory `available_url_parameters/0` is not enforced internally, leaving validation to the caller. |

---

*End of report A048.*
