# Audit Report A030
**Agent:** A030
**Run:** 2026-02-27-01
**Repo:** api_server
**Branch:** master
**Stack:** Elixir/Phoenix (vendored geonames-elixir endpoint modules)
**Date:** 2026-02-27

---

## Assigned Files

1. `geonames-elixir/lib/geonames/endpoints/find_nearby_wikipedia.ex`
2. `geonames-elixir/lib/geonames/endpoints/find_nearest_address.ex`
3. `geonames-elixir/lib/geonames/endpoints/find_nearest_intersection.ex`

---

## Reading Evidence

### File 1: `geonames-elixir/lib/geonames/endpoints/find_nearby_wikipedia.ex`

**Module name:** `Geonames.Endpoints.FindNearbyWikipedia`

**Public functions (def):**

| Name | Arity | Line |
|------|-------|------|
| `endpoint` | 0 | 14 |
| `available_url_parameters` | 0 | 15 |
| `required_url_parameters` | 0 | 16 |
| `function_name` | 0 | 17 |
| `url_arguments` | 1 | 19 |

**defstruct / defexception / schema:** None defined.

**use / import / alias at module level:** None. Only `@behaviour Geonames.Endpoint` at line 3.

**Module attributes:**
- `@moduledoc false` (line 2)
- `@behaviour Geonames.Endpoint` (line 3)
- `@default_arguments` map literal with keys `lat`, `lng`, `radius`, `postalcode`, `country`, `maxRows` — all defaulting to `nil` (lines 5–12)

---

### File 2: `geonames-elixir/lib/geonames/endpoints/find_nearest_address.ex`

**Module name:** `Geonames.Endpoints.FindNearestAddress`

**Public functions (def):**

| Name | Arity | Line |
|------|-------|------|
| `endpoint` | 0 | 10 |
| `available_url_parameters` | 0 | 11 |
| `required_url_parameters` | 0 | 12 |
| `function_name` | 0 | 13 |
| `url_arguments` | 1 | 15 |

**defstruct / defexception / schema:** None defined.

**use / import / alias at module level:** None. Only `@behaviour Geonames.Endpoint` at line 3.

**Module attributes:**
- `@moduledoc false` (line 2)
- `@behaviour Geonames.Endpoint` (line 3)
- `@default_arguments` map literal with keys `lat`, `lng` — both defaulting to `nil` (lines 5–8)

---

### File 3: `geonames-elixir/lib/geonames/endpoints/find_nearest_intersection.ex`

**Module name:** `Geonames.Endpoints.FindNearestIntersection`

**Public functions (def):**

| Name | Arity | Line |
|------|-------|------|
| `endpoint` | 0 | 10 |
| `available_url_parameters` | 0 | 11 |
| `required_url_parameters` | 0 | 12 |
| `function_name` | 0 | 13 |
| `url_arguments` | 1 | 15 |

**defstruct / defexception / schema:** None defined.

**use / import / alias at module level:** None. Only `@behaviour Geonames.Endpoint` at line 3.

**Module attributes:**
- `@moduledoc false` (line 2)
- `@behaviour Geonames.Endpoint` (line 3)
- `@default_arguments` map literal with keys `lat`, `lng` — both defaulting to `nil` (lines 5–8)

---

## Checklist Review

### §1: Secrets and Configuration

No config files, environment variable access, credentials, API keys, secret key bases, database URLs, AWS resource identifiers, hardcoded hostnames, or release configuration are present in any of the three files. All three modules are pure behaviour-implementation data-mapping modules with no I/O or configuration concerns.

§1: No issues found.

---

### §2: Authentication and Authorization

These modules implement the `Geonames.Endpoint` behaviour and define only parameter-mapping logic. They contain no plug pipelines, no Guardian usage, no route definitions, no password handling, and no access-control logic. Authentication and authorization are entirely outside the scope of these files.

§2: No issues found.

---

### §3: Input Validation and Injection

All three files implement `url_arguments/1`, which merges a caller-supplied map over a static `@default_arguments` map using `Map.merge/2`. This is the primary code path that accepts external data.

**Observations:**

1. **No type validation or sanitisation of `provided_arguments`** — `url_arguments/1` accepts any map and merges it directly into the default arguments map. There is no guard, no schema, no Ecto changeset, and no type constraint. Values for `lat`, `lng`, `radius`, `postalcode`, `country`, `maxRows` are accepted as-is from the caller.

   The severity of this observation depends entirely on how callers use these modules. If the calling layer (e.g., `Geonames` client) passes user-supplied values directly without prior validation, arbitrary values will be forwarded to the external GeoNames HTTP API. Because the downstream call is to an external read-only third-party API (not an internal database), the injection surface is limited to malformed HTTP query strings — not SQL injection or Ecto injection.

2. **No atom creation from user input** — keys in `@default_arguments` are compile-time atoms. `Map.merge/2` does not create new atoms from keys present only in `provided_arguments`; excess keys are simply included in the merged map. No `String.to_atom/1` or `String.to_existing_atom/1` is used.

3. **No `Ecto.Adapters.SQL.query/3`, `fragment/1`, `:erlang.binary_to_term/1`, `Code.eval_string/1`, or `Kernel.apply/3`** — none of these patterns are present.

**Finding:**

A030-1 — LOW — `url_arguments/1` performs no input validation before forwarding caller-supplied parameters to the GeoNames API query string.

All three modules are affected:
- `Geonames.Endpoints.FindNearbyWikipedia.url_arguments/1` (line 19)
- `Geonames.Endpoints.FindNearestAddress.url_arguments/1` (line 15)
- `Geonames.Endpoints.FindNearestIntersection.url_arguments/1` (line 15)

If any calling code passes user-supplied values for `lat` or `lng` without prior type enforcement, non-numeric strings will be forwarded to the external API. While this does not constitute an injection vulnerability against an internal data store, it may result in unexpected error responses from GeoNames being propagated to clients or logged with user-supplied content. The risk is bounded by the fact that the GeoNames API is external, read-only, and unauthenticated from the user's perspective (the API key is expected to be added at a lower layer, not here). Remediation should occur at the calling layer rather than in these endpoint modules.

§3: One finding — see A030-1.

---

### §4: Session and CSRF

These modules contain no Phoenix endpoint configuration, no plug pipelines, no channel or WebSocket handling, and no session or cookie configuration.

§4: No issues found.

---

### §5: File and Data Handling

These modules perform no file I/O, no Logger calls, no error rendering, and return no PII, GPS coordinates, or fleet data to clients directly. They only produce parameter maps consumed by the GeoNames HTTP client layer.

Note: `lat` and `lng` parameters handled by `FindNearestAddress` and `[REDACTED-AWS-SMTP-PASSWORD]` are GPS coordinate values. These modules do not log, store, or return such values — they only pass them through to a parameter map. No disclosure risk exists within these files themselves. Risk from coordinates in transit or in API responses is outside the scope of these endpoint definition modules.

§5: No issues found.

---

### §6: Dependencies

These files do not declare or reference any Mix dependencies, hex packages, or `git:` source URLs. Dependency analysis is not applicable at the individual module level.

§6: No issues found.

---

### §7: Infrastructure Exposure

No hardcoded hostnames, IP addresses, port numbers, TLS/SSL configuration, CORS settings, Content Security Policy headers, or inter-service call logic are present in any of the three files. The string values returned by `endpoint/0` (`"findNearbyWikipediaJSON"`, `"findNearestAddressJSON"`, `"findNearestIntersectionJSON"`) are GeoNames API endpoint path segments — these are public API identifiers, not internal infrastructure identifiers.

§7: No issues found.

---

## Findings Summary

| ID | Severity | File(s) | Description |
|----|----------|---------|-------------|
| A030-1 | LOW | `find_nearby_wikipedia.ex` (line 19), `find_nearest_address.ex` (line 15), `find_nearest_intersection.ex` (line 15) | `url_arguments/1` performs no input validation on the caller-supplied map before merging into the outbound GeoNames API query parameters. Risk is limited to malformed external API requests; no internal injection surface exists. |

---

## Notes

All three files are structurally identical shallow data-mapping modules implementing the `Geonames.Endpoint` behaviour. They are minimal and carry negligible security surface on their own. The single finding (A030-1) is a design-level observation about the absence of a validation layer, and its actual exploitability is fully determined by how the calling code (outside the scope of this assignment) handles user input before invoking these endpoint modules.
