# Pass 1 Security Audit — A001
**Agent:** A001
**Repo:** api_server
**Stack:** Elixir/Phoenix
**Branch:** master
**Run:** 2026-02-27-01
**Date:** 2026-02-27

---

## Reading Evidence

---

### File: `.dockerignore`

- No module name (non-Elixir file)
- No public functions, structs, plugs, pipelines, use/import/alias
- **Entries present:**
  - `.git/`
  - `_build/`
  - `assets/node_modules/`
  - `deps/`

---

### File: `.gitignore`

- No module name (non-Elixir file)
- No public functions, structs, plugs, pipelines, use/import/alias
- **Entries present:**
  - `/_build`
  - `/db`
  - `/deps`
  - `/*.ez`
  - `erl_crash.dump`
  - `npm-debug.log`
  - `/assets/node_modules`
  - `/priv/static/`
  - `.elixir_ls/`
  - `.DS_Store`
  - `.vscode/`
- **Notable absence:** The line `# /config/*.secret.exs` is commented out — `config/*.secret.exs` is NOT excluded from version control.
- **Notable absence:** No exclusion for `*.csv`, `*.sql`, or any data files at the repo root.

---

### File: `Dockerfile`

- No module name (non-Elixir file)
- No public functions, structs, plugs, pipelines, use/import/alias
- **Key configuration:**
  - Base image: `bitwalker/alpine-elixir:1.13.4`
  - Packages installed: `git make wget curl inotify-tools nodejs npm ca-certificates`
  - npm pinned to `8.1.3` globally
  - Custom CA certificate: `priv/certs/sectigo_root_r46.crt` added and `update-ca-certificates --fresh` run
  - `EXPOSE 4000` (HTTP), `EXPOSE 4001` (TCP)
  - `ENV PORT=4000`, `ENV TCP_PORT=4001`, `ENV MIX_ENV=prod`
  - Build sequence: `COPY . .` → `mix deps.get` → `npm install` → `mix compile` → `mix release`
  - CMD: `/app/_build/prod/rel/api_server/bin/api_server start`
  - Directory `/opt/app` created with `chmod -R 777`

---

### File: `assets/brunch-config.js`

- No module name (JavaScript config file)
- No public functions, structs, plugs, pipelines, use/import/alias
- **Key configuration:**
  - Compiles JS to `js/app.js`, CSS to `css/app.css`
  - Babel configured to ignore `/vendor/`
  - Public output path: `../priv/static`
  - npm enabled: `true`

---

### File: `assets/package.json`

- No module name (JSON file)
- No public functions, structs, plugs, pipelines, use/import/alias
- **Dependencies:**
  - `phoenix`: `file:../deps/phoenix` (local)
  - `phoenix_html`: `file:../deps/phoenix_html` (local)
- **DevDependencies:**
  - `babel-brunch`: `6.1.1`
  - `brunch`: `^2.10.17`
  - `clean-css-brunch`: `2.10.0`
  - `uglify-js-brunch`: `2.10.0`
- **License:** MIT

---

### File: `assets/package-lock.json`

- No module name (JSON lock file)
- No public functions, structs, plugs, pipelines, use/import/alias
- **lockfileVersion:** 2
- **Notable resolved versions:**
  - `acorn`: `5.7.3`
  - `ansi-regex`: `2.1.1`
  - `ansi-styles`: `2.2.1`
  - All packages resolved from `https://registry.npmjs.org/`
  - Phoenix/phoenix_html sourced from local file paths (`file:../deps/phoenix`, `file:../deps/phoenix_html`)

---

### File: `config/config.exs`

- No module name (Mix config file)
- No public functions, structs, plugs, pipelines
- **use:** `Mix.Config`
- **Config keys set:**
  - `:api_server` → `ecto_repos: [ApiServer.Repo]`
  - `:api_server, ApiServerWeb.Endpoint` → `url`, `secret_key_base` (hardcoded), `render_errors`, `pubsub`
  - `:api_server, ApiServer.Scheduler` → `debug_logging`, `jobs` (cron schedule — active jobs for vx_keller, vx_dpworld, vx_linde, vx_sielift; many commented-out customer tenants)
  - `:api_server, ApiServer.Mailer` → `adapter: Bamboo.SMTPAdapter`, `server: "email-smtp.us-west-2.amazonaws.com"`, `port: 587`, `username: "[REDACTED-AWS-KEY-ID]"`, `password: "[REDACTED-AWS-SMTP-PASSWORD]"`, `tls: :always`, `ssl: false`, `retries: 1`
  - `:logger, :console` → `format`, `metadata`
  - `:api_server, ApiServer.Guardian` → `issuer: "rhmapi"`, `ttl: {52, :weeks}`, `secret_key: "wf1TLkCaEKIPY61A5LvxtPrUA63wrV/hz0RAtaDPh7BENw5WgsCPUN0/qH65BYmA"` (hardcoded)
  - `:geonames` → `username: "vinxstudio"`, `language: "en"`
  - `import_config "#{Mix.env()}.exs"`

---

### File: `config/dev.exs`

- No module name (Mix config file)
- No public functions, structs, plugs, pipelines
- **use:** `Mix.Config`
- **Config keys set:**
  - `:api_server, ApiServerWeb.Endpoint` → `http: [port: 4000]`, `debug_errors: true`, `code_reloader: true`, `check_origin: false`, `watchers`, `live_reload`
  - `:logger` → `level: :info`
  - `:phoenix` → `stacktrace_depth: 20`, `json_library: Poison`
  - `:api_server, ApiServer.FortyNineRepo` → `adapter: Ecto.Adapters.MySQL`, `database: "trackingsolutions"`, `username: "svr49_hi_x_user"`, `password: "Q973bFtc9z/cVW#mA"` (hardcoded), `hostname: "svr49.tracking-intelligence.com"` (external host), `pool_timeout: 15000`, `timeout: :infinity`, `loggers: []`
  - `:api_server, ApiServer.Repo` → `adapter: Ecto.Adapters.MySQL`, `username: "vxaurorasyduser"`, `password: "TRxbixk9fuZc"` (hardcoded), `hostname: "vxsandboxsydneytest-cluster-1.cluster-c4fwadrw9quy.ap-southeast-2.rds.amazonaws.com"` (AWS RDS endpoint, hardcoded), `port: 3306`
  - `:api_server, ApiServer.Mailer` → same AWS SES credentials as config.exs (duplicated)

---

### File: `config/prod.exs`

- No module name (Mix config file)
- No public functions, structs, plugs, pipelines
- **use:** `Mix.Config`
- **Config keys set:**
  - `:api_server, ApiServerWeb.Endpoint` → `http: [port: 4000]`, `url: [host: "localhost", port: 4000]`, `server: true`, `version`
  - `:logger` → `level: :info`
  - `:api_server, ApiServer.FortyNineRepo` → `database: "trackingsolutions"`, `username: "svr49_hi_x_user"`, `password: "Q973bFtc9z/cVW#mA"` (hardcoded), `hostname: "svr49.tracking-intelligence.com"`, `timeout: :infinity`
  - `:api_server, ApiServer.Repo` → `username: "vxaurorasyduser"`, `password: "TRxbixk9fuZc"` (hardcoded), `hostname: "vxsandboxsydneytest-cluster-1.cluster-c4fwadrw9quy.ap-southeast-2.rds.amazonaws.com"` (AWS RDS, hardcoded), `timeout: 600_000` (10 min — noted as "bad" in comment), `port: 3306`
  - `:api_server, ApiServer.Mailer` → same AWS SES credentials (duplicated again)
  - `import_config "prod.secret.exs"`
- **Notable:** Production URL is `localhost:4000`, not a real hostname.
- **Notable:** `timeout: 600_000` (10 minutes) on the production DB pool, acknowledged in a comment as a known bad value.

---

### File: `config/prod.secret.exs`

- No module name (Mix config file)
- No public functions, structs, plugs, pipelines
- **use:** `Mix.Config`
- **Config keys set:**
  - `:api_server, ApiServerWeb.Endpoint` → `secret_key_base: "glcsjqnr64PEc+Las0f0pIwIBr/J91VELfvyzCWgXGWXOSg/Ow4eX0hWCNvspNjN"` (hardcoded literal string)
- **Notable:** This file is present in the repository and tracked by git (not excluded by .gitignore — see .gitignore analysis above). The commented-out DB config block also shows the RDS password `TRxbixk9fuZc`.

---

### File: `config/test.exs`

- No module name (Mix config file)
- No public functions, structs, plugs, pipelines
- **use:** `Mix.Config`
- **Config keys set:**
  - `:api_server, ApiServerWeb.Endpoint` → `http: [port: 4001]`, `server: false`
  - `:logger, :console` → `format`
  - `:phoenix` → `stacktrace_depth: 20`
  - `:api_server, ApiServer.Repo` → `adapter: Ecto.Adapters.MySQL`, `database: "vx_dev"`, `username: "root"`, `password: "secret"`, `hostname: "127.0.0.1"`, `port: 3307`
  - `:api_server, ApiServer.Mailer` → same AWS SES credentials (`[REDACTED-AWS-KEY-ID]` / `[REDACTED-AWS-SMTP-PASSWORD]`) — production SMTP credentials in test config

---

### File: `mix.exs`

- **Module:** `ApiServer.Mixfile`
- **use:** `Mix.Project`
- **Public functions:**
  - `project/0` (line 4)
  - `application/0` (line 20)
- **Private functions:** `elixirc_paths/1`, `deps/0`, `aliases/0`
- **No defstruct/defexception/schema**
- **Dependencies declared (mix.exs):**
  - `{:phoenix, "~> 1.5.9"}`
  - `{:phoenix_pubsub, "~> 2.0"}`
  - `{:phoenix_ecto, "~> 3.2"}`
  - `{:mariaex, "~>0.8.2"}` — DEPRECATED (no security support per checklist)
  - `{:phoenix_html, "~> 2.10"}`
  - `{:phoenix_live_reload, "~> 1.0", only: :dev}`
  - `{:gettext, "~> 0.11"}`
  - `{:cowboy, "~> 1.0"}` — Cowboy 1.x (old major version)
  - `{:cors_plug, "~> 1.5"}`
  - `{:distillery, "~> 1.5"}`
  - `{:ex_crc, "~> 1.0.0"}`
  - `{:absinthe, "~> 1.4.0"}`
  - `{:absinthe_plug, "~> 1.4.0"}`
  - `{:absinthe_ecto, "~> 0.1.3"}`
  - `{:httpoison, "~> 1.6"}`
  - `{:poison, "~> 3.1"}`
  - `{:elixir_xml_to_map, "~> 0.1"}`
  - `{:timex, "~> 3.1"}`
  - `{:guardian, "~> 1.0"}`
  - `{:csv, "~> 2.1.1"}`
  - `{:geonames, path: "geonames-elixir"}` — local path dependency
  - `{:geohax, ">= 0.0.0"}` — unbounded version constraint
  - `{:con_cache, "~> 0.13"}`
  - `{:topo, "~> 0.1.0"}`
  - `{:bamboo, "~> 1.2"}`
  - `{:bamboo_smtp, "~> 2.1.0"}`
  - `{:quantum, "~> 2.3"}`
  - `{:plug_cowboy, "~> 1.0"}`
- **Elixir version constraint:** `"~> 1.4"` (very permissive — allows 1.x up to but not 2.0)

---

### File: `mix.lock`

- No module name (lock file)
- No public functions, structs, plugs, pipelines, use/import/alias
- **Resolved versions (security-relevant):**
  - `absinthe`: `1.4.16`
  - `absinthe_plug`: `1.4.7`
  - `bamboo`: `1.5.0`
  - `bamboo_smtp`: `2.1.0`
  - `certifi`: `2.5.2`
  - `cowboy`: `1.1.2`
  - `distillery`: `1.5.5`
  - `ecto`: `2.2.12`
  - `guardian`: `1.2.1`
  - `hackney`: `1.16.0`
  - `httpoison`: `1.6.2`
  - `jose`: `1.10.1`
  - `mariaex`: `0.8.4` (specified `~>0.8.2` in mix.exs; resolved to `0.8.4`)
  - `phoenix`: `1.5.13`
  - `plug`: `1.13.6`
  - `plug_cowboy`: `1.0.0`
  - `poison`: `3.1.0`
  - `quantum`: `2.4.0`
  - All packages sourced from `hexpm` (no `git:` URLs)
  - `geonames` is a `path:` dependency (not in mix.lock — local)

---

### File: `rel/config.exs`

- No module name (Distillery release config)
- No public functions, structs, plugs, pipelines, use/import/alias
- **use:** `Mix.Releases.Config`
- **Config keys set:**
  - `default_release: :default`
  - `default_environment: Mix.env()`
  - `environment :dev` → `dev_mode: true`, `include_erts: false`, `cookie: :"JKjj4~EgQ[*I;|ap1Gr2i.Lg4U(8])B/qqR8AWKoZLe@K!YN^!jjGH7yL8g8zDI0"` (hardcoded)
  - `environment :prod` → `include_erts: true`, `include_src: false`, `cookie: :"uGovGv~THz5>(L)>:_:.KDV>]Kr7mtIeFL)ESD\`a$bF\`I^hrWwwjea|K$HbFRIpR"` (hardcoded)
  - `release :api_server` → `version: current_version(:api_server)`, `applications: [:runtime_tools]`
- **Notable:** Both dev and prod Erlang distribution cookies are hardcoded plaintext literals committed to version control.

---

## Findings

---

### §1 Secrets and Configuration

**A001-1 — CRITICAL: AWS SES SMTP credentials hardcoded in four tracked config files**

The AWS SES SMTP username and password are hardcoded in plaintext in every config environment file that is tracked in git:

- `config/config.exs` lines 117–120:
  `username: "[REDACTED-AWS-KEY-ID]"`
  `password: "[REDACTED-AWS-SMTP-PASSWORD]"`
- `config/dev.exs` lines 98–101 (identical values)
- `config/prod.exs` lines 45–48 (identical values)
- `config/test.exs` lines 57–59 (identical values)

A comment in config.exs line 115 also preserves the prior IAM key `[REDACTED-AWS-KEY-ID]` (and prior password `[REDACTED-AWS-SMTP-PASSWORD]`) in commented-out form — both are committed to version control and visible in git history. The `AKIA`-prefix format confirms these are IAM access key IDs. These credentials must be revoked immediately, rotated, and replaced with environment variable references (`System.get_env/1`).

---

**A001-2 — CRITICAL: Guardian JWT secret key hardcoded in tracked config file**

`config/config.exs` line 136:
```
secret_key: "wf1TLkCaEKIPY61A5LvxtPrUA63wrV/hz0RAtaDPh7BENw5WgsCPUN0/qH65BYmA"
```

The Guardian signing key is used to sign all JWT tokens for the application. Any party with read access to this repository can forge arbitrary JWT tokens, bypassing all authentication. This value must be rotated immediately, all existing tokens invalidated, and the key loaded via `System.get_env/1` at runtime.

---

**A001-3 — CRITICAL: Phoenix `secret_key_base` hardcoded in two tracked config files**

- `config/config.exs` line 15:
  `secret_key_base: "djHcKcu+CWBtfoT6k1mLsC1ObkKOy1ZF1G840aRXnQ+oAgAU9efRLUJ+yTd3x/Fh"`
- `config/prod.secret.exs` line 12:
  `secret_key_base: "glcsjqnr64PEc+Las0f0pIwIBr/J91VELfvyzCWgXGWXOSg/Ow4eX0hWCNvspNjN"`

The `secret_key_base` is used to sign cookies, session tokens, and CSRF tokens. Exposure allows session forgery and CSRF bypass. Both values must be rotated and loaded from environment variables.

---

**A001-4 — CRITICAL: Production and dev database passwords hardcoded in tracked config files**

Multiple database credentials are hardcoded in tracked files:

- `config/dev.exs` line 64 (`ApiServer.FortyNineRepo`):
  `password: "Q973bFtc9z/cVW#mA"`, `hostname: "svr49.tracking-intelligence.com"`
- `config/dev.exs` lines 87–88 (`ApiServer.Repo`):
  `password: "TRxbixk9fuZc"`, `hostname: "vxsandboxsydneytest-cluster-1.cluster-c4fwadrw9quy.ap-southeast-2.rds.amazonaws.com"`
- `config/prod.exs` lines 17, 35–36 (same passwords for both repos in production)
- `config/prod.secret.exs` lines 18–19 (commented-out block still exposes `TRxbixk9fuZc`)

The fact that the same password (`TRxbixk9fuZc`) is used across dev and prod RDS instances is a separate concern (credential reuse).

---

**A001-5 — CRITICAL: `config/prod.secret.exs` is tracked in git (not excluded by .gitignore)**

The `.gitignore` file contains the line:
```
# /config/*.secret.exs
```
The exclusion rule is commented out. `prod.secret.exs` is therefore tracked by git and confirmed present in the repository (`git ls-files` returns it). The file contains the production `secret_key_base`. This defeats the entire purpose of having a `*.secret.exs` file pattern.

---

**A001-6 — CRITICAL: Erlang distribution cookies hardcoded in tracked `rel/config.exs`**

`rel/config.exs` lines 33 and 39 contain hardcoded Erlang node cookies for dev and prod environments:
```
cookie: :"JKjj4~EgQ[*I;|ap1Gr2i.Lg4U(8])B/qqR8AWKoZLe@K!YN^!jjGH7yL8g8zDI0"
cookie: :"uGovGv~THz5>(L)>:_:.KDV>]Kr7mtIeFL)ESD`a$bF`I^hrWwwjea|K$HbFRIpR"
```
The Erlang distribution cookie is the only authentication mechanism for Erlang/OTP node-to-node communication. Any host that knows the cookie and can reach the EPMD port can connect to the node, execute arbitrary Erlang code, and take full control of the runtime. These must be rotated and injected at deploy time via environment variable or a secrets manager, never committed to source control.

---

**A001-7 — HIGH: `geonames` username hardcoded in tracked config**

`config/config.exs` line 139:
```
username: "vinxstudio"
```
This is a third-party API credential (geonames.org) committed in plaintext. While the impact of this specific credential is lower than the database and JWT secrets, it represents the same pattern of hardcoded credentials and may allow abuse of the account's quota or API limits.

---

**A001-8 — HIGH: AWS RDS endpoint hostname hardcoded in tracked config files**

`config/dev.exs` line 88 and `config/prod.exs` line 36:
```
hostname: "vxsandboxsydneytest-cluster-1.cluster-c4fwadrw9quy.ap-southeast-2.rds.amazonaws.com"
```
`config/dev.exs` line 65 and `config/prod.exs` line 16:
```
hostname: "svr49.tracking-intelligence.com"
```
Hardcoded RDS cluster endpoints and external hostnames reveal infrastructure topology and region (`ap-southeast-2`). These should be injected via environment variables. Additionally, `svr49.tracking-intelligence.com` appears to be an external third-party tracking service, confirming a dependency on an external database server.

---

**A001-9 — HIGH: No `bitbucket-pipelines.yml` present — CI/CD pipeline absent**

The file `bitbucket-pipelines.yml` does not exist in the repository. The checklist requires its presence and review. The absence means there is no automated CI/CD pipeline visible in source control, so it is unknown whether deployments are being performed with hardcoded credentials in an out-of-band pipeline, or whether no automated deployment exists. The lack of pipeline configuration also means no automated security scanning or testing gate is enforced on commits.

---

**A001-10 — MEDIUM: Guardian TTL is 52 weeks — excessively long token lifetime**

`config/config.exs` line 135:
```
ttl: {52, :weeks}
```
JWT tokens issued by Guardian are valid for one full year. If a token is compromised, the attacker has up to 52 weeks of authenticated access before the token naturally expires. Industry best practice for API tokens is 15 minutes to 24 hours for access tokens, with refresh tokens handling long-lived sessions. There is no evidence in this configuration of a refresh token policy.

---

**A001-11 — MEDIUM: Production `url` host is `localhost` in `prod.exs`**

`config/prod.exs` line 5:
```
url: [host: "localhost", port: 4000]
```
The production endpoint URL is configured as `localhost`. This affects URL generation (e.g., email links, redirects). This suggests either the server sits behind a reverse proxy that was never configured here, or the production URL is simply not set correctly. Generated URLs in emails or webhooks will contain `localhost` as the host.

---

**A001-12 — MEDIUM: `timeout: :infinity` on `FortyNineRepo` in dev and prod**

`config/dev.exs` line 72 and `config/prod.exs` line 24:
```
timeout: :infinity
```
An infinite database query timeout on a production repository means a hung query will hold a connection pool slot indefinitely, enabling a denial-of-service condition through connection pool exhaustion.

---

**A001-13 — INFO: Prior AWS IAM key preserved in comments across multiple files**

The old IAM access key `[REDACTED-AWS-KEY-ID]` and its password `[REDACTED-AWS-SMTP-PASSWORD]` appear in commented-out blocks in `config/config.exs` (lines 115–116), `config/dev.exs` (lines 96–99), `config/prod.exs` (lines 43–44), and `config/test.exs` (lines 56–58). Even if revoked, these remain in git history and represent credential hygiene debt. The comments should be removed and git history cleaned.

---

### §2 Authentication and Authorization

**A001-14 — HIGH: Guardian signing algorithm not explicitly configured — default risk**

`config/config.exs` configures Guardian with only `issuer`, `ttl`, and `secret_key`. No `allowed_algos` or `secret_fetcher` module is specified. Guardian 1.x defaults to `HS512` when a binary secret key is provided. While HS512 is not inherently insecure, the absence of explicit algorithm configuration means the acceptable algorithm set is not auditable from configuration alone. Combined with the hardcoded `secret_key` (A001-2), any compromise of the key allows forging tokens with the default algorithm. Explicit `allowed_algos: ["HS512"]` (or RS256 with a key pair) should be configured.

---

**A001-15 — MEDIUM: `check_origin: false` in `dev.exs` — WebSocket origin not validated in dev**

`config/dev.exs` line 13:
```
check_origin: false
```
While this is a development-only setting, if the Docker image is built with `MIX_ENV=dev` or if dev config is accidentally applied to a staging/production-like environment, WebSocket connections will be accepted from any origin. The Dockerfile sets `MIX_ENV=prod`, which mitigates this for production builds, but the configuration remains a risk for any non-production deployment using this image pattern.

§2: No further issues found in the assigned files. (Router/endpoint files are not in the assigned file set for this pass; authentication pipeline review is deferred to a later pass covering those files.)

---

### §3 Input Validation and Injection

§3: No issues found in the assigned files. (Controller, context, and schema files are not in the assigned file set for this pass.)

---

### §4 Session and CSRF

**A001-16 — HIGH: `secret_key_base` hardcoded in two tracked files — session/CSRF forgery risk**

Covered under A001-3. The `secret_key_base` is the cryptographic root for Plug session signing and CSRF token generation. Its exposure in git means sessions can be forged and CSRF tokens can be computed by anyone with repository read access.

§4: No additional session or CSRF configuration was observable in the assigned files beyond the `secret_key_base` issues already reported. Cookie flags, session storage backend, and channel `connect/3` validation are in endpoint/router files deferred to a later pass.

---

### §5 File and Data Handling

**A001-17 — CRITICAL: 21 data files (20 CSV + 1 SQL) committed and tracked in git**

`git ls-files` confirms the following data files are tracked in the repository and committed since the initial commit (`e675b0b Initial clean commit into CIG bitbucket`):

**CSV files (20):**
- `2021-11-29.csv` (1,201 lines) — customer work order data with customer numbers, equipment serials, invoice amounts, addresses
- `2021-11-30.csv`
- `2021-12-06.csv`
- `2022-03-04 Pronto.csv`
- `2022-05-23 Work Orders.csv`
- `Daily Usage Summary - 2020-06-21.csv`
- `EBS Data .csv` (2,402 lines) — equipment service records with hardware IDs and customer numbers
- `EBS Data 2021-11-30.csv`
- `EBS Data 2022-01-18.csv`
- `EBS Data 2022-05-24.csv`
- `EBS Data 2022-05-24a.csv`
- `EBS Data 2022-03-04.csv` (as `Pronto Data Processed 2022-03-04.csv`)
- `all.csv`
- `anniversary_data_1.csv`
- `next_services.csv`
- `small.csv`
- `speed.csv`
- `usage_data.csv` (60,960 lines) — per-device usage data with customer identifiers and hardware IDs
- `usage_data_ayo.csv`
- `usage_report.csv`
- `vehicle_status.csv` (1,139 lines) — vehicle fleet data with serial numbers, product codes, GPS geofence locations, service types, customer locations

**SQL file (1):**
- `dump.sql` — present and tracked; file is empty (0 bytes) on disk but is in git history

Inspected CSV samples confirm real operational data: customer numbers (`kcustnum`), equipment serial numbers (`kserialnum`), invoice numbers (`arinvno`), work order text, hardware device IDs, GPS geofence locations, customer postal codes. This constitutes PII-adjacent operational and fleet data.

The `.gitignore` has no entries for `*.csv`, `*.sql`, or data files. These files were never excluded and are now part of the repository's permanent git history.

**Immediate action required:** Remove these files from the working tree, add exclusion patterns to `.gitignore`, and use `git filter-repo` or BFG Repo Cleaner to purge them from git history. All persons with repository access must be notified that this data was exposed. Consider whether data breach notification obligations apply.

---

**A001-18 — MEDIUM: `dump.sql` tracked in git (empty on disk but in history)**

The file `dump.sql` is tracked by git (confirmed via `git ls-files`). While it is currently 0 bytes on disk, it was introduced in the initial commit. If it ever contained a database dump — or if git history contains a non-empty version — that data is permanently accessible to anyone who can clone the repository. A full history audit with `git log -p -- dump.sql` should be performed to determine whether any non-empty version was committed.

---

### §6 Dependencies

**A001-19 — HIGH: `mariaex ~>0.8.2` — deprecated package with no security support**

`mix.exs` line 39: `{:mariaex, "~>0.8.2"}`
`mix.lock` resolves to `mariaex 0.8.4`.

The checklist explicitly flags Mariaex 0.8.2 as deprecated with no security support. This package has not received updates and any security vulnerabilities discovered will not be patched. The recommended migration path is to `myxql`, which is the actively maintained MySQL/MariaDB driver for Ecto 3+. Note that migration requires upgrading Ecto from 2.x to 3.x simultaneously.

---

**A001-20 — HIGH: Ecto 2.2.12 — end-of-life version**

`mix.lock` resolves `ecto` to `2.2.12`. Ecto 2.x is end-of-life; all security maintenance has moved to Ecto 3.x. Using an unmaintained ORM version on a production fleet management system accepting external data is a significant risk.

---

**A001-21 — HIGH: Cowboy 1.1.2 / plug_cowboy 1.0.0 — end-of-life HTTP server**

`mix.exs` declares `{:cowboy, "~> 1.0"}` and `{:plug_cowboy, "~> 1.0"}`.
`mix.lock` resolves `cowboy` to `1.1.2` and `plug_cowboy` to `1.0.0`.

Cowboy 1.x is end-of-life. Cowboy 2.x introduced significant security and correctness improvements including HTTP/2 support and better request smuggling protections. Running Cowboy 1.x in production exposes the application to unpatched vulnerabilities in the HTTP server.

---

**A001-22 — MEDIUM: `{:geohax, ">= 0.0.0"}` — unbounded version constraint**

`mix.exs` line 57: `{:geohax, ">= 0.0.0"}`

An unbounded version constraint (`>= 0.0.0`) means any future version of geohax, including major versions with breaking changes or potential supply-chain compromises, could be resolved. `mix.lock` pins it to `0.3.0`, which provides reproducibility for existing builds, but the constraint in `mix.exs` is dangerous: if `mix.lock` is ever regenerated (e.g., `mix deps.update --all`), the resolved version could jump arbitrarily. This should be tightened to a specific approximate version such as `"~> 0.3"`.

---

**A001-23 — MEDIUM: `{:geonames, path: "geonames-elixir"}` — local path dependency**

`mix.exs` line 56: `{:geonames, path: "geonames-elixir"}`

This dependency is loaded from a local directory rather than hex.pm. It does not appear in `mix.lock` (local path deps are not locked). This means: (a) the exact version used is not reproducibly pinned; (b) the code is not subject to hex.pm's checksum verification; (c) the dependency is not visible for vulnerability scanning. The local `geonames-elixir` directory must be audited separately. If the package is suitable for publication, it should be published to hex.pm and declared as a versioned dependency.

---

**A001-24 — MEDIUM: Phoenix 1.5.13 — significantly outdated framework**

`mix.lock` resolves `phoenix` to `1.5.13`. Phoenix 1.7+ introduced significant security improvements including better CSRF handling and LiveView security fixes. Running Phoenix 1.5 in production means missing multiple patch releases of security improvements. The `mix.exs` constraint `"~> 1.5.9"` prevents upgrading to 1.6+.

---

**A001-25 — MEDIUM: Guardian 1.2.1 — outdated authentication library**

`mix.lock` resolves `guardian` to `1.2.1`. Guardian 2.x introduced API improvements and security fixes. Combined with the extremely long TTL (A001-10) and hardcoded secret (A001-2), this represents a compounded authentication risk.

---

**A001-26 — MEDIUM: `brunch ^2.10.17` — outdated and unmaintained JS build tool**

`assets/package.json` declares `"brunch": "^2.10.17"`. Brunch has been largely abandoned as a build tool in favour of webpack and esbuild. While this is an assets pipeline concern, unmaintained build tools can introduce vulnerabilities in the build environment. The `^` prefix allows minor-version bumps automatically. This should be migrated to a maintained build tool such as esbuild (which Phoenix 1.7+ uses by default).

---

**A001-27 — INFO: `acorn 5.7.3` in package-lock.json — known vulnerability history**

`assets/package-lock.json` resolves `acorn` to `5.7.3` (a dev dependency of brunch). Acorn versions prior to 5.7.4, 6.4.1, and 7.1.1 had a ReDoS vulnerability (CVE-2020-7598). Version 5.7.3 is below the patched 5.7.4 threshold. While this is a build-time dev dependency (not included in the runtime Docker image), it could be exploited in a CI/CD environment that runs `npm install` and processes malicious JavaScript source files.

---

**A001-28 — INFO: `distillery 1.5.5` — outdated release tooling**

`mix.lock` resolves `distillery` to `1.5.5`. Distillery 2.x and the now-standard Mix Releases (built into Elixir 1.9+) are preferred. Distillery 1.x has known issues with hot-upgrades and release configuration. For security, release tooling should be current to ensure correct handling of environment variables and secrets in the release boot process.

---

### §7 Infrastructure Exposure

**A001-29 — HIGH: AWS region, RDS cluster endpoint, and external service hostname hardcoded in tracked config**

See A001-8. In summary:
- Region `ap-southeast-2` is exposed through the RDS hostname.
- The full Aurora cluster endpoint `vxsandboxsydneytest-cluster-1.cluster-c4fwadrw9quy.ap-southeast-2.rds.amazonaws.com` is hardcoded in both dev and prod configs.
- The external hostname `svr49.tracking-intelligence.com` is hardcoded with its database credentials.

This information, combined with the leaked credentials (A001-4), provides a complete connection profile for the production database to any reader of this repository.

---

**A001-30 — HIGH: Docker `chmod -R 777 /opt/app` — overly permissive directory permissions**

`Dockerfile` line 7:
```
chmod -R 777 /opt/app
```
Setting world-writable (`777`) permissions on the application directory allows any process running in the container — including any compromised dependency or injected code — to write to the application directory. This is a significant container hardening failure. The directory should be owned by a non-root user with permissions `755` or stricter, and the application should run as a non-root user.

---

**A001-31 — HIGH: Docker container runs as root**

The Dockerfile does not create a non-root user or include a `USER` directive. The application process (`api_server start`) runs as root inside the container. If any vulnerability allows command injection or container escape, the attacker has root-level access. A dedicated low-privilege user should be created and used to run the application.

---

**A001-32 — MEDIUM: Docker image based on `bitwalker/alpine-elixir:1.13.4` — community image, potentially outdated**

The base image `bitwalker/alpine-elixir:1.13.4` is a community-maintained image (not an official Elixir or Alpine image). Community images may not receive timely security updates. Elixir 1.13.4 was released in early 2022; current Elixir is 1.16+. The underlying Alpine packages installed during `RUN apk update` will pull latest Alpine packages at build time, but the Elixir runtime and OTP version are pinned to what the base image provides. The official `hexpm/elixir` Docker images are recommended instead.

---

**A001-33 — MEDIUM: No TLS termination configured in the application**

`config/prod.exs` configures only HTTP (`http: [port: 4000]`). The `https:` key is commented out with a note referencing `SOME_APP_SSL_KEY_PATH` and `SOME_APP_SSL_CERT_PATH` environment variables. There is no `force_ssl` configuration. If TLS is not terminated by an upstream load balancer or reverse proxy, traffic to and from the application travels unencrypted. Given that this is a fleet management API handling vehicle locations and driver data, unencrypted transport is unacceptable. Confirmation that TLS is terminated externally (e.g., at an AWS ALB) is required; this is not verifiable from the assigned files alone.

---

**A001-34 — MEDIUM: `EXPOSE 4001` / `ENV TCP_PORT=4001` — unknown TCP service exposed**

The Dockerfile exposes port 4001 and sets `TCP_PORT=4001`. The purpose of this port is not documented in the assigned files. If this is an Erlang distribution port, it should never be exposed publicly. The port's purpose and access controls must be verified in the application source files.

---

**A001-35 — INFO: `cors_plug ~> 1.5` — CORS configuration not visible in assigned files**

`mix.exs` includes `{:cors_plug, "~> 1.5"}`. CORS configuration (allowed origins, methods, headers) is typically set in the endpoint or router, which are not in the assigned file set. A001-35 notes that CORS configuration must be reviewed in subsequent passes to verify that wildcard origins are not permitted for authenticated endpoints.

---

## Summary Table

| ID       | Severity | Section | Title |
|----------|----------|---------|-------|
| A001-1   | CRITICAL | §1      | AWS SES SMTP credentials hardcoded in 4 tracked config files |
| A001-2   | CRITICAL | §1      | Guardian JWT secret key hardcoded in tracked config |
| A001-3   | CRITICAL | §1      | Phoenix `secret_key_base` hardcoded in 2 tracked config files |
| A001-4   | CRITICAL | §1      | Production DB passwords hardcoded in tracked config files |
| A001-5   | CRITICAL | §1      | `prod.secret.exs` tracked in git (.gitignore entry commented out) |
| A001-6   | CRITICAL | §1      | Erlang distribution cookies hardcoded in tracked `rel/config.exs` |
| A001-7   | HIGH     | §1      | Geonames third-party API username hardcoded |
| A001-8   | HIGH     | §1      | AWS RDS endpoint and external service hostname hardcoded |
| A001-9   | HIGH     | §1      | No `bitbucket-pipelines.yml` — CI/CD pipeline absent from source control |
| A001-10  | MEDIUM   | §1      | Guardian TTL 52 weeks — excessively long token lifetime |
| A001-11  | MEDIUM   | §1      | Production URL host configured as `localhost` |
| A001-12  | MEDIUM   | §1      | `timeout: :infinity` on FortyNineRepo in dev and prod |
| A001-13  | INFO     | §1      | Prior AWS IAM key preserved in comments across config files |
| A001-14  | HIGH     | §2      | Guardian signing algorithm not explicitly configured |
| A001-15  | MEDIUM   | §2      | `check_origin: false` in dev config |
| A001-16  | HIGH     | §4      | `secret_key_base` hardcoded — session/CSRF forgery risk (see A001-3) |
| A001-17  | CRITICAL | §5      | 20 CSV + 1 SQL data files committed and tracked in git |
| A001-18  | MEDIUM   | §5      | `dump.sql` tracked in git (empty on disk, history unknown) |
| A001-19  | HIGH     | §6      | `mariaex ~>0.8.2` — deprecated, no security support |
| A001-20  | HIGH     | §6      | Ecto 2.2.12 — end-of-life version |
| A001-21  | HIGH     | §6      | Cowboy 1.1.2 / plug_cowboy 1.0.0 — end-of-life HTTP server |
| A001-22  | MEDIUM   | §6      | `{:geohax, ">= 0.0.0"}` — unbounded version constraint |
| A001-23  | MEDIUM   | §6      | `{:geonames, path: "geonames-elixir"}` — local path dependency, not locked |
| A001-24  | MEDIUM   | §6      | Phoenix 1.5.13 — significantly outdated framework |
| A001-25  | MEDIUM   | §6      | Guardian 1.2.1 — outdated authentication library |
| A001-26  | MEDIUM   | §6      | `brunch ^2.10.17` — outdated and unmaintained build tool |
| A001-27  | INFO     | §6      | `acorn 5.7.3` — below patched threshold for CVE-2020-7598 (dev dep) |
| A001-28  | INFO     | §6      | `distillery 1.5.5` — outdated release tooling |
| A001-29  | HIGH     | §7      | AWS region, RDS endpoint, external hostname hardcoded |
| A001-30  | HIGH     | §7      | Docker `chmod -R 777 /opt/app` — overly permissive |
| A001-31  | HIGH     | §7      | Docker container runs as root (no USER directive) |
| A001-32  | MEDIUM   | §7      | Community base image `bitwalker/alpine-elixir:1.13.4` — potentially outdated |
| A001-33  | MEDIUM   | §7      | No TLS termination configured in application |
| A001-34  | MEDIUM   | §7      | Port 4001 / TCP_PORT exposed with no documented purpose |
| A001-35  | INFO     | §7      | CORS configuration not visible — deferred to later pass |

---

## Critical Actions Required (Immediate)

1. **Revoke and rotate** all credentials exposed in this repository: AWS IAM key `[REDACTED-AWS-KEY-ID]`, SES SMTP password, both database passwords (`TRxbixk9fuZc`, `Q973bFtc9z/cVW#mA`), Guardian JWT secret key, both Phoenix `secret_key_base` values, and both Erlang distribution cookies.
2. **Purge git history** of all secrets using `git filter-repo` or BFG Repo Cleaner; force-push to all remotes; notify all collaborators to re-clone.
3. **Remove all CSV and SQL data files** from the working tree and git history. Assess data breach notification obligations under applicable privacy law (GDPR, Australian Privacy Act) given the customer fleet data exposed.
4. **Add `.gitignore` entries** for `*.csv`, `*.sql`, `/config/*.secret.exs`, and any other data or secret file patterns.
5. **Move all secrets to environment variables** or a secrets manager (AWS Secrets Manager, Parameter Store); reference them with `System.get_env/1` in runtime configuration.
