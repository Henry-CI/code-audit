# Pass 3: Documentation — B015
**Agent:** B015
**Files:**
- `lib/api_server_web/controllers/calamp_controller.ex`
- `lib/api_server_web/controllers/digital_matter_controller.ex`
- `lib/api_server_web/controllers/fallback_controller.ex`
- `lib/api_server_web/controllers/file_controller.ex`

**Date:** 2026-02-27

---

## calamp_controller.ex

### Reading Evidence

**Module:** `ApiServerWeb.CalampController`

**Public functions:**

| Function | Line |
|---|---|
| `recieve_calamp_data/2` | 4 |

**Private functions (not subject to @doc findings):**

| Function | Line |
|---|---|
| `validate/3` | 31 |

**Types / constants / errors defined:** None

**@moduledoc:** Absent

**@doc on public functions:** None present

---

### Findings

#### B015-1 — Missing @moduledoc in CalampController
**Severity:** LOW
**File:** `lib/api_server_web/controllers/calamp_controller.ex`, line 1

`ApiServerWeb.CalampController` has no `@moduledoc`. There is no description of the controller's purpose, the device protocol it handles (CalAmp), nor any notes about the expected request format (XML payload delivered via the `:xml` key). A `@moduledoc false` would be the minimum acceptable value; a descriptive string is preferred.

---

#### B015-2 — Missing @doc on `recieve_calamp_data/2`
**Severity:** INFO
**File:** `lib/api_server_web/controllers/calamp_controller.ex`, line 4

The only public action, `recieve_calamp_data/2`, has no `@doc`. The function accepts a `conn` and a map that must contain the key `:xml` (a pre-parsed XML map). Its behaviour — generating a ThingEvent, performing validation, and responding 200 OK — is undocumented. The function name also contains a spelling error (`recieve` instead of `receive`), which a doc string would at minimum make visible in generated documentation.

---

## digital_matter_controller.ex

### Reading Evidence

**Module:** `ApiServerWeb.DigitalMatterController`

**Public functions:**

| Function | Line |
|---|---|
| `get_g62_data/2` | 4 |

**Private functions (not subject to @doc findings):** None

**Types / constants / errors defined:** None

**@moduledoc:** Absent

**@doc on public functions:** None present

---

### Findings

#### B015-3 — Missing @moduledoc in DigitalMatterController
**Severity:** LOW
**File:** `lib/api_server_web/controllers/digital_matter_controller.ex`, line 1

`ApiServerWeb.DigitalMatterController` has no `@moduledoc`. There is no description of the controller's purpose, the device vendor it targets (Digital Matter G62/G70), or the expected JSON payload structure.

---

#### B015-4 — Missing @doc on `get_g62_data/2`
**Severity:** INFO
**File:** `lib/api_server_web/controllers/digital_matter_controller.ex`, line 4

`get_g62_data/2` has no `@doc`. The function accepts a `conn` and a `params` map that must conform to the Digital Matter JSON upload format (keys `"SerNo"`, `"Records"`, each record containing `"Fields"` with typed FType entries and a `"Reason"` code). Its behaviour — iterating records, mapping FType fields to internal event structures, looking up a VX Thing by hardware ID, creating ThingEvent records, and updating cached fields — is entirely undocumented. The expected response shape (200 JSON `{message: "OK"}` or 400 with error detail) is also undocumented.

---

## fallback_controller.ex

### Reading Evidence

**Module:** `ApiServerWeb.FallbackController`

**Public functions:**

| Function | Line |
|---|---|
| `call/2` (Ecto.Changeset clause) | 9 |
| `call/2` (:not_found clause) | 15 |

**Types / constants / errors defined:** None

**@moduledoc:** Present (lines 2–6)

```elixir
@moduledoc """
Translates controller action results into valid `Plug.Conn` responses.

See `Phoenix.Controller.action_fallback/1` for more details.
"""
```

**@doc on public functions:** None present

---

### Findings

#### B015-5 — Missing @doc on `call/2` (Ecto.Changeset clause)
**Severity:** INFO
**File:** `lib/api_server_web/controllers/fallback_controller.ex`, line 9

The `call/2` clause matching `{:error, %Ecto.Changeset{}}` has no `@doc`. It renders a 422 Unprocessable Entity response using `ApiServerWeb.ChangesetView`. While the `@moduledoc` gives a brief module-level description, individual clause behaviour (status code, view used, response shape) is not documented.

---

#### B015-6 — Missing @doc on `call/2` (:not_found clause)
**Severity:** INFO
**File:** `lib/api_server_web/controllers/fallback_controller.ex`, line 15

The `call/2` clause matching `{:error, :not_found}` has no `@doc`. It renders a 404 Not Found response using `ApiServerWeb.ErrorView`. As with B015-5, a `@doc` on the first `call/2` clause (with both clauses listed) would clarify the full set of handled error tuples and the corresponding HTTP responses.

---

## file_controller.ex

### Reading Evidence

**Module:** `ApiServerWeb.FileController`

**Public functions:**

| Function | Line |
|---|---|
| `get_size/2` | 12 |
| `send_file_download/2` | 28 |

**Private functions (not subject to @doc findings):**

| Function | Line |
|---|---|
| `generate_binary_file_contents/1` | 42 |
| `check_crc/1` | 52 |

**Types / constants / errors defined:** None

**@moduledoc:** Absent

**@doc on public functions:** None present

---

### Findings

#### B015-7 — Missing @moduledoc in FileController
**Severity:** LOW
**File:** `lib/api_server_web/controllers/file_controller.ex`, line 1

`ApiServerWeb.FileController` has no `@moduledoc`. There is no description of the controller's purpose: serving binary fob-code files (containing CRC16-XMODEM authenticated access fob data) to hardware devices identified by ESN/hardware ID.

---

#### B015-8 — Missing @doc on `get_size/2`
**Severity:** INFO
**File:** `lib/api_server_web/controllers/file_controller.ex`, line 12

`get_size/2` has no `@doc`. The function accepts a `conn` and a map with key `"esn"` (the hardware ID), looks up the associated VX Thing, collects all fleet fobs and admin fobs, calculates the file size as `(num_fobs + num_admin_fobs) * 6 + 2` bytes, and renders a `filesize.json` response. The parameter requirement and the size calculation formula are undocumented.

---

#### B015-9 — Missing @doc on `send_file_download/2`
**Severity:** INFO
**File:** `lib/api_server_web/controllers/file_controller.ex`, line 28

`send_file_download/2` has no `@doc`. The function accepts a `conn` and a map with key `"esn"`, looks up fleet and admin fobs, concatenates their hex fob codes, generates a binary file with a CRC16-XMODEM checksum appended, and sends it as a download with a timestamped filename (format `SM-<unix_epoch>-<hardwareid>.bin`). None of this behaviour, parameter requirements, or the download file format is documented.

---

## Summary

| ID | Severity | File | Description |
|---|---|---|---|
| B015-1 | LOW | `calamp_controller.ex` line 1 | Missing `@moduledoc` in `ApiServerWeb.CalampController` |
| B015-2 | INFO | `calamp_controller.ex` line 4 | Missing `@doc` on `recieve_calamp_data/2` |
| B015-3 | LOW | `digital_matter_controller.ex` line 1 | Missing `@moduledoc` in `ApiServerWeb.DigitalMatterController` |
| B015-4 | INFO | `digital_matter_controller.ex` line 4 | Missing `@doc` on `get_g62_data/2` |
| B015-5 | INFO | `fallback_controller.ex` line 9 | Missing `@doc` on `call/2` (Ecto.Changeset clause) |
| B015-6 | INFO | `fallback_controller.ex` line 15 | Missing `@doc` on `call/2` (:not_found clause) |
| B015-7 | LOW | `file_controller.ex` line 1 | Missing `@moduledoc` in `ApiServerWeb.FileController` |
| B015-8 | INFO | `file_controller.ex` line 12 | Missing `@doc` on `get_size/2` |
| B015-9 | INFO | `file_controller.ex` line 28 | Missing `@doc` on `send_file_download/2` |
