# Pass 3: Documentation — B009
**Agent:** B009
**Files:**
- `lib/api_server/vx/vx_abl_record.ex`
- `lib/api_server/vx/vx_access_fob.ex`
- `lib/api_server/vx/vx_customer.ex`
- `lib/api_server/vx/vx_fleet.ex`

**Date:** 2026-02-27

---

## vx_abl_record.ex

### Reading Evidence

**Module:** `ApiServer.Vx.VXAblRecord`

**Schema:** `abl_data_changes` (primary key: `ablid`)

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 25 |
| `generate_service/10` | 31 |
| `clean_xml_value/1` | 54 |
| `clean_xml_number_value/1` | 63 |
| `expand_xml_to_struct/1` | 72 |

**Types/constants defined:** None.

**Notes:**
- `changeset/2` carries `@doc false` (line 24) — intentionally suppressed, acceptable Ecto convention.
- `generate_service/10`, `clean_xml_value/1`, `clean_xml_number_value/1`, and `expand_xml_to_struct/1` have no `@doc` annotation of any kind.

### Findings

#### B009-1 — Missing @moduledoc in VXAblRecord
**Severity:** LOW
**File:** `lib/api_server/vx/vx_abl_record.ex`, line 1

The module `ApiServer.Vx.VXAblRecord` has no `@moduledoc` attribute. There is no description of its purpose (audit/change-log record schema for the `abl_data_changes` table), the XML blob format stored in `ablimage`, or the relationship to `VXUser`.

---

#### B009-2 — Missing @doc on generate_service/10
**Severity:** INFO
**File:** `lib/api_server/vx/vx_abl_record.ex`, line 31

The public function `generate_service/10` has no `@doc`. The function builds an XML audit payload recording a service-date change, then persists it via `Vx.create_abl_record/2`. Its ten parameters (`user`, `import_hour_meter`, `performed_by`, `thing`, `existing_service_date`, `new_service_date`, `current_hour_meter`, `input_one_hour_meter`, `usage`, `customer`) are undocumented. Return value (`:ok` or `:error` atom extracted from the tuple) is also undocumented.

---

#### B009-3 — Missing @doc on clean_xml_value/1
**Severity:** INFO
**File:** `lib/api_server/vx/vx_abl_record.ex`, line 54

The public function `clean_xml_value/1` has no `@doc`. The function converts an empty map `%{}` (produced by `XmlToMap` for absent XML elements) to `nil`, passing all other values through. The intent and the `XmlToMap` convention it compensates for are not described.

---

#### B009-4 — Missing @doc on clean_xml_number_value/1
**Severity:** INFO
**File:** `lib/api_server/vx/vx_abl_record.ex`, line 63

The public function `clean_xml_number_value/1` has no `@doc`. It is functionally similar to `clean_xml_value/1` but returns `0` instead of `nil` for empty-map inputs. The distinction between the two helpers and when each should be used is not documented. (Note: `clean_xml_number_value/1` is defined but never called within this module; its public visibility without documentation compounds the clarity gap.)

---

#### B009-5 — Missing @doc on expand_xml_to_struct/1
**Severity:** INFO
**File:** `lib/api_server/vx/vx_abl_record.ex`, line 72

The public function `expand_xml_to_struct/1` has no `@doc`. The function parses the raw XML string stored in `ablimage`, extracts service-related fields (including `hardwareid`), and merges them into the record map. The expected shape of the input, the fields added to the result, and the `XmlToMap` dependency are all undocumented.

---

## vx_access_fob.ex

### Reading Evidence

**Module:** `ApiServer.Vx.VXAccessFob`

**Schema:** `access_fobs` (default primary key `id`)

**Public functions:** None (no functions are defined in this module beyond the implicit Ecto schema callbacks).

**Types/constants defined:** None.

**Notes:**
- The module contains only a `use Ecto.Schema` declaration and a single `schema` block; no manually defined functions exist.
- `require Ecto.Query` and `require Ecto.Adapters.SQL` appear at the top of the file (lines 1–2) outside the `defmodule` block — these are file-level requires that have no effect on the module and appear to be leftover dead code.

### Findings

#### B009-6 — Missing @moduledoc in VXAccessFob
**Severity:** LOW
**File:** `lib/api_server/vx/vx_access_fob.ex`, line 4

The module `ApiServer.Vx.VXAccessFob` has no `@moduledoc`. There is no description of what an access fob is, its relationship to `VXUser` (via `assigned_to_user` → `aacid`), or how fob codes are used within the system.

---

## vx_customer.ex

### Reading Evidence

**Module:** `ApiServer.Vx.VXCustomer`

**Schema:** `aaa_customers` (primary key: `aaaid`)

**Public functions:**

| Function | Line |
|---|---|
| `convert_json_to_changeset/1` | 25 |
| `changeset/2` | 43 |

**Types/constants defined:** None.

**Notes:**
- `changeset/2` carries `@doc false` (line 42) — intentionally suppressed, consistent with Ecto convention.
- `convert_json_to_changeset/1` has no `@doc` annotation of any kind.

### Findings

#### B009-7 — Missing @moduledoc in VXCustomer
**Severity:** LOW
**File:** `lib/api_server/vx/vx_customer.ex`, line 1

The module `ApiServer.Vx.VXCustomer` has no `@moduledoc`. There is no description of its purpose, the `aaa_customers` table it maps to, or the customer code derivation logic embedded in `convert_json_to_changeset/1`.

---

#### B009-8 — Missing @doc on convert_json_to_changeset/1
**Severity:** INFO
**File:** `lib/api_server/vx/vx_customer.ex`, line 25

The public function `convert_json_to_changeset/1` has no `@doc`. The function accepts a raw JSON-decoded map and constructs a changeset map using `Vx.update_key_if_value/3`. Key behaviour that goes undocumented includes:

- The expected keys of the input map (e.g. `"name"`, `"address_line_1"`, `"timezone"`, `"aaaudfcustcode"`, `"aaacolour"`).
- The automatic derivation of `:aaacustcode` from the customer name by reversing it, removing spaces, and taking the first 9 characters uppercased.
- The fact that the return value is a plain map, not an `Ecto.Changeset` struct (despite the function name).

---

## vx_fleet.ex

### Reading Evidence

**Module:** `ApiServer.Vx.VXFleet`

**Schema:** `aae_group` (primary key: `aaeid`)

**Public functions:**

| Function | Line |
|---|---|
| `convert_json_to_changeset/1` | 19 |
| `changeset/2` | 27 |

**Types/constants defined:** None.

**Notes:**
- `changeset/2` has no `@doc false` annotation — it is fully public and undocumented.
- `convert_json_to_changeset/1` has no `@doc` annotation.

### Findings

#### B009-9 — Missing @moduledoc in VXFleet
**Severity:** LOW
**File:** `lib/api_server/vx/vx_fleet.ex`, line 1

The module `ApiServer.Vx.VXFleet` has no `@moduledoc`. There is no description of what a fleet/group is, its relationship to `VXFleetAssociation`, or the semantics of `:aaetype` and `:aaeshowfilter`.

---

#### B009-10 — Missing @doc on convert_json_to_changeset/1
**Severity:** INFO
**File:** `lib/api_server/vx/vx_fleet.ex`, line 19

The public function `convert_json_to_changeset/1` has no `@doc`. The function accepts a raw JSON-decoded map and produces a plain map suitable for passing to `changeset/2`. The expected input keys (`"name"`, `"color"`, `"type"`, `"show_in_filters"`) and the return type (plain map, not `Ecto.Changeset`) are undocumented.

---

#### B009-11 — Missing @doc on changeset/2
**Severity:** INFO
**File:** `lib/api_server/vx/vx_fleet.ex`, line 27

The public function `changeset/2` has no `@doc` and no `@doc false`. Unlike the analogous `changeset/2` functions in `VXAblRecord` and `VXCustomer` (which explicitly suppress documentation with `@doc false`), this function is fully exposed with no annotation. The permitted fields (`:aaedesc`, `:aaecolour`, `:aaetype`, `:aaeshowfilter`) and the required field (`:aaedesc`) are not described.

---

## Summary

| ID | Severity | File | Description |
|---|---|---|---|
| B009-1 | LOW | `vx_abl_record.ex` | Missing `@moduledoc` in `VXAblRecord` |
| B009-2 | INFO | `vx_abl_record.ex:31` | Missing `@doc` on `generate_service/10` |
| B009-3 | INFO | `vx_abl_record.ex:54` | Missing `@doc` on `clean_xml_value/1` |
| B009-4 | INFO | `vx_abl_record.ex:63` | Missing `@doc` on `clean_xml_number_value/1` |
| B009-5 | INFO | `vx_abl_record.ex:72` | Missing `@doc` on `expand_xml_to_struct/1` |
| B009-6 | LOW | `vx_access_fob.ex:4` | Missing `@moduledoc` in `VXAccessFob` |
| B009-7 | LOW | `vx_customer.ex:1` | Missing `@moduledoc` in `VXCustomer` |
| B009-8 | INFO | `vx_customer.ex:25` | Missing `@doc` on `convert_json_to_changeset/1` |
| B009-9 | LOW | `vx_fleet.ex:1` | Missing `@moduledoc` in `VXFleet` |
| B009-10 | INFO | `vx_fleet.ex:19` | Missing `@doc` on `convert_json_to_changeset/1` |
| B009-11 | INFO | `vx_fleet.ex:27` | Missing `@doc` on `changeset/2` (no `@doc false` suppression either) |
