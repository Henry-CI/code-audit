# Pass 3: Documentation — B011
**Agent:** B011
**Files:**
- `lib/api_server/vx/vx_restriction.ex`
- `lib/api_server/vx/vx_thing.ex`
- `lib/api_server/vx/vx_thing_event.ex`
- `lib/api_server/vx/vx_thing_event_omega.ex`

**Date:** 2026-02-27

---

## lib/api_server/vx/vx_restriction.ex

### Reading Evidence

**Module:** `ApiServer.Vx.VXRestriction`

**Schema:** `aau_rest` table, primary key `aauid` (autogenerate: true)

**Fields defined via schema:** `:aaucharval` (string), `:aaucustcode` (string), `:aaufun` (string), `:aaunumval` (integer); belongs_to `:user` (`ApiServer.Vx.VXUser`, foreign key `:aauuser_id`, references `:aacid`)

**Types / constants / errors:** None defined explicitly.

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 16 |

**Documentation annotations present:**
- No `@moduledoc`
- `changeset/2` has `@doc false` (intentionally suppressed)

### Findings

#### B011-1 — Missing @moduledoc in VXRestriction
**Severity:** LOW
**File:** `lib/api_server/vx/vx_restriction.ex`, line 1

The module `ApiServer.Vx.VXRestriction` has no `@moduledoc` attribute. There is no description of the schema's purpose, the `aau_rest` table it maps to, the domain concept (user access restrictions), or the meaning of the fields (`aaufun`, `aaucustcode`, `aaucharval`, `aaunumval`).

---

## lib/api_server/vx/vx_thing.ex

### Reading Evidence

**Module:** `ApiServer.Vx.VXThing`

**Schema:** `aad_thing` table, primary key `aadid` (autogenerate: true)

**Fields defined via schema:** `:aadcustcode`, `:aaddesc`, `:aadintext`, `:aadaddr`, `:aadcustomerid`, `:aadcat`, `:aadhardwareid`, `:aadhw_type`, `:aadmake`, `:aadmodel`, `:aadserialno`, `:aadmobile`, `:aadimei`, `:aadhourmeter` through `:aadhourmeter4`, `:aadhourmeterprnt`, `:aadodometer`, `:aadhourmeteromega`, `:aadhourmeterothcan`, `:aaddateintoservice`, `:aadlastservice`, `:aadvalid`, `:aadserviceoffset`, `:aadsvchrs`, `:aadrange_lat`, `:aadrange_long`, `:aadrange_dist`, `:aadrange_unit`, `:service_calculation_input`, `:reference_1`, `:reference_2`, `:reference_3`, `:notes`, `:equipment_date_into_service`

**Associations:** `has_many :fleet_thing_joins`, `has_many :rentals`, `has_many :events`, `has_one :summary`, `has_one :info`, `has_one :customer`

**Types / constants / errors:** None defined explicitly.

**Public functions:**

| Function | Line |
|---|---|
| `convert_json_to_changeset/1` | 60 |
| `changeset/2` | 75 |

**Documentation annotations present:**
- No `@moduledoc`
- No `@doc` on `convert_json_to_changeset/1`
- No `@doc` on `changeset/2`

### Findings

#### B011-2 — Missing @moduledoc in VXThing
**Severity:** LOW
**File:** `lib/api_server/vx/vx_thing.ex`, line 5

The module `ApiServer.Vx.VXThing` has no `@moduledoc` attribute. There is no description of the schema's purpose, the `aad_thing` table it represents, the domain concept (a tracked asset / "thing"), or the meaning of the many fields (hourmeter variants, odometer, service intervals, geofencing range fields, etc.).

#### B011-3 — Missing @doc on VXThing.convert_json_to_changeset/1
**Severity:** INFO
**File:** `lib/api_server/vx/vx_thing.ex`, line 60

The public function `convert_json_to_changeset/1` has no `@doc` attribute. It converts an incoming JSON map (using string keys such as `"name"`, `"hardwareid"`, `"make"`, `"model"`, `"serialno"`, `"address"`, `"service_interval"`, `"service_offset"`, `"custcode"`, `"lastservice"`, `"current_hour_meter"`) into an Ecto changeset attribute map via `Vx.update_key_if_value/3`. The mapping from JSON key names to internal schema atoms, and the fact that missing/nil values are skipped, is not documented.

#### B011-4 — Missing @doc on VXThing.changeset/2
**Severity:** INFO
**File:** `lib/api_server/vx/vx_thing.ex`, line 75

The public function `changeset/2` has no `@doc` attribute. It accepts a `VXThing` struct and an attribute map, casts a specific subset of fields (`:aadcat`, `:aadhw_type`, `:aadhardwareid`, `:aadcustcode`, `:aaddesc`, `:aadmake`, `:aadmodel`, `:aadserialno`, `:aadaddr`, `:aadsvchrs`, `:aadserviceoffset`, `:aadlastservice`), and applies no `validate_required/2` call — which is noteworthy absence given the breadth of fields. None of this is documented.

---

## lib/api_server/vx/vx_thing_event.ex

### Reading Evidence

**Module:** `ApiServer.Vx.VXThingEvent`

**Schema:** `thingevents` table, default primary key (`:id`)

**Fields defined via schema:** `:gmtdatetime`, `:hardwareid`, `:eventtype`, `:eventcode`, `:latitude`, `:longitude`, `:driverid`, `:engineonelapsed`, `:totalengineseconds`, `:custcode`, `:hardwaretype`, `:datetimesaved`, `:dateinqueue`, `:timeoffix`, `:altitude`, `:heading`, `:speed`, `:rssi`, `:gpsfixquality`, `:odometer`, `:mifaredriverid`, `:ignition`, `:ignitionstatus`, `:calcengineseconds`, `:input1elapsed` through `:input4elapsed` and related status/totalseconds/calctotalseconds fields, `:prntelapsed`, `:prntstatus`, `:prnttotalseconds`, `:prntcalctotalseconds`, `:rhmprestartchecklist`, `:geofence`

**Associations:** `has_one :thingeventomega` (`VXThingEventOmega`, foreign_key `:id`, references `:id`); `belongs_to :thing` (`VXThing`, foreign_key `:hardwareid`, references `:aadhardwareid`, define_field: false)

**Types / constants / errors:** None defined explicitly.

**Public functions:**

| Function | Line |
|---|---|
| `map_xml/1` | 71 |
| `changeset/2` | 111 |

**Documentation annotations present:**
- No `@moduledoc`
- No `@doc` on `map_xml/1`
- `changeset/2` has `@doc false` (intentionally suppressed)

**Notes:** Lines 63–69 contain commented-out fields that were never mapped (`MotionTotalElapsed`, `containerLiftCount`, `input1Flag`, `ioFlagStatus`, `prestartChecklist`, `totalEngineHour`, `totalInput1Hour`). Lines 103–106 contain commented-out struct keys with inline explanations noting they require the thing record — these represent silent data gaps with no runtime error.

### Findings

#### B011-5 — Missing @moduledoc in VXThingEvent
**Severity:** LOW
**File:** `lib/api_server/vx/vx_thing_event.ex`, line 1

The module `ApiServer.Vx.VXThingEvent` has no `@moduledoc` attribute. There is no description of the schema's purpose, the `thingevents` table it maps to, the telemetry event domain model it represents, or the significance of the many input channel fields, the commented-out unmapped fields, or the relationship to `VXThingEventOmega`.

#### B011-6 — Missing @doc on VXThingEvent.map_xml/1
**Severity:** INFO
**File:** `lib/api_server/vx/vx_thing_event.ex`, line 71

The public function `map_xml/1` has no `@doc` attribute. Despite its name suggesting XML, it actually accepts a plain map with string keys (as produced by XML-to-map parsing) and converts it to an Ecto-compatible atom-keyed map. The function performs several `String.to_integer/1` and `String.to_float/1` conversions that will raise `ArgumentError` if source strings are missing or malformed. It also explicitly omits several fields (`driverid` as struct key, `mifaredriverid`, `calcengineseconds`, `[REDACTED-AWS-SMTP-PASSWORD]`) with inline comments explaining why — none of which is captured in documentation. The hardcoded empty strings for `[REDACTED-AWS-SMTP-PASSWORD]` and `geofence` are also undocumented.

---

## lib/api_server/vx/vx_thing_event_omega.ex

### Reading Evidence

**Module:** `ApiServer.Vx.VXThingEventOmega`

**Schema:** `thingomega` table, default primary key (`:id`)

**Fields defined via schema (68 fields):** `:accelerometerx`, `:accelerometery`, `:accelerometerz`, `:distancesincelastevent`, `:omegadriverid`, `:seatbelt`, `:seated`, `:parkbrakerequest`, `:parkbreakreleased`, `:vehicleload`, `:tilt`, `:height`, `:overload`, `:attretracted`, `:yellowled`, `:redled`, `:greenled`, `:liftenable`, `:safetyoverride`, `:doorclosed`, `:parkbrakerror`, `:batterynotcharged`, `:lowengineoil`, `:accnotcharged`, `:hydraulicfilgerblocked`, `:airfilterblocked`, `:attpressure`, `:oilcoolerfan`, `:lowerinterruption`, `:undersafetyheight`, `:joystickliftposition`, `:hydraulicoiltemperature`, `:md3temperature`, `:fuellevel`, `:md3status`, `:xa2status`, `:batteryvoltage`, `:xa2temperature`, `:boomangle`, `:boomextension`, `:lift`, `:extension`, `:totalfuelconsumption`, `:fuelrate`, `:totalfuelidle`, `:totalidlehour`, `:totalenginehour`, `:enginerpm`, `:capacity`, `:coolanttemperature`, `:oiltemperature`, `:engineerrorcode`, `:vehiclespeed`, `:gearselection`, `:transerrorcode`, `:prestartchecklist`, `:truckerrorcode`, `:mc43status`, `:mc43temperature`, `:lc5status`, `:lc5temperature`, `:truckangle`

**Associations:** `belongs_to :thingevent` (`VXThingEvent`, foreign_key `:id`, references `:id`, primary_key: true, define_field: false)

**Types / constants / errors:** None defined explicitly.

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 72 |

**Documentation annotations present:**
- No `@moduledoc`
- No `@doc` on `changeset/2` (not even `@doc false`)

### Findings

#### B011-7 — Missing @moduledoc in VXThingEventOmega
**Severity:** LOW
**File:** `lib/api_server/vx/vx_thing_event_omega.ex`, line 1

The module `ApiServer.Vx.VXThingEventOmega` has no `@moduledoc` attribute. There is no description of the schema's purpose, the `thingomega` table it maps to, what "Omega" signifies (extended telemetry data from specialised hardware such as aerial work platforms/forklifts), or the meaning of the domain-specific fields (seatbelt, tilt, height, overload, LED states, hydraulic sensors, CAN-bus data). Note also the likely typo `:hydraulicfilgerblocked` (should be `filterblocked`) and `:parkbreakreleased` (should be `brakerealeased`) — undocumented fields with misspelled names are especially high risk as they cannot be corrected without a migration.

#### B011-8 — Missing @doc on VXThingEventOmega.changeset/2
**Severity:** INFO
**File:** `lib/api_server/vx/vx_thing_event_omega.ex`, line 72

The public function `changeset/2` has no `@doc` attribute (and unlike the similar function in `VXRestriction` and `VXThingEvent`, it also lacks `@doc false`). The function casts all 63 fields listed in a dense single-line invocation and requires only `:id`. The absence of any required fields beyond `:id` and the choice of which fields to include/exclude from the cast list is entirely undocumented.

---

## Summary

| ID | Severity | File | Description |
|---|---|---|---|
| B011-1 | LOW | `vx_restriction.ex` | Missing `@moduledoc` in `ApiServer.Vx.VXRestriction` |
| B011-2 | LOW | `vx_thing.ex` | Missing `@moduledoc` in `ApiServer.Vx.VXThing` |
| B011-3 | INFO | `vx_thing.ex`, line 60 | Missing `@doc` on `VXThing.convert_json_to_changeset/1` |
| B011-4 | INFO | `vx_thing.ex`, line 75 | Missing `@doc` on `VXThing.changeset/2` |
| B011-5 | LOW | `vx_thing_event.ex` | Missing `@moduledoc` in `ApiServer.Vx.VXThingEvent` |
| B011-6 | INFO | `vx_thing_event.ex`, line 71 | Missing `@doc` on `VXThingEvent.map_xml/1` |
| B011-7 | LOW | `vx_thing_event_omega.ex` | Missing `@moduledoc` in `ApiServer.Vx.VXThingEventOmega` |
| B011-8 | INFO | `vx_thing_event_omega.ex`, line 72 | Missing `@doc` on `VXThingEventOmega.changeset/2` |
