# Pass 3: Documentation — B005
**Agent:** B005
**Files:**
- `lib/api_server/vx/device_database_lookup.ex`
- `lib/api_server/vx/email.ex`
- `lib/api_server/vx/equipment.ex`
- `lib/api_server/vx/equipment_assignment.ex`

**Date:** 2026-02-27

---

## device_database_lookup.ex

### Reading Evidence

**Module:** `ApiServer.Vx.DeviceDatabaseLookup`

**Schema:** `"DeviceDatabaseLookup"` (Ecto schema, primary key `ID`)

**Fields:**
- `:hardwareid` (string, source: `hardwareID`)
- `:customer` (string, source: `databaseName`)
- `:custcode` (string, source: `CustCode`)
- `:iccid` (string, source: `ICCID`)

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 13 |

**Types defined:** none
**Errors defined:** none
**Constants defined:** none
**`@moduledoc`:** absent
**`@doc` on `changeset/2`:** absent
**`@spec` on `changeset/2`:** absent

### Findings

#### B005-1 — Missing @moduledoc in DeviceDatabaseLookup
**Severity:** LOW
**File:** `lib/api_server/vx/device_database_lookup.ex`, line 1

The module `ApiServer.Vx.DeviceDatabaseLookup` has no `@moduledoc` attribute. There is no description of the table it maps to, the column-name divergence between Elixir field names and the underlying database column names (e.g. `:customer` sourced from `databaseName`), or the intended usage of the schema.

#### B005-2 — Missing @doc on changeset/2 in DeviceDatabaseLookup
**Severity:** INFO
**File:** `lib/api_server/vx/device_database_lookup.ex`, line 13

The public function `changeset/2` has no `@doc` attribute. There is no description of accepted attributes, validation rules applied, or expected return value.

---

## email.ex

### Reading Evidence

**Module:** `ApiServer.Email`

**Public functions:**

| Function | Line |
|---|---|
| `send_notification_email/3` | 4 |
| `send_test_email/3` | 14 |
| `send_enter_email/4` | 103 |
| `send_missing_serial_email/4` | 167 |
| `send_digital_matter_email/4` | 215 |
| `send_slow_email/4` | 262 |
| `send_exit_email/4` | 303 |

**Types defined:** none
**Errors defined:** none
**Constants defined:** none
**`@moduledoc`:** absent
**`@doc` on any function:** absent
**`@spec` on any function:** absent

### Findings

#### B005-3 — Missing @moduledoc in ApiServer.Email
**Severity:** LOW
**File:** `lib/api_server/vx/email.ex`, line 1

The module `ApiServer.Email` has no `@moduledoc` attribute. There is no description of the module's purpose (composing and sending geofence alert and operational notification emails via Bamboo), the email delivery mechanism, or the fixed recipient hardcoded into several functions.

#### B005-4 — Missing @doc on send_notification_email/3
**Severity:** INFO
**File:** `lib/api_server/vx/email.ex`, line 4

The public function `send_notification_email/3` has no `@doc`. There is no description of its parameters (`to`, `subject`, `message`), the fact that the `to` parameter is ignored and the message is always sent to a hardcoded recipient address (`graham.oconnell@trackingsolutions.com.au`), or the return value.

#### B005-5 — Missing @doc on send_test_email/3
**Severity:** INFO
**File:** `lib/api_server/vx/email.ex`, line 14

The public function `send_test_email/3` has no `@doc`. There is no description of its parameters (`from_email_address`, `subject`, `message`), the fact that the `message` parameter is ignored entirely (the HTML body is a hardcoded template containing both a geofence-exit and geofence-enter example side by side), or the return value.

#### B005-6 — Missing @doc on send_enter_email/4
**Severity:** INFO
**File:** `lib/api_server/vx/email.ex`, line 103

The public function `send_enter_email/4` has no `@doc`. The inline comment block (lines 104–114) describes the expected shape of the `data` map but is not a proper `@doc` and is not surfaced in ExDoc or IEx help. There is no description of required map keys, the return value, or potential runtime errors if required keys are absent.

#### B005-7 — Missing @doc on send_missing_serial_email/4
**Severity:** INFO
**File:** `lib/api_server/vx/email.ex`, line 167

The public function `send_missing_serial_email/4` has no `@doc`. There is no description of its parameters, the required keys on the `data` map (`:customer`, `:vehicle_name`, `:hardware_id`), or the return value.

#### B005-8 — Missing @doc on send_digital_matter_email/4
**Severity:** INFO
**File:** `lib/api_server/vx/email.ex`, line 215

The public function `send_digital_matter_email/4` has no `@doc`. There is no description of its parameters, the expected structure of `data` (which is inspected raw via `Kernel.inspect/2` into the HTML body), or the return value.

#### B005-9 — Missing @doc on send_slow_email/4
**Severity:** INFO
**File:** `lib/api_server/vx/email.ex`, line 262

The public function `send_slow_email/4` has no `@doc`. There is no description of its parameters, the required keys on the `data` map (`:customer`, `:diff`), or the return value.

#### B005-10 — Missing @doc on send_exit_email/4
**Severity:** INFO
**File:** `lib/api_server/vx/email.ex`, line 303

The public function `send_exit_email/4` has no `@doc`. There is no description of its parameters, the required keys on the `data` map (`:person_name`, `:geofence_name`, `:vehicle_name`, `:vehicle_serial`, `:time_left`, `:event_reference`), or the return value.

#### B005-11 — Inaccurate implicit contract: send_notification_email/3 ignores the `to` parameter
**Severity:** MEDIUM
**File:** `lib/api_server/vx/email.ex`, line 4

The function signature `send_notification_email(to, subject, message)` implies the `to` parameter controls the recipient. However, the implementation ignores `to` entirely and hardcodes the recipient as `"graham.oconnell@trackingsolutions.com.au"` (line 7). Any caller relying on the parameter name to understand behaviour will be misled. The absence of `@doc` means there is no warning about this discrepancy.

#### B005-12 — Inaccurate implicit contract: send_test_email/3 ignores the `message` parameter
**Severity:** MEDIUM
**File:** `lib/api_server/vx/email.ex`, line 14

The function signature `send_test_email(from_email_address, subject, message)` implies the `message` parameter supplies the email body. However, the implementation ignores `message` entirely and renders a hardcoded HTML body (lines 20–99). The absence of `@doc` means there is no warning about this discrepancy.

---

## equipment.ex

### Reading Evidence

**Module:** `ApiServer.Vx.Equipment`

**Schema:** `"equipment"` (Ecto schema, primary key `ID`)

**Fields:**
- `:id` (integer, source: `id`)
- `:name` (string, source: `name`)
- `:make` (string, source: `make`)
- `:model` (string, source: `model`)
- `:serial_number` (string, source: `serial_number`)
- `:class` (string, source: `class`)
- `:type` (string, source: `type`)
- `:created` (utc_datetime, source: `created`)

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 20 |

**Types defined:** none
**Errors defined:** none
**Constants defined:** none
**`@moduledoc`:** absent
**`@doc` on `changeset/2`:** absent
**`@spec` on `changeset/2`:** absent

### Findings

#### B005-13 — Missing @moduledoc in ApiServer.Vx.Equipment
**Severity:** LOW
**File:** `lib/api_server/vx/equipment.ex`, line 1

The module `ApiServer.Vx.Equipment` has no `@moduledoc` attribute. There is no description of the database table it maps to, the domain concept it represents, or the relationship to `ApiServer.Vx.EquipmentAssignment` (the `alias ApiServer.Vx` is present but unused, suggesting planned associations that were never documented).

#### B005-14 — Missing @doc on changeset/2 in ApiServer.Vx.Equipment
**Severity:** INFO
**File:** `lib/api_server/vx/equipment.ex`, line 20

The public function `changeset/2` has no `@doc` attribute. There is no description of the permitted attributes cast, the validation rules applied (`:serial_number` required, unique constraint on `:serial_number` via index name `:serial_number`), or the return value.

---

## equipment_assignment.ex

### Reading Evidence

**Module:** `ApiServer.Vx.EquipmentAssignment`

**Schema:** `"equipment_assignment"` (Ecto schema, primary key `ID`)

**Fields:**
- `:id` (integer, source: `id`)
- `:equipment_id` (integer, source: `equipment_id`)
- `:device_group` (string, source: `device_group`)
- `:device_group_timezone` (string, source: `device_group_timezone`)
- `:assignment_start` (utc_datetime, source: `assignment_start`)
- `:assignment_end` (utc_datetime, source: `assignment_end`)
- `:created` (utc_datetime, source: `created`)

**Commented-out code:** a `belongs_to` association to `ApiServer.Vx.Equipment` (line 17).

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 20 |

**Types defined:** none
**Errors defined:** none
**Constants defined:** none
**`@moduledoc`:** absent
**`@doc` on `changeset/2`:** absent
**`@spec` on `changeset/2`:** absent

### Findings

#### B005-15 — Missing @moduledoc in ApiServer.Vx.EquipmentAssignment
**Severity:** LOW
**File:** `lib/api_server/vx/equipment_assignment.ex`, line 1

The module `ApiServer.Vx.EquipmentAssignment` has no `@moduledoc` attribute. There is no description of the table's purpose (recording which device group an equipment item is assigned to over a time range), the fields, the relationship to `ApiServer.Vx.Equipment`, or the significance of the commented-out `belongs_to` association.

#### B005-16 — Missing @doc on changeset/2 in ApiServer.Vx.EquipmentAssignment
**Severity:** INFO
**File:** `lib/api_server/vx/equipment_assignment.ex`, line 20

The public function `changeset/2` has no `@doc` attribute. There is no description of the permitted attributes cast, the validation rules applied (`:equipment_id` and `:device_group` required, unique constraint on `:equipment_id`), or the return value.

---

## Summary

| ID | Severity | File | Description |
|---|---|---|---|
| B005-1 | LOW | `device_database_lookup.ex` | Missing `@moduledoc` in `ApiServer.Vx.DeviceDatabaseLookup` |
| B005-2 | INFO | `device_database_lookup.ex` | Missing `@doc` on `changeset/2` |
| B005-3 | LOW | `email.ex` | Missing `@moduledoc` in `ApiServer.Email` |
| B005-4 | INFO | `email.ex` | Missing `@doc` on `send_notification_email/3` |
| B005-5 | INFO | `email.ex` | Missing `@doc` on `send_test_email/3` |
| B005-6 | INFO | `email.ex` | Missing `@doc` on `send_enter_email/4` |
| B005-7 | INFO | `email.ex` | Missing `@doc` on `send_missing_serial_email/4` |
| B005-8 | INFO | `email.ex` | Missing `@doc` on `send_digital_matter_email/4` |
| B005-9 | INFO | `email.ex` | Missing `@doc` on `send_slow_email/4` |
| B005-10 | INFO | `email.ex` | Missing `@doc` on `send_exit_email/4` |
| B005-11 | MEDIUM | `email.ex` | `send_notification_email/3`: `to` parameter is silently ignored; recipient is hardcoded |
| B005-12 | MEDIUM | `email.ex` | `send_test_email/3`: `message` parameter is silently ignored; body is hardcoded |
| B005-13 | LOW | `equipment.ex` | Missing `@moduledoc` in `ApiServer.Vx.Equipment` |
| B005-14 | INFO | `equipment.ex` | Missing `@doc` on `changeset/2` |
| B005-15 | LOW | `equipment_assignment.ex` | Missing `@moduledoc` in `ApiServer.Vx.EquipmentAssignment` |
| B005-16 | INFO | `equipment_assignment.ex` | Missing `@doc` on `changeset/2` |
