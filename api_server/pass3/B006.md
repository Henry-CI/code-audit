# Pass 3: Documentation — B006
**Agent:** B006
**Files:**
- `lib/api_server/vx/erp_import.ex`
- `lib/api_server/vx/geofence.ex`
- `lib/api_server/vx/mailer.ex`
- `lib/api_server/vx/rental_contracts.ex`

**Date:** 2026-02-27

---

## lib/api_server/vx/erp_import.ex

### Reading Evidence

**Module:** `ApiServer.Vx.ERPImport`

**Behaviours / macros used:**
- `use Ecto.Schema`
- `import Ecto.Changeset`

**Schema fields:** `id`, `raw_record`, `serialno`, `name`, `matched`, `type`

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 15 |

**Types / errors / constants defined:** none

**Documentation present:**
- `@moduledoc`: absent
- `@doc` on `changeset/2`: absent
- `@spec` on `changeset/2`: absent

### Findings

#### B006-1 — Missing @moduledoc in ApiServer.Vx.ERPImport
**Severity:** LOW
**File:** `lib/api_server/vx/erp_import.ex`, line 1

The module `ApiServer.Vx.ERPImport` has no `@moduledoc` attribute. There is no description of the purpose of the schema (ERP import staging records), the table it maps to (`erp_imports`), or the fields it exposes.

#### B006-2 — Missing @doc on ERPImport.changeset/2
**Severity:** INFO
**File:** `lib/api_server/vx/erp_import.ex`, line 15

The public function `changeset/2` has no `@doc` attribute. The function casts `:raw_record`, `:serialno`, `:name`, `:matched`, and `:type`, and validates that `:raw_record` is required. None of this is documented.

---

## lib/api_server/vx/geofence.ex

### Reading Evidence

**Module:** `ApiServer.Vx.Geofence`

**Behaviours / macros used:**
- `use Ecto.Schema`
- `import Ecto.Changeset`
- `import Ecto.Query, warn: false`

**Aliases:** `ApiServer.Repo`, `ApiServer.Vx`, `ApiServer.Vx.VXThingEvent`

**Schema fields:** `id`, `name`, `geojson`

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 17 |
| `geojson_map_to_string/1` | 24 |
| `geojson_db_string_to_map/1` | 38 |

**Private functions (not subject to @doc requirement):**

| Function | Line |
|---|---|
| `does_event_cause_geofence_events_no_thing/5` | 52 |
| `check_event_for_left_events_no_thing/5` (two clauses) | 69, 70 |
| `check_event_for_entered_events_no_thing/6` | 86 |
| `make_geofence_event_no_thing/5` | 103 |
| `engine_hours_at_event_no_thing/2` | 119 |

**Types / errors / constants defined:** none

**Documentation present:**
- `@moduledoc`: absent
- `@doc` on all three public functions: absent
- `@spec` on all public functions: absent

### Findings

#### B006-3 — Missing @moduledoc in ApiServer.Vx.Geofence
**Severity:** LOW
**File:** `lib/api_server/vx/geofence.ex`, line 1

The module `ApiServer.Vx.Geofence` has no `@moduledoc`. There is no description of the geofence concept, the underlying `geofences` table, the GeoJSON format used for the `geojson` field, or the relationship between this schema and the geofence-event detection logic contained in the private functions.

#### B006-4 — Missing @doc on Geofence.changeset/2
**Severity:** INFO
**File:** `lib/api_server/vx/geofence.ex`, line 17

The public function `changeset/2` has no `@doc` attribute. The function casts `:name` and `:geojson` and validates that `:name` is required. The absence of documentation leaves callers uninformed about which fields are accepted and which are mandatory.

#### B006-5 — Missing @doc on Geofence.geojson_map_to_string/1
**Severity:** INFO
**File:** `lib/api_server/vx/geofence.ex`, line 24

The public function `geojson_map_to_string/1` has no `@doc` attribute. The function converts a GeoJSON map (or `nil`) into a JSON-encoded string, returning an empty string `""` on both `nil` input and encoding failure. The silent fallback to `""` on error is a non-obvious behaviour that warrants explicit documentation.

#### B006-6 — Missing @doc on Geofence.geojson_db_string_to_map/1
**Severity:** INFO
**File:** `lib/api_server/vx/geofence.ex`, line 38

The public function `geojson_db_string_to_map/1` has no `@doc` attribute. The function decodes a JSON string from the database back into a map, returning `""` on both `nil` input and decode failure. As with `geojson_map_to_string/1`, the silent error path is non-obvious and undocumented.

---

## lib/api_server/vx/mailer.ex

### Reading Evidence

**Module:** `ApiServer.Mailer`

**Behaviours / macros used:**
- `use Bamboo.Mailer, otp_app: :api_server`

**Public functions:** none explicitly defined; all public API is injected by `Bamboo.Mailer` at compile time (e.g., `deliver_now/1`, `deliver_later/1`).

**Types / errors / constants defined:** none

**Documentation present:**
- `@moduledoc`: absent

### Findings

#### B006-7 — Missing @moduledoc in ApiServer.Mailer
**Severity:** LOW
**File:** `lib/api_server/vx/mailer.ex`, line 1

The module `ApiServer.Mailer` has no `@moduledoc`. There is no description of the mailer's purpose, the OTP application it is bound to (`:api_server`), or the Bamboo adapter that is expected to be configured in the application environment. A brief module doc would help developers locate configuration details and understand how the mailer is used throughout the application.

---

## lib/api_server/vx/rental_contracts.ex

### Reading Evidence

**Module:** `ApiServer.Vx.RentalContract`

**Behaviours / macros used:**
- `use Ecto.Schema`
- `import Ecto.Changeset`

**Primary key:** `{:ID, :id, autogenerate: true}` (note: non-standard uppercase atom `:ID`)

**Schema fields:** `id`, `equipment_id`, `customer_id`, `contract_reference`, `contract_start`, `contract_end`, `billing_frequency`, `hours_per_billing_period`, `cost_units`, `cost_per_unit`, `reporting_frequency`, `created`, `sent_to_rayven`

**Public functions:**

| Function | Line |
|---|---|
| `changeset/2` | 22 |

**Types / errors / constants defined:** none

**Documentation present:**
- `@moduledoc`: absent
- `@doc` on `changeset/2`: absent
- `@spec` on `changeset/2`: absent

### Findings

#### B006-8 — Missing @moduledoc in ApiServer.Vx.RentalContract
**Severity:** LOW
**File:** `lib/api_server/vx/rental_contracts.ex`, line 1

The module `ApiServer.Vx.RentalContract` has no `@moduledoc`. There is no description of what a rental contract represents in the domain, which database table it maps to (`rental_contracts`), or any explanation of the non-standard primary key declaration (`:ID` uppercase atom vs. the conventional `:id`).

#### B006-9 — Missing @doc on RentalContract.changeset/2
**Severity:** INFO
**File:** `lib/api_server/vx/rental_contracts.ex`, line 22

The public function `changeset/2` has no `@doc` attribute. The function casts all thirteen schema fields but applies no `validate_required/2` constraints. The absence of any required-field validation is a notable design decision that should be documented to make it clear this is intentional rather than an oversight.

---

## Summary

| ID | Severity | File | Description |
|---|---|---|---|
| B006-1 | LOW | `erp_import.ex` | Missing `@moduledoc` in `ApiServer.Vx.ERPImport` |
| B006-2 | INFO | `erp_import.ex:15` | Missing `@doc` on `ERPImport.changeset/2` |
| B006-3 | LOW | `geofence.ex` | Missing `@moduledoc` in `ApiServer.Vx.Geofence` |
| B006-4 | INFO | `geofence.ex:17` | Missing `@doc` on `Geofence.changeset/2` |
| B006-5 | INFO | `geofence.ex:24` | Missing `@doc` on `Geofence.geojson_map_to_string/1` |
| B006-6 | INFO | `geofence.ex:38` | Missing `@doc` on `Geofence.geojson_db_string_to_map/1` |
| B006-7 | LOW | `mailer.ex` | Missing `@moduledoc` in `ApiServer.Mailer` |
| B006-8 | LOW | `rental_contracts.ex` | Missing `@moduledoc` in `ApiServer.Vx.RentalContract` |
| B006-9 | INFO | `rental_contracts.ex:22` | Missing `@doc` on `RentalContract.changeset/2` |
