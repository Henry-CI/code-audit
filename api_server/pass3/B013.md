# Pass 3: Documentation — B013
**Agent:** B013
**Files:**
- `lib/api_server_web.ex`
- `lib/api_server_web/auth_error_handler.ex`
- `lib/api_server_web/auth_pipeline.ex`

**Date:** 2026-02-27

---

## lib/api_server_web.ex

### Reading Evidence

**Module:** `ApiServerWeb`

**Public functions:**

| Function | Line |
|---|---|
| `controller/0` | 20 |
| `view/0` | 29 |
| `router/0` | 46 |
| `channel/0` | 54 |
| `__using__/1` (defmacro) | 64 |

**Types / errors / constants defined:** None.

**@moduledoc:** Present (lines 2–18). Describes the module's purpose as the entrypoint for defining web interface components and explains the `use ApiServerWeb, :controller` / `:view` pattern.

**@doc coverage:**
- `controller/0` — no `@doc`
- `view/0` — no `@doc`
- `router/0` — no `@doc`
- `channel/0` — no `@doc`
- `__using__/1` — `@doc` present (lines 61–63): "When used, dispatch to the appropriate controller/view/etc."

---

### Findings

#### B013-1 — Missing @doc on `controller/0`
**Severity:** INFO
**File:** `lib/api_server_web.ex`, line 20

The public function `controller/0` has no `@doc` attribute. It injects `Phoenix.Controller`, `Plug.Conn`, `ApiServerWeb.Router.Helpers`, and `ApiServerWeb.Gettext` into the calling module via a `quote` block. A doc string explaining what is imported would aid developers using `use ApiServerWeb, :controller`.

---

#### B013-2 — Missing @doc on `view/0`
**Severity:** INFO
**File:** `lib/api_server_web.ex`, line 29

The public function `view/0` has no `@doc` attribute. It configures `Phoenix.View` with a template root, imports flash/view helpers, enables `Phoenix.HTML`, and imports router helpers, error helpers, and Gettext. A doc string should describe these injected dependencies.

---

#### B013-3 — Missing @doc on `router/0`
**Severity:** INFO
**File:** `lib/api_server_web.ex`, line 46

The public function `router/0` has no `@doc` attribute. It injects `Phoenix.Router`, `Plug.Conn`, and `Phoenix.Controller`. A brief doc string would clarify what is available in a module that does `use ApiServerWeb, :router`.

---

#### B013-4 — Missing @doc on `channel/0`
**Severity:** INFO
**File:** `lib/api_server_web.ex`, line 54

The public function `channel/0` has no `@doc` attribute. It injects `Phoenix.Channel` and `ApiServerWeb.Gettext`. A doc string noting these injected modules would be consistent with the pattern established for `__using__/1`.

---

## lib/api_server_web/auth_error_handler.ex

### Reading Evidence

**Module:** `ApiServerWeb.AuthErrorHandler`

**Public functions:**

| Function | Line |
|---|---|
| `auth_error/3` | 4 |

**Types / errors / constants defined:** None.

**@moduledoc:** Absent.

**@doc coverage:**
- `auth_error/3` — no `@doc`

---

### Findings

#### B013-5 — Missing @moduledoc on `ApiServerWeb.AuthErrorHandler`
**Severity:** LOW
**File:** `lib/api_server_web/auth_error_handler.ex`, line 1

The module `ApiServerWeb.AuthErrorHandler` has no `@moduledoc` attribute. The module implements the Guardian error handler behaviour, responding with an HTTP 401 and a JSON body containing the error type on authentication failure. A module-level doc should describe this contract and the expected caller (Guardian pipeline configuration).

---

#### B013-6 — Missing @doc on `auth_error/3`
**Severity:** INFO
**File:** `lib/api_server_web/auth_error_handler.ex`, line 4

The public function `auth_error/3` has no `@doc` attribute. It encodes a JSON error body using `Poison.encode!/1` and sends a 401 response via `Plug.Conn.send_resp/3`. The Guardian `error_handler` behaviour requires this callback signature `(conn, {type, reason}, opts)`. A doc string should describe the callback contract, the response format (`{"error": "<type>"}` as JSON), and note that `reason` is intentionally discarded.

---

## lib/api_server_web/auth_pipeline.ex

### Reading Evidence

**Module:** `ApiServer.Guardian.AuthPipeline`

**Public functions:** None. The module is a Guardian plug pipeline defined entirely via `use Guardian.Plug.Pipeline` and `plug` macro calls. No explicit function definitions are present.

**Plugs declared:**

| Plug | Line | Notes |
|---|---|---|
| `Guardian.Plug.VerifyHeader` | 6 | `realm: "Bearer"` — verifies JWT in `Authorization: Bearer <token>` header |
| `Guardian.Plug.EnsureAuthenticated` | 7 | Commented out — authentication enforcement is disabled |
| `Guardian.Plug.LoadResource` | 8 | Loads the resource identified by the token claims |

**Types / errors / constants defined:** None.

**@moduledoc:** Absent.

**@doc coverage:** N/A (no public functions defined).

---

### Findings

#### B013-7 — Missing @moduledoc on `ApiServer.Guardian.AuthPipeline`
**Severity:** LOW
**File:** `lib/api_server_web/auth_pipeline.ex`, line 1

The module `ApiServer.Guardian.AuthPipeline` has no `@moduledoc` attribute. A module doc should describe the pipeline's purpose, the OTP app it is registered under (`:MyApi`), the Guardian module it delegates to (`ApiServer.Guardian`), the error handler in use (`ApiServerWeb.AuthErrorHandler`), and — critically — should document the fact that `Guardian.Plug.EnsureAuthenticated` is currently commented out (line 7), meaning authenticated routes relying solely on this pipeline do NOT enforce authentication. The absence of any documentation makes this security-relevant omission invisible to reviewers.

---

## Summary

| ID | Severity | File | Description |
|---|---|---|---|
| B013-1 | INFO | `lib/api_server_web.ex`:20 | Missing `@doc` on `controller/0` |
| B013-2 | INFO | `lib/api_server_web.ex`:29 | Missing `@doc` on `view/0` |
| B013-3 | INFO | `lib/api_server_web.ex`:46 | Missing `@doc` on `router/0` |
| B013-4 | INFO | `lib/api_server_web.ex`:54 | Missing `@doc` on `channel/0` |
| B013-5 | LOW | `lib/api_server_web/auth_error_handler.ex`:1 | Missing `@moduledoc` on `ApiServerWeb.AuthErrorHandler` |
| B013-6 | INFO | `lib/api_server_web/auth_error_handler.ex`:4 | Missing `@doc` on `auth_error/3` |
| B013-7 | LOW | `lib/api_server_web/auth_pipeline.ex`:1 | Missing `@moduledoc` on `ApiServer.Guardian.AuthPipeline`; no documentation of the commented-out `EnsureAuthenticated` plug |
