# Pass 3: Documentation — B017
**Agent:** B017
**Files:**
- `lib/api_server_web/controllers/vx_abl_record_controller.ex`
- `lib/api_server_web/controllers/vx_access_fob_controller.ex`
- `lib/api_server_web/controllers/vx_customer_controller.ex`

**Date:** 2026-02-27

---

## vx_abl_record_controller.ex

### Reading Evidence

**Module:** `ApiServerWeb.VXAblRecordController`

**Public functions:**

| Function | Line |
|---|---|
| `create/2` | 9 |
| `show/2` | 18 |
| `update/2` | 23 |
| `delete/2` | 31 |
| `rhm_service_records/2` | 38 |
| `generate_service_record/3` | 66 |

**Types/errors/constants defined:** None.

**Attributes present:** None (`@moduledoc`, `@doc`, `@spec` are all absent throughout the file).

### Findings

#### B017-1 — Missing @moduledoc in VXAblRecordController
**Severity:** LOW
**File:** `lib/api_server_web/controllers/vx_abl_record_controller.ex`, line 1

The module `ApiServerWeb.VXAblRecordController` has no `@moduledoc` attribute. There is no description of the controller's purpose, the resource it manages (VX ABL audit/log records), or any notes about authentication requirements or route context.

#### B017-2 — Missing @doc on create/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_abl_record_controller.ex`, line 9

The public function `create/2` has no `@doc`. Its purpose (creating a VX ABL record), expected parameters (`vx_abl_record` map), response (201 Created with location header and rendered record), and fallback behaviour are undocumented.

#### B017-3 — Missing @doc on show/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_abl_record_controller.ex`, line 18

The public function `show/2` has no `@doc`. Its purpose (fetching a single VX ABL record by ID), the bang function used (`get_vx_abl_record!`), and error propagation via `action_fallback` are undocumented.

#### B017-4 — Missing @doc on update/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_abl_record_controller.ex`, line 23

The public function `update/2` has no `@doc`. Its purpose (updating a VX ABL record), expected parameters (`id` and `vx_abl_record` map), and the two-step fetch-then-update pattern are undocumented.

#### B017-5 — Missing @doc on delete/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_abl_record_controller.ex`, line 31

The public function `delete/2` has no `@doc`. Its purpose (deleting a VX ABL record), the 204 No Content response, and fallback behaviour are undocumented.

#### B017-6 — Missing @doc on rhm_service_records/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_abl_record_controller.ex`, line 38

The public function `rhm_service_records/2` has no `@doc`. This function has non-trivial logic that warrants documentation: it reads the authenticated customer from JWT claims, optionally filters by `fleet_id`, applies an optional date range filter (with ±1-day boundary shifts via Timex), expands XML to structs, and renders a `services.json` view. The optional query parameters `fleet_id`, `from`, and `to` are completely undocumented.

#### B017-7 — Missing @doc on generate_service_record/3
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_abl_record_controller.ex`, line 66

The public function `generate_service_record/3` has no `@doc`. This is a non-action helper (three-arity, not a standard Phoenix action) with significant business logic: it reads JWT claims for customer and user, resolves user timezone, calculates hour-meter values, computes usage since last service, constructs an XML ABL record, and persists it. The fact that it is public but not a route action, the meaning of each argument (`conn`, `thing`, `new_service_date`), and its return value (`:ok` or `:error` atom from `Vx.create_abl_record/2`) are entirely undocumented.

---

## vx_access_fob_controller.ex

### Reading Evidence

**Module:** `ApiServerWeb.VXAccessFobController`

**Public functions:**

| Function | Line |
|---|---|
| `index/2` | 9 |
| `show/2` | 14 |
| `delete/2` | 19 |

**Types/errors/constants defined:** None.

**Attributes present:** None (`@moduledoc`, `@doc`, `@spec` are all absent throughout the file).

### Findings

#### B017-8 — Missing @moduledoc in VXAccessFobController
**Severity:** LOW
**File:** `lib/api_server_web/controllers/vx_access_fob_controller.ex`, line 1

The module `ApiServerWeb.VXAccessFobController` has no `@moduledoc`. There is no description of what an access fob resource is, what routes this controller handles, or any authentication/authorisation context.

#### B017-9 — Missing @doc on index/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_access_fob_controller.ex`, line 9

The public function `index/2` has no `@doc`. Its purpose (listing all VX access fobs via `Vx.list_vxaccessfobs/0`) and the absence of any customer-scoping or pagination are undocumented.

#### B017-10 — Missing @doc on show/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_access_fob_controller.ex`, line 14

The public function `show/2` has no `@doc`. Its purpose (fetching a single access fob by ID), the bang function used, and fallback error handling are undocumented.

#### B017-11 — Missing @doc on delete/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_access_fob_controller.ex`, line 19

The public function `delete/2` has no `@doc`. Its purpose (deleting an access fob), the 204 No Content response, and fallback behaviour are undocumented.

---

## vx_customer_controller.ex

### Reading Evidence

**Module:** `ApiServerWeb.VXCustomerController`

**Public functions:**

| Function | Line |
|---|---|
| `index/2` | 9 |
| `create/2` | 16 |
| `show/2` | 32 |
| `update/2` | 39 |
| `delete/2` | 51 |

**Types/errors/constants defined:** None.

**Attributes present:** None (`@moduledoc`, `@doc`, `@spec` are all absent throughout the file).

### Findings

#### B017-12 — Missing @moduledoc in VXCustomerController
**Severity:** LOW
**File:** `lib/api_server_web/controllers/vx_customer_controller.ex`, line 1

The module `ApiServerWeb.VXCustomerController` has no `@moduledoc`. There is no description of the resource managed, the multi-tenant customer-scoping pattern used throughout the controller, or any authentication requirements.

#### B017-13 — Missing @doc on index/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_customer_controller.ex`, line 9

The public function `index/2` has no `@doc`. Its purpose (listing customers scoped to the authenticated tenant), the JWT claim extraction for `customer`, and the rendered view are undocumented.

#### B017-14 — Missing @doc on create/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_customer_controller.ex`, line 16

The public function `create/2` has no `@doc`. Its purpose (creating a new VX customer scoped to the authenticated tenant), the use of `VXCustomer.convert_json_to_changeset/1`, the 201 Created response path, and the inline error handling path (which bypasses `action_fallback` and returns a raw JSON 500 response) are undocumented.

#### B017-15 — Missing @doc on show/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_customer_controller.ex`, line 32

The public function `show/2` has no `@doc`. Its purpose (fetching a single customer by ID scoped to the authenticated tenant) and tenant-isolation enforcement are undocumented.

#### B017-16 — Missing @doc on update/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_customer_controller.ex`, line 39

The public function `update/2` has no `@doc`. Its purpose (updating a customer), the non-standard parameter pattern (ID is taken from inside the `vx_customer_params` map rather than as a top-level path parameter), and the post-update re-fetch pattern are undocumented.

#### B017-17 — Missing @doc on delete/2
**Severity:** INFO
**File:** `lib/api_server_web/controllers/vx_customer_controller.ex`, line 51

The public function `delete/2` has no `@doc`. Its purpose (deleting a customer scoped to the authenticated tenant) and the non-standard 200 OK response with an empty JSON body `{}` (rather than 204 No Content used in the other controllers) are undocumented.

---

## Summary

| ID | Severity | File | Description |
|---|---|---|---|
| B017-1 | LOW | vx_abl_record_controller.ex, line 1 | Missing @moduledoc in VXAblRecordController |
| B017-2 | INFO | vx_abl_record_controller.ex, line 9 | Missing @doc on create/2 |
| B017-3 | INFO | vx_abl_record_controller.ex, line 18 | Missing @doc on show/2 |
| B017-4 | INFO | vx_abl_record_controller.ex, line 23 | Missing @doc on update/2 |
| B017-5 | INFO | vx_abl_record_controller.ex, line 31 | Missing @doc on delete/2 |
| B017-6 | INFO | vx_abl_record_controller.ex, line 38 | Missing @doc on rhm_service_records/2 |
| B017-7 | INFO | vx_abl_record_controller.ex, line 66 | Missing @doc on generate_service_record/3 |
| B017-8 | LOW | vx_access_fob_controller.ex, line 1 | Missing @moduledoc in VXAccessFobController |
| B017-9 | INFO | vx_access_fob_controller.ex, line 9 | Missing @doc on index/2 |
| B017-10 | INFO | vx_access_fob_controller.ex, line 14 | Missing @doc on show/2 |
| B017-11 | INFO | vx_access_fob_controller.ex, line 19 | Missing @doc on delete/2 |
| B017-12 | LOW | vx_customer_controller.ex, line 1 | Missing @moduledoc in VXCustomerController |
| B017-13 | INFO | vx_customer_controller.ex, line 9 | Missing @doc on index/2 |
| B017-14 | INFO | vx_customer_controller.ex, line 16 | Missing @doc on create/2 |
| B017-15 | INFO | vx_customer_controller.ex, line 32 | Missing @doc on show/2 |
| B017-16 | INFO | vx_customer_controller.ex, line 39 | Missing @doc on update/2 |
| B017-17 | INFO | vx_customer_controller.ex, line 51 | Missing @doc on delete/2 |
