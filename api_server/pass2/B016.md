# Audit Report B016
**Audit run:** 2026-02-27-01
**Agent:** B016
**Date:** 2026-02-27

---

## Assigned Source Files

1. `lib/api_server_web/controllers/geofence_controller.ex`
2. `lib/api_server_web/controllers/page_controller.ex`
3. `lib/api_server_web/controllers/pivotel_controller.ex`
4. `lib/api_server_web/controllers/utility_controller.ex`

---

## Test Coverage Search Results

A grep for all four module names (`GeofenceController`, `PageController`, `PivotelController`, `UtilityController`) across the entire `test/` directory returned **no matches**. A second sweep covering all public function names from these modules also returned **no matches**. The known test files (`calamp_controller_test.exs`, `vx_restriction_controller_test.exs`, `layout_view_test.exs`, `page_view_test.exs`) contain no references to any of these controllers.

**Conclusion: zero test coverage exists — direct or indirect — for any of the four assigned source files.**

---

## READING EVIDENCE

### 1. `ApiServerWeb.GeofenceController`

**Module:** `ApiServerWeb.GeofenceController`
**Aliases/imports:** `ApiServer.Vx`, `ApiServer.Vx.Geofence`, `Ecto.Query`, `ApiServer.Repo`

| Line | Name | Visibility | Type |
|------|------|-----------|------|
| 11 | `list_all_geofences/2` | public | action (`conn`, `_params`) |
| 18 | `create_geofence/2` | public | action (`conn`, `%{"geofence" => …}`) |
| 35 | `update_geofence/2` | public | action (`conn`, `%{"geofence" => …}`) |
| 57 | `delete_geofence/2` | public | action (`conn`, `%{"id" => id}`) |
| 73 | `process_things_geofences/2` | public | action (`conn`, `%{"hardwareid" => …, "from" => …, "to" => …}`) |
| 96 | `check_geofences_for_unit/6` | private | helper |
| 115 | `does_event_cause_geofence_events/6` | private | helper |
| 132 | `check_event_for_left_events/6` (nil clause) | private | helper |
| 133 | `check_event_for_left_events/6` (list clause) | private | helper |
| 149 | `check_event_for_entered_events/7` | private | helper |
| 168 | `make_geofence_event/6` | private | helper |
| 184 | `engine_hours_at_event/3` | private | helper — nine `aadcat` branches (2–9) |

**Constants/structs defined:** none directly; relies on `%Geofence{}` struct from alias.

---

### 2. `ApiServerWeb.PageController`

**Module:** `ApiServerWeb.PageController`

| Line | Name | Visibility | Type |
|------|------|-----------|------|
| 4 | `index/2` | public | action (`conn`, `_params`) |

**Constants/structs defined:** none.

---

### 3. `ApiServerWeb.PivotelController`

**Module:** `ApiServerWeb.PivotelController`

| Line | Name | Visibility | Type |
|------|------|-----------|------|
| 4 | `get_pivotel_data/2` (PSG_MOmsg_send clause) | public | action — matched pattern `%{xml: %{"PSG_MOmsg_send" => …}}` |
| 15 | `get_pivotel_data/2` (fallback clause) | public | action — `%{}` catch-all → 500 |
| 20 | `create_update_object/1` (LOCATION cause clause) | public | parser |
| 63 | `create_update_object/1` (ACCUM cause clause) | public | parser |
| 103 | `create_update_object/1` (fallback clause) | public | parser → returns `%{}` |
| 109 | `convert_timestamp/1` | private | timestamp converter |

**Constants/structs defined:** none.

---

### 4. `ApiServerWeb.UtilityController`

**Module:** `ApiServerWeb.UtilityController`
**Behaviour/use:** `Bamboo.Phoenix` (view: `ApiServer.EmailView`)
**Key aliases:** `ApiServer.Vx`, `VXCustomer`, `ERPImport`, `VXThingInfo`, `Repo`, `VXThingEvent`, `VXThingEventOmega`, `[REDACTED-AWS-SMTP-PASSWORD]`, `VXRayvenMessageLog`, `[REDACTED-AWS-SMTP-PASSWORD]`, `[REDACTED-AWS-SMTP-PASSWORD]`, `VXThingSummary`, `Equipment`, `EquipmentAssignment`, `VXRental`, `RentalPeriod`, `RentalContract`

**Module-level constant:**

| Lines | Name | Type |
|-------|------|------|
| 25–126 | `@lookup_olson` | module attribute — list of `{windows_tz, olson_tz}` tuples (93 entries) |

**Functions:**

| Line | Name | Visibility | Notes |
|------|------|-----------|-------|
| 128 | `update_puls_firmware/1` | public | No `conn`; calls CalAmp PULS HTTP API |
| 228 | `bulk_daily_usage_summary/1` | public | No `conn`; writes CSV file; hard-coded dates |
| 320 | `do_health_check/2` | public | action — returns 200 `{}` |
| 324 | `calculate_roi_value/2` | public | action — body is **empty** (no implementation) |
| 328 | `process_incoming_omegawatch_data/2` | public | action — echoes params |
| 333 | `process_prodisplay_event/2` | public | action — 4-key pattern match; writes to three DB tables; dual-customer routing (vx_sssl, vx_mondialevgl) |
| 701 | `parse_prodisplay_thingevent/4` | private | parses event metadata |
| 806 | `parse_prodisplay_thingomega_event/5` | private | parses omega event |
| 923 | `parse_prodisplay_thingomegatires_event/5` | private | parses tires event |
| 982 | `do_error/2` | public | action — reflects arbitrary HTTP status code |
| 991 | `do_geocode_lookup/2` | public | action — lat/long reverse geocode via Geonames/ConCache |
| 1052 | `sync_to_DISCorp/2` | public | action — hard-coded payload; calls DISCorp API |
| 1076 | `sync_vehicles_to_rayven/1` | public | No `conn`; customer-specific allowlist logic |
| 1203 | `test_rental_messages/1` | public | No `conn`; iterates things, actual send is commented out |
| 1445 | `send_vehicle_to_rayven/2` | public | No `conn`; builds and sends vehicle JSON to Rayven |
| 1677 | `send_to_rayven/7` | public | No `conn`; core Rayven HTTP POST; handles nil/empty serialno; logs to DB |
| 1986 | `pull_from_rayven/1` | public | No `conn`; pulls from Rayven API pull endpoint |
| 2009 | `check_out_of_sequence_events/1` | public | No `conn`; analyses event ordering |
| 2078 | `get_tracker_ids/0` | public | No `conn`; queries DeviceDatabaseLookup |
| 2093 | `device_lookup_with_hardware_id/1` | public | No `conn`; DB lookup |
| 2100 | `check_vehicles_for_rental_overage/3` | public | No `conn`; generates CSV + sends email |
| 2280 | `process_monthly_movements/0` | public | No `conn`; reads local CSV files |
| 2463 | `process_pronto/0` | public | No `conn`; reads local CSV file; calls `Vx.get_most_recent_thingevent_with_date` |
| 2821 | `process_ebs/0` | public | No `conn`; reads local CSV file |
| 2972 | `process_ebs_check_service/1` | public | Pure string check; no `conn` |
| 2990 | `process_ebs_get_hour_meter/2` | public | DB query; no `conn` |
| 3036 | `send_local_arrow_data/0` | public | No `conn`; reads CSV + sends to Rayven IOTX8 |
| 3170 | `check_vehicles_for_no_usage_historical/1` | public | No `conn`; writes usage_report.csv |
| 3213 | `process_events_for_next_usage/4` | public | No `conn`; recursive |
| 3298 | `sync_events_to_rayven/0` | public | No `conn`; hard-coded customer `vx_sielift` |
| 3346 | `rayven_login/2` | public | No `conn`; **body is entirely comments** — no implementation |
| 3390 | `get_rayven_devices_for_project/2` | public | No `conn`; calls Rayven external API |
| 3412 | `pull_data_from_rayven/1` | public | No `conn`; calls Rayven apipull endpoint |
| 3453 | `create_equipment/3` | public | No `conn`; creates Equipment record |
| 3524 | `get_equipment_id/2` | public | No `conn`; DB lookup |
| 3533 | `create_equipment_assignment/3` | public | No `conn`; uses `@lookup_olson` for timezone mapping |
| 3596 | `create_rental_records/1` | public | No `conn`; **body is comment only** — no implementation |
| 3600 | `sync_rental_contracts_to_rayven/1` | public | No `conn`; **body returns a bare map literal** — no implementation |
| 3615 | `sync_rental_periods_to_rayven/1` | public | No `conn`; **body returns `%{}`** — no implementation |
| 3623 | `copy_rental_contracts/1` | public | No `conn`; complex rental period + Rayven sync |
| 4647 | `pull_equipment_data_from_rayven/1` | public | No `conn`; iterates customer devices, calls Rayven |
| 4729 | `pull_services_from_rayven/1` | public | No `conn`; calls Rayven apipull + posts to erp-import endpoint |
| 4900 | `refresh_rayven_stream_status/1` | public | No `conn`; async_stream with rescue block |
| 5020 | `sync_historical_events_to_rayven/1` | public | No `conn`; calls `refresh_rayven_stream_status` then dispatches per-unit |
| 5091 | `sync_historical_events_to_rayven/5` | public | No `conn`; overload with `(customer, batch_number, batch_size, tracker_ids, delay)` |
| 5358 | `send_events_to_rayven/6` | public | No `conn`; checks for future dates, prepares and sends events |
| 5416 | `prepare_rayven_events/3` | public | No `conn`; maps events to Rayven payload format |
| 5567 | `check_for_future_date/2` | public | No `conn`; deletes or corrects future-dated events |
| 5666 | `erp_import/2` | public | action — processes ERP rentals and services; `from` email → customer mapping |
| 6025 | `driverid_converter/2` | public | action — converts Wiegand driver IDs |
| 6172 | `get_additional_data/1` | public | No `conn`; reads `vehicle_status.csv` |
| 6225 | `next_service/1` | public | No `conn`; reads `next_services.csv` |
| 6264 | `rayven_ssl_opts/0` | private | builds SSL opts list |
| 6278 | `rayven_cacerts/0` | private | loads CA certs from disk + certifi |
| 5735 | `check_and_save_erp_record/3` | private | saves ERP import record |
| 5758 | `process_rental_from_erp/2` | private | creates/updates rental from ERP payload |
| 5850 | `find_or_make_customer/3` | private | finds or creates VXCustomer |
| 5882 | `process_services_from_erp/2` | private | unused within this file (called nowhere within the module) |
| 5896 | `process_service_from_erp/2` | private | processes a single service record from ERP |
| 6092 | `get_dm_driverid/1` | private | bit-manipulation Wiegand conversion |

---

## Findings

---

### B016-1
**Severity:** HIGH
**File:** `lib/api_server_web/controllers/geofence_controller.ex`
**Finding:** No test file exists for `ApiServerWeb.GeofenceController`, and no indirect test coverage was found anywhere in `test/`. The module contains five public HTTP actions including create, update, and delete operations against a geofence database, plus a complex geofence event processor (`process_things_geofences`).

---

### B016-2
**Severity:** HIGH
**File:** `lib/api_server_web/controllers/page_controller.ex`
**Finding:** No test file exists for `ApiServerWeb.PageController`, and no indirect coverage was found. While this controller contains only a single trivial `index/2` action, the existing `test/api_server_web/views/page_view_test.exs` tests the view layer only and does not exercise the controller action or its rendered output end-to-end.

---

### B016-3
**Severity:** HIGH
**File:** `lib/api_server_web/controllers/pivotel_controller.ex`
**Finding:** No test file exists for `ApiServerWeb.PivotelController`, and no indirect coverage was found. The controller receives XML-wrapped Pivotel satellite device messages, parses them into telemetry records, and delegates to `VXThingEventController.write_partial_record/3`. None of the three `create_update_object/1` clauses, the fallback 500 path, or the `convert_timestamp/1` helper are tested.

---

### B016-4
**Severity:** HIGH
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Finding:** No test file exists for `ApiServerWeb.UtilityController`, and no indirect coverage was found. The module is 6,293 lines and contains approximately 50 public functions, including critical production HTTP actions (`erp_import/2`, `driverid_converter/2`, `do_health_check/2`, `process_prodisplay_event/2`, `do_geocode_lookup/2`, `do_error/2`) and numerous scheduler/batch functions that interact directly with the database and external HTTP APIs (Rayven, CalAmp PULS, DISCorp, Geonames).

---

### B016-5
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/geofence_controller.ex`
**Function:** `create_geofence/2` (line 18)
**Finding:** The failure branch `{:error, error}` at line 29–32 returns a 500 with an `inspect`-formatted error in the response body. This path is untested. A changeset validation error or DB constraint violation would hit this path in production.

---

### B016-6
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/geofence_controller.ex`
**Function:** `update_geofence/2` (line 35)
**Finding:** Two untested failure paths exist: (a) the `geofence == nil` branch at line 52–54, which returns a 500 when no geofence matches the supplied ID; (b) the `status != :ok` branch at line 50, which returns a 500 on update failure.

---

### B016-7
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/geofence_controller.ex`
**Function:** `delete_geofence/2` (line 57)
**Finding:** Two untested failure paths: (a) `geofence` is falsy (nil) → returns 500 "No geofence with that ID to delete" (line 69); (b) `{:error, _}` from `Vx.delete_geofence/2` → returns 500 (line 66).

---

### B016-8
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/geofence_controller.ex`
**Function:** `process_things_geofences/2` (line 73)
**Finding:** No test exercises this action. It calls `Date.from_iso8601!` (bang — raises on bad input), `Timex.to_datetime`, `Vx.get_augmented_thing_with_hardware_id!`, and `Vx.get_geofences_as_map`. Invalid date strings or unknown hardware IDs will raise an uncaught exception, and no test verifies graceful error handling or correct event calculation.

---

### B016-9
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/geofence_controller.ex`
**Function:** `engine_hours_at_event/3` (line 184)
**Finding:** Nine `aadcat` branches (2–9) are completely untested. Branch 4 (`aadcat == 4`, Omega) and branch 5 (`aadcat == 5`, J1939) both execute `Repo.one(Ecto.assoc(event, :thingeventomega))` which can return `nil`, leading to a `nil.totalenginehour` crash. No test verifies any of the nine paths or nil-safety.

---

### B016-10
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/pivotel_controller.ex`
**Function:** `get_pivotel_data/2` (line 4, PSG_MOmsg_send clause)
**Finding:** The happy-path action is untested. It calls `create_update_object/1` then delegates to `VXThingEventController.write_partial_record/3`. No test verifies the `{:ok, "{}"}` response.

---

### B016-11
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/pivotel_controller.ex`
**Function:** `get_pivotel_data/2` (line 15, fallback clause)
**Finding:** The fallback catch-all that returns a 500 is untested. It is reached whenever the `xml` key is missing from params or the XML does not match the expected structure.

---

### B016-12
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/pivotel_controller.ex`
**Function:** `create_update_object/1` — LOCATION clause (line 20) and ACCUM clause (line 63)
**Finding:** Both parsing clauses are untested. The LOCATION clause calls `String.to_float(latitude)` and `String.to_float(longitude)` which will crash if either value is not a valid float string. The ACCUM clause similarly calls `String.to_float/1` three times. No test verifies correct map construction or error resilience.

---

### B016-13
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/pivotel_controller.ex`
**Function:** `create_update_object/1` — fallback clause (line 103)
**Finding:** The fallback clause returns `%{}` when the message does not match known structures. This is then passed to `write_partial_record/3` as an empty map. No test verifies that an unrecognised message is handled gracefully end-to-end.

---

### B016-14
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `erp_import/2` (line 5666)
**Finding:** This is a critical ingestion endpoint used in production by multiple customers (SieLift, CEA, Komatsu AU, Yocam, Redpath). The `from`-to-customer mapping is untested, as are all rental and service processing code paths, the fallback `"vx_dev"` customer for unrecognised senders, the duplicate-check filter logic (`Vx.check_for_existing_erp_record`), and the error branch for `process_rental_from_erp` (line 5832–5834).

---

### B016-15
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `process_prodisplay_event/2` (line 333)
**Finding:** This action contains four deeply nested `case` branches covering ceaomega-only, vx_mondialevgl dual-write, and vx_sssl dual-write paths. Every branch is untested. The action also hard-codes the customer `"vx_ceaomega"` at line 339 regardless of the JWT claim, which means it cannot serve multi-tenant traffic without a code change.

---

### B016-16
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `driverid_converter/2` (line 6025)
**Finding:** The Wiegand bit-manipulation logic in `get_dm_driverid/1` (line 6092) is complex and entirely untested. It calls `String.split_at(driverid, 3)` and `String.to_integer` on the resulting parts without validation — a driverid shorter than 3 characters will produce an empty string, and `String.to_integer("")` will raise `ArgumentError`.

---

### B016-17
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `check_for_future_date/2` (line 5567)
**Finding:** This function permanently deletes events from the database (`Vx.delete_thingevent_record`) when `gmtdatetime - dateinqueue > 3600` seconds. It also modifies event timestamps in-place for smaller differences. Both mutation paths are completely untested. A bug here silently destroys production telemetry data.

---

### B016-18
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `send_to_rayven/7` (line 1677)
**Finding:** The `nil` and `""` serial number branches (lines 1687–1730) silently do nothing (commented-out email code). No test verifies that these silent-drop paths are reached correctly, and a vehicle with no serial number will never emit an error to the caller.

---

### B016-19
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `do_geocode_lookup/2` (line 991)
**Finding:** Uses `Float.parse/1` on user-supplied lat/long, then calls `Geonames.find_nearby_streets_osm/1` and `Geonames.find_nearby_place_name/1` via `ConCache.get_or_store/3`. The `streets` variable at line 1016 has three branches: a single-item map (count == 7), a list (non-nil), and fallback to place name. The single-item branch at line 1016 calls `IO.inspect()` and pipes to `Map.get("name")` — the `IO.inspect` return value is the same map, so it works, but non-string `lat`/`long` params or a nil Geonames response in the fallback will crash unchecked.

---

### B016-20
**Severity:** MEDIUM
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `process_ebs_get_hour_meter/2` (line 2990)
**Finding:** Hard-codes `prefix: "vx_cea_latest"` (line 3002) regardless of the `customer` argument passed in. This means it always queries one specific customer's database. No test exists to detect this customer-scoping bug.

---

### B016-21
**Severity:** LOW
**File:** `lib/api_server_web/controllers/geofence_controller.ex`
**Function:** `check_event_for_left_events/6` (line 132)
**Finding:** The nil-clause guard at line 132 returns bare `[]` (a list) instead of the tuple `{[], []}` that the caller at line 126 destructures into `{fences_still_inside, left_events}`. This is a **latent runtime crash**: if `currently_in_geofences` is `nil`, the pattern match `{fences_still_inside, left_events} = []` will raise `MatchError`. No test covers this nil path.

---

### B016-22
**Severity:** LOW
**File:** `lib/api_server_web/controllers/geofence_controller.ex`
**Function:** `process_things_geofences/2` (line 73)
**Finding:** `from_date` and `to_date` are parsed with `Date.from_iso8601!` (bang). No test verifies error handling for invalid date format strings (e.g., `"not-a-date"`), which would raise `ArgumentError` and produce an unformatted 500 response.

---

### B016-23
**Severity:** LOW
**File:** `lib/api_server_web/controllers/pivotel_controller.ex`
**Function:** `convert_timestamp/1` (line 109)
**Finding:** Uses `NaiveDateTime.from_iso8601!` and `DateTime.from_naive!` (both bang). No test covers a malformed timestamp string, which would raise and crash the process.

---

### B016-24
**Severity:** LOW
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `calculate_roi_value/2` (line 324)
**Finding:** This is a public HTTP action whose body is completely empty (no return value, no response sent to `conn`). Elixir will return `nil` from the function and Phoenix will raise a `Plug.Conn.NotSentError`. No test detects this broken action.

---

### B016-25
**Severity:** LOW
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Functions:** `rayven_login/2` (line 3346), `create_rental_records/1` (line 3596), `sync_rental_contracts_to_rayven/1` (line 3600), `sync_rental_periods_to_rayven/1` (line 3615)
**Finding:** These four public functions have no real implementation: `rayven_login/2` contains only comments; `create_rental_records/1` contains only a comment; `sync_rental_contracts_to_rayven/1` and `sync_rental_periods_to_rayven/1` return bare map literals and do nothing. These stubs are callable from routes or schedulers with no visible indication they are not implemented, and no test documents their stub status.

---

### B016-26
**Severity:** LOW
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `create_equipment_assignment/3` (line 3533)
**Finding:** Uses `@lookup_olson` to map Windows timezone names to Olson names. The lookup at line 3568 returns `nil` if the timezone string is not in the table, setting `mapped_device_group_timezone` to `nil`. No test verifies the timezone-mapping path, the nil fallback, or the "append Standard Time" retry at line 3571.

---

### B016-27
**Severity:** LOW
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `get_additional_data/1` (line 6172) and `next_service/1` (line 6225)
**Finding:** Both functions read local CSV files (`vehicle_status.csv`, `next_services.csv`) using `File.stream!`. If the file does not exist, `File.stream!` raises `File.Error`. In a deployed environment where these files are absent, any call to `send_vehicle_to_rayven/2` will crash. No test verifies the file-present or file-absent behaviour.

---

### B016-28
**Severity:** LOW
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Function:** `erp_import/2` (line 5666) — `process_rental_from_erp/2` sub-call
**Finding:** `process_rental_from_erp/2` at line 5758 calls `Vx.get_rental/4` with a pattern `{:ok, new_rental}` but `Vx.get_rental/4` may also return a plain struct or `nil` (lines 5826–5843). The current match at line 5823–5826 handles `{:ok, new_rental}` but this looks inconsistent with the nil and `existing_rental` clauses below it — the function appears to mix return-value conventions. No test exercises these branches to confirm correctness.

---

### B016-29
**Severity:** INFO
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Finding:** The module contains multiple `IO.puts` and `IO.inspect` calls scattered throughout production action and batch functions (e.g., lines 133, 182, 187, 259, 329, 742, 752, 1019, 1034, 1045, 1071, 1078, 1092, etc.). While not a test coverage gap, these debug statements will log potentially sensitive data (hardware IDs, customer codes, request bodies) to stdout in production. No test verifies or gates their presence.

---

### B016-30
**Severity:** INFO
**File:** `lib/api_server_web/controllers/utility_controller.ex`
**Finding:** The `update_puls_firmware/1` function at line 128 contains API keys for CalAmp PULS hard-coded in comments (lines 140–141): `IwZTptJkQeOxZCoKRKVtI3IrIVwotFW6KRDS8O8OI-RKjmykQ95DPGlEE4yxjqbg` and `1SdeU1293s78waU_2P3vwCInz2oEOe-Rj6_AYqL-FwBzFtsG3n_o5mNsqat5rO4L`. The active key used in the live call at line 146 is also embedded as a string literal. Similarly, `send_to_rayven/7` at line 1747 hard-codes a Rayven UID token. These credentials are committed to source control. This is an informational note for the secrets audit pass; it also means no test can safely exercise these functions without live credential exposure.

---

## Summary Table

| ID | Severity | File | Subject |
|----|----------|------|---------|
| B016-1 | HIGH | geofence_controller.ex | Entire module has no test coverage |
| B016-2 | HIGH | page_controller.ex | Entire module has no test coverage |
| B016-3 | HIGH | pivotel_controller.ex | Entire module has no test coverage |
| B016-4 | HIGH | utility_controller.ex | Entire module (6,293 lines, ~50 public functions) has no test coverage |
| B016-5 | MEDIUM | geofence_controller.ex | `create_geofence/2` error path untested |
| B016-6 | MEDIUM | geofence_controller.ex | `update_geofence/2` nil-geofence and update-failure paths untested |
| B016-7 | MEDIUM | geofence_controller.ex | `delete_geofence/2` nil-geofence and DB-error paths untested |
| B016-8 | MEDIUM | geofence_controller.ex | `process_things_geofences/2` entirely untested; bang functions on user input |
| B016-9 | MEDIUM | geofence_controller.ex | `engine_hours_at_event/3` nine branches untested; nil crash risk on aadcat 4/5 |
| B016-10 | MEDIUM | pivotel_controller.ex | `get_pivotel_data/2` happy path untested |
| B016-11 | MEDIUM | pivotel_controller.ex | `get_pivotel_data/2` fallback 500 path untested |
| B016-12 | MEDIUM | pivotel_controller.ex | `create_update_object/1` LOCATION and ACCUM clauses untested; `String.to_float` on unvalidated input |
| B016-13 | MEDIUM | pivotel_controller.ex | `create_update_object/1` fallback clause passes `%{}` to downstream untested |
| B016-14 | MEDIUM | utility_controller.ex | `erp_import/2` critical ingestion endpoint entirely untested |
| B016-15 | MEDIUM | utility_controller.ex | `process_prodisplay_event/2` complex multi-customer routing entirely untested; hard-coded customer |
| B016-16 | MEDIUM | utility_controller.ex | `driverid_converter/2` and `get_dm_driverid/1` bit-manipulation untested; crash on short input |
| B016-17 | MEDIUM | utility_controller.ex | `check_for_future_date/2` silently deletes/modifies DB records, entirely untested |
| B016-18 | MEDIUM | utility_controller.ex | `send_to_rayven/7` nil/empty serial silent-drop paths untested |
| B016-19 | MEDIUM | utility_controller.ex | `do_geocode_lookup/2` Geonames nil response and street-count branches untested |
| B016-20 | MEDIUM | utility_controller.ex | `process_ebs_get_hour_meter/2` hard-codes customer prefix regardless of argument |
| B016-21 | LOW | geofence_controller.ex | `check_event_for_left_events/6` nil clause returns `[]` not `{[], []}` — latent `MatchError` |
| B016-22 | LOW | geofence_controller.ex | Bang date parsing in `process_things_geofences/2` — no invalid-input test |
| B016-23 | LOW | pivotel_controller.ex | Bang timestamp parsing in `convert_timestamp/1` — no invalid-input test |
| B016-24 | LOW | utility_controller.ex | `calculate_roi_value/2` has empty body — will raise `NotSentError` in production |
| B016-25 | LOW | utility_controller.ex | Four stub functions with no implementation are publicly callable |
| B016-26 | LOW | utility_controller.ex | `create_equipment_assignment/3` timezone-lookup nil path untested |
| B016-27 | LOW | utility_controller.ex | `get_additional_data/1` and `next_service/1` read local CSV files; crash if absent |
| B016-28 | LOW | utility_controller.ex | `process_rental_from_erp/2` mixed return-value conventions on `Vx.get_rental/4` |
| B016-29 | INFO | utility_controller.ex | Pervasive `IO.puts`/`IO.inspect` debug logging in production code |
| B016-30 | INFO | utility_controller.ex | API keys and Rayven UID tokens hard-coded as string literals in source |
